<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-2"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-3"></a><span class="hs-comment">-- Module      :  File.Format.TNT.Command.XRead</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- Copyright   :  (c) 2015-2015 Ward Wheeler</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- License     :  BSD-style</span><span>
</span><a name="line-6"></a><span class="hs-comment">--</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- Maintainer  :  wheeler@amnh.org</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- Stability   :  provisional</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- Portability :  portable</span><span>
</span><a name="line-10"></a><span class="hs-comment">--</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- Parser for the XREAD command sepecifying the collection of the taxa set</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- and thier corresponding sequences. Sequences are well typed and may be</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- specified as contiguous segments of character types.</span><span>
</span><a name="line-14"></a><span class="hs-comment">----------------------------------------------------------------------------- </span><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts, TypeFamilies #-}</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">File</span><span class="hs-operator">.</span><span class="hs-identifier">Format</span><span class="hs-operator">.</span><span class="hs-identifier">TNT</span><span class="hs-operator">.</span><span class="hs-identifier">Command</span><span class="hs-operator">.</span><span class="hs-identifier">XRead</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span class="hs-comment">{-- TODO:
  - Robust tests
  - Good documentation
  - Organize this jumbled monolith
  -}</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Bifunctor</span><span>           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">second</span><span class="hs-special">)</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Bits</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">CaseInsensitive</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Char</span><span>                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isSpace</span><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">DList</span><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-type">DList</span><span class="hs-special">,</span><span class="hs-identifier hs-var">append</span><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">DList</span><span>         </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">DL</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concat</span><span class="hs-special">,</span><span class="hs-identifier hs-var">fromList</span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Foldable</span><span>            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toList</span><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Functor</span><span>             </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">$&gt;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Key</span><span>                 </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span class="hs-operator">.</span><span class="hs-identifier">NonEmpty</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-type">NonEmpty</span><span class="hs-special">)</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span class="hs-operator">.</span><span class="hs-identifier">NonEmpty</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">NE</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">filter</span><span class="hs-special">,</span><span class="hs-identifier hs-var">fromList</span><span class="hs-special">,</span><span class="hs-identifier hs-var">length</span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span class="hs-operator">.</span><span class="hs-identifier">Utility</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Map</span><span>                 </span><span class="hs-special">(</span><span class="hs-identifier hs-var">assocs</span><span class="hs-special">,</span><span class="hs-identifier hs-var">insertWith</span><span class="hs-special">,</span><span class="hs-identifier hs-var">lookup</span><span class="hs-special">)</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">catMaybes</span><span class="hs-special">,</span><span class="hs-identifier hs-var">fromJust</span><span class="hs-special">,</span><span class="hs-identifier hs-var">isJust</span><span class="hs-special">)</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Semigroup</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Traversable</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span>           </span><a href="File.Format.TNT.Internal.html"><span class="hs-identifier">File</span><span class="hs-operator">.</span><span class="hs-identifier">Format</span><span class="hs-operator">.</span><span class="hs-identifier">TNT</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span></a><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Prelude</span><span>           </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lookup</span><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Megaparsec</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Megaparsec</span><span class="hs-operator">.</span><span class="hs-identifier">Char</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span>           </span><a href="Text.Megaparsec.Custom.html"><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Megaparsec</span><span class="hs-operator">.</span><span class="hs-identifier">Custom</span></a><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-51"></a><span class="hs-comment">-- Parses an XREAD command. Correctly validates for taxa count and character</span><span>
</span><a name="line-52"></a><span class="hs-comment">-- sequence length. Produces one or more taxa sequences.</span><span>
</span><a name="line-53"></a><span class="hs-identifier">xreadCommand</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FoldCase</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Tokens</span><span> </span><a href="#local-6989586621679125381"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125382"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125381"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125383"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679125381"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679125383"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="File.Format.TNT.Internal.html#XRead"><span class="hs-identifier hs-type">XRead</span></a><span>
</span><a name="line-54"></a><a name="xreadCommand"><a href="File.Format.TNT.Command.XRead.html#xreadCommand"><span class="hs-identifier">xreadCommand</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679125385"><span class="hs-identifier hs-var">xreadValidation</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="#local-6989586621679125384"><span class="hs-identifier hs-var">xreadDefinition</span></a><span>
</span><a name="line-55"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-56"></a><span>    </span><span class="hs-identifier">xreadDefinition</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FoldCase</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Tokens</span><span> </span><a href="#local-6989586621679125386"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125387"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125386"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125388"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679125386"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679125388"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">NonEmpty</span><span> </span><a href="File.Format.TNT.Internal.html#TaxonInfo"><span class="hs-identifier hs-type">TaxonInfo</span></a><span class="hs-special">)</span><span>
</span><a name="line-57"></a><span>    </span><a name="local-6989586621679125384"><a href="#local-6989586621679125384"><span class="hs-identifier">xreadDefinition</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">uncurry</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#xreadPreamble"><span class="hs-identifier hs-var">xreadPreamble</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#xreadSequences"><span class="hs-identifier hs-var">xreadSequences</span></a><span> </span><span class="hs-operator hs-var">&lt;*</span><span> </span><a href="File.Format.TNT.Internal.html#symbol"><span class="hs-identifier hs-var">symbol</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">';'</span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span>    </span><span class="hs-identifier">xreadValidation</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125389"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125390"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125391"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-comment">{- , Token s ~ Char -}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">NonEmpty</span><span> </span><a href="File.Format.TNT.Internal.html#TaxonInfo"><span class="hs-identifier hs-type">TaxonInfo</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679125391"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="File.Format.TNT.Internal.html#XRead"><span class="hs-identifier hs-type">XRead</span></a><span>
</span><a name="line-60"></a><span>    </span><a name="local-6989586621679125385"><a href="#local-6989586621679125385"><span class="hs-identifier">xreadValidation</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679125392"><a href="#local-6989586621679125392"><span class="hs-identifier">charCount</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679125393"><a href="#local-6989586621679125393"><span class="hs-identifier">taxaCount</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679125394"><a href="#local-6989586621679125394"><span class="hs-identifier">taxaSeqs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679125395"><span class="hs-identifier hs-var">errors</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="File.Format.TNT.Internal.html#XRead"><span class="hs-identifier hs-var">XRead</span></a><span> </span><a href="#local-6989586621679125392"><span class="hs-identifier hs-var">charCount</span></a><span> </span><a href="#local-6989586621679125393"><span class="hs-identifier hs-var">taxaCount</span></a><span> </span><a href="#local-6989586621679125394"><span class="hs-identifier hs-var">taxaSeqs</span></a><span>
</span><a name="line-62"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Text.Megaparsec.Custom.html#fails"><span class="hs-identifier hs-var">fails</span></a><span> </span><a href="#local-6989586621679125395"><span class="hs-identifier hs-var">errors</span></a><span>
</span><a name="line-63"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-64"></a><span>        </span><a name="local-6989586621679125395"><a href="#local-6989586621679125395"><span class="hs-identifier">errors</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">catMaybes</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679125396"><span class="hs-identifier hs-var">taxaCountError</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679125397"><span class="hs-identifier hs-var">charCountError</span></a><span class="hs-special">]</span><span>
</span><a name="line-65"></a><span>        </span><a name="local-6989586621679125396"><a href="#local-6989586621679125396"><span class="hs-identifier">taxaCountError</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679125399"><a href="#local-6989586621679125399"><span class="hs-identifier">taxaLength</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">NE</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679125394"><span class="hs-identifier hs-var">taxaSeqs</span></a><span>
</span><a name="line-66"></a><span>                         </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679125393"><span class="hs-identifier hs-var">taxaCount</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679125399"><span class="hs-identifier hs-var">taxaLength</span></a><span>
</span><a name="line-67"></a><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-68"></a><span>                            </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">concat</span><span>
</span><a name="line-69"></a><span>                              </span><span class="hs-special">[</span><span> </span><span class="hs-string">&quot;The number of taxa specified (&quot;</span><span>
</span><a name="line-70"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679125393"><span class="hs-identifier hs-var">taxaCount</span></a><span>
</span><a name="line-71"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;) does not match the number of taxa found (&quot;</span><span>
</span><a name="line-72"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679125394"><span class="hs-identifier hs-var">taxaSeqs</span></a><span>
</span><a name="line-73"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-74"></a><span>                              </span><span class="hs-special">]</span><span>
</span><a name="line-75"></a><span>
</span><a name="line-76"></a><span>        </span><a name="local-6989586621679125397"><a href="#local-6989586621679125397"><span class="hs-identifier">charCountError</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">NE</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679125392"><span class="hs-identifier hs-var">charCount</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-identifier hs-var">length</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679125394"><span class="hs-identifier hs-var">taxaSeqs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-77"></a><span>                           </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-78"></a><span>                           </span><a name="local-6989586621679125400"><a href="#local-6989586621679125400"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">concat</span><span>
</span><a name="line-79"></a><span>                              </span><span class="hs-special">[</span><span> </span><span class="hs-string">&quot;The number of characters specified (&quot;</span><span>
</span><a name="line-80"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679125392"><span class="hs-identifier hs-var">charCount</span></a><span>
</span><a name="line-81"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;) does not match the number of chararacters found for the following taxa:\n&quot;</span><span>
</span><a name="line-82"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unlines</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679125398"><span class="hs-identifier hs-var">prettyPrint</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679125400"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-83"></a><span>                              </span><span class="hs-special">]</span><span>                            </span><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span>        </span><a name="local-6989586621679125398"><a href="#local-6989586621679125398"><span class="hs-identifier">prettyPrint</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679125401"><a href="#local-6989586621679125401"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679125402"><a href="#local-6989586621679125402"><span class="hs-identifier">num</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;\t&quot;</span><span class="hs-special">,</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679125401"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span class="hs-string">&quot; found (&quot;</span><span class="hs-special">,</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679125402"><span class="hs-identifier hs-var">num</span></a><span class="hs-special">,</span><span class="hs-string">&quot;) characters&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-89"></a><span class="hs-comment">-- Consumes everything in the XREAD command prior to the taxa sequences.</span><span>
</span><a name="line-90"></a><span class="hs-comment">-- Produces the expected taxa count and the length of the character sequences.</span><span>
</span><a name="line-91"></a><span class="hs-identifier">xreadPreamble</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FoldCase</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Tokens</span><span> </span><a href="#local-6989586621679125378"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125379"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125378"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125380"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679125378"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679125380"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-92"></a><a name="xreadPreamble"><a href="File.Format.TNT.Command.XRead.html#xreadPreamble"><span class="hs-identifier">xreadPreamble</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Command.XRead.html#xreadHeader"><span class="hs-identifier hs-var">xreadHeader</span></a><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#xreadCharCount"><span class="hs-identifier hs-var">xreadCharCount</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#xreadTaxaCount"><span class="hs-identifier hs-var">xreadTaxaCount</span></a><span class="hs-special">)</span><span>
</span><a name="line-93"></a><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-96"></a><span class="hs-comment">-- The superflous information of an XREAD command.</span><span>
</span><a name="line-97"></a><span class="hs-comment">-- Consumes the XREAD string identifier and zero or more comments</span><span>
</span><a name="line-98"></a><span class="hs-comment">-- preceeding the taxa count and character cound parameters</span><span>
</span><a name="line-99"></a><span class="hs-identifier">xreadHeader</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FoldCase</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Tokens</span><span> </span><a href="#local-6989586621679125375"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125376"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125375"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125377"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679125375"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679125377"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-100"></a><a name="xreadHeader"><a href="File.Format.TNT.Command.XRead.html#xreadHeader"><span class="hs-identifier">xreadHeader</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><a href="File.Format.TNT.Internal.html#symbol"><span class="hs-identifier hs-var">symbol</span></a><span> </span><span class="hs-special">(</span><a href="File.Format.TNT.Internal.html#keyword"><span class="hs-identifier hs-var">keyword</span></a><span> </span><span class="hs-string">&quot;xread&quot;</span><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span>            </span><span class="hs-operator hs-var">*&gt;</span><span> </span><span class="hs-identifier hs-var">many</span><span> </span><a href="#local-6989586621679125403"><span class="hs-identifier hs-var">simpleComment</span></a><span>
</span><a name="line-102"></a><span>            </span><span class="hs-operator hs-var">$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-103"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-104"></a><span>    </span><a name="local-6989586621679125403"><a href="#local-6989586621679125403"><span class="hs-identifier">simpleComment</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679125404"><span class="hs-identifier hs-var">delimiter</span></a><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="Text.Megaparsec.Custom.html#anythingTill"><span class="hs-identifier hs-var">anythingTill</span></a><span> </span><a href="#local-6989586621679125404"><span class="hs-identifier hs-var">delimiter</span></a><span> </span><span class="hs-operator hs-var">&lt;*</span><span> </span><a href="File.Format.TNT.Internal.html#symbol"><span class="hs-identifier hs-var">symbol</span></a><span> </span><a href="#local-6989586621679125404"><span class="hs-identifier hs-var">delimiter</span></a><span>
</span><a name="line-105"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-106"></a><span>        </span><a name="local-6989586621679125404"><a href="#local-6989586621679125404"><span class="hs-identifier">delimiter</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'\''</span><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span>
</span><a name="line-109"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-110"></a><span class="hs-comment">-- The number of taxa present in the XREAD command.</span><span>
</span><a name="line-111"></a><span class="hs-comment">-- __Naturally__ this number must be a positive integer.</span><span>
</span><a name="line-112"></a><span class="hs-identifier">xreadTaxaCount</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125372"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125373"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125374"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679125373"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679125374"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-113"></a><a name="xreadTaxaCount"><a href="File.Format.TNT.Command.XRead.html#xreadTaxaCount"><span class="hs-identifier">xreadTaxaCount</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Internal.html#symbol"><span class="hs-identifier hs-var">symbol</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="File.Format.TNT.Internal.html#flexiblePositiveInt"><span class="hs-identifier hs-var">flexiblePositiveInt</span></a><span> </span><span class="hs-string">&quot;taxa count&quot;</span><span> </span><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-117"></a><span class="hs-comment">-- The number of characters in a taxon sequence for this XREAD command.</span><span>
</span><a name="line-118"></a><span class="hs-comment">-- __Naturally__ this number must be a non-negative integer.</span><span>
</span><a name="line-119"></a><span class="hs-identifier">xreadCharCount</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125369"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125370"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125371"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679125370"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679125371"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-120"></a><a name="xreadCharCount"><a href="File.Format.TNT.Command.XRead.html#xreadCharCount"><span class="hs-identifier">xreadCharCount</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Internal.html#symbol"><span class="hs-identifier hs-var">symbol</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="File.Format.TNT.Internal.html#flexibleNonNegativeInt"><span class="hs-identifier hs-var">flexibleNonNegativeInt</span></a><span> </span><span class="hs-string">&quot;character count&quot;</span><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-124"></a><span class="hs-comment">-- Reads one or more taxon sequences.</span><span>
</span><a name="line-125"></a><span class="hs-comment">-- Performs deinterleaving of identically named taxon sequences. </span><span>
</span><a name="line-126"></a><span class="hs-comment">-- ==== __Examples__</span><span>
</span><a name="line-127"></a><span class="hs-comment">--</span><span>
</span><a name="line-128"></a><span class="hs-comment">-- Basic usage:</span><span>
</span><a name="line-129"></a><span class="hs-comment">--</span><span>
</span><a name="line-130"></a><span class="hs-comment">-- &gt;&gt;&gt; parse xreadSequences &quot;&quot; &quot;taxonOne GATACA\ntaxonTwo GGAATT&quot;</span><span>
</span><a name="line-131"></a><span class="hs-comment">-- Right [ (&quot;taxonOne&quot;, &quot;GATACA&quot;)</span><span>
</span><a name="line-132"></a><span class="hs-comment">--       , (&quot;taxonTwo&quot;, &quot;GGAATT&quot;)</span><span>
</span><a name="line-133"></a><span class="hs-comment">--       ]</span><span>
</span><a name="line-134"></a><span class="hs-comment">--</span><span>
</span><a name="line-135"></a><span class="hs-comment">-- Interleaved usage:</span><span>
</span><a name="line-136"></a><span class="hs-comment">--</span><span>
</span><a name="line-137"></a><span class="hs-comment">-- &gt;&gt;&gt; parse xreadSequences &quot;&quot; &quot;taxonOne GATACA\ntaxonTwo GGAATT\ntaxonOne ACATAG\ntaxonTwo CCGATC\n&quot;</span><span>
</span><a name="line-138"></a><span class="hs-comment">-- Right [ (&quot;taxonOne&quot;, &quot;GATACAACATAG&quot;)</span><span>
</span><a name="line-139"></a><span class="hs-comment">--       , (&quot;taxonTwo&quot;, &quot;GGAATTCCGATC&quot;)</span><span>
</span><a name="line-140"></a><span class="hs-comment">--       ]</span><span>
</span><a name="line-141"></a><span class="hs-identifier">xreadSequences</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FoldCase</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Tokens</span><span> </span><a href="#local-6989586621679125366"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125367"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125366"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125368"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679125366"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679125368"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">NonEmpty</span><span> </span><a href="File.Format.TNT.Internal.html#TaxonInfo"><span class="hs-identifier hs-type">TaxonInfo</span></a><span class="hs-special">)</span><span>
</span><a name="line-142"></a><a name="xreadSequences"><a href="File.Format.TNT.Command.XRead.html#xreadSequences"><span class="hs-identifier">xreadSequences</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">NE</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679125405"><span class="hs-identifier hs-var">deinterleaveTaxa</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#taxonSequence"><span class="hs-identifier hs-var">taxonSequence</span></a><span>
</span><a name="line-143"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-144"></a><span>    </span><a name="local-6989586621679125405"><a href="#local-6989586621679125405"><span class="hs-identifier">deinterleaveTaxa</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">assocs</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="#local-6989586621679125406"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-145"></a><span>    </span><a name="local-6989586621679125406"><a href="#local-6989586621679125406"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679125407"><a href="#local-6989586621679125407"><span class="hs-identifier">taxaName</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679125408"><a href="#local-6989586621679125408"><span class="hs-identifier">taxonSeq</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">insertWith</span><span> </span><span class="hs-identifier hs-var">append</span><span> </span><a href="#local-6989586621679125407"><span class="hs-identifier hs-var">taxaName</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DL</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><a href="#local-6989586621679125408"><span class="hs-identifier hs-var">taxonSeq</span></a><span class="hs-special">)</span><span>
</span><a name="line-146"></a><span>
</span><a name="line-147"></a><span>
</span><a name="line-148"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-149"></a><span class="hs-comment">-- Parses a taxon name and sequence of characters for a given character.</span><span>
</span><a name="line-150"></a><span class="hs-comment">-- Character values can be one of 64 states ordered @[0..9,A..Z,a..z]@ and</span><span>
</span><a name="line-151"></a><span class="hs-comment">-- also the Chars @\'-\'@ &amp; @\'?\'@.</span><span>
</span><a name="line-152"></a><span class="hs-comment">-- Taxon name cannot contain spaces or the @\';\'@ character.</span><span>
</span><a name="line-153"></a><span class="hs-identifier">taxonSequence</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FoldCase</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Tokens</span><span> </span><a href="#local-6989586621679125363"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125364"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125363"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125365"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679125363"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679125365"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">NonEmpty</span><span> </span><a href="File.Format.TNT.Internal.html#TaxonInfo"><span class="hs-identifier hs-type">TaxonInfo</span></a><span class="hs-special">)</span><span>
</span><a name="line-154"></a><a name="taxonSequence"><a href="File.Format.TNT.Command.XRead.html#taxonSequence"><span class="hs-identifier">taxonSequence</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">NE</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">DL</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">some</span><span> </span><a href="File.Format.TNT.Command.XRead.html#taxonSequenceSegment"><span class="hs-identifier hs-var">taxonSequenceSegment</span></a><span>
</span><a name="line-155"></a><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-158"></a><span class="hs-comment">-- Parses the taxon name prepending a taxon sequence. A taxon name cannot begin</span><span>
</span><a name="line-159"></a><span class="hs-comment">-- with with the prefix '&quot;&amp;[&quot;' as this make the taxon name ambiguous with a</span><span>
</span><a name="line-160"></a><span class="hs-comment">-- character type segmentation specifcation. Taxon names cannot contain the</span><span>
</span><a name="line-161"></a><span class="hs-comment">-- characters '&quot;().;&quot;' as this makes it impossible to parse other things that I</span><span>
</span><a name="line-162"></a><span class="hs-comment">-- forget. Maybe I'll remember and add that info some day.</span><span>
</span><a name="line-163"></a><span class="hs-identifier">taxonName</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125360"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125361"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125362"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679125361"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679125362"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-164"></a><a name="taxonName"><a href="File.Format.TNT.Command.XRead.html#taxonName"><span class="hs-identifier">taxonName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">notFollowedBy</span><span> </span><a href="#local-6989586621679125410"><span class="hs-identifier hs-var">openingSequence</span></a><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><span class="hs-identifier hs-var">some</span><span> </span><a href="#local-6989586621679125409"><span class="hs-identifier hs-var">validNameChar</span></a><span>
</span><a name="line-165"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-166"></a><span>    </span><a name="local-6989586621679125409"><a href="#local-6989586621679125409"><span class="hs-identifier">validNameChar</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">satisfy</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679125411"><a href="#local-6989586621679125411"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">isSpace</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679125411"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679125411"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">notElem</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot;(),;&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-167"></a><span>    </span><a name="local-6989586621679125410"><a href="#local-6989586621679125410"><span class="hs-identifier">openingSequence</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'&amp;'</span><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'['</span><span> </span><span class="hs-operator hs-var">$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-168"></a><span>
</span><a name="line-169"></a><span>
</span><a name="line-170"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-171"></a><span class="hs-comment">-- Represents a partial taxon sequence. The sequence segment can either have it's</span><span>
</span><a name="line-172"></a><span class="hs-comment">-- character type specified explicitly by a tag or the sequence segment will be</span><span>
</span><a name="line-173"></a><span class="hs-comment">-- interpreted as the default discrete character type.</span><span>
</span><a name="line-174"></a><span class="hs-identifier">taxonSequenceSegment</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FoldCase</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Tokens</span><span> </span><a href="#local-6989586621679125357"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125358"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125357"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125359"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679125357"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679125359"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">DList</span><span> </span><a href="File.Format.TNT.Internal.html#TaxonInfo"><span class="hs-identifier hs-type">TaxonInfo</span></a><span class="hs-special">)</span><span>
</span><a name="line-175"></a><a name="taxonSequenceSegment"><a href="File.Format.TNT.Command.XRead.html#taxonSequenceSegment"><span class="hs-identifier">taxonSequenceSegment</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">choice</span><span>
</span><a name="line-176"></a><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">try</span><span> </span><a href="File.Format.TNT.Command.XRead.html#taggedInterleaveBlock"><span class="hs-identifier hs-var">taggedInterleaveBlock</span></a><span>
</span><a name="line-177"></a><span>    </span><span class="hs-special">,</span><span>    </span><a href="File.Format.TNT.Command.XRead.html#defaultInterleaveBlock"><span class="hs-identifier hs-var">defaultInterleaveBlock</span></a><span>
</span><a name="line-178"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-179"></a><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-182"></a><span class="hs-comment">-- The default sequence segment type is of discrete characters.</span><span>
</span><a name="line-183"></a><span class="hs-identifier">defaultInterleaveBlock</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125354"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125355"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125356"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679125355"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679125356"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">DList</span><span> </span><a href="File.Format.TNT.Internal.html#TaxonInfo"><span class="hs-identifier hs-type">TaxonInfo</span></a><span class="hs-special">)</span><span>
</span><a name="line-184"></a><a name="defaultInterleaveBlock"><a href="File.Format.TNT.Command.XRead.html#defaultInterleaveBlock"><span class="hs-identifier">defaultInterleaveBlock</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Command.XRead.html#discreteSegments"><span class="hs-identifier hs-var">discreteSegments</span></a><span>
</span><a name="line-185"></a><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span class="hs-comment">-- Sequence definitions</span><span>
</span><a name="line-188"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span>
</span><a name="line-191"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-192"></a><span class="hs-comment">-- A sequence segment consisting of real valued literals or '?' characters to</span><span>
</span><a name="line-193"></a><span class="hs-comment">-- represent a missing value.</span><span>
</span><a name="line-194"></a><span class="hs-identifier">continuousSequence</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125351"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125352"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125353"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679125352"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679125353"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><a href="File.Format.TNT.Internal.html#TntContinuousCharacter"><span class="hs-identifier hs-type">TntContinuousCharacter</span></a><span class="hs-special">]</span><span>
</span><a name="line-195"></a><a name="continuousSequence"><a href="File.Format.TNT.Command.XRead.html#continuousSequence"><span class="hs-identifier">continuousSequence</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">many</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679125413"><span class="hs-identifier hs-var">missingValue</span></a><span> </span><span class="hs-operator hs-var">&lt;|&gt;</span><span> </span><a href="#local-6989586621679125412"><span class="hs-identifier hs-var">presentValue</span></a><span class="hs-special">)</span><span>
</span><a name="line-196"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-197"></a><span>    </span><a name="local-6989586621679125412"><a href="#local-6989586621679125412"><span class="hs-identifier">presentValue</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span>       </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Text.Megaparsec.Custom.html#double"><span class="hs-identifier hs-var">double</span></a><span>   </span><span class="hs-operator hs-var">&lt;*</span><span> </span><a href="File.Format.TNT.Internal.html#whitespaceInline"><span class="hs-identifier hs-var">whitespaceInline</span></a><span>
</span><a name="line-198"></a><span>    </span><a name="local-6989586621679125413"><a href="#local-6989586621679125413"><span class="hs-identifier">missingValue</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>    </span><span class="hs-operator hs-var">&lt;$</span><span>  </span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'?'</span><span> </span><span class="hs-operator hs-var">&lt;*</span><span> </span><a href="File.Format.TNT.Internal.html#whitespaceInline"><span class="hs-identifier hs-var">whitespaceInline</span></a><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span>
</span><a name="line-201"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-202"></a><span class="hs-comment">-- Parses a collection of discrete characters.</span><span>
</span><a name="line-203"></a><span class="hs-comment">-- Intended to be reused as a primative for other XREAD combinators.</span><span>
</span><a name="line-204"></a><span class="hs-identifier">coreDiscreteSequenceThatGetsReused</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125348"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125349"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125350"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679125349"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679125350"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><a href="File.Format.TNT.Internal.html#TntDiscreteCharacter"><span class="hs-identifier hs-type">TntDiscreteCharacter</span></a><span class="hs-special">]</span><span>
</span><a name="line-205"></a><a name="coreDiscreteSequenceThatGetsReused"><a href="File.Format.TNT.Command.XRead.html#coreDiscreteSequenceThatGetsReused"><span class="hs-identifier">coreDiscreteSequenceThatGetsReused</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">many</span><span> </span><a href="#local-6989586621679125414"><span class="hs-identifier hs-var">discreteCharacter</span></a><span>
</span><a name="line-206"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-207"></a><span>    </span><a name="local-6989586621679125414"><a href="#local-6989586621679125414"><span class="hs-identifier">discreteCharacter</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679125416"><span class="hs-identifier hs-var">ambiguityCharacter</span></a><span> </span><span class="hs-operator hs-var">&lt;|&gt;</span><span> </span><a href="#local-6989586621679125415"><span class="hs-identifier hs-var">singletonCharacter</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;*</span><span> </span><a href="File.Format.TNT.Internal.html#whitespaceInline"><span class="hs-identifier hs-var">whitespaceInline</span></a><span>
</span><a name="line-208"></a><span>    </span><a name="local-6989586621679125415"><a href="#local-6989586621679125415"><span class="hs-identifier">singletonCharacter</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679125418"><span class="hs-identifier hs-var">bitPack</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679125417"><span class="hs-identifier hs-var">stateToken</span></a><span>
</span><a name="line-209"></a><span>    </span><a name="local-6989586621679125416"><a href="#local-6989586621679125416"><span class="hs-identifier">ambiguityCharacter</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679125418"><span class="hs-identifier hs-var">bitPack</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679125419"><span class="hs-identifier hs-var">validateAmbiguityGroup</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#withinBraces"><span class="hs-identifier hs-var">withinBraces</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">many</span><span> </span><a href="#local-6989586621679125417"><span class="hs-identifier hs-var">stateToken</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-210"></a><span>    </span><a name="local-6989586621679125417"><a href="#local-6989586621679125417"><span class="hs-identifier">stateToken</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Internal.html#characterStateChar"><span class="hs-identifier hs-var">characterStateChar</span></a><span> </span><span class="hs-operator hs-var">&lt;*</span><span> </span><a href="File.Format.TNT.Internal.html#whitespaceInline"><span class="hs-identifier hs-var">whitespaceInline</span></a><span>
</span><a name="line-211"></a><span>    </span><a name="local-6989586621679125418"><a href="#local-6989586621679125418"><span class="hs-identifier">bitPack</span></a></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.|.</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">zeroBits</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">catMaybes</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">lookup</span><span class="hs-special">`</span><span> </span><a href="File.Format.TNT.Internal.html#deserializeStateDiscrete"><span class="hs-identifier hs-var">deserializeStateDiscrete</span></a><span class="hs-special">)</span><span>
</span><a name="line-212"></a><span>    </span><a name="local-6989586621679125419"><a href="#local-6989586621679125419"><span class="hs-identifier">validateAmbiguityGroup</span></a></a><span> </span><a name="local-6989586621679125420"><a href="#local-6989586621679125420"><span class="hs-identifier">xs</span></a></a><span>
</span><a name="line-213"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679125420"><span class="hs-identifier hs-var">xs</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fail</span><span>   </span><span class="hs-string">&quot;An ambiguity group containing no character states was found.&quot;</span><span>
</span><a name="line-214"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679125421"><span class="hs-identifier hs-var">hasDupes</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;An ambiguity group contains duplicate character states: &quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679125422"><span class="hs-identifier hs-var">dupes</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;.&quot;</span><span>
</span><a name="line-215"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679125423"><span class="hs-identifier hs-var">hasMissing</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fail</span><span>   </span><span class="hs-string">&quot;An ambiguity group contains a \&quot;missing data\&quot; character state: '?'.&quot;</span><span>
</span><a name="line-216"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679125424"><span class="hs-identifier hs-var">hasGap</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fail</span><span>   </span><span class="hs-string">&quot;An ambiguity group contains a \&quot;gap\&quot; character state: '-'.&quot;</span><span>
</span><a name="line-217"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679125420"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-218"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-219"></a><span>        </span><a name="local-6989586621679125421"><a href="#local-6989586621679125421"><span class="hs-identifier">hasDupes</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679125422"><span class="hs-identifier hs-var">dupes</span></a><span>
</span><a name="line-220"></a><span>        </span><a name="local-6989586621679125422"><a href="#local-6989586621679125422"><span class="hs-identifier">dupes</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">duplicates</span><span> </span><a href="#local-6989586621679125420"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-221"></a><span>        </span><a name="local-6989586621679125423"><a href="#local-6989586621679125423"><span class="hs-identifier">hasMissing</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-char">'?'</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679125420"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isSingleton</span><span> </span><a href="#local-6989586621679125420"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-222"></a><span>        </span><a name="local-6989586621679125424"><a href="#local-6989586621679125424"><span class="hs-identifier">hasGap</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-char">'-'</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679125420"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isSingleton</span><span> </span><a href="#local-6989586621679125420"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-223"></a><span>
</span><a name="line-224"></a><span>
</span><a name="line-225"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-226"></a><span class="hs-comment">-- A sequence consisting of characters states which are a prefix of the list:</span><span>
</span><a name="line-227"></a><span class="hs-comment">-- '&quot;?-&quot; &lt;&gt; [\'0\'..\'9\'] &lt;&gt; [\'a\'..\'z\'] &lt;&gt; [\'A\'..\'Z\']'. Ambiguity</span><span>
</span><a name="line-228"></a><span class="hs-comment">-- groups are specified by braces enclosing two or more state values. Results</span><span>
</span><a name="line-229"></a><span class="hs-comment">-- are bitpacked into a 64 bit structure with the ordering specified by</span><span>
</span><a name="line-230"></a><span class="hs-comment">-- 'TntDiscreteCharacter'.</span><span>
</span><a name="line-231"></a><span class="hs-comment">--</span><span>
</span><a name="line-232"></a><span class="hs-comment">-- Remeber that you can never have the character literal @'-'@ mean gap. It means</span><span>
</span><a name="line-233"></a><span class="hs-comment">-- missing. Why not use @'?'@ and just say what you mean? We'll never know.</span><span>
</span><a name="line-234"></a><span class="hs-comment">-- So we substitute gaps for missing in discrete charcters.</span><span>
</span><a name="line-235"></a><span class="hs-identifier">discreteSequence</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125345"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125346"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125347"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679125346"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679125347"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><a href="File.Format.TNT.Internal.html#TntDiscreteCharacter"><span class="hs-identifier hs-type">TntDiscreteCharacter</span></a><span class="hs-special">]</span><span>
</span><a name="line-236"></a><a name="discreteSequence"><a href="File.Format.TNT.Command.XRead.html#discreteSequence"><span class="hs-identifier">discreteSequence</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679125427"><span class="hs-identifier hs-var">substituteGapForMissingBecauseOfReasonsIllNeverUnderstand</span></a><span> </span><a href="File.Format.TNT.Command.XRead.html#coreDiscreteSequenceThatGetsReused"><span class="hs-identifier hs-var">coreDiscreteSequenceThatGetsReused</span></a><span>
</span><a name="line-237"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-238"></a><span>    </span><a name="local-6989586621679125425"><a href="#local-6989586621679125425"><span class="hs-identifier">gapOnlyChar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Internal.html#deserializeStateDiscrete"><span class="hs-identifier hs-var">deserializeStateDiscrete</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-char">'-'</span><span>
</span><a name="line-239"></a><span>    </span><a name="local-6989586621679125426"><a href="#local-6989586621679125426"><span class="hs-identifier">missingChar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Internal.html#deserializeStateDiscrete"><span class="hs-identifier hs-var">deserializeStateDiscrete</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-char">'?'</span><span>
</span><a name="line-240"></a><span>    </span><a name="local-6989586621679125427"><a href="#local-6989586621679125427"><span class="hs-identifier">substituteGapForMissingBecauseOfReasonsIllNeverUnderstand</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621679125428"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-241"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-242"></a><span>        </span><a name="local-6989586621679125428"><a href="#local-6989586621679125428"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679125429"><a href="#local-6989586621679125429"><span class="hs-identifier">c</span></a></a><span>
</span><a name="line-243"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679125429"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><a href="#local-6989586621679125425"><span class="hs-identifier hs-var">gapOnlyChar</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-identifier hs-var">zeroBits</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679125426"><span class="hs-identifier hs-var">missingChar</span></a><span>
</span><a name="line-244"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679125429"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-245"></a><span>
</span><a name="line-246"></a><span>
</span><a name="line-247"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-248"></a><span class="hs-comment">-- A sequence segment containing dna character states. This sequence segment</span><span>
</span><a name="line-249"></a><span class="hs-comment">-- can contain IUPAC codes which will be converted to abiguity groups, or</span><span>
</span><a name="line-250"></a><span class="hs-comment">-- explicit ambiguity group notation with braces. Ambiguity groups are</span><span>
</span><a name="line-251"></a><span class="hs-comment">-- bitpacked into 8 bit structures with the bit ordering specified by</span><span>
</span><a name="line-252"></a><span class="hs-comment">-- 'TntDnaCharacter'.</span><span>
</span><a name="line-253"></a><span class="hs-identifier">dnaSequence</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125342"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125343"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125344"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679125343"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679125344"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><a href="File.Format.TNT.Internal.html#TntDnaCharacter"><span class="hs-identifier hs-type">TntDnaCharacter</span></a><span class="hs-special">]</span><span>
</span><a name="line-254"></a><a name="dnaSequence"><a href="File.Format.TNT.Command.XRead.html#dnaSequence"><span class="hs-identifier">dnaSequence</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="File.Format.TNT.Command.XRead.html#discreteToDna"><span class="hs-identifier hs-var">discreteToDna</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#coreDiscreteSequenceThatGetsReused"><span class="hs-identifier hs-var">coreDiscreteSequenceThatGetsReused</span></a><span>
</span><a name="line-255"></a><span>
</span><a name="line-256"></a><span>
</span><a name="line-257"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-258"></a><span class="hs-comment">-- A sequence segment containing protein character states. This sequence segment</span><span>
</span><a name="line-259"></a><span class="hs-comment">-- can contain IUPAC codes which will be converted to abiguity groups, or</span><span>
</span><a name="line-260"></a><span class="hs-comment">-- explicit ambiguity group notation with braces. Ambiguity groups are bitpacked</span><span>
</span><a name="line-261"></a><span class="hs-comment">-- into 8 bit structures with the bit ordering specified by 'TntProteinCharacter'.</span><span>
</span><a name="line-262"></a><span class="hs-identifier">proteinSequence</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125339"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125340"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125341"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679125340"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679125341"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><a href="File.Format.TNT.Internal.html#TntProteinCharacter"><span class="hs-identifier hs-type">TntProteinCharacter</span></a><span class="hs-special">]</span><span>
</span><a name="line-263"></a><a name="proteinSequence"><a href="File.Format.TNT.Command.XRead.html#proteinSequence"><span class="hs-identifier">proteinSequence</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="File.Format.TNT.Command.XRead.html#discreteToProtein"><span class="hs-identifier hs-var">discreteToProtein</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#coreDiscreteSequenceThatGetsReused"><span class="hs-identifier hs-var">coreDiscreteSequenceThatGetsReused</span></a><span>
</span><a name="line-264"></a><span>
</span><a name="line-265"></a><span>
</span><a name="line-266"></a><span class="hs-comment">-- Sequence normalization &amp; support</span><span>
</span><a name="line-267"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-268"></a><span>
</span><a name="line-269"></a><span>
</span><a name="line-270"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-271"></a><span class="hs-comment">-- A conversion function from a discrete character ambiguity group to a dna</span><span>
</span><a name="line-272"></a><span class="hs-comment">-- character ambiguity group. The mapping is not injective and unmatched</span><span>
</span><a name="line-273"></a><span class="hs-comment">-- discrete character values will result in a parse error being raised.</span><span>
</span><a name="line-274"></a><span class="hs-identifier">discreteToDna</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125336"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125337"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125338"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-comment">{- , Token s ~ Char -}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="File.Format.TNT.Internal.html#TntDiscreteCharacter"><span class="hs-identifier hs-type">TntDiscreteCharacter</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679125338"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="File.Format.TNT.Internal.html#TntDnaCharacter"><span class="hs-identifier hs-type">TntDnaCharacter</span></a><span>
</span><a name="line-275"></a><a name="discreteToDna"><a href="File.Format.TNT.Command.XRead.html#discreteToDna"><span class="hs-identifier">discreteToDna</span></a></a><span> </span><a name="local-6989586621679125430"><a href="#local-6989586621679125430"><span class="hs-identifier">character</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.|.</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">zeroBits</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621679125433"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679125431"><span class="hs-identifier hs-var">flags</span></a><span>
</span><a name="line-276"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-277"></a><span>    </span><a name="local-6989586621679125431"><a href="#local-6989586621679125431"><span class="hs-identifier">flags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Internal.html#bitsToFlags"><span class="hs-identifier hs-var">bitsToFlags</span></a><span> </span><a href="#local-6989586621679125430"><span class="hs-identifier hs-var">character</span></a><span>
</span><a name="line-278"></a><span>    </span><a name="local-6989586621679125432"><a href="#local-6989586621679125432"><span class="hs-identifier">toDna</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">lookup</span><span class="hs-special">`</span><span> </span><a href="File.Format.TNT.Internal.html#deserializeStateDna"><span class="hs-identifier hs-var">deserializeStateDna</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><a href="File.Format.TNT.Internal.html#serializeStateDiscrete"><span class="hs-identifier hs-var">serializeStateDiscrete</span></a><span> </span><span class="hs-glyph">!</span><span class="hs-special">)</span><span>
</span><a name="line-279"></a><span>    </span><a name="local-6989586621679125433"><a href="#local-6989586621679125433"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679125434"><a href="#local-6989586621679125434"><span class="hs-identifier">x</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679125432"><span class="hs-identifier hs-var">toDna</span></a><span> </span><a href="#local-6989586621679125434"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-280"></a><span>              </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;The character state '&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-special">[</span><a href="File.Format.TNT.Internal.html#serializeStateDiscrete"><span class="hs-identifier hs-var">serializeStateDiscrete</span></a><span> </span><span class="hs-glyph">!</span><span> </span><a href="#local-6989586621679125434"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;' is not a valid DNA character state.&quot;</span><span> </span><span>
</span><a name="line-281"></a><span>              </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679125435"><a href="#local-6989586621679125435"><span class="hs-identifier">b</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679125435"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-282"></a><span>
</span><a name="line-283"></a><span>
</span><a name="line-284"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-285"></a><span class="hs-comment">-- A conversion function from a discrete character ambiguity group to a</span><span>
</span><a name="line-286"></a><span class="hs-comment">-- protein character ambiguity group. The mapping is not injective and</span><span>
</span><a name="line-287"></a><span class="hs-comment">-- unmatched discrete character values will result in a parse error being</span><span>
</span><a name="line-288"></a><span class="hs-comment">-- raised.</span><span>
</span><a name="line-289"></a><span class="hs-identifier">discreteToProtein</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125333"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125334"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125335"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-comment">{- , Token s ~ Char -}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="File.Format.TNT.Internal.html#TntDiscreteCharacter"><span class="hs-identifier hs-type">TntDiscreteCharacter</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679125335"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="File.Format.TNT.Internal.html#TntProteinCharacter"><span class="hs-identifier hs-type">TntProteinCharacter</span></a><span>
</span><a name="line-290"></a><a name="discreteToProtein"><a href="File.Format.TNT.Command.XRead.html#discreteToProtein"><span class="hs-identifier">discreteToProtein</span></a></a><span> </span><a name="local-6989586621679125436"><a href="#local-6989586621679125436"><span class="hs-identifier">character</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.|.</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">zeroBits</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621679125439"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679125437"><span class="hs-identifier hs-var">flags</span></a><span>
</span><a name="line-291"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-292"></a><span>    </span><a name="local-6989586621679125437"><a href="#local-6989586621679125437"><span class="hs-identifier">flags</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Internal.html#bitsToFlags"><span class="hs-identifier hs-var">bitsToFlags</span></a><span> </span><a href="#local-6989586621679125436"><span class="hs-identifier hs-var">character</span></a><span>
</span><a name="line-293"></a><span>    </span><a name="local-6989586621679125438"><a href="#local-6989586621679125438"><span class="hs-identifier">toProtein</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">lookup</span><span class="hs-special">`</span><span> </span><a href="File.Format.TNT.Internal.html#deserializeStateProtein"><span class="hs-identifier hs-var">deserializeStateProtein</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><a href="File.Format.TNT.Internal.html#serializeStateDiscrete"><span class="hs-identifier hs-var">serializeStateDiscrete</span></a><span> </span><span class="hs-glyph">!</span><span class="hs-special">)</span><span>
</span><a name="line-294"></a><span>    </span><a name="local-6989586621679125439"><a href="#local-6989586621679125439"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679125440"><a href="#local-6989586621679125440"><span class="hs-identifier">x</span></a></a><span>       </span><span class="hs-glyph">=</span><span>
</span><a name="line-295"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679125438"><span class="hs-identifier hs-var">toProtein</span></a><span> </span><a href="#local-6989586621679125440"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-296"></a><span>          </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;The character state '&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-special">[</span><a href="File.Format.TNT.Internal.html#serializeStateDiscrete"><span class="hs-identifier hs-var">serializeStateDiscrete</span></a><span> </span><span class="hs-glyph">!</span><span> </span><a href="#local-6989586621679125440"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;' is not a valid amino acid character state.&quot;</span><span> </span><span>
</span><a name="line-297"></a><span>          </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679125441"><a href="#local-6989586621679125441"><span class="hs-identifier">b</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679125441"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-298"></a><span>
</span><a name="line-299"></a><span>
</span><a name="line-300"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-301"></a><span class="hs-comment">-- Represents the terminal character sequence for a chatacter sequence.</span><span>
</span><a name="line-302"></a><span class="hs-comment">-- Nomenclature ambiguities /are fun!/</span><span>
</span><a name="line-303"></a><span class="hs-identifier">segmentTerminal</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125330"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125331"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125332"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679125331"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679125332"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">Char</span><span>
</span><a name="line-304"></a><a name="segmentTerminal"><a href="File.Format.TNT.Command.XRead.html#segmentTerminal"><span class="hs-identifier">segmentTerminal</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Internal.html#whitespaceInline"><span class="hs-identifier hs-var">whitespaceInline</span></a><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="Text.Megaparsec.Custom.html#endOfLine"><span class="hs-identifier hs-var">endOfLine</span></a><span> </span><span class="hs-operator hs-var">&lt;*</span><span> </span><a href="File.Format.TNT.Internal.html#whitespace"><span class="hs-identifier hs-var">whitespace</span></a><span>
</span><a name="line-305"></a><span>
</span><a name="line-306"></a><span>
</span><a name="line-307"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-308"></a><span class="hs-comment">-- Takes a 'zeroBits' bit value, a 'Foldable' structure of 'Char's to represent</span><span>
</span><a name="line-309"></a><span class="hs-comment">-- the ordered alphabet and a 'Traversable' structure of 'Char's to be bit</span><span>
</span><a name="line-310"></a><span class="hs-comment">-- encoded. Constructs a bit value with a bit set for each 'Char' in the</span><span>
</span><a name="line-311"></a><span class="hs-comment">-- 'Traversable' structure where the index of the set bit in the bit value is</span><span>
</span><a name="line-312"></a><span class="hs-comment">-- equal to the index of where the 'Char' first occured in the ordered alphabet</span><span>
</span><a name="line-313"></a><span class="hs-comment">-- 'Foldable' structure.</span><span>
</span><a name="line-314"></a><span class="hs-comment">--</span><span>
</span><a name="line-315"></a><span class="hs-comment">-- ==== __Examples__</span><span>
</span><a name="line-316"></a><span class="hs-comment">--</span><span>
</span><a name="line-317"></a><span class="hs-comment">-- Basic usage:</span><span>
</span><a name="line-318"></a><span class="hs-comment">--</span><span>
</span><a name="line-319"></a><span class="hs-comment">-- &gt;&gt;&gt; toBits (zeroBits :: Word8) &quot;Example&quot; &quot;alex&quot;</span><span>
</span><a name="line-320"></a><span class="hs-comment">-- 102</span><span>
</span><a name="line-321"></a><span class="hs-identifier">toBits</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bits</span><span> </span><a href="#local-6989586621679125327"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Foldable</span><span> </span><a href="#local-6989586621679125328"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Traversable</span><span> </span><a href="#local-6989586621679125329"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679125327"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679125328"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-identifier hs-type">Char</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679125329"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-identifier hs-type">Char</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679125327"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-322"></a><a name="toBits"><a href="File.Format.TNT.Command.XRead.html#toBits"><span class="hs-identifier">toBits</span></a></a><span> </span><a name="local-6989586621679125442"><a href="#local-6989586621679125442"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679125443"><a href="#local-6989586621679125443"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.|.</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679125442"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621679125444"><span class="hs-identifier hs-var">setFlag</span></a><span> </span><span>
</span><a name="line-323"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-324"></a><span>    </span><a name="local-6989586621679125444"><a href="#local-6989586621679125444"><span class="hs-identifier">setFlag</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">bit</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="#local-6989586621679125445"><span class="hs-identifier hs-var">getIndex</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679125443"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-325"></a><span>    </span><a name="local-6989586621679125445"><a href="#local-6989586621679125445"><span class="hs-identifier">getIndex</span></a></a><span> </span><a name="local-6989586621679125446"><a href="#local-6989586621679125446"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromJust</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">foldl</span><span> </span><a href="#local-6989586621679125447"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-326"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-327"></a><span>        </span><a name="local-6989586621679125447"><a href="#local-6989586621679125447"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679125448"><a href="#local-6989586621679125448"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679125449"><a href="#local-6989586621679125449"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679125450"><a href="#local-6989586621679125450"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679125451"><a href="#local-6989586621679125451"><span class="hs-identifier">x</span></a></a><span>
</span><a name="line-328"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isJust</span><span> </span><a href="#local-6989586621679125450"><span class="hs-identifier hs-var">m</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679125448"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-329"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679125446"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679125451"><span class="hs-identifier hs-var">x</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679125449"><span class="hs-identifier hs-var">i</span></a><span>  </span><span class="hs-special">,</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679125449"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-330"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679125449"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><span>
</span><a name="line-331"></a><span>
</span><a name="line-332"></a><span>
</span><a name="line-333"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-334"></a><span class="hs-comment">-- Represents a sequence segement tag specification identified by the</span><span>
</span><a name="line-335"></a><span class="hs-comment">-- parameter combinator.</span><span>
</span><a name="line-336"></a><span class="hs-identifier">tagIdentifier</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125323"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125324"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125325"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679125324"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679125325"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679125326"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679125325"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-337"></a><a name="tagIdentifier"><a href="File.Format.TNT.Command.XRead.html#tagIdentifier"><span class="hs-identifier">tagIdentifier</span></a></a><span> </span><a name="local-6989586621679125452"><a href="#local-6989586621679125452"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Internal.html#symbol"><span class="hs-identifier hs-var">symbol</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'&amp;'</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="File.Format.TNT.Internal.html#symbol"><span class="hs-identifier hs-var">symbol</span></a><span> </span><span class="hs-special">(</span><a href="File.Format.TNT.Command.XRead.html#withinBraces"><span class="hs-identifier hs-var">withinBraces</span></a><span> </span><a href="#local-6989586621679125452"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-338"></a><span>
</span><a name="line-339"></a><span>
</span><a name="line-340"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-341"></a><span class="hs-comment">-- Represents the parameter combinator within braces.</span><span>
</span><a name="line-342"></a><span class="hs-identifier">withinBraces</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125319"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125320"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125321"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679125320"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679125321"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679125322"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679125321"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679125322"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-343"></a><a name="withinBraces"><a href="File.Format.TNT.Command.XRead.html#withinBraces"><span class="hs-identifier">withinBraces</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">between</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679125453"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-char">'['</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679125453"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-char">']'</span><span class="hs-special">)</span><span>
</span><a name="line-344"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-345"></a><span>    </span><a name="local-6989586621679125453"><a href="#local-6989586621679125453"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679125454"><a href="#local-6989586621679125454"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">char</span><span> </span><a href="#local-6989586621679125454"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">&lt;*</span><span> </span><a href="File.Format.TNT.Internal.html#whitespaceInline"><span class="hs-identifier hs-var">whitespaceInline</span></a><span> </span><span>
</span><a name="line-346"></a><span>
</span><a name="line-347"></a><span>
</span><a name="line-348"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-349"></a><span class="hs-comment">-- An append efficient datastructure containing 'TntCharacter's.</span><span>
</span><a name="line-350"></a><span class="hs-comment">-- Used to efficiently concatenat many interleaved taxon sequence segments.</span><span>
</span><a name="line-351"></a><span class="hs-keyword">type</span><span> </span><a name="TntCharacterSegment"><a href="File.Format.TNT.Command.XRead.html#TntCharacterSegment"><span class="hs-identifier">TntCharacterSegment</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">DList</span><span> </span><a href="File.Format.TNT.Internal.html#TntCharacter"><span class="hs-identifier hs-type">TntCharacter</span></a><span>
</span><a name="line-352"></a><span>
</span><a name="line-353"></a><span>
</span><a name="line-354"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-355"></a><span class="hs-comment">-- Different possible tags specifications for a given sequence segment.</span><span>
</span><a name="line-356"></a><span class="hs-keyword">data</span><span> </span><a name="XReadTag"><a href="File.Format.TNT.Command.XRead.html#XReadTag"><span class="hs-identifier">XReadTag</span></a></a><span>
</span><a name="line-357"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a name="TagContinuous"><a href="File.Format.TNT.Command.XRead.html#TagContinuous"><span class="hs-identifier">TagContinuous</span></a></a><span>
</span><a name="line-358"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a name="TagDna"><a href="File.Format.TNT.Command.XRead.html#TagDna"><span class="hs-identifier">TagDna</span></a></a><span>
</span><a name="line-359"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a name="TagProtein"><a href="File.Format.TNT.Command.XRead.html#TagProtein"><span class="hs-identifier">TagProtein</span></a></a><span>
</span><a name="line-360"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a name="TagNumeric"><a href="File.Format.TNT.Command.XRead.html#TagNumeric"><span class="hs-identifier">TagNumeric</span></a></a><span>
</span><a name="line-361"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a name="TagGaps"><a href="File.Format.TNT.Command.XRead.html#TagGaps"><span class="hs-identifier">TagGaps</span></a></a><span>
</span><a name="line-362"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a name="TagNoGaps"><a href="File.Format.TNT.Command.XRead.html#TagNoGaps"><span class="hs-identifier">TagNoGaps</span></a></a><span>
</span><a name="line-363"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a name="TagTrimHead"><a href="File.Format.TNT.Command.XRead.html#TagTrimHead"><span class="hs-identifier">TagTrimHead</span></a></a><span>
</span><a name="line-364"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a name="TagTrimTail"><a href="File.Format.TNT.Command.XRead.html#TagTrimTail"><span class="hs-identifier">TagTrimTail</span></a></a><span>
</span><a name="line-365"></a><span>   </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-366"></a><span>
</span><a name="line-367"></a><span>
</span><a name="line-368"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-369"></a><span class="hs-comment">-- Different possible parse interpretations derived from a sequence segment tag.</span><span>
</span><a name="line-370"></a><span class="hs-keyword">data</span><span> </span><a name="XReadParseType"><a href="File.Format.TNT.Command.XRead.html#XReadParseType"><span class="hs-identifier">XReadParseType</span></a></a><span>
</span><a name="line-371"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a name="ParseContinuous"><a href="File.Format.TNT.Command.XRead.html#ParseContinuous"><span class="hs-identifier">ParseContinuous</span></a></a><span>
</span><a name="line-372"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a name="ParseDna"><a href="File.Format.TNT.Command.XRead.html#ParseDna"><span class="hs-identifier">ParseDna</span></a></a><span>
</span><a name="line-373"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a name="ParseNumeric"><a href="File.Format.TNT.Command.XRead.html#ParseNumeric"><span class="hs-identifier">ParseNumeric</span></a></a><span>
</span><a name="line-374"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a name="ParseProtein"><a href="File.Format.TNT.Command.XRead.html#ParseProtein"><span class="hs-identifier">ParseProtein</span></a></a><span>
</span><a name="line-375"></a><span>   </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">)</span><span>
</span><a name="line-376"></a><span>
</span><a name="line-377"></a><span>
</span><a name="line-378"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-379"></a><span class="hs-comment">-- The complete parse interpretation context derived from a sequence segment tag.</span><span>
</span><a name="line-380"></a><span class="hs-keyword">data</span><span> </span><a name="XReadInterpretation"><a href="File.Format.TNT.Command.XRead.html#XReadInterpretation"><span class="hs-identifier">XReadInterpretation</span></a></a><span>
</span><a name="line-381"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a name="XReadInterpretation"><a href="File.Format.TNT.Command.XRead.html#XReadInterpretation"><span class="hs-identifier">XReadInterpretation</span></a></a><span>
</span><a name="line-382"></a><span>   </span><span class="hs-special">{</span><span> </span><a name="parseType"><a href="File.Format.TNT.Command.XRead.html#parseType"><span class="hs-identifier">parseType</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="File.Format.TNT.Command.XRead.html#XReadParseType"><span class="hs-identifier hs-type">XReadParseType</span></a><span>
</span><a name="line-383"></a><span>   </span><span class="hs-special">,</span><span> </span><a name="parseGaps"><a href="File.Format.TNT.Command.XRead.html#parseGaps"><span class="hs-identifier">parseGaps</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-384"></a><span>   </span><span class="hs-special">,</span><span> </span><a name="parseTrimHead"><a href="File.Format.TNT.Command.XRead.html#parseTrimHead"><span class="hs-identifier">parseTrimHead</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-385"></a><span>   </span><span class="hs-special">,</span><span> </span><a name="parseTrimTail"><a href="File.Format.TNT.Command.XRead.html#parseTrimTail"><span class="hs-identifier">parseTrimTail</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-386"></a><span>   </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">)</span><span>
</span><a name="line-387"></a><span>
</span><a name="line-388"></a><span>
</span><a name="line-389"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-390"></a><span class="hs-comment">-- Parses a tagged sequence segment. First parses a sequence segment tag.</span><span>
</span><a name="line-391"></a><span class="hs-comment">-- Then validates that mutually exclusive tags do not exist. Parses a sequence</span><span>
</span><a name="line-392"></a><span class="hs-comment">-- segment based on the contextual information derived from the sequence segment</span><span>
</span><a name="line-393"></a><span class="hs-comment">-- tag. Applies any transformations to the sequence segment that were specified</span><span>
</span><a name="line-394"></a><span class="hs-comment">-- by the sequence segment tag context.</span><span>
</span><a name="line-395"></a><span class="hs-identifier">taggedInterleaveBlock</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FoldCase</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Tokens</span><span> </span><a href="#local-6989586621679125316"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125317"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125316"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125318"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679125316"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679125318"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">DList</span><span> </span><a href="File.Format.TNT.Internal.html#TaxonInfo"><span class="hs-identifier hs-type">TaxonInfo</span></a><span class="hs-special">)</span><span>
</span><a name="line-396"></a><a name="taggedInterleaveBlock"><a href="File.Format.TNT.Command.XRead.html#taggedInterleaveBlock"><span class="hs-identifier">taggedInterleaveBlock</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Command.XRead.html#nightmare"><span class="hs-identifier hs-var">nightmare</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#xreadTags"><span class="hs-identifier hs-var">xreadTags</span></a><span>
</span><a name="line-397"></a><span>
</span><a name="line-398"></a><span>
</span><a name="line-399"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-400"></a><span class="hs-comment">-- &#8220;Beware that, when ~~fighting monsters~~ writing parsers,</span><span>
</span><a name="line-401"></a><span class="hs-comment">--    you yourself do not become a monster...</span><span>
</span><a name="line-402"></a><span class="hs-comment">--    for when you gaze long into the abyss,</span><span>
</span><a name="line-403"></a><span class="hs-comment">--    the abyss gazes also into you.&#8221;</span><span>
</span><a name="line-404"></a><span class="hs-comment">--</span><span>
</span><a name="line-405"></a><span class="hs-comment">-- In all seriousness, interpreting the tags correctly is messy.</span><span>
</span><a name="line-406"></a><span class="hs-identifier">nightmare</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125313"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125314"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125315"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679125314"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#XReadInterpretation"><span class="hs-identifier hs-type">XReadInterpretation</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679125315"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">DList</span><span> </span><a href="File.Format.TNT.Internal.html#TaxonInfo"><span class="hs-identifier hs-type">TaxonInfo</span></a><span class="hs-special">)</span><span>
</span><a name="line-407"></a><a name="nightmare"><a href="File.Format.TNT.Command.XRead.html#nightmare"><span class="hs-identifier">nightmare</span></a></a><span> </span><a name="local-6989586621679125455"><a href="#local-6989586621679125455"><span class="hs-identifier">interpretation</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679125459"><span class="hs-identifier hs-var">transformation</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679125460"><span class="hs-identifier hs-var">segment</span></a><span>
</span><a name="line-408"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-409"></a><span>    </span><a name="local-6989586621679125456"><a href="#local-6989586621679125456"><span class="hs-identifier">applyGapsToMissings</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">parseGaps</span><span>     </span><a href="#local-6989586621679125455"><span class="hs-identifier hs-var">interpretation</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="File.Format.TNT.Command.XRead.html#gapsToMissings"><span class="hs-identifier hs-var">gapsToMissings</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-410"></a><span>    </span><a name="local-6989586621679125457"><a href="#local-6989586621679125457"><span class="hs-identifier">applyTrimHead</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span>       </span><span class="hs-identifier">parseTrimHead</span><span> </span><a href="#local-6989586621679125455"><span class="hs-identifier hs-var">interpretation</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="File.Format.TNT.Command.XRead.html#trimHead"><span class="hs-identifier hs-var">trimHead</span></a><span>       </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-411"></a><span>    </span><a name="local-6989586621679125458"><a href="#local-6989586621679125458"><span class="hs-identifier">applyTrimTail</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span>       </span><span class="hs-identifier">parseTrimTail</span><span> </span><a href="#local-6989586621679125455"><span class="hs-identifier hs-var">interpretation</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="File.Format.TNT.Command.XRead.html#trimTail"><span class="hs-identifier hs-var">trimTail</span></a><span>       </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-412"></a><span>    </span><a name="local-6989586621679125459"><a href="#local-6989586621679125459"><span class="hs-identifier">transformation</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679125456"><span class="hs-identifier hs-var">applyGapsToMissings</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679125458"><span class="hs-identifier hs-var">applyTrimTail</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679125457"><span class="hs-identifier hs-var">applyTrimHead</span></a><span>
</span><a name="line-413"></a><span>    </span><a name="local-6989586621679125460"><a href="#local-6989586621679125460"><span class="hs-identifier">segment</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">parseType</span><span> </span><a href="#local-6989586621679125455"><span class="hs-identifier hs-var">interpretation</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-414"></a><span>                </span><a href="File.Format.TNT.Command.XRead.html#ParseContinuous"><span class="hs-identifier hs-var">ParseContinuous</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#continuousSegments"><span class="hs-identifier hs-var">continuousSegments</span></a><span>
</span><a name="line-415"></a><span>                </span><a href="File.Format.TNT.Command.XRead.html#ParseDna"><span class="hs-identifier hs-var">ParseDna</span></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#dnaSegments"><span class="hs-identifier hs-var">dnaSegments</span></a><span>
</span><a name="line-416"></a><span>                </span><a href="File.Format.TNT.Command.XRead.html#ParseNumeric"><span class="hs-identifier hs-var">ParseNumeric</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#discreteSegments"><span class="hs-identifier hs-var">discreteSegments</span></a><span>
</span><a name="line-417"></a><span>                </span><a href="File.Format.TNT.Command.XRead.html#ParseProtein"><span class="hs-identifier hs-var">ParseProtein</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#proteinSegments"><span class="hs-identifier hs-var">proteinSegments</span></a><span>
</span><a name="line-418"></a><span>
</span><a name="line-419"></a><span>
</span><a name="line-420"></a><span class="hs-identifier">continuousSegments</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dnaSegments</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">discreteSegments</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">proteinSegments</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125310"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125311"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125312"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679125311"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679125312"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">DList</span><span> </span><a href="File.Format.TNT.Internal.html#TaxonInfo"><span class="hs-identifier hs-type">TaxonInfo</span></a><span class="hs-special">)</span><span>
</span><a name="line-421"></a><span>
</span><a name="line-422"></a><span>
</span><a name="line-423"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-424"></a><span class="hs-comment">-- Parses one or more continuous sequence segments.</span><span>
</span><a name="line-425"></a><a name="continuousSegments"><a href="File.Format.TNT.Command.XRead.html#continuousSegments"><span class="hs-identifier">continuousSegments</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Command.XRead.html#segmentsOf"><span class="hs-identifier hs-var">segmentsOf</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="File.Format.TNT.Internal.html#Continuous"><span class="hs-identifier hs-var">Continuous</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#continuousSequence"><span class="hs-identifier hs-var">continuousSequence</span></a><span class="hs-special">)</span><span>
</span><a name="line-426"></a><span>
</span><a name="line-427"></a><span>
</span><a name="line-428"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-429"></a><span class="hs-comment">-- Parses one or more dna sequence segments.</span><span>
</span><a name="line-430"></a><a name="dnaSegments"><a href="File.Format.TNT.Command.XRead.html#dnaSegments"><span class="hs-identifier">dnaSegments</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Command.XRead.html#segmentsOf"><span class="hs-identifier hs-var">segmentsOf</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="File.Format.TNT.Internal.html#Dna"><span class="hs-identifier hs-var">Dna</span></a><span>        </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#dnaSequence"><span class="hs-identifier hs-var">dnaSequence</span></a><span class="hs-special">)</span><span>
</span><a name="line-431"></a><span>
</span><a name="line-432"></a><span>
</span><a name="line-433"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-434"></a><span class="hs-comment">-- Parses one or more discrete sequence segments.</span><span>
</span><a name="line-435"></a><a name="discreteSegments"><a href="File.Format.TNT.Command.XRead.html#discreteSegments"><span class="hs-identifier">discreteSegments</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Command.XRead.html#segmentsOf"><span class="hs-identifier hs-var">segmentsOf</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="File.Format.TNT.Internal.html#Discrete"><span class="hs-identifier hs-var">Discrete</span></a><span>   </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#discreteSequence"><span class="hs-identifier hs-var">discreteSequence</span></a><span class="hs-special">)</span><span>
</span><a name="line-436"></a><span>
</span><a name="line-437"></a><span>
</span><a name="line-438"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-439"></a><span class="hs-comment">-- Parses one or more protein sequence segments.</span><span>
</span><a name="line-440"></a><a name="proteinSegments"><a href="File.Format.TNT.Command.XRead.html#proteinSegments"><span class="hs-identifier">proteinSegments</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Command.XRead.html#segmentsOf"><span class="hs-identifier hs-var">segmentsOf</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="File.Format.TNT.Internal.html#Protein"><span class="hs-identifier hs-var">Protein</span></a><span>    </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#proteinSequence"><span class="hs-identifier hs-var">proteinSequence</span></a><span class="hs-special">)</span><span>
</span><a name="line-441"></a><span>
</span><a name="line-442"></a><span>
</span><a name="line-443"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-444"></a><span class="hs-comment">-- Parses one or more of the parameter sequence segment combinator.</span><span>
</span><a name="line-445"></a><span class="hs-comment">-- Combinators are seperated by 'segmentTerminal'</span><span>
</span><a name="line-446"></a><span class="hs-identifier">segmentsOf</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125307"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125308"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125309"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679125308"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679125309"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><a href="File.Format.TNT.Internal.html#TntCharacter"><span class="hs-identifier hs-type">TntCharacter</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679125309"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">DList</span><span> </span><a href="File.Format.TNT.Internal.html#TaxonInfo"><span class="hs-identifier hs-type">TaxonInfo</span></a><span class="hs-special">)</span><span>
</span><a name="line-447"></a><a name="segmentsOf"><a href="File.Format.TNT.Command.XRead.html#segmentsOf"><span class="hs-identifier">segmentsOf</span></a></a><span> </span><a name="local-6989586621679125461"><a href="#local-6989586621679125461"><span class="hs-identifier">seqDef</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">DL</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="File.Format.TNT.Internal.html#symbol"><span class="hs-identifier hs-var">symbol</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679125462"><span class="hs-identifier hs-var">segment</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">sepEndBy1</span><span class="hs-special">`</span><span> </span><a href="File.Format.TNT.Command.XRead.html#segmentTerminal"><span class="hs-identifier hs-var">segmentTerminal</span></a><span class="hs-special">)</span><span>
</span><a name="line-448"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-449"></a><span>    </span><a name="local-6989586621679125462"><a href="#local-6989586621679125462"><span class="hs-identifier">segment</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="File.Format.TNT.Command.XRead.html#taxonName"><span class="hs-identifier hs-var">taxonName</span></a><span> </span><span class="hs-operator hs-var">&lt;*</span><span> </span><a href="File.Format.TNT.Internal.html#whitespaceInline"><span class="hs-identifier hs-var">whitespaceInline</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621679125461"><span class="hs-identifier hs-var">seqDef</span></a><span>
</span><a name="line-450"></a><span>
</span><a name="line-451"></a><span>
</span><a name="line-452"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-453"></a><span class="hs-comment">-- Replaces gap chracters with missing characters. Correctly handles ambiguity</span><span>
</span><a name="line-454"></a><span class="hs-comment">-- groups.</span><span>
</span><a name="line-455"></a><span class="hs-identifier">gapsToMissings</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DList</span><span> </span><a href="File.Format.TNT.Internal.html#TaxonInfo"><span class="hs-identifier hs-type">TaxonInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DList</span><span> </span><a href="File.Format.TNT.Internal.html#TaxonInfo"><span class="hs-identifier hs-type">TaxonInfo</span></a><span>
</span><a name="line-456"></a><a name="gapsToMissings"><a href="File.Format.TNT.Command.XRead.html#gapsToMissings"><span class="hs-identifier">gapsToMissings</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621679125463"><span class="hs-identifier hs-var">gapToMissing</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-457"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-458"></a><span>    </span><a name="local-6989586621679125463"><a href="#local-6989586621679125463"><span class="hs-identifier">gapToMissing</span></a></a><span> </span><a name="local-6989586621679125464"><a href="#local-6989586621679125464"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="File.Format.TNT.Internal.html#Continuous"><span class="hs-identifier hs-var">Continuous</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679125464"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-459"></a><span>    </span><span class="hs-identifier">gapToMissing</span><span> </span><a name="local-6989586621679125465"><a href="#local-6989586621679125465"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="File.Format.TNT.Internal.html#Dna"><span class="hs-identifier hs-var">Dna</span></a><span> </span><a name="local-6989586621679125466"><a href="#local-6989586621679125466"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-460"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679125466"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">testBit</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679125467"><span class="hs-identifier hs-var">gapBit</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Internal.html#Dna"><span class="hs-identifier hs-var">Dna</span></a><span> </span><a href="#local-6989586621679125468"><span class="hs-identifier hs-var">missing</span></a><span>
</span><a name="line-461"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679125465"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-462"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-463"></a><span>        </span><a name="local-6989586621679125467"><a href="#local-6989586621679125467"><span class="hs-identifier">gapBit</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Internal.html#findFirstSet"><span class="hs-identifier hs-var">findFirstSet</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="File.Format.TNT.Internal.html#deserializeStateDna"><span class="hs-identifier hs-var">deserializeStateDna</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-char">'-'</span><span>
</span><a name="line-464"></a><span>        </span><a name="local-6989586621679125468"><a href="#local-6989586621679125468"><span class="hs-identifier">missing</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Internal.html#deserializeStateDna"><span class="hs-identifier hs-var">deserializeStateDna</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-char">'?'</span><span>
</span><a name="line-465"></a><span>    </span><span class="hs-identifier">gapToMissing</span><span> </span><a name="local-6989586621679125469"><a href="#local-6989586621679125469"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="File.Format.TNT.Internal.html#Discrete"><span class="hs-identifier hs-var">Discrete</span></a><span> </span><a name="local-6989586621679125470"><a href="#local-6989586621679125470"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-466"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679125470"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">testBit</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679125471"><span class="hs-identifier hs-var">gapBit</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Internal.html#Discrete"><span class="hs-identifier hs-var">Discrete</span></a><span> </span><a href="#local-6989586621679125472"><span class="hs-identifier hs-var">missing</span></a><span>
</span><a name="line-467"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679125469"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-468"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-469"></a><span>        </span><a name="local-6989586621679125471"><a href="#local-6989586621679125471"><span class="hs-identifier">gapBit</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Internal.html#findFirstSet"><span class="hs-identifier hs-var">findFirstSet</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="File.Format.TNT.Internal.html#deserializeStateDiscrete"><span class="hs-identifier hs-var">deserializeStateDiscrete</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-char">'-'</span><span>
</span><a name="line-470"></a><span>        </span><a name="local-6989586621679125472"><a href="#local-6989586621679125472"><span class="hs-identifier">missing</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Internal.html#deserializeStateDiscrete"><span class="hs-identifier hs-var">deserializeStateDiscrete</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-char">'?'</span><span>
</span><a name="line-471"></a><span>    </span><span class="hs-identifier">gapToMissing</span><span> </span><a name="local-6989586621679125473"><a href="#local-6989586621679125473"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="File.Format.TNT.Internal.html#Protein"><span class="hs-identifier hs-var">Protein</span></a><span> </span><a name="local-6989586621679125474"><a href="#local-6989586621679125474"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-472"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679125474"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">testBit</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679125475"><span class="hs-identifier hs-var">gapBit</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Internal.html#Protein"><span class="hs-identifier hs-var">Protein</span></a><span> </span><a href="#local-6989586621679125476"><span class="hs-identifier hs-var">missing</span></a><span>
</span><a name="line-473"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679125473"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-474"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-475"></a><span>        </span><a name="local-6989586621679125475"><a href="#local-6989586621679125475"><span class="hs-identifier">gapBit</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Internal.html#findFirstSet"><span class="hs-identifier hs-var">findFirstSet</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="File.Format.TNT.Internal.html#deserializeStateProtein"><span class="hs-identifier hs-var">deserializeStateProtein</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-char">'-'</span><span>
</span><a name="line-476"></a><span>        </span><a name="local-6989586621679125476"><a href="#local-6989586621679125476"><span class="hs-identifier">missing</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Internal.html#deserializeStateProtein"><span class="hs-identifier hs-var">deserializeStateProtein</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-char">'?'</span><span>
</span><a name="line-477"></a><span>
</span><a name="line-478"></a><span>
</span><a name="line-479"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-480"></a><span class="hs-comment">-- Truncate gap values from the front of the sequence segment.</span><span>
</span><a name="line-481"></a><span class="hs-identifier">trimHead</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DList</span><span> </span><a href="File.Format.TNT.Internal.html#TaxonInfo"><span class="hs-identifier hs-type">TaxonInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DList</span><span> </span><a href="File.Format.TNT.Internal.html#TaxonInfo"><span class="hs-identifier hs-type">TaxonInfo</span></a><span>
</span><a name="line-482"></a><a name="trimHead"><a href="File.Format.TNT.Command.XRead.html#trimHead"><span class="hs-identifier">trimHead</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">second</span><span> </span><a href="#local-6989586621679125477"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-483"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-484"></a><span>    </span><a name="local-6989586621679125477"><a href="#local-6989586621679125477"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679125478"><a href="#local-6989586621679125478"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="File.Format.TNT.Command.XRead.html#toMissing"><span class="hs-identifier hs-var">toMissing</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679125479"><span class="hs-identifier hs-var">gaps</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679125480"><span class="hs-identifier hs-var">chars</span></a><span>
</span><a name="line-485"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-486"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679125479"><a href="#local-6989586621679125479"><span class="hs-identifier">gaps</span></a></a><span class="hs-special">,</span><a name="local-6989586621679125480"><a href="#local-6989586621679125480"><span class="hs-identifier">chars</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">span</span><span> </span><a href="File.Format.TNT.Command.XRead.html#isGap"><span class="hs-identifier hs-var">isGap</span></a><span> </span><a href="#local-6989586621679125478"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-487"></a><span>
</span><a name="line-488"></a><span>
</span><a name="line-489"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-490"></a><span class="hs-comment">-- Truncate gap values from the end of the sequence segment.</span><span>
</span><a name="line-491"></a><span class="hs-identifier">trimTail</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DList</span><span> </span><a href="File.Format.TNT.Internal.html#TaxonInfo"><span class="hs-identifier hs-type">TaxonInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DList</span><span> </span><a href="File.Format.TNT.Internal.html#TaxonInfo"><span class="hs-identifier hs-type">TaxonInfo</span></a><span>
</span><a name="line-492"></a><a name="trimTail"><a href="File.Format.TNT.Command.XRead.html#trimTail"><span class="hs-identifier">trimTail</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">second</span><span> </span><a href="#local-6989586621679125481"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-493"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-494"></a><span>    </span><a name="local-6989586621679125481"><a href="#local-6989586621679125481"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679125482"><a href="#local-6989586621679125482"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><a href="File.Format.TNT.Command.XRead.html#toMissing"><span class="hs-identifier hs-var">toMissing</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679125483"><span class="hs-identifier hs-var">gaps</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679125484"><span class="hs-identifier hs-var">chars</span></a><span>
</span><a name="line-495"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-496"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679125483"><a href="#local-6989586621679125483"><span class="hs-identifier">gaps</span></a></a><span class="hs-special">,</span><a name="local-6989586621679125484"><a href="#local-6989586621679125484"><span class="hs-identifier">chars</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">span</span><span> </span><a href="File.Format.TNT.Command.XRead.html#isGap"><span class="hs-identifier hs-var">isGap</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621679125482"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-497"></a><span>
</span><a name="line-498"></a><span>
</span><a name="line-499"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-500"></a><span class="hs-comment">-- Test if a given sequence character value is a gap value.</span><span>
</span><a name="line-501"></a><span class="hs-identifier">isGap</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="File.Format.TNT.Internal.html#TntCharacter"><span class="hs-identifier hs-type">TntCharacter</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-502"></a><a name="isGap"><a href="File.Format.TNT.Command.XRead.html#isGap"><span class="hs-identifier">isGap</span></a></a><span> </span><span class="hs-special">(</span><a href="File.Format.TNT.Internal.html#Dna"><span class="hs-identifier hs-var">Dna</span></a><span>      </span><a name="local-6989586621679125485"><a href="#local-6989586621679125485"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="File.Format.TNT.Internal.html#deserializeStateDna"><span class="hs-identifier hs-var">deserializeStateDna</span></a><span>      </span><span class="hs-glyph">!</span><span> </span><span class="hs-char">'-'</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679125485"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span>
</span><a name="line-503"></a><span class="hs-identifier">isGap</span><span> </span><span class="hs-special">(</span><a href="File.Format.TNT.Internal.html#Discrete"><span class="hs-identifier hs-var">Discrete</span></a><span> </span><a name="local-6989586621679125486"><a href="#local-6989586621679125486"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="File.Format.TNT.Internal.html#deserializeStateDiscrete"><span class="hs-identifier hs-var">deserializeStateDiscrete</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-char">'-'</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679125486"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span>
</span><a name="line-504"></a><span class="hs-identifier">isGap</span><span> </span><span class="hs-special">(</span><a href="File.Format.TNT.Internal.html#Protein"><span class="hs-identifier hs-var">Protein</span></a><span>  </span><a name="local-6989586621679125487"><a href="#local-6989586621679125487"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="File.Format.TNT.Internal.html#deserializeStateProtein"><span class="hs-identifier hs-var">deserializeStateProtein</span></a><span>  </span><span class="hs-glyph">!</span><span> </span><span class="hs-char">'-'</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679125487"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span>
</span><a name="line-505"></a><span class="hs-identifier">isGap</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-506"></a><span>
</span><a name="line-507"></a><span>
</span><a name="line-508"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-509"></a><span class="hs-comment">-- Overwrite given seuqence character value with the missing character value.</span><span>
</span><a name="line-510"></a><span class="hs-identifier">toMissing</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="File.Format.TNT.Internal.html#TntCharacter"><span class="hs-identifier hs-type">TntCharacter</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.TNT.Internal.html#TntCharacter"><span class="hs-identifier hs-type">TntCharacter</span></a><span> </span><span>
</span><a name="line-511"></a><a name="toMissing"><a href="File.Format.TNT.Command.XRead.html#toMissing"><span class="hs-identifier">toMissing</span></a></a><span> </span><a href="File.Format.TNT.Internal.html#Dna"><span class="hs-identifier hs-var">Dna</span></a><span>     </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Internal.html#Dna"><span class="hs-identifier hs-var">Dna</span></a><span>      </span><span class="hs-operator hs-var">$</span><span> </span><a href="File.Format.TNT.Internal.html#deserializeStateDna"><span class="hs-identifier hs-var">deserializeStateDna</span></a><span>      </span><span class="hs-glyph">!</span><span> </span><span class="hs-char">'?'</span><span>
</span><a name="line-512"></a><span class="hs-identifier">toMissing</span><span> </span><a href="File.Format.TNT.Internal.html#Discrete"><span class="hs-identifier hs-var">Discrete</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Internal.html#Discrete"><span class="hs-identifier hs-var">Discrete</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="File.Format.TNT.Internal.html#deserializeStateDiscrete"><span class="hs-identifier hs-var">deserializeStateDiscrete</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-char">'?'</span><span>
</span><a name="line-513"></a><span class="hs-identifier">toMissing</span><span> </span><a href="File.Format.TNT.Internal.html#Protein"><span class="hs-identifier hs-var">Protein</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Internal.html#Protein"><span class="hs-identifier hs-var">Protein</span></a><span>  </span><span class="hs-operator hs-var">$</span><span> </span><a href="File.Format.TNT.Internal.html#deserializeStateProtein"><span class="hs-identifier hs-var">deserializeStateProtein</span></a><span>  </span><span class="hs-glyph">!</span><span> </span><span class="hs-char">'?'</span><span>
</span><a name="line-514"></a><span class="hs-identifier">toMissing</span><span> </span><a name="local-6989586621679125488"><a href="#local-6989586621679125488"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679125488"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-515"></a><span>
</span><a name="line-516"></a><span>
</span><a name="line-517"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-518"></a><span class="hs-comment">-- Reads a sequence segment tag containing one or more parse interpretation</span><span>
</span><a name="line-519"></a><span class="hs-comment">-- identifiers. Validates that neither duplicate nor mutually exclusive</span><span>
</span><a name="line-520"></a><span class="hs-comment">-- identifiers exist. Returns the contextual information for interpreting the</span><span>
</span><a name="line-521"></a><span class="hs-comment">-- sequence segments following the tag.</span><span>
</span><a name="line-522"></a><span class="hs-identifier">xreadTags</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FoldCase</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Tokens</span><span> </span><a href="#local-6989586621679125304"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125305"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125304"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125306"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679125304"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679125306"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="File.Format.TNT.Command.XRead.html#XReadInterpretation"><span class="hs-identifier hs-type">XReadInterpretation</span></a><span>
</span><a name="line-523"></a><a name="xreadTags"><a href="File.Format.TNT.Command.XRead.html#xreadTags"><span class="hs-identifier">xreadTags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679125492"><span class="hs-identifier hs-var">validateXReadTags</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="#local-6989586621679125489"><span class="hs-identifier hs-var">xreadTagsDef</span></a><span>
</span><a name="line-524"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-525"></a><span>    </span><a name="local-6989586621679125489"><a href="#local-6989586621679125489"><span class="hs-identifier">xreadTagsDef</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Internal.html#symbol"><span class="hs-identifier hs-var">symbol</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'&amp;'</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="File.Format.TNT.Internal.html#symbol"><span class="hs-identifier hs-var">symbol</span></a><span> </span><span class="hs-special">(</span><a href="File.Format.TNT.Command.XRead.html#withinBraces"><span class="hs-identifier hs-var">withinBraces</span></a><span> </span><a href="#local-6989586621679125490"><span class="hs-identifier hs-var">tags</span></a><span class="hs-special">)</span><span>
</span><a name="line-526"></a><span>
</span><a name="line-527"></a><span>    </span><a name="local-6989586621679125490"><a href="#local-6989586621679125490"><span class="hs-identifier">tags</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">NE</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679125491"><span class="hs-identifier hs-var">tagOptions</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">sepBy1</span><span class="hs-special">`</span><span> </span><a href="File.Format.TNT.Internal.html#whitespaceInline"><span class="hs-identifier hs-var">whitespaceInline</span></a><span class="hs-special">)</span><span>
</span><a name="line-528"></a><span>
</span><a name="line-529"></a><span>    </span><a name="local-6989586621679125491"><a href="#local-6989586621679125491"><span class="hs-identifier">tagOptions</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">choice</span><span>
</span><a name="line-530"></a><span>                 </span><span class="hs-special">[</span><span>      </span><a href="File.Format.TNT.Internal.html#keyword"><span class="hs-identifier hs-var">keyword</span></a><span> </span><span class="hs-string">&quot;continuous&quot;</span><span> </span><span class="hs-number">4</span><span>  </span><span class="hs-operator hs-var">$&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#TagContinuous"><span class="hs-identifier hs-var">TagContinuous</span></a><span>
</span><a name="line-531"></a><span>                 </span><span class="hs-special">,</span><span>      </span><a href="File.Format.TNT.Internal.html#keyword"><span class="hs-identifier hs-var">keyword</span></a><span> </span><span class="hs-string">&quot;dna&quot;</span><span>        </span><span class="hs-number">3</span><span>  </span><span class="hs-operator hs-var">$&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#TagDna"><span class="hs-identifier hs-var">TagDna</span></a><span>
</span><a name="line-532"></a><span>                 </span><span class="hs-special">,</span><span>      </span><a href="File.Format.TNT.Internal.html#keyword"><span class="hs-identifier hs-var">keyword</span></a><span> </span><span class="hs-string">&quot;protein&quot;</span><span>    </span><span class="hs-number">4</span><span>  </span><span class="hs-operator hs-var">$&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#TagProtein"><span class="hs-identifier hs-var">TagProtein</span></a><span>
</span><a name="line-533"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">try</span><span> </span><span class="hs-special">(</span><a href="File.Format.TNT.Internal.html#keyword"><span class="hs-identifier hs-var">keyword</span></a><span> </span><span class="hs-string">&quot;numeric&quot;</span><span>    </span><span class="hs-number">3</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#TagNumeric"><span class="hs-identifier hs-var">TagNumeric</span></a><span>
</span><a name="line-534"></a><span>                 </span><span class="hs-special">,</span><span>      </span><a href="File.Format.TNT.Internal.html#keyword"><span class="hs-identifier hs-var">keyword</span></a><span> </span><span class="hs-string">&quot;gaps&quot;</span><span>       </span><span class="hs-number">3</span><span>  </span><span class="hs-operator hs-var">$&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#TagGaps"><span class="hs-identifier hs-var">TagGaps</span></a><span>
</span><a name="line-535"></a><span>                 </span><span class="hs-special">,</span><span>      </span><a href="File.Format.TNT.Internal.html#keyword"><span class="hs-identifier hs-var">keyword</span></a><span> </span><span class="hs-string">&quot;nogaps&quot;</span><span>     </span><span class="hs-number">5</span><span>  </span><span class="hs-operator hs-var">$&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#TagNoGaps"><span class="hs-identifier hs-var">TagNoGaps</span></a><span>
</span><a name="line-536"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">try</span><span> </span><span class="hs-special">(</span><a href="File.Format.TNT.Internal.html#keyword"><span class="hs-identifier hs-var">keyword</span></a><span> </span><span class="hs-string">&quot;trimhead&quot;</span><span>   </span><span class="hs-number">5</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#TagTrimHead"><span class="hs-identifier hs-var">TagTrimHead</span></a><span>
</span><a name="line-537"></a><span>                 </span><span class="hs-special">,</span><span>      </span><a href="File.Format.TNT.Internal.html#keyword"><span class="hs-identifier hs-var">keyword</span></a><span> </span><span class="hs-string">&quot;trimtail&quot;</span><span>   </span><span class="hs-number">5</span><span>  </span><span class="hs-operator hs-var">$&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#TagTrimTail"><span class="hs-identifier hs-var">TagTrimTail</span></a><span>
</span><a name="line-538"></a><span>                 </span><span class="hs-special">]</span><span>
</span><a name="line-539"></a><span>
</span><a name="line-540"></a><span>    </span><span class="hs-identifier">validateXReadTags</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679125493"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679125494"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679125495"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-comment">{- , Token s ~ Char -}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">NonEmpty</span><span> </span><a href="File.Format.TNT.Command.XRead.html#XReadTag"><span class="hs-identifier hs-type">XReadTag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679125495"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="File.Format.TNT.Command.XRead.html#XReadInterpretation"><span class="hs-identifier hs-type">XReadInterpretation</span></a><span>
</span><a name="line-541"></a><span>    </span><a name="local-6989586621679125492"><a href="#local-6989586621679125492"><span class="hs-identifier">validateXReadTags</span></a></a><span> </span><a name="local-6989586621679125496"><a href="#local-6989586621679125496"><span class="hs-identifier">xs</span></a></a><span>
</span><a name="line-542"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679125497"><span class="hs-identifier hs-var">dupes</span></a><span class="hs-special">)</span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;You got duplicate tags man! Like only one's allowed. For realz! &quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679125497"><span class="hs-identifier hs-var">dupes</span></a><span>
</span><a name="line-543"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679125502"><span class="hs-identifier hs-var">manyTags</span></a><span> </span><a href="#local-6989586621679125498"><span class="hs-identifier hs-var">allTypeTags</span></a><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;You can't have multiple character type tags: &quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679125498"><span class="hs-identifier hs-var">allTypeTags</span></a><span>
</span><a name="line-544"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679125502"><span class="hs-identifier hs-var">manyTags</span></a><span> </span><a href="#local-6989586621679125499"><span class="hs-identifier hs-var">allGapTags</span></a><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;You can't have multiple gap specification tags: &quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679125499"><span class="hs-identifier hs-var">allGapTags</span></a><span>
</span><a name="line-545"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679125503"><span class="hs-identifier hs-var">isContinuous</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679125499"><span class="hs-identifier hs-var">allGapTags</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fail</span><span>   </span><span class="hs-string">&quot;You can't have gaps or nogaps specified for continuous data&quot;</span><span>
</span><a name="line-546"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679125504"><span class="hs-identifier hs-var">isNumeric</span></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679125499"><span class="hs-identifier hs-var">allGapTags</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fail</span><span>   </span><span class="hs-string">&quot;You can't have gaps or nogaps specified for numeric data&quot;</span><span>
</span><a name="line-547"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679125506"><span class="hs-identifier hs-var">pGaps</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679125507"><span class="hs-identifier hs-var">pTrimHead</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679125508"><span class="hs-identifier hs-var">pTrimTail</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fail</span><span>   </span><span class="hs-string">&quot;You can't have trimhead or trimTail along with nogaps&quot;</span><span>
</span><a name="line-548"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="File.Format.TNT.Command.XRead.html#XReadInterpretation"><span class="hs-identifier hs-var">XReadInterpretation</span></a><span> </span><a href="#local-6989586621679125505"><span class="hs-identifier hs-var">pType</span></a><span> </span><a href="#local-6989586621679125506"><span class="hs-identifier hs-var">pGaps</span></a><span> </span><a href="#local-6989586621679125507"><span class="hs-identifier hs-var">pTrimHead</span></a><span> </span><a href="#local-6989586621679125508"><span class="hs-identifier hs-var">pTrimTail</span></a><span>
</span><a name="line-549"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-550"></a><span>        </span><a name="local-6989586621679125497"><a href="#local-6989586621679125497"><span class="hs-identifier">dupes</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">duplicates</span><span> </span><a href="#local-6989586621679125496"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-551"></a><span>        </span><a name="local-6989586621679125498"><a href="#local-6989586621679125498"><span class="hs-identifier">allTypeTags</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679125500"><span class="hs-identifier hs-var">typeTags</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621679125496"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-552"></a><span>        </span><a name="local-6989586621679125499"><a href="#local-6989586621679125499"><span class="hs-identifier">allGapTags</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679125501"><span class="hs-identifier hs-var">gapTags</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621679125496"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-553"></a><span>        </span><a name="local-6989586621679125500"><a href="#local-6989586621679125500"><span class="hs-identifier">typeTags</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="File.Format.TNT.Command.XRead.html#TagContinuous"><span class="hs-identifier hs-var">TagContinuous</span></a><span class="hs-special">,</span><span> </span><a href="File.Format.TNT.Command.XRead.html#TagDna"><span class="hs-identifier hs-var">TagDna</span></a><span class="hs-special">,</span><span> </span><a href="File.Format.TNT.Command.XRead.html#TagProtein"><span class="hs-identifier hs-var">TagProtein</span></a><span class="hs-special">,</span><span> </span><a href="File.Format.TNT.Command.XRead.html#TagNumeric"><span class="hs-identifier hs-var">TagNumeric</span></a><span class="hs-special">]</span><span>
</span><a name="line-554"></a><span>        </span><a name="local-6989586621679125501"><a href="#local-6989586621679125501"><span class="hs-identifier">gapTags</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="File.Format.TNT.Command.XRead.html#TagGaps"><span class="hs-identifier hs-var">TagGaps</span></a><span class="hs-special">,</span><span> </span><a href="File.Format.TNT.Command.XRead.html#TagNoGaps"><span class="hs-identifier hs-var">TagNoGaps</span></a><span class="hs-special">]</span><span>
</span><a name="line-555"></a><span>        </span><a name="local-6989586621679125502"><a href="#local-6989586621679125502"><span class="hs-identifier">manyTags</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">length</span><span>
</span><a name="line-556"></a><span>        </span><a name="local-6989586621679125503"><a href="#local-6989586621679125503"><span class="hs-identifier">isContinuous</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Command.XRead.html#TagContinuous"><span class="hs-identifier hs-var">TagContinuous</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679125498"><span class="hs-identifier hs-var">allTypeTags</span></a><span>
</span><a name="line-557"></a><span>        </span><a name="local-6989586621679125504"><a href="#local-6989586621679125504"><span class="hs-identifier">isNumeric</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Command.XRead.html#TagNumeric"><span class="hs-identifier hs-var">TagNumeric</span></a><span>    </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679125498"><span class="hs-identifier hs-var">allTypeTags</span></a><span>
</span><a name="line-558"></a><span>        </span><a name="local-6989586621679125505"><a href="#local-6989586621679125505"><span class="hs-identifier">pType</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679125498"><span class="hs-identifier hs-var">allTypeTags</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-559"></a><span>                         </span><span class="hs-special">[</span><a href="File.Format.TNT.Command.XRead.html#TagContinuous"><span class="hs-identifier hs-var">TagContinuous</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#ParseContinuous"><span class="hs-identifier hs-var">ParseContinuous</span></a><span>
</span><a name="line-560"></a><span>                         </span><span class="hs-special">[</span><a href="File.Format.TNT.Command.XRead.html#TagDna"><span class="hs-identifier hs-var">TagDna</span></a><span>       </span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#ParseDna"><span class="hs-identifier hs-var">ParseDna</span></a><span>
</span><a name="line-561"></a><span>                         </span><span class="hs-special">[</span><a href="File.Format.TNT.Command.XRead.html#TagProtein"><span class="hs-identifier hs-var">TagProtein</span></a><span>   </span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#ParseProtein"><span class="hs-identifier hs-var">ParseProtein</span></a><span>
</span><a name="line-562"></a><span>                         </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.TNT.Command.XRead.html#ParseNumeric"><span class="hs-identifier hs-var">ParseNumeric</span></a><span>
</span><a name="line-563"></a><span>        </span><a name="local-6989586621679125506"><a href="#local-6989586621679125506"><span class="hs-identifier">pGaps</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679125499"><span class="hs-identifier hs-var">allGapTags</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-564"></a><span>                         </span><span class="hs-special">[</span><a href="File.Format.TNT.Command.XRead.html#TagNoGaps"><span class="hs-identifier hs-var">TagNoGaps</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-565"></a><span>                         </span><span class="hs-identifier">_</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-566"></a><span>        </span><a name="local-6989586621679125507"><a href="#local-6989586621679125507"><span class="hs-identifier">pTrimHead</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Command.XRead.html#TagTrimHead"><span class="hs-identifier hs-var">TagTrimHead</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679125496"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-567"></a><span>        </span><a name="local-6989586621679125508"><a href="#local-6989586621679125508"><span class="hs-identifier">pTrimTail</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.TNT.Command.XRead.html#TagTrimTail"><span class="hs-identifier hs-var">TagTrimTail</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679125496"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-568"></a><span>
</span><a name="line-569"></a></pre></body></html>