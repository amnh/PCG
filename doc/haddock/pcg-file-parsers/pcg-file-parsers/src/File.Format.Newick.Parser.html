<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-2"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-3"></a><span class="hs-comment">-- Module      :  File.Format.Newick</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- Copyright   :  (c) 2015-2015 Ward Wheeler</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- License     :  BSD-style</span><span>
</span><a name="line-6"></a><span class="hs-comment">--</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- Maintainer  :  wheeler@amnh.org</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- Stability   :  provisional</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- Portability :  portable</span><span>
</span><a name="line-10"></a><span class="hs-comment">--</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- Function for parsing Newick tree files into a topological tree structure.</span><span>
</span><a name="line-12"></a><span class="hs-comment">--</span><span>
</span><a name="line-13"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts, ScopedTypeVariables, TypeFamilies #-}</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">File</span><span class="hs-operator">.</span><span class="hs-identifier">Format</span><span class="hs-operator">.</span><span class="hs-identifier">Newick</span><span class="hs-operator">.</span><span class="hs-identifier">Parser</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Char</span><span>                   </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isSpace</span><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Foldable</span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Functor</span><span>                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span class="hs-special">)</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span>                   </span><span class="hs-special">(</span><span class="hs-identifier hs-var">intercalate</span><span class="hs-special">)</span><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span class="hs-operator">.</span><span class="hs-identifier">NonEmpty</span><span>          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">some1</span><span class="hs-special">)</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Map</span><span>             </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">filter</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">null</span><span class="hs-special">)</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span>                  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromJust</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">isJust</span><span class="hs-special">)</span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Proxy</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Semigroup</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">String</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><a href="File.Format.Newick.Internal.html"><span class="hs-identifier">File</span><span class="hs-operator">.</span><span class="hs-identifier">Format</span><span class="hs-operator">.</span><span class="hs-identifier">Newick</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span>              </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lookup</span><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Megaparsec</span><span>      </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">label</span><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Megaparsec</span><span class="hs-operator">.</span><span class="hs-identifier">Char</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Megaparsec</span><span class="hs-operator">.</span><span class="hs-identifier">Char</span><span class="hs-operator">.</span><span class="hs-identifier">Lexer</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">skipBlockCommentNested</span><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><a href="Text.Megaparsec.Custom.html"><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Megaparsec</span><span class="hs-operator">.</span><span class="hs-identifier">Custom</span></a><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-38"></a><span class="hs-comment">-- Parses a stream producing a standard Newick tree</span><span>
</span><a name="line-39"></a><span class="hs-identifier">newickStandardDefinition</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679138307"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679138308"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679138309"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679138308"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679138309"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="File.Format.Newick.Internal.html#NewickNode"><span class="hs-identifier hs-type">NewickNode</span></a><span>
</span><a name="line-40"></a><a name="newickStandardDefinition"><a href="File.Format.Newick.Parser.html#newickStandardDefinition"><span class="hs-identifier">newickStandardDefinition</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Newick.Parser.html#whitespace"><span class="hs-identifier hs-var">whitespace</span></a><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="File.Format.Newick.Parser.html#newickNodeDefinition"><span class="hs-identifier hs-var">newickNodeDefinition</span></a><span> </span><span class="hs-operator hs-var">&lt;*</span><span> </span><a href="File.Format.Newick.Parser.html#symbol"><span class="hs-identifier hs-var">symbol</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">';'</span><span class="hs-special">)</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-44"></a><span class="hs-comment">-- Parses a stream producing an extended Newick tree.</span><span>
</span><a name="line-45"></a><span class="hs-comment">-- Directed cycles in extended Newick trees are not permitted.</span><span>
</span><a name="line-46"></a><span class="hs-identifier">newickExtendedDefinition</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679138304"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679138305"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679138306"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679138305"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679138306"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="File.Format.Newick.Internal.html#NewickNode"><span class="hs-identifier hs-type">NewickNode</span></a><span>
</span><a name="line-47"></a><a name="newickExtendedDefinition"><a href="File.Format.Newick.Parser.html#newickExtendedDefinition"><span class="hs-identifier">newickExtendedDefinition</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Newick.Parser.html#newickStandardDefinition"><span class="hs-identifier hs-var">newickStandardDefinition</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="File.Format.Newick.Parser.html#joinNonUniqueLabeledNodes"><span class="hs-identifier hs-var">joinNonUniqueLabeledNodes</span></a><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-51"></a><span class="hs-comment">-- Parses a stream producing a forest of extended Newick trees.</span><span>
</span><a name="line-52"></a><span class="hs-identifier">newickForestDefinition</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679138301"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679138302"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679138303"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679138302"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679138303"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="File.Format.Newick.Internal.html#NewickForest"><span class="hs-identifier hs-type">NewickForest</span></a><span>
</span><a name="line-53"></a><a name="newickForestDefinition"><a href="File.Format.Newick.Parser.html#newickForestDefinition"><span class="hs-identifier">newickForestDefinition</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Newick.Parser.html#whitespace"><span class="hs-identifier hs-var">whitespace</span></a><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="File.Format.Newick.Parser.html#symbol"><span class="hs-identifier hs-var">symbol</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'&lt;'</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><span class="hs-identifier hs-var">some1</span><span> </span><a href="File.Format.Newick.Parser.html#newickExtendedDefinition"><span class="hs-identifier hs-var">newickExtendedDefinition</span></a><span> </span><span class="hs-operator hs-var">&lt;*</span><span> </span><a href="File.Format.Newick.Parser.html#symbol"><span class="hs-identifier hs-var">symbol</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'&gt;'</span><span class="hs-special">)</span><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-57"></a><span class="hs-comment">-- Definition of a serialized Newick node consisiting of the node's descendants,</span><span>
</span><a name="line-58"></a><span class="hs-comment">-- optional label, and optional branch length. Mutually recursive with</span><span>
</span><a name="line-59"></a><span class="hs-comment">-- 'subtreeDefinition '.</span><span>
</span><a name="line-60"></a><span class="hs-identifier">newickNodeDefinition</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679138298"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679138299"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679138300"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679138299"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679138300"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="File.Format.Newick.Internal.html#NewickNode"><span class="hs-identifier hs-type">NewickNode</span></a><span>
</span><a name="line-61"></a><a name="newickNodeDefinition"><a href="File.Format.Newick.Parser.html#newickNodeDefinition"><span class="hs-identifier">newickNodeDefinition</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-62"></a><span>    </span><a name="local-6989586621679138310"><a href="#local-6989586621679138310"><span class="hs-identifier">descendants'</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="File.Format.Newick.Parser.html#descendantListDefinition"><span class="hs-identifier hs-var">descendantListDefinition</span></a><span>
</span><a name="line-63"></a><span>    </span><a name="local-6989586621679138311"><a href="#local-6989586621679138311"><span class="hs-identifier">label'</span></a></a><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">optional</span><span> </span><a href="File.Format.Newick.Parser.html#newickLabelDefinition"><span class="hs-identifier hs-var">newickLabelDefinition</span></a><span>
</span><a name="line-64"></a><span>    </span><a name="local-6989586621679138312"><a href="#local-6989586621679138312"><span class="hs-identifier">branchLength'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">optional</span><span> </span><a href="File.Format.Newick.Parser.html#branchLengthDefinition"><span class="hs-identifier hs-var">branchLengthDefinition</span></a><span>
</span><a name="line-65"></a><span>    </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="File.Format.Newick.Internal.html#NewickNode"><span class="hs-identifier hs-var">NewickNode</span></a><span> </span><a href="#local-6989586621679138310"><span class="hs-identifier hs-var">descendants'</span></a><span> </span><a href="#local-6989586621679138311"><span class="hs-identifier hs-var">label'</span></a><span> </span><a href="#local-6989586621679138312"><span class="hs-identifier hs-var">branchLength'</span></a><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-69"></a><span class="hs-comment">-- Parses one or more subtrees consisting of a single node or a further</span><span>
</span><a name="line-70"></a><span class="hs-comment">-- descendant list.</span><span>
</span><a name="line-71"></a><span class="hs-identifier">descendantListDefinition</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679138295"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679138296"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679138297"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679138296"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679138297"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><a href="File.Format.Newick.Internal.html#NewickNode"><span class="hs-identifier hs-type">NewickNode</span></a><span class="hs-special">]</span><span>
</span><a name="line-72"></a><a name="descendantListDefinition"><a href="File.Format.Newick.Parser.html#descendantListDefinition"><span class="hs-identifier">descendantListDefinition</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'('</span><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="File.Format.Newick.Parser.html#trimmed"><span class="hs-identifier hs-var">trimmed</span></a><span> </span><a href="File.Format.Newick.Parser.html#subtreeDefinition"><span class="hs-identifier hs-var">subtreeDefinition</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">sepBy1</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">','</span><span> </span><span class="hs-operator hs-var">&lt;*</span><span> </span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">')'</span><span> </span><span class="hs-operator hs-var">&lt;*</span><span> </span><a href="File.Format.Newick.Parser.html#whitespace"><span class="hs-identifier hs-var">whitespace</span></a><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span>
</span><a name="line-75"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-76"></a><span class="hs-comment">-- Definition of a Newick subtree consisting of either a single leaf node or a</span><span>
</span><a name="line-77"></a><span class="hs-comment">-- greater subtree. Mutually recursive with 'newickNodeDefinition'.</span><span>
</span><a name="line-78"></a><span class="hs-identifier">subtreeDefinition</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679138292"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679138293"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679138294"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679138293"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679138294"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="File.Format.Newick.Internal.html#NewickNode"><span class="hs-identifier hs-type">NewickNode</span></a><span>
</span><a name="line-79"></a><a name="subtreeDefinition"><a href="File.Format.Newick.Parser.html#subtreeDefinition"><span class="hs-identifier">subtreeDefinition</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Newick.Parser.html#newickNodeDefinition"><span class="hs-identifier hs-var">newickNodeDefinition</span></a><span> </span><span class="hs-operator hs-var">&lt;|&gt;</span><span> </span><a href="File.Format.Newick.Parser.html#newickLeafDefinition"><span class="hs-identifier hs-var">newickLeafDefinition</span></a><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-83"></a><span class="hs-comment">-- Definition of a sigle leaf node in a Newick tree. Must contain a node label.</span><span>
</span><a name="line-84"></a><span class="hs-comment">-- Has no descendants be definition.</span><span>
</span><a name="line-85"></a><span class="hs-identifier">newickLeafDefinition</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679138289"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679138290"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679138291"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679138290"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679138291"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="File.Format.Newick.Internal.html#NewickNode"><span class="hs-identifier hs-type">NewickNode</span></a><span>
</span><a name="line-86"></a><a name="newickLeafDefinition"><a href="File.Format.Newick.Parser.html#newickLeafDefinition"><span class="hs-identifier">newickLeafDefinition</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-87"></a><span>    </span><a name="local-6989586621679138313"><a href="#local-6989586621679138313"><span class="hs-identifier">label'</span></a></a><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><a href="File.Format.Newick.Parser.html#newickLabelDefinition"><span class="hs-identifier hs-var">newickLabelDefinition</span></a><span>
</span><a name="line-88"></a><span>    </span><a name="local-6989586621679138314"><a href="#local-6989586621679138314"><span class="hs-identifier">branchLength'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">optional</span><span> </span><a href="File.Format.Newick.Parser.html#branchLengthDefinition"><span class="hs-identifier hs-var">branchLengthDefinition</span></a><span>
</span><a name="line-89"></a><span>    </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="File.Format.Newick.Internal.html#NewickNode"><span class="hs-identifier hs-var">NewickNode</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679138313"><span class="hs-identifier hs-var">label'</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679138314"><span class="hs-identifier hs-var">branchLength'</span></a><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-93"></a><span class="hs-comment">-- Defines the label for a 'NewickNode' which can be either quoted or unquoted.</span><span>
</span><a name="line-94"></a><span class="hs-identifier">newickLabelDefinition</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679138286"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679138287"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679138288"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679138287"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679138288"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-95"></a><a name="newickLabelDefinition"><a href="File.Format.Newick.Parser.html#newickLabelDefinition"><span class="hs-identifier">newickLabelDefinition</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="File.Format.Newick.Parser.html#quotedLabel"><span class="hs-identifier hs-var">quotedLabel</span></a><span> </span><span class="hs-operator hs-var">&lt;|&gt;</span><span> </span><a href="File.Format.Newick.Parser.html#unquotedLabel"><span class="hs-identifier hs-var">unquotedLabel</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;*</span><span> </span><a href="File.Format.Newick.Parser.html#whitespace"><span class="hs-identifier hs-var">whitespace</span></a><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-99"></a><span class="hs-comment">-- We use a recursive parsing technique to handle the quoted escape sequence</span><span>
</span><a name="line-100"></a><span class="hs-comment">-- of two single quotes (&quot;''&quot;) to denote an escaped quotation character </span><span>
</span><a name="line-101"></a><span class="hs-comment">-- in the quoted label rather than signifying the end of the quoted label</span><span>
</span><a name="line-102"></a><span class="hs-identifier">quotedLabel</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679138283"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679138284"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679138285"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679138284"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679138285"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-103"></a><a name="quotedLabel"><a href="File.Format.Newick.Parser.html#quotedLabel"><span class="hs-identifier">quotedLabel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-104"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'\''</span><span>
</span><a name="line-105"></a><span>    </span><a name="local-6989586621679138319"><a href="#local-6989586621679138319"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679138315"><span class="hs-identifier hs-var">quotedLabelData</span></a><span>
</span><a name="line-106"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">isSpace</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679138319"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-107"></a><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Blank quoted identifier found. The identifier '&quot;</span><span class="hs-operator hs-var">&lt;&gt;</span><a href="#local-6989586621679138319"><span class="hs-identifier hs-var">x</span></a><span class="hs-operator hs-var">&lt;&gt;</span><span class="hs-string">&quot;' is not valid&quot;</span><span>
</span><a name="line-108"></a><span>      </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679138319"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-109"></a><span>  </span><span class="hs-keyword">where</span><span> </span><span>
</span><a name="line-110"></a><span>    </span><a name="local-6989586621679138315"><a href="#local-6989586621679138315"><span class="hs-identifier">quotedLabelData</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-111"></a><span>      </span><a name="local-6989586621679138316"><a href="#local-6989586621679138316"><span class="hs-identifier">prefix</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">many</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">noneOf</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-char">'\''</span><span class="hs-glyph">:</span><a href="File.Format.Newick.Parser.html#invalidQuotedLabelChars"><span class="hs-identifier hs-var">invalidQuotedLabelChars</span></a><span class="hs-special">)</span><span>
</span><a name="line-112"></a><span>      </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'\''</span><span>
</span><a name="line-113"></a><span>      </span><a name="local-6989586621679138317"><a href="#local-6989586621679138317"><span class="hs-identifier">suffix</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">optional</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">try</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'\''</span><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="#local-6989586621679138315"><span class="hs-identifier hs-var">quotedLabelData</span></a><span>
</span><a name="line-114"></a><span>      </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-115"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679138317"><span class="hs-identifier hs-var">suffix</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-116"></a><span>          </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679138318"><a href="#local-6989586621679138318"><span class="hs-identifier">y</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679138316"><span class="hs-identifier hs-var">prefix</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-char">'\''</span><span class="hs-glyph">:</span><a href="#local-6989586621679138318"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-117"></a><span>          </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679138316"><span class="hs-identifier hs-var">prefix</span></a><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-121"></a><span class="hs-comment">-- The following characters are not allowed in a newick unquoted label:</span><span>
</span><a name="line-122"></a><span class="hs-comment">-- &quot; \r\n\t\v\b':;,()[]&lt;&gt;&quot;</span><span>
</span><a name="line-123"></a><span class="hs-comment">-- We disallow the '&lt;' &amp; '&gt;' characters in unquoted labels in all newick </span><span>
</span><a name="line-124"></a><span class="hs-comment">-- file formats because they would interfere with the parsing of Foreset </span><span>
</span><a name="line-125"></a><span class="hs-comment">-- Extended Newick file types. The '&lt;' &amp; '&gt;' characters are technically</span><span>
</span><a name="line-126"></a><span class="hs-comment">-- allowed in an unquoted newick label according to the Gary Olsen</span><span>
</span><a name="line-127"></a><span class="hs-comment">-- interpretation of the standard Newick format and the Extended Newick</span><span>
</span><a name="line-128"></a><span class="hs-comment">-- format. However, if a user really want to put '&lt;' &amp; '&gt;' characters in</span><span>
</span><a name="line-129"></a><span class="hs-comment">-- a node label, they can always put such characters in a quoted label.</span><span>
</span><a name="line-130"></a><span class="hs-identifier">unquotedLabel</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679138280"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679138281"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679138282"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679138281"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679138282"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-131"></a><a name="unquotedLabel"><a href="File.Format.Newick.Parser.html#unquotedLabel"><span class="hs-identifier">unquotedLabel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">some</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">noneOf</span><span> </span><a href="File.Format.Newick.Parser.html#invalidUnquotedLabelChars"><span class="hs-identifier hs-var">invalidUnquotedLabelChars</span></a><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span>
</span><a name="line-134"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-135"></a><span class="hs-comment">-- Characters which can ontly appear in a quoted 'NewickNode' label.</span><span>
</span><a name="line-136"></a><span class="hs-identifier">requiresQuotedLabelChars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-137"></a><a name="requiresQuotedLabelChars"><a href="File.Format.Newick.Parser.html#requiresQuotedLabelChars"><span class="hs-identifier">requiresQuotedLabelChars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot; ':;,()[]&lt;&gt;&quot;</span><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-141"></a><span class="hs-comment">-- List of chacracters which __cannot__ appear in an /quoted/ label of a</span><span>
</span><a name="line-142"></a><span class="hs-comment">-- 'NewickNode'.</span><span>
</span><a name="line-143"></a><span class="hs-identifier">invalidQuotedLabelChars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-144"></a><a name="invalidQuotedLabelChars"><a href="File.Format.Newick.Parser.html#invalidQuotedLabelChars"><span class="hs-identifier">invalidQuotedLabelChars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;\r\n\t\f\v\b&quot;</span><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><span>
</span><a name="line-147"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-148"></a><span class="hs-comment">-- List of chacracters which __cannot__ appear in an /unquoted/ label of a</span><span>
</span><a name="line-149"></a><span class="hs-comment">-- 'NewickNode'. A superset of 'invalidQuotedLabelChars'.</span><span>
</span><a name="line-150"></a><span class="hs-identifier">invalidUnquotedLabelChars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-151"></a><a name="invalidUnquotedLabelChars"><a href="File.Format.Newick.Parser.html#invalidUnquotedLabelChars"><span class="hs-identifier">invalidUnquotedLabelChars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Newick.Parser.html#invalidQuotedLabelChars"><span class="hs-identifier hs-var">invalidQuotedLabelChars</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="File.Format.Newick.Parser.html#requiresQuotedLabelChars"><span class="hs-identifier hs-var">requiresQuotedLabelChars</span></a><span>
</span><a name="line-152"></a><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-155"></a><span class="hs-comment">-- Definition of a serialized branch length between two nodes in the Newick</span><span>
</span><a name="line-156"></a><span class="hs-comment">-- tree. Since the Newick tree is impicitly rooted in it's serialization form,</span><span>
</span><a name="line-157"></a><span class="hs-comment">-- the 'branchLength' of a given 'NewickNode' is the branch length itself and</span><span>
</span><a name="line-158"></a><span class="hs-comment">-- it's parent. Becomes non-sensical with extended Newick trees that have nodes</span><span>
</span><a name="line-159"></a><span class="hs-comment">-- with &quot;in-degree&quot; greater than one.</span><span>
</span><a name="line-160"></a><span class="hs-identifier">branchLengthDefinition</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679138277"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679138278"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679138279"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679138278"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679138279"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">Double</span><span>
</span><a name="line-161"></a><a name="branchLengthDefinition"><a href="File.Format.Newick.Parser.html#branchLengthDefinition"><span class="hs-identifier">branchLengthDefinition</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Newick.Parser.html#symbol"><span class="hs-identifier hs-var">symbol</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">':'</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="File.Format.Newick.Parser.html#symbol"><span class="hs-identifier hs-var">symbol</span></a><span> </span><a href="Text.Megaparsec.Custom.html#double"><span class="hs-identifier hs-var">double</span></a><span>
</span><a name="line-162"></a><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-165"></a><span class="hs-comment">-- Convinience combinator for stripping /leading and trailing/ whitespace from a</span><span>
</span><a name="line-166"></a><span class="hs-comment">-- combinator.</span><span>
</span><a name="line-167"></a><span class="hs-identifier">trimmed</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679138273"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679138274"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679138275"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679138274"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679138275"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679138276"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679138275"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679138276"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-168"></a><a name="trimmed"><a href="File.Format.Newick.Parser.html#trimmed"><span class="hs-identifier">trimmed</span></a></a><span> </span><a name="local-6989586621679138320"><a href="#local-6989586621679138320"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Newick.Parser.html#whitespace"><span class="hs-identifier hs-var">whitespace</span></a><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="#local-6989586621679138320"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&lt;*</span><span> </span><a href="File.Format.Newick.Parser.html#whitespace"><span class="hs-identifier hs-var">whitespace</span></a><span>
</span><a name="line-169"></a><span>
</span><a name="line-170"></a><span>
</span><a name="line-171"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-172"></a><span class="hs-comment">-- Convinience combinator for stripping /trailing/ whitespace from a combinator.</span><span>
</span><a name="line-173"></a><span class="hs-identifier">symbol</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679138269"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679138270"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679138271"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679138270"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679138271"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679138272"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679138271"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679138272"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-174"></a><a name="symbol"><a href="File.Format.Newick.Parser.html#symbol"><span class="hs-identifier">symbol</span></a></a><span> </span><a name="local-6989586621679138321"><a href="#local-6989586621679138321"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679138321"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&lt;*</span><span> </span><a href="File.Format.Newick.Parser.html#whitespace"><span class="hs-identifier hs-var">whitespace</span></a><span>
</span><a name="line-175"></a><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-178"></a><span class="hs-comment">-- Definition of space between tokens which can be discarded. This includes</span><span>
</span><a name="line-179"></a><span class="hs-comment">-- spaces /and/ comments.</span><span>
</span><a name="line-180"></a><span class="hs-identifier">whitespace</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679138266"><a href="#local-6989586621679138266"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679138267"><a href="#local-6989586621679138267"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679138268"><a href="#local-6989586621679138268"><span class="hs-identifier">m</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679138266"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679138267"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679138268"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679138267"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679138268"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-181"></a><a name="whitespace"><a href="File.Format.Newick.Parser.html#whitespace"><span class="hs-identifier">whitespace</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">skipMany</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">choice</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">hidden</span><span> </span><a href="#local-6989586621679138322"><span class="hs-identifier hs-var">single</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">hidden</span><span> </span><a href="#local-6989586621679138323"><span class="hs-identifier hs-var">block</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-182"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-183"></a><span>    </span><a name="local-6989586621679138322"><a href="#local-6989586621679138322"><span class="hs-identifier">single</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">void</span><span> </span><span class="hs-identifier hs-var">spaceChar</span><span>
</span><a name="line-184"></a><span>    </span><a name="local-6989586621679138323"><a href="#local-6989586621679138323"><span class="hs-identifier">block</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">skipBlockCommentNested</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tokenToChunk</span><span> </span><a href="#local-6989586621679138324"><span class="hs-identifier hs-var">proxy</span></a><span> </span><span class="hs-char">'['</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tokenToChunk</span><span> </span><a href="#local-6989586621679138324"><span class="hs-identifier hs-var">proxy</span></a><span> </span><span class="hs-char">']'</span><span class="hs-special">)</span><span>
</span><a name="line-185"></a><span>    </span><a name="local-6989586621679138324"><a href="#local-6989586621679138324"><span class="hs-identifier">proxy</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621679138267"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span>    </span><span>
</span><a name="line-188"></a><span class="hs-comment">{-
whitespace = try commentDefinition &lt;|&gt; space
  where
    commentDefinition :: (MonadParsec e s m, Token s ~ Char) =&gt; m ()
    commentDefinition = space *&gt; some (comment commentStart commentEnd *&gt; space) &gt;&gt; pure ()
    commentStart, commentEnd :: (MonadParsec e s m, Token s ~ Char) =&gt; m String
    commentStart = string &quot;[&quot; &lt;?&gt; &quot;\&quot;[\&quot; comment start&quot;
    commentEnd   = string &quot;]&quot; &lt;?&gt; &quot;\&quot;]\&quot; comment end&quot;
-}</span><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-199"></a><span class="hs-comment">-- Joins the nodes of an extended Newick tree which share the same label.</span><span>
</span><a name="line-200"></a><span class="hs-comment">-- Directed cycles from the tree's implicit root will result in a 'ParseError'.</span><span>
</span><a name="line-201"></a><span class="hs-identifier">joinNonUniqueLabeledNodes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679138263"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679138264"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679138265"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679138264"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="File.Format.Newick.Internal.html#NewickNode"><span class="hs-identifier hs-type">NewickNode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679138265"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="File.Format.Newick.Internal.html#NewickNode"><span class="hs-identifier hs-type">NewickNode</span></a><span>
</span><a name="line-202"></a><a name="joinNonUniqueLabeledNodes"><a href="File.Format.Newick.Parser.html#joinNonUniqueLabeledNodes"><span class="hs-identifier">joinNonUniqueLabeledNodes</span></a></a><span> </span><a name="local-6989586621679138325"><a href="#local-6989586621679138325"><span class="hs-identifier">root</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679138327"><span class="hs-identifier hs-var">joinNonUniqueLabeledNodes'</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679138325"><span class="hs-identifier hs-var">root</span></a><span>
</span><a name="line-203"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-204"></a><span>    </span><span>
</span><a name="line-205"></a><span>    </span><span class="hs-comment">-- We first fold over the Newick Tree to collect all labeled nodes and </span><span>
</span><a name="line-206"></a><span>    </span><span class="hs-comment">-- combine thier descendant lists. We use this Map of Newick labels to</span><span>
</span><a name="line-207"></a><span>    </span><span class="hs-comment">-- combined descendant lists for substituting labeled node descendants</span><span>
</span><a name="line-208"></a><span>    </span><span class="hs-comment">-- in a second pass over the Newick Tree.</span><span>
</span><a name="line-209"></a><span>    </span><span class="hs-identifier">joinedNodes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">[</span><a href="File.Format.Newick.Internal.html#NewickNode"><span class="hs-identifier hs-type">NewickNode</span></a><span class="hs-special">]</span><span>
</span><a name="line-210"></a><span>    </span><a name="local-6989586621679138326"><a href="#local-6989586621679138326"><span class="hs-identifier">joinedNodes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="#local-6989586621679138332"><span class="hs-identifier hs-var">joinNodes</span></a><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><a href="#local-6989586621679138331"><span class="hs-identifier hs-var">labeledNodes</span></a><span>
</span><a name="line-211"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-212"></a><span>        </span><a name="local-6989586621679138331"><a href="#local-6989586621679138331"><span class="hs-identifier">labeledNodes</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isJust</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">newickLabel</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679138333"><span class="hs-identifier hs-var">toList'</span></a><span> </span><a href="#local-6989586621679138325"><span class="hs-identifier hs-var">root</span></a><span> </span><span>
</span><a name="line-213"></a><span>        </span><span class="hs-identifier">joinNodes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">[</span><a href="File.Format.Newick.Internal.html#NewickNode"><span class="hs-identifier hs-type">NewickNode</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.Newick.Internal.html#NewickNode"><span class="hs-identifier hs-type">NewickNode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">[</span><a href="File.Format.Newick.Internal.html#NewickNode"><span class="hs-identifier hs-type">NewickNode</span></a><span class="hs-special">]</span><span>
</span><a name="line-214"></a><span>        </span><a name="local-6989586621679138332"><a href="#local-6989586621679138332"><span class="hs-identifier">joinNodes</span></a></a><span> </span><a name="local-6989586621679138334"><a href="#local-6989586621679138334"><span class="hs-identifier">mapping</span></a></a><span> </span><a name="local-6989586621679138335"><a href="#local-6989586621679138335"><span class="hs-identifier">node</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">insertWith</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromJust</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">newickLabel</span><span> </span><a href="#local-6989586621679138335"><span class="hs-identifier hs-var">node</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">descendants</span><span> </span><a href="#local-6989586621679138335"><span class="hs-identifier hs-var">node</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679138334"><span class="hs-identifier hs-var">mapping</span></a><span>
</span><a name="line-215"></a><span>        </span><a name="local-6989586621679138333"><a href="#local-6989586621679138333"><span class="hs-identifier">toList'</span></a></a><span> </span><a name="local-6989586621679138336"><a href="#local-6989586621679138336"><span class="hs-identifier">node</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679138336"><span class="hs-identifier hs-var">node</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">=&lt;&lt;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679138333"><span class="hs-identifier hs-var">toList'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">descendants</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679138336"><span class="hs-identifier hs-var">node</span></a><span>
</span><a name="line-216"></a><span>        </span><span>
</span><a name="line-217"></a><span>    </span><span class="hs-comment">-- When transforming the Newick Tree to the Newick Network by joining </span><span>
</span><a name="line-218"></a><span>    </span><span class="hs-comment">-- identically labeled nodes, there exists the possiblily that a directed </span><span>
</span><a name="line-219"></a><span>    </span><span class="hs-comment">-- cycle is defined in the tree which will result in infinite recursion </span><span>
</span><a name="line-220"></a><span>    </span><span class="hs-comment">-- during the transformation process (and probably erroneous processing</span><span>
</span><a name="line-221"></a><span>    </span><span class="hs-comment">-- in subsequent graph computations). To prevent this we track previously</span><span>
</span><a name="line-222"></a><span>    </span><span class="hs-comment">-- processed nodes via a stack to detect cycles. Upon cycle detection we</span><span>
</span><a name="line-223"></a><span>    </span><span class="hs-comment">-- return a Left value of type Either ParseError NewickNode to represent </span><span>
</span><a name="line-224"></a><span>    </span><span class="hs-comment">-- a parse error. It is assumed that cycles are note permitted in our</span><span>
</span><a name="line-225"></a><span>    </span><span class="hs-comment">-- PhyloGraph data structures.</span><span>
</span><a name="line-226"></a><span>    </span><span class="hs-identifier">joinNonUniqueLabeledNodes'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679138328"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679138329"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679138330"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Token</span><span> </span><a href="#local-6989586621679138329"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.Newick.Internal.html#NewickNode"><span class="hs-identifier hs-type">NewickNode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679138330"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="File.Format.Newick.Internal.html#NewickNode"><span class="hs-identifier hs-type">NewickNode</span></a><span>
</span><a name="line-227"></a><span>    </span><a name="local-6989586621679138327"><a href="#local-6989586621679138327"><span class="hs-identifier">joinNonUniqueLabeledNodes'</span></a></a><span> </span><a name="local-6989586621679138337"><a href="#local-6989586621679138337"><span class="hs-identifier">stack</span></a></a><span> </span><a name="local-6989586621679138338"><a href="#local-6989586621679138338"><span class="hs-identifier">node</span></a></a><span>
</span><a name="line-228"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679138346"><span class="hs-identifier hs-var">hasCycle</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><a href="#local-6989586621679138348"><span class="hs-identifier hs-var">cycleError</span></a><span>
</span><a name="line-229"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679138341"><span class="hs-identifier hs-var">children</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679138344"><span class="hs-identifier hs-var">newNode</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-230"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679138343"><span class="hs-identifier hs-var">resultNode</span></a><span> </span><a href="#local-6989586621679138341"><span class="hs-identifier hs-var">children</span></a><span>
</span><a name="line-231"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-232"></a><span>        </span><a name="local-6989586621679138339"><a href="#local-6989586621679138339"><span class="hs-identifier">label</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">newickLabel</span><span> </span><a href="#local-6989586621679138338"><span class="hs-identifier hs-var">node</span></a><span>
</span><a name="line-233"></a><span>        </span><a name="local-6989586621679138340"><a href="#local-6989586621679138340"><span class="hs-identifier">joinedList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679138339"><span class="hs-identifier hs-var">label</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">lookup</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679138326"><span class="hs-identifier hs-var">joinedNodes</span></a><span class="hs-special">)</span><span>
</span><a name="line-234"></a><span>        </span><a name="local-6989586621679138341"><a href="#local-6989586621679138341"><span class="hs-identifier">children</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">descendants</span><span> </span><a href="#local-6989586621679138338"><span class="hs-identifier hs-var">node</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679138340"><span class="hs-identifier hs-var">joinedList</span></a><span>
</span><a name="line-235"></a><span>        </span><a name="local-6989586621679138342"><a href="#local-6989586621679138342"><span class="hs-identifier">gatherList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">traverse</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679138327"><span class="hs-identifier hs-var">joinNonUniqueLabeledNodes'</span></a><span> </span><a href="#local-6989586621679138345"><span class="hs-identifier hs-var">stack'</span></a><span class="hs-special">)</span><span>
</span><a name="line-236"></a><span>        </span><a name="local-6989586621679138343"><a href="#local-6989586621679138343"><span class="hs-identifier">resultNode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621679138344"><span class="hs-identifier hs-var">newNode</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679138342"><span class="hs-identifier hs-var">gatherList</span></a><span>
</span><a name="line-237"></a><span>        </span><a name="local-6989586621679138344"><a href="#local-6989586621679138344"><span class="hs-identifier">newNode</span></a></a><span> </span><a name="local-6989586621679138350"><a href="#local-6989586621679138350"><span class="hs-identifier">x</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Newick.Internal.html#NewickNode"><span class="hs-identifier hs-var">NewickNode</span></a><span> </span><a href="#local-6989586621679138350"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679138339"><span class="hs-identifier hs-var">label</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">branchLength</span><span> </span><a href="#local-6989586621679138338"><span class="hs-identifier hs-var">node</span></a><span class="hs-special">)</span><span>
</span><a name="line-238"></a><span>        </span><a name="local-6989586621679138345"><a href="#local-6989586621679138345"><span class="hs-identifier">stack'</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679138339"><span class="hs-identifier hs-var">label</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679138337"><span class="hs-identifier hs-var">stack</span></a><span>
</span><a name="line-239"></a><span>        </span><a name="local-6989586621679138346"><a href="#local-6989586621679138346"><span class="hs-identifier">hasCycle</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">isJust</span><span> </span><a href="#local-6989586621679138339"><span class="hs-identifier hs-var">label</span></a><span>
</span><a name="line-240"></a><span>                  </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">dropWhile</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><a href="#local-6989586621679138339"><span class="hs-identifier hs-var">label</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679138337"><span class="hs-identifier hs-var">stack</span></a><span>
</span><a name="line-241"></a><span>        </span><a name="local-6989586621679138347"><a href="#local-6989586621679138347"><span class="hs-identifier">cycle'</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679138339"><span class="hs-identifier hs-var">label</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">takeWhile</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><a href="#local-6989586621679138339"><span class="hs-identifier hs-var">label</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679138337"><span class="hs-identifier hs-var">stack</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679138339"><span class="hs-identifier hs-var">label</span></a><span class="hs-special">]</span><span>
</span><a name="line-242"></a><span>        </span><a name="local-6989586621679138348"><a href="#local-6989586621679138348"><span class="hs-identifier">cycleError</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">init</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">unlines</span><span> </span><span class="hs-comment">-- we use init to remove trailing newline</span><span>
</span><a name="line-243"></a><span>                   </span><span class="hs-special">[</span><span> </span><span class="hs-string">&quot;Cycle detected in Newick tree definition&quot;</span><span>
</span><a name="line-244"></a><span>                   </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679138349"><span class="hs-identifier hs-var">prettyErr</span></a><span> </span><a href="#local-6989586621679138347"><span class="hs-identifier hs-var">cycle'</span></a><span>
</span><a name="line-245"></a><span>                   </span><span class="hs-special">]</span><span>
</span><a name="line-246"></a><span>        </span><a name="local-6989586621679138349"><a href="#local-6989586621679138349"><span class="hs-identifier">prettyErr</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">intercalate</span><span> </span><span class="hs-string">&quot; -&gt; &quot;</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">show</span><span>
</span><a name="line-247"></a></pre></body></html>