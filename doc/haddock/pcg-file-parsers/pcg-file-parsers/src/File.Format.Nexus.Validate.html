<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-2"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-3"></a><span class="hs-comment">-- Module      :  File.Format.Nexus.Validate</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- Copyright   :  (c) 2015-2015 Ward Wheeler</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- License     :  BSD-style</span><span>
</span><a name="line-6"></a><span class="hs-comment">--</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- Maintainer  :  wheeler@amnh.org</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- Stability   :  provisional</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- Portability :  portable</span><span>
</span><a name="line-10"></a><span class="hs-comment">--</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- Functions for validating Nexus files.</span><span>
</span><a name="line-12"></a><span class="hs-comment">--</span><span>
</span><a name="line-13"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts, TypeFamilies #-}</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">File</span><span class="hs-operator">.</span><span class="hs-identifier">Format</span><span class="hs-operator">.</span><span class="hs-identifier">Nexus</span><span class="hs-operator">.</span><span class="hs-identifier">Validate</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Bifunctor</span><span>            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">second</span><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Char</span><span>                 </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isSpace</span><span class="hs-special">)</span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Either</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Foldable</span><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span>                 </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sort</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sortBy</span><span class="hs-special">)</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span class="hs-operator">.</span><span class="hs-identifier">NonEmpty</span><span>        </span><span class="hs-special">(</span><span class="hs-identifier hs-type">NonEmpty</span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">:|</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-25"></a><span class="hs-comment">--import qualified Data.List.NonEmpty as NE</span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span class="hs-operator">.</span><span class="hs-identifier">Split</span><span>           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">splitOn</span><span class="hs-special">)</span><span>
</span><a name="line-27"></a><span class="hs-comment">--import           Data.List.Utility      (chunksOf)</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Map</span><span class="hs-operator">.</span><span class="hs-identifier">Lazy</span><span>             </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Map</span><span class="hs-operator">.</span><span class="hs-identifier">Lazy</span><span>      </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">M</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Monoid</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Ord</span><span>                  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">comparing</span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Semigroup</span><span class="hs-operator">.</span><span class="hs-identifier">Foldable</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Set</span><span>                  </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Set</span><span class="hs-special">)</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Set</span><span>           </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Set</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Vector</span><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span class="hs-special">)</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Vector</span><span>        </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">V</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span>           </span><a href="File.Format.Newick.html"><span class="hs-identifier">File</span><span class="hs-operator">.</span><span class="hs-identifier">Format</span><span class="hs-operator">.</span><span class="hs-identifier">Newick</span></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span>           </span><a href="File.Format.Nexus.Data.html"><span class="hs-identifier">File</span><span class="hs-operator">.</span><span class="hs-identifier">Format</span><span class="hs-operator">.</span><span class="hs-identifier">Nexus</span><span class="hs-operator">.</span><span class="hs-identifier">Data</span></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Safe</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Megaparsec</span><span>
</span><a name="line-42"></a><span class="hs-comment">--import qualified Text.Megaparsec.Prim as P (Token)</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span>           </span><a href="Text.Megaparsec.Custom.html"><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Megaparsec</span><span class="hs-operator">.</span><span class="hs-identifier">Custom</span></a><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span class="hs-comment">-- import Debug.Trace (trace)</span><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-comment">-- Because some errors are dependent on passing some other validation, they've been split into</span><span>
</span><a name="line-49"></a><span class="hs-comment">-- dependant and independant errors. Errors are enumerated below, along with their dependancies.</span><span>
</span><a name="line-50"></a><span class="hs-comment">-- Comments are included in the code that explain which of the below errors are caught at various points.</span><span>
</span><a name="line-51"></a><span class="hs-comment">-- Note that nos. 4--6, below, are only dependent on 3, so are simply done as nested ifs. This may</span><span>
</span><a name="line-52"></a><span class="hs-comment">-- or may not be best practice.                                                             coded as</span><span>
</span><a name="line-53"></a><span class="hs-comment">-- Errors currently caught: # error                                    err/warn   dependency   inde- or de-pendant    finished</span><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span class="hs-comment">--  ** removed ** too many sequence blocks                                            -              indep              done</span><span>
</span><a name="line-56"></a><span class="hs-comment">--     There are actually two subcases here:</span><span>
</span><a name="line-57"></a><span class="hs-comment">--        too many aligned, too many unaligned</span><span>
</span><a name="line-58"></a><span class="hs-comment">--  ** removed ** No sequence blocks                                                  -              indep              done</span><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span class="hs-comment">--  1. No usable blocks                                                 error         -              indep              done</span><span>
</span><a name="line-61"></a><span class="hs-comment">-----------------------------------  Everything below this relies on 1  -------------------------------------</span><span>
</span><a name="line-62"></a><span class="hs-comment">--  2. Too many taxa blocks                                             warn          -              indep              done</span><span>
</span><a name="line-63"></a><span class="hs-comment">--  3. No taxa specified---multiple checks, in multiple blocks          error         -              indep          not done</span><span>
</span><a name="line-64"></a><span class="hs-comment">--  4. No seqMatrix in some sequence block                              warn          -              indep              done</span><span>
</span><a name="line-65"></a><span class="hs-comment">--  5. No dimensions in some sequence block                             error         -              indep              done</span><span>
</span><a name="line-66"></a><span class="hs-comment">--  6. Non-data sequence block with &quot;nolabels&quot;, or data block           error         -              indep              done</span><span>
</span><a name="line-67"></a><span class="hs-comment">--     but no taxa block _and_ no newtaxa specified in</span><span>
</span><a name="line-68"></a><span class="hs-comment">--     sequence blocks</span><span>
</span><a name="line-69"></a><span class="hs-comment">--  7. &quot;newtaxa&quot; keyword in characters or unaligned block,              error         -                dep              done</span><span>
</span><a name="line-70"></a><span class="hs-comment">--     but &quot;nolabels&quot; and no &quot;taxlabels&quot; subblock</span><span>
</span><a name="line-71"></a><span class="hs-comment">--  8. &quot;newtaxa&quot; keyword in characters or unaligned block,              warn          5                dep              done</span><span>
</span><a name="line-72"></a><span class="hs-comment">--     but ntaxa missing</span><span>
</span><a name="line-73"></a><span class="hs-comment">--  9. &quot;nolabels&quot; but labels actually present---</span><span>
</span><a name="line-74"></a><span class="hs-comment">--     subsumed under 10, 11, 12                                        n/a           -                dep</span><span>
</span><a name="line-75"></a><span class="hs-comment">-- 10. Matrix has alphabet values not specified                         error         4                dep</span><span>
</span><a name="line-76"></a><span class="hs-comment">-- 11. Aligned block not Aligned                                        error         4                dep</span><span>
</span><a name="line-77"></a><span class="hs-comment">-- 12. Matrix has non-spec'ed taxa                                      error         4,5              dep              revisit</span><span>
</span><a name="line-78"></a><span class="hs-comment">-- 13. Matrix interleaved, but some blocks missing taxa                 error         4,5              dep              done</span><span>
</span><a name="line-79"></a><span class="hs-comment">--     ---for aligned matrices, caught by 10</span><span>
</span><a name="line-80"></a><span class="hs-comment">--     ---for unaligned, caught by combo of 12 &amp; 22</span><span>
</span><a name="line-81"></a><span class="hs-comment">-- 14. Matrix interleaved, unlabeled, but length not a                  error         4                dep              done</span><span>
</span><a name="line-82"></a><span class="hs-comment">--     multiple of # of taxa</span><span>
</span><a name="line-83"></a><span class="hs-comment">-- 15. Character count is incorrect                                     error         4,5              dep</span><span>
</span><a name="line-84"></a><span class="hs-comment">-- 16. Taxa count is incorrect                                          error         5                dep              done</span><span>
</span><a name="line-85"></a><span class="hs-comment">--     a) in taxa block</span><span>
</span><a name="line-86"></a><span class="hs-comment">--     b) in taxlabels in seq. block</span><span>
</span><a name="line-87"></a><span class="hs-comment">--     b) in matrix in sequence block</span><span>
</span><a name="line-88"></a><span class="hs-comment">-- 17. &quot;nolabels&quot; but there is a taxa block and newtaxa in seq block,   error         7,8              dep          not done</span><span>
</span><a name="line-89"></a><span class="hs-comment">--     so order of sequences is unclear</span><span>
</span><a name="line-90"></a><span class="hs-comment">-- 18. Missing semicolons                                               error         -              indep         caught in parse</span><span>
</span><a name="line-91"></a><span class="hs-comment">-- 19. Equate or symbols strings missing their closing quotes           error         3                dep         caught in parse (but ignored?)</span><span>
</span><a name="line-92"></a><span class="hs-comment">-- 20. Match character can't be a space                                 error         3                dep          not done</span><span>
</span><a name="line-93"></a><span class="hs-comment">-- 21. Space in taxon name                                              error         5,6              dep              done</span><span>
</span><a name="line-94"></a><span class="hs-comment">--     ---for aligned, should be caught by 16</span><span>
</span><a name="line-95"></a><span class="hs-comment">--     ---for unaligned, caught by combo of 12 &amp; 22</span><span>
</span><a name="line-96"></a><span class="hs-comment">-- 22. In unaligned, interleaved block, a taxon is repeated             error         3                dep              done</span><span>
</span><a name="line-97"></a><span class="hs-comment">-- 23. Since whitespace is allowed in sequences, and \n counts</span><span>
</span><a name="line-98"></a><span class="hs-comment">--     as whitespace, so I need to eliminate that. At the same time,</span><span>
</span><a name="line-99"></a><span class="hs-comment">--     it seems to be possible to list taxa *only* inside the</span><span>
</span><a name="line-100"></a><span class="hs-comment">--     character matrix. In that specific case, I can't</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span class="hs-comment">-- TODOs:</span><span>
</span><a name="line-103"></a><span class="hs-comment">-- &#8226; Verify character metadata, especially alphabets</span><span>
</span><a name="line-104"></a><span class="hs-comment">-- &#8226;&#160;deal with special chars in step matrices</span><span>
</span><a name="line-105"></a><span class="hs-comment">-- &#8226; check for and eliminate thusly noted characters (occurs in at least two places in Nexus file?)</span><span>
</span><a name="line-106"></a><span class="hs-comment">-- &#8226; add error checking on equate string (it needs to be of form a=b, [c=d]) ** also, look up Bachus-Naur form again.</span><span>
</span><a name="line-107"></a><span class="hs-comment">-- &#8226; ignore case</span><span>
</span><a name="line-108"></a><span class="hs-comment">-- &#8226;&#160;check alignment and length of aligned blocks</span><span>
</span><a name="line-109"></a><span class="hs-comment">-- &#8226; check tcm for size; see how *'s work in tcm</span><span>
</span><a name="line-110"></a><span class="hs-comment">-- &#8226; check for chars that aren't in alphabet</span><span>
</span><a name="line-111"></a><span class="hs-comment">-- &#8226; fail on incorrect datatype</span><span>
</span><a name="line-112"></a><span class="hs-comment">-- &#8226; dependentErrors &amp; independentErrors become :: String error, String warning =&gt; [Maybe (Either error warning)]</span><span>
</span><a name="line-113"></a><span>     </span><span class="hs-comment">-- then partitionEithers . catMaybes, etc., etc. (talk to Alex)</span><span>
</span><a name="line-114"></a><span class="hs-comment">-- &#8226; warn that eliminate (among several other things: match, additive, weight(, etc.?)) doesn't work on unaligned data</span><span>
</span><a name="line-115"></a><span class="hs-comment">-- &#8226;&#160;capture data on ordered (additive) chars</span><span>
</span><a name="line-116"></a><span class="hs-comment">-- &#8226; check for gap treatment, possibly replace with missing</span><span>
</span><a name="line-117"></a><span class="hs-comment">-- &#8226; symbol order in TCM should be the same as symbol order in alphabet representation</span><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span class="hs-comment">-- | Some documentation should probably go here</span><span>
</span><a name="line-120"></a><span class="hs-identifier">validateNexusParseResult</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadParsec</span><span> </span><a href="#local-6989586621679146220"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679146221"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679146222"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-comment">{- , Show s, Token s ~ Char -}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="File.Format.Nexus.Data.html#NexusParseResult"><span class="hs-identifier hs-type">NexusParseResult</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679146222"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="File.Format.Nexus.Data.html#Nexus"><span class="hs-identifier hs-type">Nexus</span></a><span>
</span><a name="line-121"></a><a name="validateNexusParseResult"><a href="File.Format.Nexus.Validate.html#validateNexusParseResult"><span class="hs-identifier">validateNexusParseResult</span></a></a><span> </span><span class="hs-special">(</span><a href="File.Format.Nexus.Data.html#NexusParseResult"><span class="hs-identifier hs-var">NexusParseResult</span></a><span> </span><a name="local-6989586621679146223"><a href="#local-6989586621679146223"><span class="hs-identifier">inputSeqBlocks</span></a></a><span> </span><a name="local-6989586621679146224"><a href="#local-6989586621679146224"><span class="hs-identifier">taxas</span></a></a><span> </span><a name="local-6989586621679146225"><a href="#local-6989586621679146225"><span class="hs-identifier">treeSet</span></a></a><span> </span><a name="local-6989586621679146226"><a href="#local-6989586621679146226"><span class="hs-identifier">assumptions</span></a></a><span> </span><a name="local-6989586621679146227"><a href="#local-6989586621679146227"><span class="hs-identifier">_ignored</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-122"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679146223"><span class="hs-identifier hs-var">inputSeqBlocks</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679146224"><span class="hs-identifier hs-var">taxas</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679146225"><span class="hs-identifier hs-var">treeSet</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Text.Megaparsec.Custom.html#fails"><span class="hs-identifier hs-var">fails</span></a><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;There are no usable blocks in this file.&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- error 1</span><span>
</span><a name="line-123"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679146228"><span class="hs-identifier hs-var">independentErrors</span></a><span class="hs-special">)</span><span>                      </span><span class="hs-glyph">=</span><span> </span><a href="Text.Megaparsec.Custom.html#fails"><span class="hs-identifier hs-var">fails</span></a><span> </span><a href="#local-6989586621679146228"><span class="hs-identifier hs-var">independentErrors</span></a><span>
</span><a name="line-124"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679146232"><span class="hs-identifier hs-var">dependentErrors</span></a><span class="hs-special">)</span><span>                        </span><span class="hs-glyph">=</span><span> </span><a href="Text.Megaparsec.Custom.html#fails"><span class="hs-identifier hs-var">fails</span></a><span> </span><a href="#local-6989586621679146232"><span class="hs-identifier hs-var">dependentErrors</span></a><span>
</span><a name="line-125"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                                         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679146239"><span class="hs-identifier hs-var">maybeThing</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-126"></a><span>                                                              </span><span class="hs-identifier hs-var">Left</span><span>   </span><a name="local-6989586621679146256"><a href="#local-6989586621679146256"><span class="hs-identifier">err</span></a></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><a href="#local-6989586621679146256"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-127"></a><span>                                                              </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679146257"><a href="#local-6989586621679146257"><span class="hs-identifier">outputSeqTups</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="File.Format.Nexus.Data.html#Nexus"><span class="hs-identifier hs-var">Nexus</span></a><span> </span><span class="hs-comment">{-taxaLst-}</span><span> </span><a href="#local-6989586621679146257"><span class="hs-identifier hs-var">outputSeqTups</span></a><span> </span><a href="#local-6989586621679146246"><span class="hs-identifier hs-var">translatedTrees</span></a><span>
</span><a name="line-128"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-129"></a><span>      </span><span class="hs-comment">-- Ordered by call, so first independentErrors, then dependentErrors, then outputSeqTups. Dependencies are subgrouped according to calling fn.</span><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span>      </span><span class="hs-comment">-- Independent errors</span><span>
</span><a name="line-132"></a><span>        </span><a name="local-6989586621679146228"><a href="#local-6989586621679146228"><span class="hs-identifier">independentErrors</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">catMaybes</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679146229"><span class="hs-identifier hs-var">noTaxaError</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679146230"><span class="hs-identifier hs-var">multipleTaxaBlocks</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679146231"><span class="hs-identifier hs-var">seqMatrixDimsErrors</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-comment">{- wrongDataTypeErrors &lt;&gt; -}</span><span> </span><a href="#local-6989586621679146245"><span class="hs-identifier hs-var">treeTranslateErrors</span></a><span> </span><span class="hs-comment">-- sequenceBlockErrors</span><span>
</span><a name="line-133"></a><span>      </span><span class="hs-comment">-- types of independent errors</span><span>
</span><a name="line-134"></a><span class="hs-comment">--        DEFINED BUT NOT USED: (taxaDimsMissingError)</span><span>
</span><a name="line-135"></a><span class="hs-comment">--        taxaDimsMissingError = taxaDimsMissing taxas inputSeqBlocks</span><span>
</span><a name="line-136"></a><span>        </span><a name="local-6989586621679146229"><a href="#local-6989586621679146229"><span class="hs-identifier">noTaxaError</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679146224"><span class="hs-identifier hs-var">taxas</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679146247"><a href="#local-6989586621679146247"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679146248"><a href="#local-6989586621679146248"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679146248"><span class="hs-identifier hs-var">acc</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="File.Format.Nexus.Validate.html#areNewTaxa"><span class="hs-identifier hs-var">areNewTaxa</span></a><span> </span><a href="#local-6989586621679146247"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621679146223"><span class="hs-identifier hs-var">inputSeqBlocks</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- will register as False if inputSeqBlocks is empty</span><span>
</span><a name="line-137"></a><span>                             </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-string">&quot;Taxa are never specified. \n&quot;</span><span>  </span><span class="hs-comment">{-++ (show taxas) ++ &quot; &quot; ++ (show inputSeqBlocks) -}</span><span> </span><span class="hs-comment">-- error 6</span><span>
</span><a name="line-138"></a><span>                             </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-139"></a><span>        </span><a name="local-6989586621679146230"><a href="#local-6989586621679146230"><span class="hs-identifier">multipleTaxaBlocks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679146224"><span class="hs-identifier hs-var">taxas</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-140"></a><span>                             </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-string">&quot;Multiple taxa blocks supplied. This is unclear input, and not allowed.\n&quot;</span><span>  </span><span class="hs-comment">-- error 1</span><span>
</span><a name="line-141"></a><span>                             </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-142"></a><span>        </span><a name="local-6989586621679146231"><a href="#local-6989586621679146231"><span class="hs-identifier">seqMatrixDimsErrors</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="File.Format.Nexus.Validate.html#seqMatrixMissing"><span class="hs-identifier hs-var">seqMatrixMissing</span></a><span> </span><a href="#local-6989586621679146223"><span class="hs-identifier hs-var">inputSeqBlocks</span></a><span> </span><span class="hs-operator hs-var">++</span><span>  </span><span class="hs-comment">-- Note that seqMatrixDimsErrors will be [] if</span><span>
</span><a name="line-143"></a><span>                                                                                               </span><span class="hs-comment">-- there are no character, unaligned or data blocks.</span><span>
</span><a name="line-144"></a><span>                                                                                               </span><span class="hs-comment">-- This allows us to do tree manipulations in their absence.</span><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><span>                              </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="File.Format.Nexus.Validate.html#seqDimsMissing"><span class="hs-identifier hs-var">seqDimsMissing</span></a><span> </span><a href="#local-6989586621679146223"><span class="hs-identifier hs-var">inputSeqBlocks</span></a><span>
</span><a name="line-147"></a><span>        </span><span class="hs-comment">-- wrongDataTypeErrors = foldr (\x acc -&gt; wrongDataType x : acc) [] inputSeqBlocks</span><span>
</span><a name="line-148"></a><span>
</span><a name="line-149"></a><span>      </span><span class="hs-comment">-- Dependent errors</span><span>
</span><a name="line-150"></a><span>        </span><a name="local-6989586621679146232"><a href="#local-6989586621679146232"><span class="hs-identifier">dependentErrors</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">catMaybes</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679146233"><span class="hs-identifier hs-var">incorrectTaxaBlockCount</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-special">(</span><span class="hs-comment">{- seqDimsError ++ -}</span><span> </span><a href="#local-6989586621679146234"><span class="hs-identifier hs-var">missingCloseQuotes</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679146235"><span class="hs-identifier hs-var">seqTaxaCountErrors</span></a><span> </span><span class="hs-comment">{- ++ {- mtxTaxonCountErrors ++
                                                                 TODO: decide if I can really delete this and seqDimsError and incorrectCharCount. -} incorrectCharCount -}</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-152"></a><span>
</span><a name="line-153"></a><span>      </span><span class="hs-comment">-- types of dependent errors</span><span>
</span><a name="line-154"></a><span>        </span><a name="local-6989586621679146233"><a href="#local-6989586621679146233"><span class="hs-identifier">incorrectTaxaBlockCount</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146249"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679146224"><span class="hs-identifier hs-var">taxas</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="File.Format.Nexus.Data.html#TaxaSpecification"><span class="hs-identifier hs-var">TaxaSpecification</span></a><span> </span><a name="local-6989586621679146251"><a href="#local-6989586621679146251"><span class="hs-identifier">num</span></a></a><span> </span><a name="local-6989586621679146252"><a href="#local-6989586621679146252"><span class="hs-identifier">listedTaxa</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-155"></a><span>            </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679146251"><span class="hs-identifier hs-var">num</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679146252"><span class="hs-identifier hs-var">listedTaxa</span></a><span>
</span><a name="line-156"></a><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-string">&quot;Incorrect number of taxa in taxa block.\n&quot;</span><span> </span><span class="hs-comment">{- ++ (show num) ++ &quot; &quot; ++ (show taxons) -}</span><span> </span><span class="hs-comment">-- error 16a</span><span>
</span><a name="line-157"></a><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-158"></a><span>            </span><span class="hs-keyword">where</span><span>
</span><a name="line-159"></a><span>                </span><a name="local-6989586621679146249"><a href="#local-6989586621679146249"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621679146250"><a href="#local-6989586621679146250"><span class="hs-identifier">x</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679146250"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-160"></a><span>                </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-161"></a><span>        </span><span class="hs-comment">--seqDimsError        = map mtxTax inputSeqBlocks</span><span>
</span><a name="line-162"></a><span>          </span><span class="hs-comment">--where</span><span>
</span><a name="line-163"></a><span>          </span><span class="hs-comment">--   f (PhyloSequence _ mat _ dim _ _ _) = mat</span><span>
</span><a name="line-164"></a><span>        </span><a name="local-6989586621679146234"><a href="#local-6989586621679146234"><span class="hs-identifier">missingCloseQuotes</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lefts</span><span> </span><a href="#local-6989586621679146236"><span class="hs-identifier hs-var">equates</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lefts</span><span> </span><a href="#local-6989586621679146237"><span class="hs-identifier hs-var">symbols'</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- error 19</span><span>
</span><a name="line-165"></a><span>        </span><a name="local-6989586621679146235"><a href="#local-6989586621679146235"><span class="hs-identifier">seqTaxaCountErrors</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="File.Format.Nexus.Validate.html#checkForNewTaxa"><span class="hs-identifier hs-var">checkForNewTaxa</span></a><span> </span><a href="#local-6989586621679146223"><span class="hs-identifier hs-var">inputSeqBlocks</span></a><span> </span><span class="hs-comment">-- errors 7, 8, 16b</span><span>
</span><a name="line-166"></a><span>
</span><a name="line-167"></a><span class="hs-comment">--        DEFINED BUT NOT USED: (mtxTaxonCountErrors)</span><span>
</span><a name="line-168"></a><span class="hs-comment">--        mtxTaxonCountErrors = foldr (\x acc -&gt; getMatrixTaxonRecurrenceErrors x ++ acc) [] inputSeqBlocks -- errors 12, 22</span><span>
</span><a name="line-169"></a><span>
</span><a name="line-170"></a><span class="hs-comment">--        incorrectCharCount  = checkSeqLength (filter (\x -&gt; alignedSeq x) inputSeqBlocks) outputSeqTups</span><span>
</span><a name="line-171"></a><span class="hs-comment">--        TODO: This doesn't work, because it takes an entire list of PhyloSequence blocks and the complete, concatted sequences.</span><span>
</span><a name="line-172"></a><span class="hs-comment">--              It needs to take place at a different point in the process.</span><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span>      </span><span class="hs-comment">-- dependencies for dependent errors</span><span>
</span><a name="line-175"></a><span>        </span><a name="local-6989586621679146236"><a href="#local-6989586621679146236"><span class="hs-identifier">equates</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="File.Format.Nexus.Validate.html#getEquates"><span class="hs-identifier hs-var">getEquates</span></a><span> </span><a href="#local-6989586621679146223"><span class="hs-identifier hs-var">inputSeqBlocks</span></a><span>
</span><a name="line-176"></a><span>        </span><a name="local-6989586621679146237"><a href="#local-6989586621679146237"><span class="hs-identifier">symbols'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="File.Format.Nexus.Validate.html#getSymbols"><span class="hs-identifier hs-var">getSymbols</span></a><span> </span><a href="#local-6989586621679146223"><span class="hs-identifier hs-var">inputSeqBlocks</span></a><span>
</span><a name="line-177"></a><span>        </span><a name="local-6989586621679146238"><a href="#local-6989586621679146238"><span class="hs-identifier">taxaLst</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679146224"><span class="hs-identifier hs-var">taxas</span></a><span>
</span><a name="line-178"></a><span>                      </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">taxaLabels</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679146224"><span class="hs-identifier hs-var">taxas</span></a><span>
</span><a name="line-179"></a><span>                      </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span>      </span><span class="hs-comment">-- these are still dependencies for dependent errors, but they're also the beginning of the output gathering.</span><span>
</span><a name="line-182"></a><span>        </span><a name="local-6989586621679146239"><a href="#local-6989586621679146239"><span class="hs-identifier">maybeThing</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#foldSeqs"><span class="hs-identifier hs-var">foldSeqs</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679146241"><span class="hs-identifier hs-var">seqMetadataTuples</span></a><span>
</span><a name="line-183"></a><span>        </span><span class="hs-comment">--seqMetadataTuples = map (\singleSeq -&gt; ( getSeqFromMatrix singleSeq taxaLst</span><span>
</span><a name="line-184"></a><span>        </span><span class="hs-comment">--                          , getCharMetadata costMatrix singleSeq</span><span>
</span><a name="line-185"></a><span>        </span><span class="hs-comment">--                          )) inputSeqBlocks -- TODO: replace getSeqFromMatrix blah blah with parsedSeqs</span><span>
</span><a name="line-186"></a><span>        </span><a name="local-6989586621679146240"><a href="#local-6989586621679146240"><span class="hs-identifier">costMatrix</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">headMay</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">tcm</span><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><span class="hs-identifier hs-var">headMay</span><span> </span><a href="#local-6989586621679146226"><span class="hs-identifier hs-var">assumptions</span></a><span> </span><span class="hs-comment">-- TODO: why does this work?</span><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span>        </span><a name="local-6989586621679146241"><a href="#local-6989586621679146241"><span class="hs-identifier">seqMetadataTuples</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146242"><span class="hs-identifier hs-var">createSeqMetaTuples</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679146243"><span class="hs-identifier hs-var">parsedSeqs</span></a><span>
</span><a name="line-189"></a><span>        </span><a name="local-6989586621679146242"><a href="#local-6989586621679146242"><span class="hs-identifier">createSeqMetaTuples</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-special">(</span><a href="File.Format.Nexus.Validate.html#getCharMetadata"><span class="hs-identifier hs-var">getCharMetadata</span></a><span> </span><a href="#local-6989586621679146240"><span class="hs-identifier hs-var">costMatrix</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">zip</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679146223"><span class="hs-identifier hs-var">inputSeqBlocks</span></a><span class="hs-special">)</span><span>
</span><a name="line-190"></a><span>        </span><a name="local-6989586621679146243"><a href="#local-6989586621679146243"><span class="hs-identifier">parsedSeqs</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#decisionTree"><span class="hs-identifier hs-var">decisionTree</span></a><span> </span><a href="#local-6989586621679146223"><span class="hs-identifier hs-var">inputSeqBlocks</span></a><span> </span><a href="#local-6989586621679146238"><span class="hs-identifier hs-var">taxaLst</span></a><span>
</span><a name="line-191"></a><span>        </span><span class="hs-comment">-- taxaSeqVector = V.fromList [(taxon, alignedTaxaSeqMap M.! taxon) | taxon &lt;- taxaLst]</span><span>
</span><a name="line-192"></a><span>        </span><span class="hs-comment">--unalignedTaxaSeqMap = getSeqFromMatrix (getBlock &quot;unaligned&quot; inputSeqBlocks) taxaLst</span><span>
</span><a name="line-193"></a><span>
</span><a name="line-194"></a><span>        </span><a name="local-6989586621679146244"><a href="#local-6989586621679146244"><span class="hs-identifier">translateTreesResult</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#translateTrees"><span class="hs-identifier hs-var">translateTrees</span></a><span> </span><a href="#local-6989586621679146238"><span class="hs-identifier hs-var">taxaLst</span></a><span> </span><a href="#local-6989586621679146225"><span class="hs-identifier hs-var">treeSet</span></a><span>
</span><a name="line-195"></a><span>        </span><a name="local-6989586621679146245"><a href="#local-6989586621679146245"><span class="hs-identifier">treeTranslateErrors</span></a></a><span>  </span><span class="hs-glyph">=</span><span>
</span><a name="line-196"></a><span>          </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679146244"><span class="hs-identifier hs-var">translateTreesResult</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-197"></a><span>            </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679146253"><a href="#local-6989586621679146253"><span class="hs-identifier">x</span></a></a><span class="hs-operator hs-var">:|</span><a name="local-6989586621679146254"><a href="#local-6989586621679146254"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679146253"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679146254"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-198"></a><span>            </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span>        </span><a name="local-6989586621679146246"><a href="#local-6989586621679146246"><span class="hs-identifier">translatedTrees</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-201"></a><span>          </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679146244"><span class="hs-identifier hs-var">translateTreesResult</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-202"></a><span>            </span><span class="hs-identifier hs-var">Left</span><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-203"></a><span>            </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679146255"><a href="#local-6989586621679146255"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679146255"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-204"></a><span>
</span><a name="line-205"></a><span class="hs-comment">---------------------------  Following set of fns is actually set of nested ifs to match decision tree in docs  ---------------------------</span><span>
</span><a name="line-206"></a><span class="hs-comment">-------------------------  Mostly, these fns just check for errors much of the logic is dup'd in getSeqFromMatrix  ------------------------</span><span>
</span><a name="line-207"></a><span>
</span><a name="line-208"></a><span class="hs-identifier">decisionTree</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="File.Format.Nexus.Data.html#PhyloSequence"><span class="hs-identifier hs-type">PhyloSequence</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">[</span><a href="File.Format.Nexus.Data.html#TaxonSequenceMap"><span class="hs-identifier hs-type">TaxonSequenceMap</span></a><span class="hs-special">]</span><span>
</span><a name="line-209"></a><a name="decisionTree"><a href="File.Format.Nexus.Validate.html#decisionTree"><span class="hs-identifier">decisionTree</span></a></a><span> </span><a name="local-6989586621679146258"><a href="#local-6989586621679146258"><span class="hs-identifier">inputSeqBlocks</span></a></a><span> </span><a name="local-6989586621679146259"><a href="#local-6989586621679146259"><span class="hs-identifier">taxaLst</span></a></a><span>
</span><a name="line-210"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679146258"><span class="hs-identifier hs-var">inputSeqBlocks</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span class="hs-special">]</span><span>
</span><a name="line-211"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="File.Format.Nexus.Validate.html#isItTransposed"><span class="hs-identifier hs-var">isItTransposed</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679146259"><span class="hs-identifier hs-var">taxaLst</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679146258"><span class="hs-identifier hs-var">inputSeqBlocks</span></a><span>
</span><a name="line-212"></a><span>
</span><a name="line-213"></a><span class="hs-identifier">isItTransposed</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="File.Format.Nexus.Data.html#PhyloSequence"><span class="hs-identifier hs-type">PhyloSequence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><a href="File.Format.Nexus.Data.html#TaxonSequenceMap"><span class="hs-identifier hs-type">TaxonSequenceMap</span></a><span>
</span><a name="line-214"></a><a name="isItTransposed"><a href="File.Format.Nexus.Validate.html#isItTransposed"><span class="hs-identifier">isItTransposed</span></a></a><span> </span><a name="local-6989586621679146260"><a href="#local-6989586621679146260"><span class="hs-identifier">block</span></a></a><span> </span><a name="local-6989586621679146261"><a href="#local-6989586621679146261"><span class="hs-identifier">taxaLst</span></a></a><span>
</span><a name="line-215"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-identifier">transpose</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">format</span><span> </span><a href="#local-6989586621679146260"><span class="hs-identifier hs-var">block</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-string">&quot;There is a transposed block.&quot;</span><span> </span><span class="hs-comment">-- TODO: Nice errors, handle transposed case</span><span>
</span><a name="line-216"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#handleNontransposedSeqs"><span class="hs-identifier hs-var">handleNontransposedSeqs</span></a><span> </span><a href="#local-6989586621679146260"><span class="hs-identifier hs-var">block</span></a><span> </span><a href="#local-6989586621679146261"><span class="hs-identifier hs-var">taxaLst</span></a><span>
</span><a name="line-217"></a><span>
</span><a name="line-218"></a><span class="hs-identifier">handleNontransposedSeqs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="File.Format.Nexus.Data.html#PhyloSequence"><span class="hs-identifier hs-type">PhyloSequence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><a href="File.Format.Nexus.Data.html#TaxonSequenceMap"><span class="hs-identifier hs-type">TaxonSequenceMap</span></a><span>
</span><a name="line-219"></a><a name="handleNontransposedSeqs"><a href="File.Format.Nexus.Validate.html#handleNontransposedSeqs"><span class="hs-identifier">handleNontransposedSeqs</span></a></a><span> </span><a name="local-6989586621679146262"><a href="#local-6989586621679146262"><span class="hs-identifier">block</span></a></a><span> </span><a name="local-6989586621679146263"><a href="#local-6989586621679146263"><span class="hs-identifier">taxaLst</span></a></a><span>
</span><a name="line-220"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-identifier">unlabeled</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">format</span><span> </span><a href="#local-6989586621679146262"><span class="hs-identifier hs-var">block</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#handleUnLabeledSeqs"><span class="hs-identifier hs-var">handleUnLabeledSeqs</span></a><span> </span><a href="#local-6989586621679146262"><span class="hs-identifier hs-var">block</span></a><span> </span><a href="#local-6989586621679146263"><span class="hs-identifier hs-var">taxaLst</span></a><span>
</span><a name="line-221"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#handleLabeledSeqs"><span class="hs-identifier hs-var">handleLabeledSeqs</span></a><span> </span><a href="#local-6989586621679146262"><span class="hs-identifier hs-var">block</span></a><span> </span><a href="#local-6989586621679146263"><span class="hs-identifier hs-var">taxaLst</span></a><span>
</span><a name="line-222"></a><span>
</span><a name="line-223"></a><span class="hs-identifier">handleUnLabeledSeqs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="File.Format.Nexus.Data.html#PhyloSequence"><span class="hs-identifier hs-type">PhyloSequence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><a href="File.Format.Nexus.Data.html#TaxonSequenceMap"><span class="hs-identifier hs-type">TaxonSequenceMap</span></a><span>
</span><a name="line-224"></a><a name="handleUnLabeledSeqs"><a href="File.Format.Nexus.Validate.html#handleUnLabeledSeqs"><span class="hs-identifier">handleUnLabeledSeqs</span></a></a><span> </span><a name="local-6989586621679146264"><a href="#local-6989586621679146264"><span class="hs-identifier">block</span></a></a><span> </span><a name="local-6989586621679146265"><a href="#local-6989586621679146265"><span class="hs-identifier">taxaLst</span></a></a><span>
</span><a name="line-225"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-identifier">interleave</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">format</span><span> </span><a href="#local-6989586621679146264"><span class="hs-identifier hs-var">block</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-string">&quot;Interleaved blocks must be labeled.\n&quot;</span><span>
</span><a name="line-226"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#handleUnlabeledNotInterleavedSeqs"><span class="hs-identifier hs-var">handleUnlabeledNotInterleavedSeqs</span></a><span> </span><a href="#local-6989586621679146264"><span class="hs-identifier hs-var">block</span></a><span> </span><a href="#local-6989586621679146265"><span class="hs-identifier hs-var">taxaLst</span></a><span>
</span><a name="line-227"></a><span>
</span><a name="line-228"></a><span class="hs-identifier">handleLabeledSeqs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="File.Format.Nexus.Data.html#PhyloSequence"><span class="hs-identifier hs-type">PhyloSequence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><a href="File.Format.Nexus.Data.html#TaxonSequenceMap"><span class="hs-identifier hs-type">TaxonSequenceMap</span></a><span>
</span><a name="line-229"></a><a name="handleLabeledSeqs"><a href="File.Format.Nexus.Validate.html#handleLabeledSeqs"><span class="hs-identifier">handleLabeledSeqs</span></a></a><span> </span><a name="local-6989586621679146266"><a href="#local-6989586621679146266"><span class="hs-identifier">block</span></a></a><span> </span><a name="local-6989586621679146267"><a href="#local-6989586621679146267"><span class="hs-identifier">taxaLst</span></a></a><span>
</span><a name="line-230"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-identifier">interleave</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">format</span><span> </span><a href="#local-6989586621679146266"><span class="hs-identifier hs-var">block</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="File.Format.Nexus.Validate.html#getSeqFromMatrix"><span class="hs-identifier hs-var">getSeqFromMatrix</span></a><span> </span><a href="#local-6989586621679146266"><span class="hs-identifier hs-var">block</span></a><span> </span><a href="#local-6989586621679146267"><span class="hs-identifier hs-var">taxaLst</span></a><span>
</span><a name="line-231"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#handleLabeledNotInterleavedSeqs"><span class="hs-identifier hs-var">handleLabeledNotInterleavedSeqs</span></a><span> </span><a href="#local-6989586621679146266"><span class="hs-identifier hs-var">block</span></a><span> </span><a href="#local-6989586621679146267"><span class="hs-identifier hs-var">taxaLst</span></a><span>
</span><a name="line-232"></a><span>
</span><a name="line-233"></a><span class="hs-comment">-- TODO: This means that no unaligned block can be parsed. Fix this pronto.</span><span>
</span><a name="line-234"></a><span class="hs-identifier">handleLabeledNotInterleavedSeqs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="File.Format.Nexus.Data.html#PhyloSequence"><span class="hs-identifier hs-type">PhyloSequence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><a href="File.Format.Nexus.Data.html#TaxonSequenceMap"><span class="hs-identifier hs-type">TaxonSequenceMap</span></a><span>
</span><a name="line-235"></a><a name="handleLabeledNotInterleavedSeqs"><a href="File.Format.Nexus.Validate.html#handleLabeledNotInterleavedSeqs"><span class="hs-identifier">handleLabeledNotInterleavedSeqs</span></a></a><span> </span><a name="local-6989586621679146268"><a href="#local-6989586621679146268"><span class="hs-identifier">block</span></a></a><span> </span><a name="local-6989586621679146269"><a href="#local-6989586621679146269"><span class="hs-identifier">taxaLst</span></a></a><span>
</span><a name="line-236"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">alignedSeq</span><span> </span><a href="#local-6989586621679146268"><span class="hs-identifier hs-var">block</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="File.Format.Nexus.Validate.html#getSeqFromMatrix"><span class="hs-identifier hs-var">getSeqFromMatrix</span></a><span> </span><a href="#local-6989586621679146268"><span class="hs-identifier hs-var">block</span></a><span> </span><a href="#local-6989586621679146269"><span class="hs-identifier hs-var">taxaLst</span></a><span>
</span><a name="line-237"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;The &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier">blockType</span><span> </span><a href="#local-6989586621679146268"><span class="hs-identifier hs-var">block</span></a><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-238"></a><span>        </span><span class="hs-string">&quot; block is labeled, not aligned, and not interleaved. Since the Nexus spec dictates that whitespace &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-239"></a><span>        </span><span class="hs-string">&quot;(hence line returns) in non-interleaved sequence matrices is ignored, it is impossible to discriminate between sequences and taxon names.&quot;</span><span>
</span><a name="line-240"></a><span>
</span><a name="line-241"></a><span class="hs-identifier">handleUnlabeledNotInterleavedSeqs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="File.Format.Nexus.Data.html#PhyloSequence"><span class="hs-identifier hs-type">PhyloSequence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><a href="File.Format.Nexus.Data.html#TaxonSequenceMap"><span class="hs-identifier hs-type">TaxonSequenceMap</span></a><span>
</span><a name="line-242"></a><a name="handleUnlabeledNotInterleavedSeqs"><a href="File.Format.Nexus.Validate.html#handleUnlabeledNotInterleavedSeqs"><span class="hs-identifier">handleUnlabeledNotInterleavedSeqs</span></a></a><span> </span><a name="local-6989586621679146270"><a href="#local-6989586621679146270"><span class="hs-identifier">block</span></a></a><span> </span><a name="local-6989586621679146271"><a href="#local-6989586621679146271"><span class="hs-identifier">taxaLst</span></a></a><span>
</span><a name="line-243"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679146271"><span class="hs-identifier hs-var">taxaLst</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679146272"><span class="hs-identifier hs-var">taxlabels'</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-244"></a><span>        </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;In a &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier">blockType</span><span> </span><a href="#local-6989586621679146270"><span class="hs-identifier hs-var">block</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; block there is an unlabeled matrix which seems not to have any corresponding taxa.\n&quot;</span><span>
</span><a name="line-245"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#handleUnlabeledNotInterleavedSeqsWithSepTaxa"><span class="hs-identifier hs-var">handleUnlabeledNotInterleavedSeqsWithSepTaxa</span></a><span> </span><a href="#local-6989586621679146270"><span class="hs-identifier hs-var">block</span></a><span> </span><a href="#local-6989586621679146271"><span class="hs-identifier hs-var">taxaLst</span></a><span> </span><a href="#local-6989586621679146272"><span class="hs-identifier hs-var">taxlabels'</span></a><span>
</span><a name="line-246"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-247"></a><span>        </span><a name="local-6989586621679146272"><a href="#local-6989586621679146272"><span class="hs-identifier">taxlabels'</span></a></a><span>
</span><a name="line-248"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">seqTaxaLabels</span><span> </span><a href="#local-6989586621679146270"><span class="hs-identifier hs-var">block</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span>
</span><a name="line-249"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">seqTaxaLabels</span><span> </span><a href="#local-6989586621679146270"><span class="hs-identifier hs-var">block</span></a><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span class="hs-identifier">handleUnlabeledNotInterleavedSeqsWithSepTaxa</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="File.Format.Nexus.Data.html#PhyloSequence"><span class="hs-identifier hs-type">PhyloSequence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><a href="File.Format.Nexus.Data.html#TaxonSequenceMap"><span class="hs-identifier hs-type">TaxonSequenceMap</span></a><span>
</span><a name="line-252"></a><a name="handleUnlabeledNotInterleavedSeqsWithSepTaxa"><a href="File.Format.Nexus.Validate.html#handleUnlabeledNotInterleavedSeqsWithSepTaxa"><span class="hs-identifier">handleUnlabeledNotInterleavedSeqsWithSepTaxa</span></a></a><span> </span><a name="local-6989586621679146273"><a href="#local-6989586621679146273"><span class="hs-identifier">block</span></a></a><span> </span><a name="local-6989586621679146274"><a href="#local-6989586621679146274"><span class="hs-identifier">taxaLst</span></a></a><span> </span><a name="local-6989586621679146275"><a href="#local-6989586621679146275"><span class="hs-identifier">taxlabels'</span></a></a><span>
</span><a name="line-253"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679146274"><span class="hs-identifier hs-var">taxaLst</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679146275"><span class="hs-identifier hs-var">taxlabels'</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-254"></a><span>        </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;In a &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier">blockType</span><span> </span><a href="#local-6989586621679146273"><span class="hs-identifier hs-var">block</span></a><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-255"></a><span>            </span><span class="hs-string">&quot; block there is an unlabeled matrix, but there are both newtaxa defined in the block, and there is a separate taxa block. &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-256"></a><span>            </span><span class="hs-string">&quot;Thus, the ordering of the sequences in this block is unclear.\n&quot;</span><span>
</span><a name="line-257"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679146274"><span class="hs-identifier hs-var">taxaLst</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#handleUnlabeledCheckTaxaCardinality"><span class="hs-identifier hs-var">handleUnlabeledCheckTaxaCardinality</span></a><span> </span><a href="#local-6989586621679146273"><span class="hs-identifier hs-var">block</span></a><span> </span><a href="#local-6989586621679146274"><span class="hs-identifier hs-var">taxaLst</span></a><span>
</span><a name="line-258"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#handleUnlabeledCheckTaxaCardinality"><span class="hs-identifier hs-var">handleUnlabeledCheckTaxaCardinality</span></a><span> </span><a href="#local-6989586621679146273"><span class="hs-identifier hs-var">block</span></a><span> </span><a href="#local-6989586621679146275"><span class="hs-identifier hs-var">taxlabels'</span></a><span>
</span><a name="line-259"></a><span>
</span><a name="line-260"></a><span class="hs-identifier">handleUnlabeledCheckTaxaCardinality</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="File.Format.Nexus.Data.html#PhyloSequence"><span class="hs-identifier hs-type">PhyloSequence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><a href="File.Format.Nexus.Data.html#TaxonSequenceMap"><span class="hs-identifier hs-type">TaxonSequenceMap</span></a><span>
</span><a name="line-261"></a><a name="handleUnlabeledCheckTaxaCardinality"><a href="File.Format.Nexus.Validate.html#handleUnlabeledCheckTaxaCardinality"><span class="hs-identifier">handleUnlabeledCheckTaxaCardinality</span></a></a><span> </span><a name="local-6989586621679146276"><a href="#local-6989586621679146276"><span class="hs-identifier">block</span></a></a><span> </span><a name="local-6989586621679146277"><a href="#local-6989586621679146277"><span class="hs-identifier">taxaLst</span></a></a><span>
</span><a name="line-262"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679146277"><span class="hs-identifier hs-var">taxaLst</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679146278"><span class="hs-identifier hs-var">mtxLength</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-263"></a><span>        </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;In a &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier">blockType</span><span> </span><a href="#local-6989586621679146276"><span class="hs-identifier hs-var">block</span></a><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-264"></a><span>            </span><span class="hs-string">&quot; block, either the number of taxa or the number of sequences in incorrect. &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-265"></a><span>            </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679146277"><span class="hs-identifier hs-var">taxaLst</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; are given, but there are &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679146278"><span class="hs-identifier hs-var">mtxLength</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; sequences in the matrix.\n&quot;</span><span>
</span><a name="line-266"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="File.Format.Nexus.Validate.html#getSeqFromMatrix"><span class="hs-identifier hs-var">getSeqFromMatrix</span></a><span> </span><a href="#local-6989586621679146276"><span class="hs-identifier hs-var">block</span></a><span> </span><a href="#local-6989586621679146277"><span class="hs-identifier hs-var">taxaLst</span></a><span>
</span><a name="line-267"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679146278"><a href="#local-6989586621679146278"><span class="hs-identifier">mtxLength</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">seqMatrix</span><span> </span><a href="#local-6989586621679146276"><span class="hs-identifier hs-var">block</span></a><span> </span><span class="hs-comment">-- this is safe, as we've already checked to make sure this block has a matrix.</span><span>
</span><a name="line-268"></a><span>
</span><a name="line-269"></a><span class="hs-comment">------------------------------------------------------  End decision tree logic  ------------------------------------------------------</span><span>
</span><a name="line-270"></a><span>
</span><a name="line-271"></a><span>
</span><a name="line-272"></a><span class="hs-comment">-- | foldSeqs takes a list of tuples of sequence maps and character metadata, and</span><span>
</span><a name="line-273"></a><span class="hs-comment">-- returns a tuple containing a single Sequences tuple and an Int. (The Int is only used for recursive calls.)</span><span>
</span><a name="line-274"></a><span class="hs-identifier">foldSeqs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="File.Format.Nexus.Data.html#TaxonSequenceMap"><span class="hs-identifier hs-type">TaxonSequenceMap</span></a><span class="hs-special">,</span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="File.Format.Nexus.Data.html#CharacterMetadata"><span class="hs-identifier hs-type">CharacterMetadata</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="File.Format.Nexus.Data.html#Sequences"><span class="hs-identifier hs-type">Sequences</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-275"></a><a name="foldSeqs"><a href="File.Format.Nexus.Validate.html#foldSeqs"><span class="hs-identifier">foldSeqs</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-276"></a><span class="hs-identifier">foldSeqs</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679146279"><a href="#local-6989586621679146279"><span class="hs-identifier">taxSeqMap</span></a></a><span class="hs-special">,</span><a name="local-6989586621679146280"><a href="#local-6989586621679146280"><span class="hs-identifier">charMDataVec</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679146281"><a href="#local-6989586621679146281"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679146285"><span class="hs-identifier hs-var">newSeqMap</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679146286"><span class="hs-identifier hs-var">newMetadata</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679146287"><span class="hs-identifier hs-var">totLength</span></a><span class="hs-special">)</span><span>
</span><a name="line-277"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-278"></a><span>        </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679146282"><a href="#local-6989586621679146282"><span class="hs-identifier">curMap</span></a></a><span class="hs-special">,</span><a name="local-6989586621679146283"><a href="#local-6989586621679146283"><span class="hs-identifier">curMetadata</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><a name="local-6989586621679146284"><a href="#local-6989586621679146284"><span class="hs-identifier">curLength</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#foldSeqs"><span class="hs-identifier hs-var">foldSeqs</span></a><span> </span><a href="#local-6989586621679146281"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-279"></a><span>        </span><a name="local-6989586621679146285"><a href="#local-6989586621679146285"><span class="hs-identifier">newSeqMap</span></a></a><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">unionWith</span><span> </span><span class="hs-special">(</span><a href="File.Format.Nexus.Validate.html#updateSeqInMap"><span class="hs-identifier hs-var">updateSeqInMap</span></a><span> </span><a href="#local-6989586621679146284"><span class="hs-identifier hs-var">curLength</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679146279"><span class="hs-identifier hs-var">taxSeqMap</span></a><span> </span><a href="#local-6989586621679146282"><span class="hs-identifier hs-var">curMap</span></a><span>
</span><a name="line-280"></a><span>                                           </span><span class="hs-comment">-- This condition shouldn't ever be True. Only seqs should have missing data.</span><span>
</span><a name="line-281"></a><span>        </span><a name="local-6989586621679146286"><a href="#local-6989586621679146286"><span class="hs-identifier">newMetadata</span></a></a><span>                      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146280"><span class="hs-identifier hs-var">charMDataVec</span></a><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.++</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679146283"><span class="hs-identifier hs-var">curMetadata</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679146284"><span class="hs-identifier hs-var">curLength</span></a><span>
</span><a name="line-282"></a><span>                                                                </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.++</span><span> </span><a href="#local-6989586621679146283"><span class="hs-identifier hs-var">curMetadata</span></a><span> </span><span class="hs-comment">-- TODO: Error out here?</span><span>
</span><a name="line-283"></a><span>                                                                </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679146283"><span class="hs-identifier hs-var">curMetadata</span></a><span>
</span><a name="line-284"></a><span>        </span><a name="local-6989586621679146287"><a href="#local-6989586621679146287"><span class="hs-identifier">totLength</span></a></a><span>                        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146284"><span class="hs-identifier hs-var">curLength</span></a><span> </span><span class="hs-operator hs-var">+</span><span>  </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679146280"><span class="hs-identifier hs-var">charMDataVec</span></a><span>
</span><a name="line-285"></a><span>
</span><a name="line-286"></a><span>
</span><a name="line-287"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-288"></a><span class="hs-comment">-- Given the supplied /ordered/ collection of taxa and the collection of</span><span>
</span><a name="line-289"></a><span class="hs-comment">-- 'TreeBlock's we apply any nescisarry translations and return Either a list of</span><span>
</span><a name="line-290"></a><span class="hs-comment">-- errors encountered when translation the 'TreeBlock's or a coalesced &amp; translated</span><span>
</span><a name="line-291"></a><span class="hs-comment">-- forest in which all leaf nodes have a coresponding taxa label.</span><span>
</span><a name="line-292"></a><span class="hs-identifier">translateTrees</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="File.Format.Nexus.Data.html#TreeBlock"><span class="hs-identifier hs-type">TreeBlock</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">NonEmpty</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="File.Format.Newick.Internal.html#NewickForest"><span class="hs-identifier hs-type">NewickForest</span></a><span class="hs-special">]</span><span>
</span><a name="line-293"></a><a name="translateTrees"><a href="File.Format.Nexus.Validate.html#translateTrees"><span class="hs-identifier">translateTrees</span></a></a><span> </span><a name="local-6989586621679146288"><a href="#local-6989586621679146288"><span class="hs-identifier">taxaList</span></a></a><span> </span><a name="local-6989586621679146289"><a href="#local-6989586621679146289"><span class="hs-identifier">treeSet</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-294"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">partitionEithers</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679146291"><span class="hs-identifier hs-var">handleTreeBlock</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679146289"><span class="hs-identifier hs-var">treeSet</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-295"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621679146682"><a href="#local-6989586621679146682"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679146683"><a href="#local-6989586621679146683"><span class="hs-identifier">xs</span></a></a><span class="hs-special">,</span><span>    </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679146682"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">:|</span><span> </span><a href="#local-6989586621679146683"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-296"></a><span>      </span><span class="hs-special">(</span><span>   </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span>   </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-297"></a><span>      </span><span class="hs-special">(</span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679146684"><a href="#local-6989586621679146684"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679146685"><a href="#local-6989586621679146685"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679146684"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">:|</span><span> </span><a href="#local-6989586621679146685"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">]</span><span>
</span><a name="line-298"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-299"></a><span>
</span><a name="line-300"></a><span>        </span><span class="hs-comment">-- |</span><span>
</span><a name="line-301"></a><span>        </span><span class="hs-comment">-- A set of all taxa labels supplied.</span><span>
</span><a name="line-302"></a><span>        </span><span class="hs-identifier">taxaSet</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Set</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-303"></a><span>        </span><a name="local-6989586621679146290"><a href="#local-6989586621679146290"><span class="hs-identifier">taxaSet</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621679146288"><span class="hs-identifier hs-var">taxaList</span></a><span>
</span><a name="line-304"></a><span>
</span><a name="line-305"></a><span>        </span><span class="hs-comment">-- |</span><span>
</span><a name="line-306"></a><span>        </span><span class="hs-comment">-- Attempt to translate a 'TreeBlock' into a 'NewickForest' with leaf</span><span>
</span><a name="line-307"></a><span>        </span><span class="hs-comment">-- nodes properly labeled with taxa names.</span><span>
</span><a name="line-308"></a><span>        </span><span class="hs-identifier">handleTreeBlock</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="File.Format.Nexus.Data.html#TreeBlock"><span class="hs-identifier hs-type">TreeBlock</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><a href="File.Format.Newick.Internal.html#NewickNode"><span class="hs-identifier hs-type">NewickNode</span></a><span>
</span><a name="line-309"></a><span>        </span><a name="local-6989586621679146291"><a href="#local-6989586621679146291"><span class="hs-identifier">handleTreeBlock</span></a></a><span> </span><span class="hs-special">(</span><a href="File.Format.Nexus.Data.html#TreeBlock"><span class="hs-identifier hs-var">TreeBlock</span></a><span> </span><a name="local-6989586621679146292"><a href="#local-6989586621679146292"><span class="hs-identifier">translateFields</span></a></a><span> </span><a name="local-6989586621679146293"><a href="#local-6989586621679146293"><span class="hs-identifier">labeledTrees</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-310"></a><span>            </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679146293"><span class="hs-identifier hs-var">labeledTrees</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-311"></a><span>              </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-string">&quot;No trees in forest&quot;</span><span>
</span><a name="line-312"></a><span>              </span><a name="local-6989586621679146317"><a href="#local-6989586621679146317"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679146318"><a href="#local-6989586621679146318"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679146319"><a href="#local-6989586621679146319"><span class="hs-identifier">forest</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146317"><span class="hs-identifier hs-var">x</span></a><span class="hs-operator hs-var">:|</span><a href="#local-6989586621679146318"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-313"></a><span>                      </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679146320"><a href="#local-6989586621679146320"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">foldMap1</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679146295"><span class="hs-identifier hs-var">translateTree</span></a><span> </span><a href="#local-6989586621679146320"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679146319"><span class="hs-identifier hs-var">forest</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679146294"><span class="hs-identifier hs-var">labelMappingEither</span></a><span>
</span><a name="line-314"></a><span>          </span><span class="hs-keyword">where</span><span>
</span><a name="line-315"></a><span>
</span><a name="line-316"></a><span>            </span><span class="hs-comment">-- |</span><span>
</span><a name="line-317"></a><span>            </span><span class="hs-comment">-- Contextually construct the symbolic mapping function.</span><span>
</span><a name="line-318"></a><span>            </span><span class="hs-comment">--</span><span>
</span><a name="line-319"></a><span>            </span><span class="hs-comment">-- There exist many possible error conditions which are supplied as</span><span>
</span><a name="line-320"></a><span>            </span><span class="hs-comment">-- Left values.</span><span>
</span><a name="line-321"></a><span>            </span><span class="hs-identifier">labelMappingEither</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span>
</span><a name="line-322"></a><span>            </span><a name="local-6989586621679146294"><a href="#local-6989586621679146294"><span class="hs-identifier">labelMappingEither</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-323"></a><span>                </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679146292"><span class="hs-identifier hs-var">translateFields</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-324"></a><span>                  </span><span class="hs-special">[</span><a name="local-6989586621679146299"><a href="#local-6989586621679146299"><span class="hs-identifier">x</span></a></a><span class="hs-special">]</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679146297"><span class="hs-identifier hs-var">presentTranslationMap</span></a><span> </span><a href="#local-6989586621679146299"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-325"></a><span>                  </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679146296"><span class="hs-identifier hs-var">missingTranslationMap</span></a><span>
</span><a name="line-326"></a><span>                  </span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-string">&quot;Multiple translate fields in a trees block&quot;</span><span>
</span><a name="line-327"></a><span>
</span><a name="line-328"></a><span>            </span><span class="hs-comment">-- |</span><span>
</span><a name="line-329"></a><span>            </span><span class="hs-comment">-- Applies a translation of leaf label symbols to taxa labels over</span><span>
</span><a name="line-330"></a><span>            </span><span class="hs-comment">-- a forest.</span><span>
</span><a name="line-331"></a><span>            </span><span class="hs-identifier">translateTree</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.Newick.Internal.html#NewickNode"><span class="hs-identifier hs-type">NewickNode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.Newick.Internal.html#NewickNode"><span class="hs-identifier hs-type">NewickNode</span></a><span>
</span><a name="line-332"></a><span>            </span><a name="local-6989586621679146295"><a href="#local-6989586621679146295"><span class="hs-identifier">translateTree</span></a></a><span> </span><a name="local-6989586621679146300"><a href="#local-6989586621679146300"><span class="hs-identifier">mapping</span></a></a><span> </span><a name="local-6989586621679146301"><a href="#local-6989586621679146301"><span class="hs-identifier">node</span></a></a><span>
</span><a name="line-333"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a href="File.Format.Newick.Internal.html#isLeaf"><span class="hs-identifier hs-var">isLeaf</span></a><span> </span><a href="#local-6989586621679146301"><span class="hs-identifier hs-var">node</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146301"><span class="hs-identifier hs-var">node</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">newickLabel</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">newickLabel</span><span> </span><a href="#local-6989586621679146301"><span class="hs-identifier hs-var">node</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">lookup</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679146300"><span class="hs-identifier hs-var">mapping</span></a><span class="hs-special">)</span><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-334"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146301"><span class="hs-identifier hs-var">node</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">descendants</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146295"><span class="hs-identifier hs-var">translateTree</span></a><span> </span><a href="#local-6989586621679146300"><span class="hs-identifier hs-var">mapping</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier">descendants</span><span> </span><a href="#local-6989586621679146301"><span class="hs-identifier hs-var">node</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-335"></a><span>
</span><a name="line-336"></a><span>            </span><span class="hs-comment">-- |</span><span>
</span><a name="line-337"></a><span>            </span><span class="hs-comment">-- Construct the leaf node symbol to taxon label mapping when there</span><span>
</span><a name="line-338"></a><span>            </span><span class="hs-comment">-- is no translation specifaction present in the TREES block.</span><span>
</span><a name="line-339"></a><span>            </span><span class="hs-comment">--</span><span>
</span><a name="line-340"></a><span>            </span><span class="hs-comment">-- Depending on the leaf label annotation either a mapping from Z+</span><span>
</span><a name="line-341"></a><span>            </span><span class="hs-comment">-- to the taxa set or an identity mapping will be constructed.</span><span>
</span><a name="line-342"></a><span>            </span><span class="hs-comment">--</span><span>
</span><a name="line-343"></a><span>            </span><span class="hs-comment">-- In the case that the leaf label set is not a subset of either Z+</span><span>
</span><a name="line-344"></a><span>            </span><span class="hs-comment">-- or the taxa set, an error condition is returned.</span><span>
</span><a name="line-345"></a><span>            </span><span class="hs-identifier">missingTranslationMap</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span>
</span><a name="line-346"></a><span>            </span><a name="local-6989586621679146296"><a href="#local-6989586621679146296"><span class="hs-identifier">missingTranslationMap</span></a></a><span>
</span><a name="line-347"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679146298"><span class="hs-identifier hs-var">leafSet</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679146302"><span class="hs-identifier hs-var">possibleIntegralValue</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-glyph">::</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621679146288"><span class="hs-identifier hs-var">taxaList</span></a><span class="hs-special">)</span><span>
</span><a name="line-348"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679146298"><span class="hs-identifier hs-var">leafSet</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">isSubsetOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679146290"><span class="hs-identifier hs-var">taxaSet</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zip</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621679146288"><span class="hs-identifier hs-var">taxaList</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621679146288"><span class="hs-identifier hs-var">taxaList</span></a><span class="hs-special">)</span><span>
</span><a name="line-349"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-string">&quot;The supplied leaf labels were not a proper subset of the taxa set or the positive integers.&quot;</span><span>
</span><a name="line-350"></a><span>              </span><span class="hs-keyword">where</span><span>
</span><a name="line-351"></a><span>                </span><a name="local-6989586621679146302"><a href="#local-6989586621679146302"><span class="hs-identifier">possibleIntegralValue</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679146298"><span class="hs-identifier hs-var">leafSet</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-352"></a><span>
</span><a name="line-353"></a><span>            </span><span class="hs-comment">-- |</span><span>
</span><a name="line-354"></a><span>            </span><span class="hs-comment">-- Construct the leaf node symbol to taxon label mapping when there</span><span>
</span><a name="line-355"></a><span>            </span><span class="hs-comment">-- is a single translation specifaction present in the TREES block.</span><span>
</span><a name="line-356"></a><span>            </span><span class="hs-comment">--</span><span>
</span><a name="line-357"></a><span>            </span><span class="hs-comment">-- Depending on the supplied transation specification either a mapping</span><span>
</span><a name="line-358"></a><span>            </span><span class="hs-comment">-- from Z+ to the permuted taxa set or a mapping from a symbol set to</span><span>
</span><a name="line-359"></a><span>            </span><span class="hs-comment">-- the taxa set will be constructed.</span><span>
</span><a name="line-360"></a><span>            </span><span class="hs-comment">--</span><span>
</span><a name="line-361"></a><span>            </span><span class="hs-comment">-- In the case that the translations specifiaction did not contain</span><span>
</span><a name="line-362"></a><span>            </span><span class="hs-comment">-- all tuples or a perutation of the taxa set, an error condition is</span><span>
</span><a name="line-363"></a><span>            </span><span class="hs-comment">-- returned.</span><span>
</span><a name="line-364"></a><span>            </span><span class="hs-identifier">presentTranslationMap</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span>
</span><a name="line-365"></a><span>            </span><a name="local-6989586621679146297"><a href="#local-6989586621679146297"><span class="hs-identifier">presentTranslationMap</span></a></a><span> </span><a name="local-6989586621679146303"><a href="#local-6989586621679146303"><span class="hs-identifier">transSpec</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-366"></a><span>                </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">partitionEithers</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679146304"><span class="hs-identifier hs-var">tupleEither</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679146303"><span class="hs-identifier hs-var">transSpec</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-367"></a><span>                  </span><span class="hs-comment">-- Alledgedly permuted taxaList</span><span>
</span><a name="line-368"></a><span>                  </span><span class="hs-special">(</span><a name="local-6989586621679146312"><a href="#local-6989586621679146312"><span class="hs-identifier">xs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-369"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><a href="#local-6989586621679146312"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">isSubsetOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679146290"><span class="hs-identifier hs-var">taxaSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-glyph">::</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679146312"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-370"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Translation specifcation: &quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679146312"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot; is not a subset of: &quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621679146288"><span class="hs-identifier hs-var">taxaList</span></a><span class="hs-special">)</span><span>
</span><a name="line-371"></a><span>                  </span><span class="hs-comment">-- Alledged /total/ symbol to taxa mapping</span><span>
</span><a name="line-372"></a><span>                  </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679146313"><a href="#local-6989586621679146313"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-373"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679146313"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">isSubsetOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679146290"><span class="hs-identifier hs-var">taxaSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;There was an element in the co-domain of the Translation specifaction &quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span>
</span><a name="line-374"></a><span>                                                                                         </span><span class="hs-string">&quot;that is not an element of the taxa set.&quot;</span><span>
</span><a name="line-375"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679146298"><span class="hs-identifier hs-var">leafSet</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">isSubsetOf</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679146313"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;There was an element in the domain of the Translation specifaction that is &quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span>
</span><a name="line-376"></a><span>                                                                                          </span><span class="hs-string">&quot;not an element of the leaf node label set.\n  LeafSet - Symbols: &quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span>
</span><a name="line-377"></a><span>                                                                                          </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679146298"><span class="hs-identifier hs-var">leafSet</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">difference</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679146313"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-378"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><a href="#local-6989586621679146313"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-379"></a><span>                  </span><span class="hs-comment">-- Inconsistent Translate formatting</span><span>
</span><a name="line-380"></a><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span>  </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-string">&quot;All elements of the Translation specifaction were not either all singleton tokens or pairwise tokens.&quot;</span><span>
</span><a name="line-381"></a><span>              </span><span class="hs-keyword">where</span><span>
</span><a name="line-382"></a><span>                </span><span class="hs-identifier">tupleEither</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span>
</span><a name="line-383"></a><span>                </span><a name="local-6989586621679146304"><a href="#local-6989586621679146304"><span class="hs-identifier">tupleEither</span></a></a><span> </span><a name="local-6989586621679146305"><a href="#local-6989586621679146305"><span class="hs-identifier">inputStr</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-384"></a><span>                    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679146310"><span class="hs-identifier hs-var">sndToken</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-385"></a><span>                      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span>   </span><a href="#local-6989586621679146307"><span class="hs-identifier hs-var">fstToken</span></a><span>
</span><a name="line-386"></a><span>                      </span><a name="local-6989586621679146311"><a href="#local-6989586621679146311"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679146307"><span class="hs-identifier hs-var">fstToken</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679146311"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-387"></a><span>                  </span><span class="hs-keyword">where</span><span>
</span><a name="line-388"></a><span>                    </span><a name="local-6989586621679146306"><a href="#local-6989586621679146306"><span class="hs-identifier">frontTrimmed</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dropWhile</span><span> </span><span class="hs-identifier hs-var">isSpace</span><span> </span><a href="#local-6989586621679146305"><span class="hs-identifier hs-var">inputStr</span></a><span>
</span><a name="line-389"></a><span>                    </span><span class="hs-special">(</span><a name="local-6989586621679146307"><a href="#local-6989586621679146307"><span class="hs-identifier">fstToken</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679146308"><a href="#local-6989586621679146308"><span class="hs-identifier">trailing</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">break</span><span> </span><span class="hs-identifier hs-var">isSpace</span><span> </span><a href="#local-6989586621679146306"><span class="hs-identifier hs-var">frontTrimmed</span></a><span>
</span><a name="line-390"></a><span>                    </span><a name="local-6989586621679146309"><a href="#local-6989586621679146309"><span class="hs-identifier">secondTrimmed</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dropWhile</span><span> </span><span class="hs-identifier hs-var">isSpace</span><span> </span><a href="#local-6989586621679146308"><span class="hs-identifier hs-var">trailing</span></a><span>
</span><a name="line-391"></a><span>                    </span><span class="hs-special">(</span><a name="local-6989586621679146310"><a href="#local-6989586621679146310"><span class="hs-identifier">sndToken</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">break</span><span> </span><span class="hs-identifier hs-var">isSpace</span><span> </span><a href="#local-6989586621679146309"><span class="hs-identifier hs-var">secondTrimmed</span></a><span>
</span><a name="line-392"></a><span>
</span><a name="line-393"></a><span>            </span><span class="hs-comment">-- |</span><span>
</span><a name="line-394"></a><span>            </span><span class="hs-comment">-- Construct the leaf set of a forest.</span><span>
</span><a name="line-395"></a><span>            </span><span class="hs-identifier">leafSet</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Set</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-396"></a><span>            </span><a name="local-6989586621679146298"><a href="#local-6989586621679146298"><span class="hs-identifier">leafSet</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldMap</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679146314"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679146293"><span class="hs-identifier hs-var">labeledTrees</span></a><span>
</span><a name="line-397"></a><span>              </span><span class="hs-keyword">where</span><span>
</span><a name="line-398"></a><span>                </span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="File.Format.Newick.Internal.html#NewickNode"><span class="hs-identifier hs-type">NewickNode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Set</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-399"></a><span>                </span><a name="local-6989586621679146314"><a href="#local-6989586621679146314"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679146315"><a href="#local-6989586621679146315"><span class="hs-identifier">node</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-400"></a><span>                  </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">descendants</span><span> </span><a href="#local-6989586621679146315"><span class="hs-identifier hs-var">node</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-401"></a><span>                    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">newickLabel</span><span> </span><a href="#local-6989586621679146315"><span class="hs-identifier hs-var">node</span></a><span>
</span><a name="line-402"></a><span>                    </span><a name="local-6989586621679146316"><a href="#local-6989586621679146316"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">foldMap</span><span> </span><a href="#local-6989586621679146314"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679146316"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-403"></a><span>
</span><a name="line-404"></a><span>
</span><a name="line-405"></a><span class="hs-comment">-- | updateSeqInMap takes in a TaxonSequenceMap, a length (the length of the longest sequence in the map), a taxon name and a sequence.</span><span>
</span><a name="line-406"></a><span class="hs-comment">-- It updates the first map by adding the new seq using the taxon name as a key. If the seq us shorter than the max, it is first</span><span>
</span><a name="line-407"></a><span class="hs-comment">-- buffered by a vector of Nothing.</span><span>
</span><a name="line-408"></a><span class="hs-comment">-- This buffering is okay because unaligned sequences, under dynamic homology, are treated as a single sequences. Therefore the buffering</span><span>
</span><a name="line-409"></a><span class="hs-comment">-- does not cause and &quot;alignment&quot;. TODO: Make sure the reasoning is right in this, regarding buffering</span><span>
</span><a name="line-410"></a><span class="hs-identifier">updateSeqInMap</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.Nexus.Data.html#Sequence"><span class="hs-identifier hs-type">Sequence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.Nexus.Data.html#Sequence"><span class="hs-identifier hs-type">Sequence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.Nexus.Data.html#Sequence"><span class="hs-identifier hs-type">Sequence</span></a><span>
</span><a name="line-411"></a><a name="updateSeqInMap"><a href="File.Format.Nexus.Validate.html#updateSeqInMap"><span class="hs-identifier">updateSeqInMap</span></a></a><span> </span><a name="local-6989586621679146686"><a href="#local-6989586621679146686"><span class="hs-identifier">curLength</span></a></a><span> </span><a name="local-6989586621679146687"><a href="#local-6989586621679146687"><span class="hs-identifier">inputSeq</span></a></a><span> </span><a name="local-6989586621679146688"><a href="#local-6989586621679146688"><span class="hs-identifier">curSeq</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146689"><span class="hs-identifier hs-var">newSeq</span></a><span>
</span><a name="line-412"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-413"></a><span>        </span><a name="local-6989586621679146689"><a href="#local-6989586621679146689"><span class="hs-identifier">newSeq</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146692"><span class="hs-identifier hs-var">seqToAdd</span></a><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.++</span><span> </span><a href="#local-6989586621679146688"><span class="hs-identifier hs-var">curSeq</span></a><span>
</span><a name="line-414"></a><span>        </span><a name="local-6989586621679146690"><a href="#local-6989586621679146690"><span class="hs-identifier">missingLength</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146686"><span class="hs-identifier hs-var">curLength</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679146688"><span class="hs-identifier hs-var">curSeq</span></a><span>
</span><a name="line-415"></a><span>        </span><a name="local-6989586621679146691"><a href="#local-6989586621679146691"><span class="hs-identifier">emptySeq</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">replicate</span><span> </span><a href="#local-6989586621679146690"><span class="hs-identifier hs-var">missingLength</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-416"></a><span>        </span><a name="local-6989586621679146692"><a href="#local-6989586621679146692"><span class="hs-identifier">seqToAdd</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146687"><span class="hs-identifier hs-var">inputSeq</span></a><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.++</span><span> </span><a href="#local-6989586621679146691"><span class="hs-identifier hs-var">emptySeq</span></a><span>
</span><a name="line-417"></a><span>
</span><a name="line-418"></a><span class="hs-comment">-- | wrongDataType looks at a PhyloSequence block and determines if it has a valid data type. If the datatype is missing, it will return Nothing, as</span><span>
</span><a name="line-419"></a><span class="hs-comment">-- results in default behavior (&quot;standard&quot; is default).</span><span>
</span><a name="line-420"></a><span class="hs-comment">-- TODO: ask Ward if mixed datatype is allowed (hope to god no).</span><span>
</span><a name="line-421"></a><span class="hs-comment">{-
wrongDataType :: PhyloSequence -&gt; Maybe String
wrongDataType inSeq
    | lowerCased `elem` acceptableTypeStrs = Nothing
    | otherwise = Just $ dataType ++ &quot; is not an accepted type of data.\n&quot;
    where
        lowerCased = fmap toLower dataType
        acceptableTypeStrs = [&quot;standard&quot;, &quot;dna&quot;, &quot;rna&quot;, &quot;nucleotide&quot;, &quot;protein&quot;, &quot;continuous&quot;, &quot;&quot;]
        (_, _noLabels, _interleaved, _tkns, dataType, _matchChar') = getFormatInfo inSeq
-}</span><span>
</span><a name="line-431"></a><span>
</span><a name="line-432"></a><span class="hs-comment">-- | checkSeqLength takes in the list of PhyloSequences and the final map of sequences and checks each sequence to see whether it's</span><span>
</span><a name="line-433"></a><span class="hs-comment">-- aligned, and if so whether it</span><span>
</span><a name="line-434"></a><span class="hs-identifier">checkSeqLength</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="File.Format.Nexus.Data.html#PhyloSequence"><span class="hs-identifier hs-type">PhyloSequence</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.Nexus.Data.html#Sequences"><span class="hs-identifier hs-type">Sequences</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-435"></a><a name="checkSeqLength"><a href="File.Format.Nexus.Validate.html#checkSeqLength"><span class="hs-identifier">checkSeqLength</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">]</span><span>
</span><a name="line-436"></a><span class="hs-identifier">checkSeqLength</span><span> </span><a name="local-6989586621679146693"><a href="#local-6989586621679146693"><span class="hs-identifier">seqBlockLst</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679146694"><a href="#local-6989586621679146694"><span class="hs-identifier">seqMap</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-437"></a><span>    </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">foldrWithKey</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679146696"><a href="#local-6989586621679146696"><span class="hs-identifier">key</span></a></a><span> </span><a name="local-6989586621679146697"><a href="#local-6989586621679146697"><span class="hs-identifier">val</span></a></a><span> </span><a name="local-6989586621679146698"><a href="#local-6989586621679146698"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679146697"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679146695"><span class="hs-identifier hs-var">len</span></a><span>
</span><a name="line-438"></a><span>                                     </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-439"></a><span>                                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679146696"><span class="hs-identifier hs-var">key</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;'s sequence is the wrong length in an aligned block. It should be &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679146695"><span class="hs-identifier hs-var">len</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;, but is &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-440"></a><span>                                                </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679146697"><span class="hs-identifier hs-var">val</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">{- ++ &quot;:\n&quot; ++ show val -}</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679146698"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679146694"><span class="hs-identifier hs-var">seqMap</span></a><span>
</span><a name="line-441"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-442"></a><span>        </span><a name="local-6989586621679146695"><a href="#local-6989586621679146695"><span class="hs-identifier">len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">numChars</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">charDims</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679146693"><span class="hs-identifier hs-var">seqBlockLst</span></a><span> </span><span class="hs-comment">-- TODO: fix this line</span><span>
</span><a name="line-443"></a><span>
</span><a name="line-444"></a><span class="hs-comment">-- | taxaDimsMissing tries to determine whether any ntax are missing. They could be missing from either</span><span>
</span><a name="line-445"></a><span class="hs-comment">-- a Taxa block, or from a Data block, or from a Characters or Unaligned block that has newtaxa.</span><span>
</span><a name="line-446"></a><span class="hs-comment">-- TODO: fix this tornado code.</span><span>
</span><a name="line-447"></a><span class="hs-comment">-- TODO: write down this decision tree.</span><span>
</span><a name="line-448"></a><span class="hs-identifier">taxaDimsMissing</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="File.Format.Nexus.Data.html#TaxaSpecification"><span class="hs-identifier hs-type">TaxaSpecification</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="File.Format.Nexus.Data.html#PhyloSequence"><span class="hs-identifier hs-type">PhyloSequence</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-449"></a><a name="taxaDimsMissing"><a href="File.Format.Nexus.Validate.html#taxaDimsMissing"><span class="hs-identifier">taxaDimsMissing</span></a></a><span> </span><a name="local-6989586621679146699"><a href="#local-6989586621679146699"><span class="hs-identifier">taxas</span></a></a><span> </span><a name="local-6989586621679146700"><a href="#local-6989586621679146700"><span class="hs-identifier">inputSeqBlocks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146701"><span class="hs-identifier hs-var">taxaProblems</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679146702"><span class="hs-identifier hs-var">seqProblems</span></a><span>
</span><a name="line-450"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-451"></a><span>        </span><a name="local-6989586621679146701"><a href="#local-6989586621679146701"><span class="hs-identifier">taxaProblems</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621679146703"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679146699"><span class="hs-identifier hs-var">taxas</span></a><span>
</span><a name="line-452"></a><span>        </span><a name="local-6989586621679146702"><a href="#local-6989586621679146702"><span class="hs-identifier">seqProblems</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621679146704"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-6989586621679146700"><span class="hs-identifier hs-var">inputSeqBlocks</span></a><span>
</span><a name="line-453"></a><span>        </span><a name="local-6989586621679146703"><a href="#local-6989586621679146703"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="File.Format.Nexus.Data.html#TaxaSpecification"><span class="hs-identifier hs-var">TaxaSpecification</span></a><span> </span><a name="local-6989586621679146705"><a href="#local-6989586621679146705"><span class="hs-identifier">len</span></a></a><span> </span><a name="local-6989586621679146706"><a href="#local-6989586621679146706"><span class="hs-identifier">list</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679146707"><a href="#local-6989586621679146707"><span class="hs-identifier">len'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679146706"><span class="hs-identifier hs-var">list</span></a><span>
</span><a name="line-454"></a><span>            </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679146705"><span class="hs-identifier hs-var">len</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679146707"><span class="hs-identifier hs-var">len'</span></a><span>
</span><a name="line-455"></a><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-456"></a><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;ntax incorrect in Taxa block. Found: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679146707"><span class="hs-identifier hs-var">len'</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;, but ntax is given as &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679146705"><span class="hs-identifier hs-var">len</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;.\n&quot;</span><span>
</span><a name="line-457"></a><span>        </span><a name="local-6989586621679146704"><a href="#local-6989586621679146704"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-special">(</span><a href="File.Format.Nexus.Data.html#PhyloSequence"><span class="hs-identifier hs-var">PhyloSequence</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679146708"><a href="#local-6989586621679146708"><span class="hs-identifier">dimensions</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679146709"><a href="#local-6989586621679146709"><span class="hs-identifier">blockType'</span></a></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-458"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679146709"><span class="hs-identifier hs-var">blockType'</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-string">&quot;data&quot;</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- TODO: double-check for case-insensitivity problems</span><span>
</span><a name="line-459"></a><span>                </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679146708"><span class="hs-identifier hs-var">dimensions</span></a><span class="hs-special">)</span><span>
</span><a name="line-460"></a><span>                </span><span class="hs-keyword">then</span><span>
</span><a name="line-461"></a><span>                    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a href="File.Format.Nexus.Data.html#DimensionsFormat"><span class="hs-identifier hs-var">DimensionsFormat</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679146710"><a href="#local-6989586621679146710"><span class="hs-identifier">ntax'</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679146708"><span class="hs-identifier hs-var">dimensions</span></a><span>
</span><a name="line-462"></a><span>                    </span><span class="hs-keyword">in</span><span>
</span><a name="line-463"></a><span>                        </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679146710"><span class="hs-identifier hs-var">ntax'</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-comment">-- 0 is default value if ntax is missing</span><span>
</span><a name="line-464"></a><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-string">&quot;Data block is missing ntax directive.\n&quot;</span><span>
</span><a name="line-465"></a><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-466"></a><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-string">&quot;Data block is missing dimensions.\n&quot;</span><span>
</span><a name="line-467"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-468"></a><span>                </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679146708"><span class="hs-identifier hs-var">dimensions</span></a><span class="hs-special">)</span><span>
</span><a name="line-469"></a><span>                </span><span class="hs-keyword">then</span><span>
</span><a name="line-470"></a><span>                    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a href="File.Format.Nexus.Data.html#DimensionsFormat"><span class="hs-identifier hs-var">DimensionsFormat</span></a><span> </span><a name="local-6989586621679146711"><a href="#local-6989586621679146711"><span class="hs-identifier">newtaxa'</span></a></a><span> </span><a name="local-6989586621679146712"><a href="#local-6989586621679146712"><span class="hs-identifier">ntax'</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679146708"><span class="hs-identifier hs-var">dimensions</span></a><span>
</span><a name="line-471"></a><span>                    </span><span class="hs-keyword">in</span><span>
</span><a name="line-472"></a><span>                        </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679146711"><span class="hs-identifier hs-var">newtaxa'</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679146712"><span class="hs-identifier hs-var">ntax'</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-comment">-- 0 is default value if ntax is missing</span><span>
</span><a name="line-473"></a><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679146709"><span class="hs-identifier hs-var">blockType'</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; block is missing ntax directive.\n&quot;</span><span>
</span><a name="line-474"></a><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-475"></a><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679146709"><span class="hs-identifier hs-var">blockType'</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;Data block is missing dimensions.\n&quot;</span><span>
</span><a name="line-476"></a><span>
</span><a name="line-477"></a><span>
</span><a name="line-478"></a><span>
</span><a name="line-479"></a><span>
</span><a name="line-480"></a><span class="hs-comment">-- TODOs:</span><span>
</span><a name="line-481"></a><span class="hs-comment">-- &#8226;&#160;name chars, Nope don't do that here, just Maybe them!</span><span>
</span><a name="line-482"></a><span class="hs-comment">-- &#8226; make sure I've dealt with dynamic &amp; static homology correctly here.</span><span>
</span><a name="line-483"></a><span class="hs-comment">-- &#8226; fix elims</span><span>
</span><a name="line-484"></a><span class="hs-comment">-- &#8226; deal with additivity</span><span>
</span><a name="line-485"></a><span class="hs-comment">-- &#8226; deal with weight</span><span>
</span><a name="line-486"></a><span class="hs-comment">-- &#8226; deal with gapmode</span><span>
</span><a name="line-487"></a><span class="hs-comment">-- Note that these last four will all need the same functionality under the hood.</span><span>
</span><a name="line-488"></a><span class="hs-identifier">getCharMetadata</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="File.Format.Nexus.Data.html#StepMatrix"><span class="hs-identifier hs-type">StepMatrix</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.Nexus.Data.html#PhyloSequence"><span class="hs-identifier hs-type">PhyloSequence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="File.Format.Nexus.Data.html#CharacterMetadata"><span class="hs-identifier hs-type">CharacterMetadata</span></a><span>
</span><a name="line-489"></a><a name="getCharMetadata"><a href="File.Format.Nexus.Validate.html#getCharMetadata"><span class="hs-identifier">getCharMetadata</span></a></a><span> </span><a name="local-6989586621679146713"><a href="#local-6989586621679146713"><span class="hs-identifier">mayMtx</span></a></a><span> </span><a name="local-6989586621679146714"><a href="#local-6989586621679146714"><span class="hs-identifier">seqBlock</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-490"></a><span>    </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">replicate</span><span> </span><a href="#local-6989586621679146722"><span class="hs-identifier hs-var">len</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="File.Format.Nexus.Data.html#CharacterMetadata"><span class="hs-identifier hs-var">CharacterMetadata</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><a href="#local-6989586621679146715"><span class="hs-identifier hs-var">aligned</span></a><span> </span><a href="#local-6989586621679146716"><span class="hs-identifier hs-var">cType</span></a><span> </span><a href="#local-6989586621679146717"><span class="hs-identifier hs-var">alph</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621679146723"><span class="hs-identifier hs-var">mayTCM</span></a><span> </span><a href="#local-6989586621679146724"><span class="hs-identifier hs-var">additivity</span></a><span> </span><a href="#local-6989586621679146725"><span class="hs-identifier hs-var">wt</span></a><span>
</span><a name="line-491"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-492"></a><span>        </span><span class="hs-comment">-- All the `case form of` statements are to handle the possibly missing format values</span><span>
</span><a name="line-493"></a><span>        </span><span class="hs-comment">-- I think I appropriately default the values... but maybe not!</span><span>
</span><a name="line-494"></a><span>        </span><a name="local-6989586621679146715"><a href="#local-6989586621679146715"><span class="hs-identifier">aligned</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">alignedSeq</span><span> </span><a href="#local-6989586621679146714"><span class="hs-identifier hs-var">seqBlock</span></a><span>
</span><a name="line-495"></a><span>        </span><a name="local-6989586621679146716"><a href="#local-6989586621679146716"><span class="hs-identifier">cType</span></a></a><span>       </span><span class="hs-glyph">=</span><span>
</span><a name="line-496"></a><span>          </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679146721"><span class="hs-identifier hs-var">form</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-497"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.Nexus.Data.html#Standard"><span class="hs-identifier hs-var">Standard</span></a><span>
</span><a name="line-498"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679146726"><a href="#local-6989586621679146726"><span class="hs-identifier">fm</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">charDataType</span><span> </span><a href="#local-6989586621679146726"><span class="hs-identifier hs-var">fm</span></a><span>
</span><a name="line-499"></a><span>        </span><a name="local-6989586621679146717"><a href="#local-6989586621679146717"><span class="hs-identifier">alph</span></a></a><span>        </span><span class="hs-glyph">=</span><span>
</span><a name="line-500"></a><span>          </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679146721"><span class="hs-identifier hs-var">form</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-501"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679146720"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">headMay</span><span> </span><a href="#local-6989586621679146718"><span class="hs-identifier hs-var">syms</span></a><span>
</span><a name="line-502"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679146727"><a href="#local-6989586621679146727"><span class="hs-identifier">fm</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-503"></a><span>              </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">areTokens</span><span> </span><a href="#local-6989586621679146727"><span class="hs-identifier hs-var">fm</span></a><span>
</span><a name="line-504"></a><span>              </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679146718"><span class="hs-identifier hs-var">syms</span></a><span>
</span><a name="line-505"></a><span>              </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679146720"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">headMay</span><span> </span><a href="#local-6989586621679146718"><span class="hs-identifier hs-var">syms</span></a><span>
</span><a name="line-506"></a><span>        </span><a name="local-6989586621679146718"><a href="#local-6989586621679146718"><span class="hs-identifier">syms</span></a></a><span>        </span><span class="hs-glyph">=</span><span>
</span><a name="line-507"></a><span>          </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679146721"><span class="hs-identifier hs-var">form</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-508"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-509"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679146728"><a href="#local-6989586621679146728"><span class="hs-identifier">fm</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679146719"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">symbols</span><span> </span><a href="#local-6989586621679146728"><span class="hs-identifier hs-var">fm</span></a><span>
</span><a name="line-510"></a><span>        </span><a name="local-6989586621679146719"><a href="#local-6989586621679146719"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679146729"><a href="#local-6989586621679146729"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146729"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-511"></a><span>        </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Shouldn't be possible, but leaving it in for completeness.</span><span>
</span><a name="line-512"></a><span>        </span><a name="local-6989586621679146720"><a href="#local-6989586621679146720"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679146730"><a href="#local-6989586621679146730"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679146730"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-513"></a><span>        </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-514"></a><span>        </span><a name="local-6989586621679146721"><a href="#local-6989586621679146721"><span class="hs-identifier">form</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">headMay</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">format</span><span> </span><a href="#local-6989586621679146714"><span class="hs-identifier hs-var">seqBlock</span></a><span>
</span><a name="line-515"></a><span>        </span><a name="local-6989586621679146722"><a href="#local-6989586621679146722"><span class="hs-identifier">len</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">numChars</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">charDims</span><span> </span><a href="#local-6989586621679146714"><span class="hs-identifier hs-var">seqBlock</span></a><span>
</span><a name="line-516"></a><span>        </span><a name="local-6989586621679146723"><a href="#local-6989586621679146723"><span class="hs-identifier">mayTCM</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">matrixData</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679146713"><span class="hs-identifier hs-var">mayMtx</span></a><span>
</span><a name="line-517"></a><span>        </span><a name="local-6989586621679146724"><a href="#local-6989586621679146724"><span class="hs-identifier">additivity</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-518"></a><span>        </span><a name="local-6989586621679146725"><a href="#local-6989586621679146725"><span class="hs-identifier">wt</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-519"></a><span>
</span><a name="line-520"></a><span>
</span><a name="line-521"></a><span>
</span><a name="line-522"></a><span>
</span><a name="line-523"></a><span class="hs-comment">-- | getMatrixTaxonRecurrenceErrors takes a Phylosequence. It reads throught the PhyloSequence matrix to see if there are any taxa</span><span>
</span><a name="line-524"></a><span class="hs-comment">-- that appear the incorrect number of times (all should appear the same number of times)</span><span>
</span><a name="line-525"></a><span class="hs-identifier">getMatrixTaxonRecurrenceErrors</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="File.Format.Nexus.Data.html#PhyloSequence"><span class="hs-identifier hs-type">PhyloSequence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-526"></a><a name="getMatrixTaxonRecurrenceErrors"><a href="File.Format.Nexus.Validate.html#getMatrixTaxonRecurrenceErrors"><span class="hs-identifier">getMatrixTaxonRecurrenceErrors</span></a></a><span> </span><a name="local-6989586621679146731"><a href="#local-6989586621679146731"><span class="hs-identifier">seq'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146732"><span class="hs-identifier hs-var">wrongCountErrors</span></a><span> </span><span class="hs-comment">-- ++ extraTaxonErrors</span><span>
</span><a name="line-527"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-528"></a><span>        </span><a name="local-6989586621679146732"><a href="#local-6989586621679146732"><span class="hs-identifier">wrongCountErrors</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">foldrWithKey</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679146735"><a href="#local-6989586621679146735"><span class="hs-identifier">key</span></a></a><span> </span><a name="local-6989586621679146736"><a href="#local-6989586621679146736"><span class="hs-identifier">val</span></a></a><span> </span><a name="local-6989586621679146737"><a href="#local-6989586621679146737"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679146736"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679146734"><span class="hs-identifier hs-var">median</span></a><span>
</span><a name="line-529"></a><span>                                                               </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;\&quot;&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679146735"><span class="hs-identifier hs-var">key</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\&quot; appears the wrong number of times in a sequence block matrix. &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-530"></a><span>                                                                          </span><span class="hs-string">&quot;It should appear &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679146734"><span class="hs-identifier hs-var">median</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; times, but it actually appears &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679146736"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; times.\n&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-531"></a><span>                                                               </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679146737"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-532"></a><span>                                          </span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679146733"><span class="hs-identifier hs-var">seqTaxaMap</span></a><span>
</span><a name="line-533"></a><span>        </span><a name="local-6989586621679146733"><a href="#local-6989586621679146733"><span class="hs-identifier">seqTaxaMap</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#getTaxaFromMatrix"><span class="hs-identifier hs-var">getTaxaFromMatrix</span></a><span> </span><a href="#local-6989586621679146731"><span class="hs-identifier hs-var">seq'</span></a><span>
</span><a name="line-534"></a><span>        </span><a name="local-6989586621679146734"><a href="#local-6989586621679146734"><span class="hs-identifier">median</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#findMedian"><span class="hs-identifier hs-var">findMedian</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">elems</span><span> </span><a href="#local-6989586621679146733"><span class="hs-identifier hs-var">seqTaxaMap</span></a><span>
</span><a name="line-535"></a><span>
</span><a name="line-536"></a><span class="hs-comment">-- | findMedian sorts a Vector of orderables, then returns the middle value. It assumes there is at least one element in the Vector.</span><span>
</span><a name="line-537"></a><span class="hs-comment">-- TODO: change this to use Vectors; will require jumping through Monad hoops.</span><span>
</span><a name="line-538"></a><span class="hs-comment">-- See: http://stackoverflow.com/questions/3655329/how-does-one-sort-with-data-vector-generic-mutable</span><span>
</span><a name="line-539"></a><span class="hs-identifier">findMedian</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679146219"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679146219"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679146219"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-540"></a><a name="findMedian"><a href="File.Format.Nexus.Validate.html#findMedian"><span class="hs-identifier">findMedian</span></a></a><span> </span><a name="local-6989586621679146738"><a href="#local-6989586621679146738"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sort</span><span> </span><a href="#local-6989586621679146738"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">!!</span><span> </span><span class="hs-identifier hs-var">quot</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679146738"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-541"></a><span>
</span><a name="line-542"></a><span class="hs-comment">-- | getEquates takes a PhyloSequence and returns an Either String [String]. The left is an error message received from the parser.</span><span>
</span><a name="line-543"></a><span class="hs-comment">-- The right is a list of strings retrieved from the Parser. If the right is empty, it returns Right [&quot;&quot;].</span><span>
</span><a name="line-544"></a><span class="hs-identifier">getEquates</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="File.Format.Nexus.Data.html#PhyloSequence"><span class="hs-identifier hs-type">PhyloSequence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-545"></a><a name="getEquates"><a href="File.Format.Nexus.Validate.html#getEquates"><span class="hs-identifier">getEquates</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">equate</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">headMay</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">format</span><span>
</span><a name="line-546"></a><span>
</span><a name="line-547"></a><span class="hs-comment">-- | getTaxaFromMatrix takes a PhyloSequence and returns a map from String to Int, where the String is a taxon name,</span><span>
</span><a name="line-548"></a><span class="hs-comment">-- and the Int is the number of times it appears in the sequence matrix.</span><span>
</span><a name="line-549"></a><span class="hs-identifier">getTaxaFromMatrix</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="File.Format.Nexus.Data.html#PhyloSequence"><span class="hs-identifier hs-type">PhyloSequence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">M</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Map</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-550"></a><a name="getTaxaFromMatrix"><a href="File.Format.Nexus.Validate.html#getTaxaFromMatrix"><span class="hs-identifier">getTaxaFromMatrix</span></a></a><span> </span><a name="local-6989586621679146739"><a href="#local-6989586621679146739"><span class="hs-identifier">seq'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">{-trace (show taxa) $ -}</span><span>
</span><a name="line-551"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679146740"><span class="hs-identifier hs-var">noLabels</span></a><span>
</span><a name="line-552"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span>
</span><a name="line-553"></a><span>        </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679146746"><span class="hs-identifier hs-var">taxaMap</span></a><span>
</span><a name="line-554"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-555"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679146740"><a href="#local-6989586621679146740"><span class="hs-identifier">noLabels</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679146741"><a href="#local-6989586621679146741"><span class="hs-identifier">_interleaved</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679146742"><a href="#local-6989586621679146742"><span class="hs-identifier">_tkns</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679146743"><a href="#local-6989586621679146743"><span class="hs-identifier">_type</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679146744"><a href="#local-6989586621679146744"><span class="hs-identifier">_matchChar'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#getFormatInfo"><span class="hs-identifier hs-var">getFormatInfo</span></a><span> </span><a href="#local-6989586621679146739"><span class="hs-identifier hs-var">seq'</span></a><span>
</span><a name="line-556"></a><span>        </span><a name="local-6989586621679146745"><a href="#local-6989586621679146745"><span class="hs-identifier">mtx</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">seqMatrix</span><span> </span><a href="#local-6989586621679146739"><span class="hs-identifier hs-var">seq'</span></a><span> </span><span class="hs-comment">-- I've already checked to make sure there's a matrix</span><span>
</span><a name="line-557"></a><span>        </span><a name="local-6989586621679146746"><a href="#local-6989586621679146746"><span class="hs-identifier">taxaMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679146748"><a href="#local-6989586621679146748"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679146749"><a href="#local-6989586621679146749"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">insert</span><span> </span><a href="#local-6989586621679146748"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">succ</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">findWithDefault</span><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679146748"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679146749"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679146749"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span> </span><a href="#local-6989586621679146747"><span class="hs-identifier hs-var">taxa</span></a><span>
</span><a name="line-558"></a><span>        </span><a name="local-6989586621679146747"><a href="#local-6989586621679146747"><span class="hs-identifier">taxa</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">takeWhile</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">notElem</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot; \t&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679146745"><span class="hs-identifier hs-var">mtx</span></a><span>
</span><a name="line-559"></a><span>
</span><a name="line-560"></a><span class="hs-comment">-- TODO: This is too similar to getEquates, above. Can they be combined?</span><span>
</span><a name="line-561"></a><span class="hs-identifier">getSymbols</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="File.Format.Nexus.Data.html#PhyloSequence"><span class="hs-identifier hs-type">PhyloSequence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-562"></a><a name="getSymbols"><a href="File.Format.Nexus.Validate.html#getSymbols"><span class="hs-identifier">getSymbols</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">symbols</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">headMay</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">format</span><span>
</span><a name="line-563"></a><span>
</span><a name="line-564"></a><span class="hs-comment">-- | splitSequenceReplaceAmbiguities takes in a String and returns a Sequence (Vector of Characters)</span><span>
</span><a name="line-565"></a><span class="hs-comment">-- The String may be returned as a singleton Vector---a single character, if unaligned (dynamic homology), or</span><span>
</span><a name="line-566"></a><span class="hs-comment">-- as a Vector with length &gt; 1 if aligned (static homology).</span><span>
</span><a name="line-567"></a><span class="hs-comment">-- either way, multiple-character ambiguities are replaced by single character ambiguities.</span><span>
</span><a name="line-568"></a><span class="hs-comment">-- TODO: abmiguity replacement shouldn't actually take place if continuous or if custom alphabet</span><span>
</span><a name="line-569"></a><span class="hs-identifier">splitSequenceReplaceAmbiguities</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.Nexus.Data.html#Sequence"><span class="hs-identifier hs-type">Sequence</span></a><span>
</span><a name="line-570"></a><a name="splitSequenceReplaceAmbiguities"><a href="File.Format.Nexus.Validate.html#splitSequenceReplaceAmbiguities"><span class="hs-identifier">splitSequenceReplaceAmbiguities</span></a></a><span> </span><a name="local-6989586621679146750"><a href="#local-6989586621679146750"><span class="hs-identifier">isTokens</span></a></a><span> </span><a name="local-6989586621679146751"><a href="#local-6989586621679146751"><span class="hs-identifier">isContinuous</span></a></a><span> </span><a name="local-6989586621679146752"><a href="#local-6989586621679146752"><span class="hs-identifier">isAlign</span></a></a><span> </span><a name="local-6989586621679146753"><a href="#local-6989586621679146753"><span class="hs-identifier">seq'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146754"><span class="hs-identifier hs-var">finalList</span></a><span>
</span><a name="line-571"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-572"></a><span>        </span><a name="local-6989586621679146754"><a href="#local-6989586621679146754"><span class="hs-identifier">finalList</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-573"></a><span>            </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679146752"><span class="hs-identifier hs-var">isAlign</span></a><span>
</span><a name="line-574"></a><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">singleton</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679146755"><span class="hs-identifier hs-var">chars</span></a><span> </span><span class="hs-comment">-- aligned, so each item in vector of ambiguity groups is single char</span><span>
</span><a name="line-575"></a><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">singleton</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><a href="#local-6989586621679146755"><span class="hs-identifier hs-var">chars</span></a><span> </span><span class="hs-comment">-- not aligned, so whole vector of ambiguity groups is single char</span><span>
</span><a name="line-576"></a><span>        </span><a name="local-6989586621679146755"><a href="#local-6989586621679146755"><span class="hs-identifier">chars</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-577"></a><span>            </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679146750"><span class="hs-identifier hs-var">isTokens</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679146751"><span class="hs-identifier hs-var">isContinuous</span></a><span>
</span><a name="line-578"></a><span>                </span><span class="hs-keyword">then</span><span> </span><a href="File.Format.Nexus.Validate.html#findAmbiguousTokens"><span class="hs-identifier hs-var">findAmbiguousTokens</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">words</span><span> </span><a href="#local-6989586621679146753"><span class="hs-identifier hs-var">seq'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-579"></a><span>                </span><span class="hs-keyword">else</span><span> </span><a href="File.Format.Nexus.Validate.html#findAmbiguousNoTokens"><span class="hs-identifier hs-var">findAmbiguousNoTokens</span></a><span> </span><span class="hs-special">(</span><a href="File.Format.Nexus.Validate.html#strip"><span class="hs-identifier hs-var">strip</span></a><span> </span><a href="#local-6989586621679146753"><span class="hs-identifier hs-var">seq'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-580"></a><span>
</span><a name="line-581"></a><span class="hs-comment">-- | findAmbiguousNoTokens takes a sequence as a String. If it encounters a '{' or '(', it translates</span><span>
</span><a name="line-582"></a><span class="hs-comment">-- the characters inside the delimiters into a list of Strings. It then outputs the original input</span><span>
</span><a name="line-583"></a><span class="hs-comment">-- with all ambiguous sequences replaced by these lists</span><span>
</span><a name="line-584"></a><span class="hs-comment">-- Parens and curly braces are treated the same</span><span>
</span><a name="line-585"></a><span class="hs-identifier">findAmbiguousNoTokens</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.Nexus.Data.html#AmbiguityGroup"><span class="hs-identifier hs-type">AmbiguityGroup</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="File.Format.Nexus.Data.html#AmbiguityGroup"><span class="hs-identifier hs-type">AmbiguityGroup</span></a><span class="hs-special">]</span><span>
</span><a name="line-586"></a><a name="findAmbiguousNoTokens"><a href="File.Format.Nexus.Validate.html#findAmbiguousNoTokens"><span class="hs-identifier">findAmbiguousNoTokens</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-587"></a><span class="hs-identifier">findAmbiguousNoTokens</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679146756"><a href="#local-6989586621679146756"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679146757"><a href="#local-6989586621679146757"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679146758"><a href="#local-6989586621679146758"><span class="hs-identifier">acc</span></a></a><span> </span><a name="local-6989586621679146759"><a href="#local-6989586621679146759"><span class="hs-identifier">isAmb</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-588"></a><span>              </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679146756"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-589"></a><span>                </span><span class="hs-char">' '</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.Nexus.Validate.html#findAmbiguousNoTokens"><span class="hs-identifier hs-var">findAmbiguousNoTokens</span></a><span> </span><a href="#local-6989586621679146757"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621679146758"><span class="hs-identifier hs-var">acc</span></a><span> </span><a href="#local-6989586621679146759"><span class="hs-identifier hs-var">isAmb</span></a><span>
</span><a name="line-590"></a><span>                </span><span class="hs-char">'{'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.Nexus.Validate.html#findAmbiguousNoTokens"><span class="hs-identifier hs-var">findAmbiguousNoTokens</span></a><span> </span><a href="#local-6989586621679146757"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-591"></a><span>                </span><span class="hs-char">'}'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679146758"><span class="hs-identifier hs-var">acc</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="File.Format.Nexus.Validate.html#findAmbiguousNoTokens"><span class="hs-identifier hs-var">findAmbiguousNoTokens</span></a><span> </span><a href="#local-6989586621679146757"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-592"></a><span>                </span><span class="hs-char">'('</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.Nexus.Validate.html#findAmbiguousNoTokens"><span class="hs-identifier hs-var">findAmbiguousNoTokens</span></a><span> </span><a href="#local-6989586621679146757"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-593"></a><span>                </span><span class="hs-char">')'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679146758"><span class="hs-identifier hs-var">acc</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="File.Format.Nexus.Validate.html#findAmbiguousNoTokens"><span class="hs-identifier hs-var">findAmbiguousNoTokens</span></a><span> </span><a href="#local-6989586621679146757"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-594"></a><span>                </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679146759"><span class="hs-identifier hs-var">isAmb</span></a><span>
</span><a name="line-595"></a><span>                           </span><span class="hs-keyword">then</span><span> </span><a href="File.Format.Nexus.Validate.html#findAmbiguousNoTokens"><span class="hs-identifier hs-var">findAmbiguousNoTokens</span></a><span> </span><a href="#local-6989586621679146757"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679146758"><span class="hs-identifier hs-var">acc</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679146756"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679146759"><span class="hs-identifier hs-var">isAmb</span></a><span>
</span><a name="line-596"></a><span>                           </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679146756"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="File.Format.Nexus.Validate.html#findAmbiguousNoTokens"><span class="hs-identifier hs-var">findAmbiguousNoTokens</span></a><span> </span><a href="#local-6989586621679146757"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679146759"><span class="hs-identifier hs-var">isAmb</span></a><span>
</span><a name="line-597"></a><span>
</span><a name="line-598"></a><span class="hs-comment">-- | seqMatrixMissing takes in a PhyloSequence and makes sure it has a sequence matrix.</span><span>
</span><a name="line-599"></a><span class="hs-comment">-- Returns a Bool.</span><span>
</span><a name="line-600"></a><span class="hs-identifier">seqMatrixMissing</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="File.Format.Nexus.Data.html#PhyloSequence"><span class="hs-identifier hs-type">PhyloSequence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-601"></a><a name="seqMatrixMissing"><a href="File.Format.Nexus.Validate.html#seqMatrixMissing"><span class="hs-identifier">seqMatrixMissing</span></a></a><span> </span><a name="local-6989586621679146760"><a href="#local-6989586621679146760"><span class="hs-identifier">phyloSeq</span></a></a><span>
</span><a name="line-602"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679146761"><span class="hs-identifier hs-var">numMatrices</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146762"><span class="hs-identifier hs-var">tooFew</span></a><span>
</span><a name="line-603"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679146761"><span class="hs-identifier hs-var">numMatrices</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146763"><span class="hs-identifier hs-var">tooMany</span></a><span>
</span><a name="line-604"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-605"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-606"></a><span>    </span><a name="local-6989586621679146761"><a href="#local-6989586621679146761"><span class="hs-identifier">numMatrices</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">seqMatrix</span><span> </span><a href="#local-6989586621679146760"><span class="hs-identifier hs-var">phyloSeq</span></a><span>
</span><a name="line-607"></a><span>    </span><a name="local-6989586621679146762"><a href="#local-6989586621679146762"><span class="hs-identifier">tooFew</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">blockType</span><span> </span><a href="#local-6989586621679146760"><span class="hs-identifier hs-var">phyloSeq</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; block has no sequence matrix.\n&quot;</span><span>
</span><a name="line-608"></a><span>    </span><a name="local-6989586621679146763"><a href="#local-6989586621679146763"><span class="hs-identifier">tooMany</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">blockType</span><span> </span><a href="#local-6989586621679146760"><span class="hs-identifier hs-var">phyloSeq</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; block has more than one sequence matrix.\n&quot;</span><span>
</span><a name="line-609"></a><span>
</span><a name="line-610"></a><span class="hs-comment">-- | seqDimsMissing checks a PhyloSequence to make sure it has the requisite sequence dims.</span><span>
</span><a name="line-611"></a><span class="hs-identifier">seqDimsMissing</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="File.Format.Nexus.Data.html#PhyloSequence"><span class="hs-identifier hs-type">PhyloSequence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-612"></a><a name="seqDimsMissing"><a href="File.Format.Nexus.Validate.html#seqDimsMissing"><span class="hs-identifier">seqDimsMissing</span></a></a><span> </span><a name="local-6989586621679146764"><a href="#local-6989586621679146764"><span class="hs-identifier">phyloSeq</span></a></a><span>
</span><a name="line-613"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679146765"><span class="hs-identifier hs-var">numDims</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier">blockType</span><span> </span><a href="#local-6989586621679146764"><span class="hs-identifier hs-var">phyloSeq</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-string">&quot;unaligned&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146766"><span class="hs-identifier hs-var">tooFew</span></a><span>
</span><a name="line-614"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679146765"><span class="hs-identifier hs-var">numDims</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146767"><span class="hs-identifier hs-var">tooMany</span></a><span>
</span><a name="line-615"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-616"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-617"></a><span>    </span><a name="local-6989586621679146765"><a href="#local-6989586621679146765"><span class="hs-identifier">numDims</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">charDims</span><span> </span><a href="#local-6989586621679146764"><span class="hs-identifier hs-var">phyloSeq</span></a><span>
</span><a name="line-618"></a><span>    </span><a name="local-6989586621679146766"><a href="#local-6989586621679146766"><span class="hs-identifier">tooFew</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">blockType</span><span> </span><a href="#local-6989586621679146764"><span class="hs-identifier hs-var">phyloSeq</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; block has no dimensions or dimensions are misformatted.\n&quot;</span><span>
</span><a name="line-619"></a><span>    </span><a name="local-6989586621679146767"><a href="#local-6989586621679146767"><span class="hs-identifier">tooMany</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">blockType</span><span> </span><a href="#local-6989586621679146764"><span class="hs-identifier hs-var">phyloSeq</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; block has more than one dimension directive.\n&quot;</span><span>
</span><a name="line-620"></a><span>
</span><a name="line-621"></a><span class="hs-comment">-- | findAmbiguousTokens is similar to findAmbiguousNoTokens. It takes a sequence as a String.</span><span>
</span><a name="line-622"></a><span class="hs-comment">-- If it encounters a '{' or '(', it translates</span><span>
</span><a name="line-623"></a><span class="hs-comment">-- the characters inside the delimiters into a list of Strings. It then outputs the original input</span><span>
</span><a name="line-624"></a><span class="hs-comment">-- with all ambiguous sequences replaced by these lists</span><span>
</span><a name="line-625"></a><span class="hs-identifier">findAmbiguousTokens</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.Nexus.Data.html#AmbiguityGroup"><span class="hs-identifier hs-type">AmbiguityGroup</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="File.Format.Nexus.Data.html#AmbiguityGroup"><span class="hs-identifier hs-type">AmbiguityGroup</span></a><span class="hs-special">]</span><span>
</span><a name="line-626"></a><a name="findAmbiguousTokens"><a href="File.Format.Nexus.Validate.html#findAmbiguousTokens"><span class="hs-identifier">findAmbiguousTokens</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-627"></a><span class="hs-identifier">findAmbiguousTokens</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679146768"><a href="#local-6989586621679146768"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679146769"><a href="#local-6989586621679146769"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679146770"><a href="#local-6989586621679146770"><span class="hs-identifier">acc</span></a></a><span> </span><a name="local-6989586621679146771"><a href="#local-6989586621679146771"><span class="hs-identifier">amb</span></a></a><span>
</span><a name="line-628"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679146772"><span class="hs-identifier hs-var">xHead</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-string">&quot;{&quot;</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679146772"><span class="hs-identifier hs-var">xHead</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-string">&quot;(&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#findAmbiguousTokens"><span class="hs-identifier hs-var">findAmbiguousTokens</span></a><span> </span><a href="#local-6989586621679146769"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679146773"><span class="hs-identifier hs-var">xTail</span></a><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-629"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679146774"><span class="hs-identifier hs-var">xLast</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-string">&quot;}&quot;</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679146774"><span class="hs-identifier hs-var">xLast</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-string">&quot;)&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679146770"><span class="hs-identifier hs-var">acc</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">takeWhile</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679146775"><a href="#local-6989586621679146775"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679146775"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-char">'}'</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679146775"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-char">')'</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679146768"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="File.Format.Nexus.Validate.html#findAmbiguousTokens"><span class="hs-identifier hs-var">findAmbiguousTokens</span></a><span> </span><a href="#local-6989586621679146769"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-630"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679146771"><span class="hs-identifier hs-var">amb</span></a><span>                          </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#findAmbiguousTokens"><span class="hs-identifier hs-var">findAmbiguousTokens</span></a><span> </span><a href="#local-6989586621679146769"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679146770"><span class="hs-identifier hs-var">acc</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679146768"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679146771"><span class="hs-identifier hs-var">amb</span></a><span>
</span><a name="line-631"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679146768"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="File.Format.Nexus.Validate.html#findAmbiguousTokens"><span class="hs-identifier hs-var">findAmbiguousTokens</span></a><span> </span><a href="#local-6989586621679146769"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679146771"><span class="hs-identifier hs-var">amb</span></a><span>
</span><a name="line-632"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-633"></a><span>    </span><a name="local-6989586621679146772"><a href="#local-6989586621679146772"><span class="hs-identifier">xHead</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#safeHead"><span class="hs-identifier hs-var">safeHead</span></a><span> </span><a href="#local-6989586621679146768"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-634"></a><span>    </span><a name="local-6989586621679146773"><a href="#local-6989586621679146773"><span class="hs-identifier">xTail</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#safeTail"><span class="hs-identifier hs-var">safeTail</span></a><span> </span><a href="#local-6989586621679146768"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-635"></a><span>    </span><a name="local-6989586621679146774"><a href="#local-6989586621679146774"><span class="hs-identifier">xLast</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#safeLast"><span class="hs-identifier hs-var">safeLast</span></a><span> </span><a href="#local-6989586621679146768"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-636"></a><span>
</span><a name="line-637"></a><span class="hs-identifier">safeLast</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679146218"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679146218"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-638"></a><a name="safeLast"><a href="File.Format.Nexus.Validate.html#safeLast"><span class="hs-identifier">safeLast</span></a></a><span> </span><a name="local-6989586621679146776"><a href="#local-6989586621679146776"><span class="hs-identifier">inLst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">last</span><span> </span><a href="#local-6989586621679146776"><span class="hs-identifier hs-var">inLst</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679146776"><span class="hs-identifier hs-var">inLst</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-639"></a><span>
</span><a name="line-640"></a><span class="hs-identifier">safeHead</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679146217"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679146217"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-641"></a><a name="safeHead"><a href="File.Format.Nexus.Validate.html#safeHead"><span class="hs-identifier">safeHead</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-642"></a><span class="hs-identifier">safeHead</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679146777"><a href="#local-6989586621679146777"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679146777"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span>
</span><a name="line-643"></a><span>
</span><a name="line-644"></a><span class="hs-identifier">safeTail</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679146216"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679146216"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-645"></a><a name="safeTail"><a href="File.Format.Nexus.Validate.html#safeTail"><span class="hs-identifier">safeTail</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-646"></a><span class="hs-identifier">safeTail</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621679146778"><a href="#local-6989586621679146778"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146778"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-647"></a><span>
</span><a name="line-648"></a><span class="hs-comment">-- | findInterleaveError takes a Vector of the taxon names and a Phylosequence and then attempts to determine</span><span>
</span><a name="line-649"></a><span class="hs-comment">-- whether the sequence matrix in the PhyloSequence, if interleaved, is interleaved correctly. I.e., no taxon appears</span><span>
</span><a name="line-650"></a><span class="hs-comment">-- more or fewer times than another.</span><span>
</span><a name="line-651"></a><span class="hs-identifier">findInterleaveError</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.Nexus.Data.html#PhyloSequence"><span class="hs-identifier hs-type">PhyloSequence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-652"></a><a name="findInterleaveError"><a href="File.Format.Nexus.Validate.html#findInterleaveError"><span class="hs-identifier">findInterleaveError</span></a></a><span> </span><a name="local-6989586621679146779"><a href="#local-6989586621679146779"><span class="hs-identifier">taxaLst</span></a></a><span> </span><a name="local-6989586621679146780"><a href="#local-6989586621679146780"><span class="hs-identifier">seq'</span></a></a><span>
</span><a name="line-653"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679146779"><span class="hs-identifier hs-var">taxaLst</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-654"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>          </span><span class="hs-glyph">=</span><span>
</span><a name="line-655"></a><span>        </span><span class="hs-comment">-- Line returns are not ignored in interleaved blocks, so this is correct logic.</span><span>
</span><a name="line-656"></a><span>        </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679146782"><span class="hs-identifier hs-var">interleaved</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679146783"><span class="hs-identifier hs-var">noLabels</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679146785"><span class="hs-identifier hs-var">lineCount</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mod</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679146784"><span class="hs-identifier hs-var">taxaCount</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-657"></a><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679146786"><span class="hs-identifier hs-var">which</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; block is not interleaved correctly. \n&quot;</span><span> </span><span class="hs-comment">{- ++ (show numLines) ++ &quot; &quot; ++ (show numTaxa) -}</span><span>
</span><a name="line-658"></a><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-659"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-660"></a><span>            </span><a name="local-6989586621679146781"><a href="#local-6989586621679146781"><span class="hs-identifier">formatted</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">format</span><span> </span><a href="#local-6989586621679146780"><span class="hs-identifier hs-var">seq'</span></a><span>
</span><a name="line-661"></a><span>            </span><a name="local-6989586621679146782"><a href="#local-6989586621679146782"><span class="hs-identifier">interleaved</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146781"><span class="hs-identifier hs-var">formatted</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier">interleave</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">format</span><span> </span><a href="#local-6989586621679146780"><span class="hs-identifier hs-var">seq'</span></a><span class="hs-special">)</span><span>
</span><a name="line-662"></a><span>            </span><a name="local-6989586621679146783"><a href="#local-6989586621679146783"><span class="hs-identifier">noLabels</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146781"><span class="hs-identifier hs-var">formatted</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier">unlabeled</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">format</span><span> </span><a href="#local-6989586621679146780"><span class="hs-identifier hs-var">seq'</span></a><span class="hs-special">)</span><span>
</span><a name="line-663"></a><span>            </span><a name="local-6989586621679146784"><a href="#local-6989586621679146784"><span class="hs-identifier">taxaCount</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679146779"><span class="hs-identifier hs-var">taxaLst</span></a><span>
</span><a name="line-664"></a><span>            </span><a name="local-6989586621679146785"><a href="#local-6989586621679146785"><span class="hs-identifier">lineCount</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">seqMatrix</span><span> </span><a href="#local-6989586621679146780"><span class="hs-identifier hs-var">seq'</span></a><span>
</span><a name="line-665"></a><span>            </span><a name="local-6989586621679146786"><a href="#local-6989586621679146786"><span class="hs-identifier">which</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">blockType</span><span> </span><a href="#local-6989586621679146780"><span class="hs-identifier hs-var">seq'</span></a><span>
</span><a name="line-666"></a><span>
</span><a name="line-667"></a><span class="hs-identifier">getFormatInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="File.Format.Nexus.Data.html#PhyloSequence"><span class="hs-identifier hs-type">PhyloSequence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><a href="File.Format.Nexus.Data.html#CharDataType"><span class="hs-identifier hs-type">CharDataType</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span>
</span><a name="line-668"></a><a name="getFormatInfo"><a href="File.Format.Nexus.Validate.html#getFormatInfo"><span class="hs-identifier">getFormatInfo</span></a></a><span> </span><a name="local-6989586621679146787"><a href="#local-6989586621679146787"><span class="hs-identifier">phyloSeq</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">headMay</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">format</span><span> </span><a href="#local-6989586621679146787"><span class="hs-identifier hs-var">phyloSeq</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-669"></a><span>                       </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span> </span><a href="File.Format.Nexus.Data.html#Standard"><span class="hs-identifier hs-var">Standard</span></a><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-670"></a><span>                       </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679146788"><a href="#local-6989586621679146788"><span class="hs-identifier">x</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">alignedSeq</span><span> </span><a href="#local-6989586621679146787"><span class="hs-identifier hs-var">phyloSeq</span></a><span>
</span><a name="line-671"></a><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">unlabeled</span><span> </span><a href="#local-6989586621679146788"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-672"></a><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">interleave</span><span> </span><a href="#local-6989586621679146788"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-673"></a><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">areTokens</span><span> </span><a href="#local-6989586621679146788"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-674"></a><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">charDataType</span><span> </span><a href="#local-6989586621679146788"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-675"></a><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">matchChar</span><span> </span><a href="#local-6989586621679146788"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-676"></a><span>                                  </span><span class="hs-special">)</span><span>
</span><a name="line-677"></a><span>
</span><a name="line-678"></a><span class="hs-comment">-- | getSeqFromMatrix takes a PhyloSequence and a Vector of taxon names and produces a Map from</span><span>
</span><a name="line-679"></a><span class="hs-comment">-- taxon name to Sequence.</span><span>
</span><a name="line-680"></a><span class="hs-comment">-- In doing so, it replaces match characters, equates characters and</span><span>
</span><a name="line-681"></a><span class="hs-comment">-- This function was written prior to creating the decision tree logic used to create the &quot;handle&quot; fns., and</span><span>
</span><a name="line-682"></a><span class="hs-comment">-- prior to realizing that newline characters are ignored whitespace except when the matrix is interleaved.</span><span>
</span><a name="line-683"></a><span class="hs-comment">-- That decision tree was created for use under deadline pressure, so to save time the existing fn</span><span>
</span><a name="line-684"></a><span class="hs-comment">-- was simply modified to be able to handle all three use cases present in the tree, leading to a rather</span><span>
</span><a name="line-685"></a><span class="hs-comment">-- convoluted structure. Those use cases are:</span><span>
</span><a name="line-686"></a><span class="hs-comment">-- 1.   labeled,     interleaved,     aligned</span><span>
</span><a name="line-687"></a><span class="hs-comment">-- 2.   labeled,     interleaved, not aligned</span><span>
</span><a name="line-688"></a><span class="hs-comment">-- 3.   labeled, not interleaved,     aligned</span><span>
</span><a name="line-689"></a><span class="hs-comment">-- 4. unlabeled, not interleaved,     aligned</span><span>
</span><a name="line-690"></a><span class="hs-comment">-- 5. unlabeled, not interleaved, not aligned</span><span>
</span><a name="line-691"></a><span class="hs-comment">-- There are actually subcases relating to whether the sequences are tokenized, as well, but they're not as</span><span>
</span><a name="line-692"></a><span class="hs-comment">-- important to my short-term goal, so they're in the code, but not separated out in the comments.</span><span>
</span><a name="line-693"></a><span class="hs-comment">--</span><span>
</span><a name="line-694"></a><span class="hs-comment">-- All checking to make sure that error cases don't exist must be performed prior to calling this fn, so some</span><span>
</span><a name="line-695"></a><span class="hs-comment">-- seemingly important program logic does not exist here, but occurs, rather in the &quot;handle&quot; fns.</span><span>
</span><a name="line-696"></a><span class="hs-identifier">getSeqFromMatrix</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="File.Format.Nexus.Data.html#PhyloSequence"><span class="hs-identifier hs-type">PhyloSequence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="File.Format.Nexus.Data.html#TaxonSequenceMap"><span class="hs-identifier hs-type">TaxonSequenceMap</span></a><span>
</span><a name="line-697"></a><span class="hs-comment">-- getSeqFromMatrix [] _ = V.empty</span><span>
</span><a name="line-698"></a><a name="getSeqFromMatrix"><a href="File.Format.Nexus.Validate.html#getSeqFromMatrix"><span class="hs-identifier">getSeqFromMatrix</span></a></a><span> </span><a name="local-6989586621679146789"><a href="#local-6989586621679146789"><span class="hs-identifier">seqBlock</span></a></a><span> </span><a name="local-6989586621679146790"><a href="#local-6989586621679146790"><span class="hs-identifier">taxaLst</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-699"></a><span>    </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="File.Format.Nexus.Validate.html#splitSequenceReplaceAmbiguities"><span class="hs-identifier hs-var">splitSequenceReplaceAmbiguities</span></a><span> </span><a href="#local-6989586621679146794"><span class="hs-identifier hs-var">tkns</span></a><span> </span><a href="#local-6989586621679146807"><span class="hs-identifier hs-var">isCont</span></a><span> </span><a href="#local-6989586621679146791"><span class="hs-identifier hs-var">aligned</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679146804"><span class="hs-identifier hs-var">equatesReplaced</span></a><span>
</span><a name="line-700"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-701"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679146791"><a href="#local-6989586621679146791"><span class="hs-identifier">aligned</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679146792"><a href="#local-6989586621679146792"><span class="hs-identifier">noLabels</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679146793"><a href="#local-6989586621679146793"><span class="hs-identifier">interleaved</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679146794"><a href="#local-6989586621679146794"><span class="hs-identifier">tkns</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679146795"><a href="#local-6989586621679146795"><span class="hs-identifier">characterType</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679146796"><a href="#local-6989586621679146796"><span class="hs-identifier">matchChar'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#getFormatInfo"><span class="hs-identifier hs-var">getFormatInfo</span></a><span> </span><a href="#local-6989586621679146789"><span class="hs-identifier hs-var">seqBlock</span></a><span>
</span><a name="line-702"></a><span>        </span><a name="local-6989586621679146797"><a href="#local-6989586621679146797"><span class="hs-identifier">seqLen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">numChars</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">charDims</span><span> </span><a href="#local-6989586621679146789"><span class="hs-identifier hs-var">seqBlock</span></a><span> </span><span class="hs-comment">-- I've already checked to make sure there's a dimensions in the block</span><span>
</span><a name="line-703"></a><span class="hs-comment">--        taxaCount  = length taxaLst</span><span>
</span><a name="line-704"></a><span>        </span><a name="local-6989586621679146798"><a href="#local-6989586621679146798"><span class="hs-identifier">taxaMap</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621679146790"><span class="hs-identifier hs-var">taxaLst</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">repeat</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-705"></a><span>        </span><a name="local-6989586621679146799"><a href="#local-6989586621679146799"><span class="hs-identifier">mtx</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">seqMatrix</span><span> </span><a href="#local-6989586621679146789"><span class="hs-identifier hs-var">seqBlock</span></a><span> </span><span class="hs-comment">-- I've already checked to make sure there's a matrix</span><span>
</span><a name="line-706"></a><span>        </span><a name="local-6989586621679146800"><a href="#local-6989586621679146800"><span class="hs-identifier">entireSeqs</span></a></a><span> </span><span class="hs-comment">-- entireSeqs will be a list of tuples (taxon, concatted seq)</span><span>
</span><a name="line-707"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679146792"><span class="hs-identifier hs-var">noLabels</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621679146790"><span class="hs-identifier hs-var">taxaLst</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679146799"><span class="hs-identifier hs-var">mtx</span></a><span> </span><span class="hs-comment">-- Cases 4 and 5: Alignment will be checked in splitSequenceReplaceAmbiguities</span><span>
</span><a name="line-708"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679146793"><span class="hs-identifier hs-var">interleaved</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#getTaxonAndSeqFromMatrixRow"><span class="hs-identifier hs-var">getTaxonAndSeqFromMatrixRow</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679146799"><span class="hs-identifier hs-var">mtx</span></a><span> </span><span class="hs-comment">-- Cases 1 and 2: Alignment will be checked in splitSequenceReplaceAmbiguities</span><span>
</span><a name="line-709"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#getTaxaAndSeqsFromEntireMatrix"><span class="hs-identifier hs-var">getTaxaAndSeqsFromEntireMatrix</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679146807"><span class="hs-identifier hs-var">isCont</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679146794"><span class="hs-identifier hs-var">tkns</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679146797"><span class="hs-identifier hs-var">seqLen</span></a><span> </span><a href="#local-6989586621679146799"><span class="hs-identifier hs-var">mtx</span></a><span> </span><span class="hs-comment">-- Case 3: To get here, we must have already errored out unaligned in &quot;handle&quot; fns</span><span>
</span><a name="line-710"></a><span>            </span><span class="hs-comment">-- TODO: need to add custom alphabet to condition here?</span><span>
</span><a name="line-711"></a><span>        </span><a name="local-6989586621679146801"><a href="#local-6989586621679146801"><span class="hs-identifier">entireDeinterleavedSeqs</span></a></a><span>
</span><a name="line-712"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679146793"><span class="hs-identifier hs-var">interleaved</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#deInterleave"><span class="hs-identifier hs-var">deInterleave</span></a><span> </span><a href="#local-6989586621679146798"><span class="hs-identifier hs-var">taxaMap</span></a><span> </span><a href="#local-6989586621679146800"><span class="hs-identifier hs-var">entireSeqs</span></a><span>
</span><a name="line-713"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><a href="#local-6989586621679146800"><span class="hs-identifier hs-var">entireSeqs</span></a><span>
</span><a name="line-714"></a><span>        </span><a name="local-6989586621679146802"><a href="#local-6989586621679146802"><span class="hs-identifier">firstSeq</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromJust</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">lookup</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679146792"><span class="hs-identifier hs-var">noLabels</span></a><span>
</span><a name="line-715"></a><span>                                        </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679146790"><span class="hs-identifier hs-var">taxaLst</span></a><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.!</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-716"></a><span>                                        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">takeWhile</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">notElem</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot; \t&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679146799"><span class="hs-identifier hs-var">mtx</span></a><span class="hs-special">)</span><span>
</span><a name="line-717"></a><span>                            </span><a href="#local-6989586621679146801"><span class="hs-identifier hs-var">entireDeinterleavedSeqs</span></a><span>
</span><a name="line-718"></a><span>        </span><a name="local-6989586621679146803"><a href="#local-6989586621679146803"><span class="hs-identifier">matchCharsReplaced</span></a></a><span>
</span><a name="line-719"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679146796"><span class="hs-identifier hs-var">matchChar'</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679146791"><span class="hs-identifier hs-var">aligned</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- TODO: Do I need to do this on tokens, continuous and custom alphabets?</span><span>
</span><a name="line-720"></a><span>                </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="File.Format.Nexus.Validate.html#replaceMatches"><span class="hs-identifier hs-var">replaceMatches</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679146796"><span class="hs-identifier hs-var">matchChar'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679146802"><span class="hs-identifier hs-var">firstSeq</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679146801"><span class="hs-identifier hs-var">entireDeinterleavedSeqs</span></a><span>
</span><a name="line-721"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146801"><span class="hs-identifier hs-var">entireDeinterleavedSeqs</span></a><span>
</span><a name="line-722"></a><span>        </span><span class="hs-comment">--vectorized = V.fromList</span><span>
</span><a name="line-723"></a><span>        </span><a name="local-6989586621679146804"><a href="#local-6989586621679146804"><span class="hs-identifier">equatesReplaced</span></a></a><span>
</span><a name="line-724"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679146805"><span class="hs-identifier hs-var">eqStr</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679146794"><span class="hs-identifier hs-var">tkns</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679146807"><span class="hs-identifier hs-var">isCont</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- TODO: Also don't do on custom alphabets?</span><span>
</span><a name="line-725"></a><span>                </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="File.Format.Nexus.Validate.html#replaceEquates"><span class="hs-identifier hs-var">replaceEquates</span></a><span> </span><a href="#local-6989586621679146806"><span class="hs-identifier hs-var">eqMap</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679146803"><span class="hs-identifier hs-var">matchCharsReplaced</span></a><span>
</span><a name="line-726"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146803"><span class="hs-identifier hs-var">matchCharsReplaced</span></a><span>
</span><a name="line-727"></a><span>        </span><a name="local-6989586621679146805"><a href="#local-6989586621679146805"><span class="hs-identifier">eqStr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">either</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="File.Format.Nexus.Validate.html#getEquates"><span class="hs-identifier hs-var">getEquates</span></a><span> </span><a href="#local-6989586621679146789"><span class="hs-identifier hs-var">seqBlock</span></a><span>
</span><a name="line-728"></a><span>        </span><a name="local-6989586621679146806"><a href="#local-6989586621679146806"><span class="hs-identifier">eqMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679146808"><a href="#local-6989586621679146808"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679146808"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">tail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">dropWhile</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-char">'='</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679146808"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679146805"><span class="hs-identifier hs-var">eqStr</span></a><span> </span><span class="hs-comment">-- TODO: force equates string to be properly formatted</span><span>
</span><a name="line-729"></a><span>        </span><a name="local-6989586621679146807"><a href="#local-6989586621679146807"><span class="hs-identifier">isCont</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146795"><span class="hs-identifier hs-var">characterType</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="File.Format.Nexus.Data.html#Continuous"><span class="hs-identifier hs-var">Continuous</span></a><span>
</span><a name="line-730"></a><span>
</span><a name="line-731"></a><span class="hs-comment">-- | deInterleave takes in a Map String String, where the first String is a taxon label, as well as an</span><span>
</span><a name="line-732"></a><span class="hs-comment">-- interleaved seqMatrix in the form [(taxon,sequence)] and returns</span><span>
</span><a name="line-733"></a><span class="hs-comment">-- a seqMatrix of the form Map taxon sequence. The original list of tuples should have duplicate taxon entries</span><span>
</span><a name="line-734"></a><span class="hs-comment">-- (because of the seqMatrix being interleaved), and the seqs should be concatted---in order---in the</span><span>
</span><a name="line-735"></a><span class="hs-comment">-- returned map.</span><span>
</span><a name="line-736"></a><span class="hs-comment">-- The first 'Map' parameter is used for when there are no label present</span><span>
</span><a name="line-737"></a><span class="hs-comment">-- Note that this fn is O(n) where n is the total length of the sequence, and not O(n^2), as originally feared.</span><span>
</span><a name="line-738"></a><span class="hs-comment">-- A (partial?) test exists in the test suite.</span><span>
</span><a name="line-739"></a><span class="hs-identifier">deInterleave</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">M</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Map</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">M</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Map</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-740"></a><a name="deInterleave"><a href="File.Format.Nexus.Validate.html#deInterleave"><span class="hs-identifier">deInterleave</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679146809"><a href="#local-6989586621679146809"><span class="hs-identifier">seqName</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679146810"><a href="#local-6989586621679146810"><span class="hs-identifier">phyloSeq</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679146811"><a href="#local-6989586621679146811"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">insertWith</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;&gt;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679146809"><span class="hs-identifier hs-var">seqName</span></a><span> </span><a href="#local-6989586621679146810"><span class="hs-identifier hs-var">phyloSeq</span></a><span> </span><a href="#local-6989586621679146811"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">)</span><span>
</span><a name="line-741"></a><span>
</span><a name="line-742"></a><span class="hs-comment">-- | getTaxonAndSeqFromMatrixRow takes a String of format &quot;xxx[space or tab]yyy&quot;</span><span>
</span><a name="line-743"></a><span class="hs-comment">-- and returns a tuple of form (&quot;xxx&quot;,&quot;yyy&quot;)</span><span>
</span><a name="line-744"></a><span class="hs-comment">-- A test exists in the test suite.</span><span>
</span><a name="line-745"></a><span class="hs-identifier">getTaxonAndSeqFromMatrixRow</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span>
</span><a name="line-746"></a><a name="getTaxonAndSeqFromMatrixRow"><a href="File.Format.Nexus.Validate.html#getTaxonAndSeqFromMatrixRow"><span class="hs-identifier">getTaxonAndSeqFromMatrixRow</span></a></a><span> </span><a name="local-6989586621679146812"><a href="#local-6989586621679146812"><span class="hs-identifier">inStr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679146813"><span class="hs-identifier hs-var">seqName</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679146815"><span class="hs-identifier hs-var">phyloSeq</span></a><span class="hs-special">)</span><span>
</span><a name="line-747"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-748"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679146813"><a href="#local-6989586621679146813"><span class="hs-identifier">seqName</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679146814"><a href="#local-6989586621679146814"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">span</span><span>   </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">notElem</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot; \t&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679146812"><span class="hs-identifier hs-var">inStr</span></a><span>
</span><a name="line-749"></a><span>        </span><a name="local-6989586621679146815"><a href="#local-6989586621679146815"><span class="hs-identifier">phyloSeq</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dropWhile</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot; \t&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679146814"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-750"></a><span>
</span><a name="line-751"></a><span class="hs-comment">-- | getTaxaAndSeqsFromEntireMatrix takes an int, the length of the sequence, and a sequence matrix. It then builds</span><span>
</span><a name="line-752"></a><span class="hs-comment">-- a list of (String, String), where the first in each tuple is a taxon name, and the second is the corresponding sequence.</span><span>
</span><a name="line-753"></a><span class="hs-comment">-- To do this, it needs to count each phylogenetic character, because it doesn't actually know where the sequence</span><span>
</span><a name="line-754"></a><span class="hs-comment">-- ends (as newlines are whitespace, and therefore should be ignored).</span><span>
</span><a name="line-755"></a><span>
</span><a name="line-756"></a><span class="hs-comment">-- first, prime loop with first line</span><span>
</span><a name="line-757"></a><span class="hs-comment">-- acc is [(taxon,seq)]</span><span>
</span><a name="line-758"></a><span class="hs-comment">-- curLen is length seq</span><span>
</span><a name="line-759"></a><span class="hs-comment">-- while there's something left:</span><span>
</span><a name="line-760"></a><span>    </span><span class="hs-comment">-- line = words input</span><span>
</span><a name="line-761"></a><span>    </span><span class="hs-comment">-- if curLen &lt; seqLen:</span><span>
</span><a name="line-762"></a><span>        </span><span class="hs-comment">-- if tkns or cont or custom alphabet:</span><span>
</span><a name="line-763"></a><span>            </span><span class="hs-comment">-- newLine = line</span><span>
</span><a name="line-764"></a><span>        </span><span class="hs-comment">-- else:</span><span>
</span><a name="line-765"></a><span>            </span><span class="hs-comment">-- newLine = concat line</span><span>
</span><a name="line-766"></a><span>        </span><span class="hs-comment">-- prepend newLine to snd $ head accumulator</span><span>
</span><a name="line-767"></a><span>        </span><span class="hs-comment">-- curLen += length newLine</span><span>
</span><a name="line-768"></a><span>    </span><span class="hs-comment">-- else:</span><span>
</span><a name="line-769"></a><span>        </span><span class="hs-comment">-- taxon = head line</span><span>
</span><a name="line-770"></a><span>        </span><span class="hs-comment">-- if tkns or cont or custom alphabet:</span><span>
</span><a name="line-771"></a><span>            </span><span class="hs-comment">-- newLine = tail line</span><span>
</span><a name="line-772"></a><span>        </span><span class="hs-comment">-- else:</span><span>
</span><a name="line-773"></a><span>            </span><span class="hs-comment">-- newLine = concat $ tail line</span><span>
</span><a name="line-774"></a><span>        </span><span class="hs-comment">-- curSeq = newLine</span><span>
</span><a name="line-775"></a><span>        </span><span class="hs-comment">-- add (taxon, curSeq) to list</span><span>
</span><a name="line-776"></a><span>        </span><span class="hs-comment">-- curLen = length newLine</span><span>
</span><a name="line-777"></a><span>        </span><span class="hs-comment">-- curSeq = newLine</span><span>
</span><a name="line-778"></a><span class="hs-identifier">getTaxaAndSeqsFromEntireMatrix</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-779"></a><a name="getTaxaAndSeqsFromEntireMatrix"><a href="File.Format.Nexus.Validate.html#getTaxaAndSeqsFromEntireMatrix"><span class="hs-identifier">getTaxaAndSeqsFromEntireMatrix</span></a></a><span> </span><a name="local-6989586621679146816"><a href="#local-6989586621679146816"><span class="hs-identifier">tokenized</span></a></a><span> </span><a name="local-6989586621679146817"><a href="#local-6989586621679146817"><span class="hs-identifier">seqLen</span></a></a><span> </span><a name="local-6989586621679146818"><a href="#local-6989586621679146818"><span class="hs-identifier">mtx</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-780"></a><span>    </span><a href="File.Format.Nexus.Validate.html#getTaxaAndSeqsFromEntireMatrixHelper"><span class="hs-identifier hs-var">getTaxaAndSeqsFromEntireMatrixHelper</span></a><span> </span><a href="#local-6989586621679146816"><span class="hs-identifier hs-var">tokenized</span></a><span> </span><a href="#local-6989586621679146817"><span class="hs-identifier hs-var">seqLen</span></a><span> </span><a href="#local-6989586621679146820"><span class="hs-identifier hs-var">curLen</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tail</span><span> </span><a href="#local-6989586621679146818"><span class="hs-identifier hs-var">mtx</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679146819"><span class="hs-identifier hs-var">accLst</span></a><span>
</span><a name="line-781"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-782"></a><span>        </span><a name="local-6989586621679146819"><a href="#local-6989586621679146819"><span class="hs-identifier">accLst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679146821"><span class="hs-identifier hs-var">taxon</span></a><span class="hs-special">,</span><a href="#local-6989586621679146822"><span class="hs-identifier hs-var">seq'</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-783"></a><span>        </span><a name="local-6989586621679146820"><a href="#local-6989586621679146820"><span class="hs-identifier">curLen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679146816"><span class="hs-identifier hs-var">tokenized</span></a><span>
</span><a name="line-784"></a><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">tail</span><span> </span><a href="#local-6989586621679146823"><span class="hs-identifier hs-var">line</span></a><span>
</span><a name="line-785"></a><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679146822"><span class="hs-identifier hs-var">seq'</span></a><span> </span><span class="hs-comment">-- this removes extra spaces in non-tokenized lines</span><span>
</span><a name="line-786"></a><span>        </span><a name="local-6989586621679146821"><a href="#local-6989586621679146821"><span class="hs-identifier">taxon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679146823"><span class="hs-identifier hs-var">line</span></a><span>
</span><a name="line-787"></a><span>        </span><a name="local-6989586621679146822"><a href="#local-6989586621679146822"><span class="hs-identifier">seq'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679146816"><span class="hs-identifier hs-var">tokenized</span></a><span>
</span><a name="line-788"></a><span>                 </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">unwords</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">tail</span><span> </span><a href="#local-6989586621679146823"><span class="hs-identifier hs-var">line</span></a><span>
</span><a name="line-789"></a><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">tail</span><span> </span><a href="#local-6989586621679146823"><span class="hs-identifier hs-var">line</span></a><span>
</span><a name="line-790"></a><span>        </span><a name="local-6989586621679146823"><a href="#local-6989586621679146823"><span class="hs-identifier">line</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">words</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679146818"><span class="hs-identifier hs-var">mtx</span></a><span> </span><span class="hs-comment">-- Should already have failed if mtx is empty</span><span>
</span><a name="line-791"></a><span>
</span><a name="line-792"></a><span class="hs-identifier">getTaxaAndSeqsFromEntireMatrixHelper</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-793"></a><a name="getTaxaAndSeqsFromEntireMatrixHelper"><a href="File.Format.Nexus.Validate.html#getTaxaAndSeqsFromEntireMatrixHelper"><span class="hs-identifier">getTaxaAndSeqsFromEntireMatrixHelper</span></a></a><span> </span><a name="local-6989586621679146824"><a href="#local-6989586621679146824"><span class="hs-identifier">tokenized</span></a></a><span> </span><a name="local-6989586621679146825"><a href="#local-6989586621679146825"><span class="hs-identifier">seqLen</span></a></a><span> </span><a name="local-6989586621679146826"><a href="#local-6989586621679146826"><span class="hs-identifier">curLen</span></a></a><span> </span><a name="local-6989586621679146827"><a href="#local-6989586621679146827"><span class="hs-identifier">mtx</span></a></a><span> </span><a name="local-6989586621679146828"><a href="#local-6989586621679146828"><span class="hs-identifier">acc</span></a></a><span>
</span><a name="line-794"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679146827"><span class="hs-identifier hs-var">mtx</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146828"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-795"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679146826"><span class="hs-identifier hs-var">curLen</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679146825"><span class="hs-identifier hs-var">seqLen</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-796"></a><span>        </span><span class="hs-keyword">let</span><span>
</span><a name="line-797"></a><span>            </span><a name="local-6989586621679146829"><a href="#local-6989586621679146829"><span class="hs-identifier">newAcc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146833"><span class="hs-identifier hs-var">newTup</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">tail</span><span> </span><a href="#local-6989586621679146828"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-798"></a><span>            </span><a name="local-6989586621679146830"><a href="#local-6989586621679146830"><span class="hs-identifier">newLen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679146826"><span class="hs-identifier hs-var">curLen</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679146824"><span class="hs-identifier hs-var">tokenized</span></a><span>
</span><a name="line-799"></a><span>                                 </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679146832"><span class="hs-identifier hs-var">line</span></a><span>
</span><a name="line-800"></a><span>                                 </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679146831"><span class="hs-identifier hs-var">seq'</span></a><span> </span><span class="hs-comment">-- this removes extra spaces in non-tokenized lines</span><span>
</span><a name="line-801"></a><span>            </span><a name="local-6989586621679146831"><a href="#local-6989586621679146831"><span class="hs-identifier">seq'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679146824"><span class="hs-identifier hs-var">tokenized</span></a><span>
</span><a name="line-802"></a><span>                     </span><span class="hs-keyword">then</span><span> </span><span class="hs-char">' '</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">unwords</span><span> </span><a href="#local-6989586621679146832"><span class="hs-identifier hs-var">line</span></a><span>
</span><a name="line-803"></a><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621679146832"><span class="hs-identifier hs-var">line</span></a><span>
</span><a name="line-804"></a><span>            </span><a name="local-6989586621679146832"><a href="#local-6989586621679146832"><span class="hs-identifier">line</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">words</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679146827"><span class="hs-identifier hs-var">mtx</span></a><span> </span><span class="hs-comment">-- Safe because of first pattern match.</span><span>
</span><a name="line-805"></a><span>            </span><a name="local-6989586621679146833"><a href="#local-6989586621679146833"><span class="hs-identifier">newTup</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679146828"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679146834"><span class="hs-identifier hs-var">headSeq</span></a><span class="hs-special">)</span><span>
</span><a name="line-806"></a><span>            </span><a name="local-6989586621679146834"><a href="#local-6989586621679146834"><span class="hs-identifier">headSeq</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679146828"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679146831"><span class="hs-identifier hs-var">seq'</span></a><span>
</span><a name="line-807"></a><span>        </span><span class="hs-keyword">in</span><span> </span><a href="File.Format.Nexus.Validate.html#getTaxaAndSeqsFromEntireMatrixHelper"><span class="hs-identifier hs-var">getTaxaAndSeqsFromEntireMatrixHelper</span></a><span> </span><a href="#local-6989586621679146824"><span class="hs-identifier hs-var">tokenized</span></a><span> </span><a href="#local-6989586621679146825"><span class="hs-identifier hs-var">seqLen</span></a><span> </span><a href="#local-6989586621679146830"><span class="hs-identifier hs-var">newLen</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tail</span><span> </span><a href="#local-6989586621679146827"><span class="hs-identifier hs-var">mtx</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679146829"><span class="hs-identifier hs-var">newAcc</span></a><span>
</span><a name="line-808"></a><span>  </span><span class="hs-comment">--  | curLen &gt; seqLen = Left $ &quot;Length of sequence, &quot; &lt;&gt; (show curLen) &lt;&gt; &quot; does not match nchar, &quot; &lt;&gt; (show seqLen) &lt;&gt; &quot;.&quot;</span><span>
</span><a name="line-809"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-810"></a><span>        </span><span class="hs-keyword">let</span><span>
</span><a name="line-811"></a><span>            </span><a name="local-6989586621679146835"><a href="#local-6989586621679146835"><span class="hs-identifier">newTup</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679146837"><span class="hs-identifier hs-var">taxon</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679146838"><span class="hs-identifier hs-var">seq'</span></a><span class="hs-special">)</span><span>
</span><a name="line-812"></a><span>            </span><a name="local-6989586621679146836"><a href="#local-6989586621679146836"><span class="hs-identifier">newLen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679146824"><span class="hs-identifier hs-var">tokenized</span></a><span>
</span><a name="line-813"></a><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">tail</span><span> </span><a href="#local-6989586621679146839"><span class="hs-identifier hs-var">line</span></a><span>
</span><a name="line-814"></a><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679146838"><span class="hs-identifier hs-var">seq'</span></a><span> </span><span class="hs-comment">-- this removes extra spaces in non-tokenized lines</span><span>
</span><a name="line-815"></a><span>            </span><a name="local-6989586621679146837"><a href="#local-6989586621679146837"><span class="hs-identifier">taxon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679146839"><span class="hs-identifier hs-var">line</span></a><span>
</span><a name="line-816"></a><span>            </span><a name="local-6989586621679146838"><a href="#local-6989586621679146838"><span class="hs-identifier">seq'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679146824"><span class="hs-identifier hs-var">tokenized</span></a><span>
</span><a name="line-817"></a><span>                     </span><span class="hs-keyword">then</span><span> </span><span class="hs-char">' '</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">unwords</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tail</span><span> </span><a href="#local-6989586621679146839"><span class="hs-identifier hs-var">line</span></a><span class="hs-special">)</span><span>
</span><a name="line-818"></a><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">tail</span><span> </span><a href="#local-6989586621679146839"><span class="hs-identifier hs-var">line</span></a><span>
</span><a name="line-819"></a><span>            </span><a name="local-6989586621679146839"><a href="#local-6989586621679146839"><span class="hs-identifier">line</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">words</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679146827"><span class="hs-identifier hs-var">mtx</span></a><span> </span><span class="hs-comment">-- Safe because of first pattern match</span><span>
</span><a name="line-820"></a><span>        </span><span class="hs-keyword">in</span><span> </span><a href="File.Format.Nexus.Validate.html#getTaxaAndSeqsFromEntireMatrixHelper"><span class="hs-identifier hs-var">getTaxaAndSeqsFromEntireMatrixHelper</span></a><span> </span><a href="#local-6989586621679146824"><span class="hs-identifier hs-var">tokenized</span></a><span> </span><a href="#local-6989586621679146825"><span class="hs-identifier hs-var">seqLen</span></a><span> </span><a href="#local-6989586621679146836"><span class="hs-identifier hs-var">newLen</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tail</span><span> </span><a href="#local-6989586621679146827"><span class="hs-identifier hs-var">mtx</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679146835"><span class="hs-identifier hs-var">newTup</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679146828"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">)</span><span>
</span><a name="line-821"></a><span>
</span><a name="line-822"></a><span class="hs-comment">-- | replaceEquates takes a Map Char String, and a String. For each Char in the input String</span><span>
</span><a name="line-823"></a><span class="hs-comment">-- it looks up that value in the Map. If the key exists, that position in the String gets replaced by</span><span>
</span><a name="line-824"></a><span class="hs-comment">-- the map value. Otherwise, the original value remains.</span><span>
</span><a name="line-825"></a><span class="hs-comment">-- Abstracted Char to a as an exercise.</span><span>
</span><a name="line-826"></a><span class="hs-identifier">replaceEquates</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679146215"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">M</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-6989586621679146215"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679146215"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679146215"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679146215"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-827"></a><a name="replaceEquates"><a href="File.Format.Nexus.Validate.html#replaceEquates"><span class="hs-identifier">replaceEquates</span></a></a><span> </span><a name="local-6989586621679146840"><a href="#local-6989586621679146840"><span class="hs-identifier">eqMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679146841"><a href="#local-6989586621679146841"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679146842"><a href="#local-6989586621679146842"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">findWithDefault</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679146841"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679146841"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679146840"><span class="hs-identifier hs-var">eqMap</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679146842"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-828"></a><span>
</span><a name="line-829"></a><span class="hs-comment">-- | replaceMatches takes a match character and two Strings,</span><span>
</span><a name="line-830"></a><span class="hs-comment">-- a canonical String and a String that contains the match character.</span><span>
</span><a name="line-831"></a><span class="hs-comment">-- It returns the second string with all match characters replaced by</span><span>
</span><a name="line-832"></a><span class="hs-comment">-- whatever character is in the same position in the canonical string</span><span>
</span><a name="line-833"></a><span class="hs-comment">-- O(n)</span><span>
</span><a name="line-834"></a><span class="hs-comment">-- A test exists in the test suite.</span><span>
</span><a name="line-835"></a><span class="hs-identifier">replaceMatches</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Char</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-836"></a><a name="replaceMatches"><a href="File.Format.Nexus.Validate.html#replaceMatches"><span class="hs-identifier">replaceMatches</span></a></a><span> </span><a name="local-6989586621679146843"><a href="#local-6989586621679146843"><span class="hs-identifier">matchTarget</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">{- trace (canonical ++&quot;\n&quot; ++ toReplace ++ &quot;\n&quot;) $ -}</span><span>
</span><a name="line-837"></a><span>    </span><span class="hs-identifier hs-var">zipWith</span><span> </span><a href="#local-6989586621679146844"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-838"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-839"></a><span>        </span><a name="local-6989586621679146844"><a href="#local-6989586621679146844"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679146845"><a href="#local-6989586621679146845"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679146846"><a href="#local-6989586621679146846"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679146846"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679146843"><span class="hs-identifier hs-var">matchTarget</span></a><span>
</span><a name="line-840"></a><span>                </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679146845"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-841"></a><span>                </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679146846"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-842"></a><span>
</span><a name="line-843"></a><span class="hs-comment">-- | areNewTaxa takes in a PhyloSequence (character, unaligned or data block) and returns</span><span>
</span><a name="line-844"></a><span class="hs-comment">-- True if that PhyloSequence contains new taxa, False otherwise.</span><span>
</span><a name="line-845"></a><span class="hs-comment">-- The criteria for True are: 1) if it is a data block</span><span>
</span><a name="line-846"></a><span class="hs-comment">--                            2) if a taxlabels sub-block is present</span><span>
</span><a name="line-847"></a><span class="hs-comment">--                            3) if newtaxa is specified in the dimensions sub-block</span><span>
</span><a name="line-848"></a><span class="hs-comment">-- By my reading of the Nexus spec, taxlabels only occur if newtaxa has, and if newtaxa is present, then taxlabels must be,</span><span>
</span><a name="line-849"></a><span class="hs-comment">-- but that's not how this fn currently works.</span><span>
</span><a name="line-850"></a><span class="hs-comment">-- In our sample files there were several files that had data blocks with no newtaxa token, no taxa block, and taxon labels only</span><span>
</span><a name="line-851"></a><span class="hs-comment">-- occurring as the first token in each line of the character matrix.</span><span>
</span><a name="line-852"></a><span class="hs-identifier">areNewTaxa</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="File.Format.Nexus.Data.html#PhyloSequence"><span class="hs-identifier hs-type">PhyloSequence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-853"></a><a name="areNewTaxa"><a href="File.Format.Nexus.Validate.html#areNewTaxa"><span class="hs-identifier">areNewTaxa</span></a></a><span> </span><a name="local-6989586621679146847"><a href="#local-6989586621679146847"><span class="hs-identifier">phyloSeq</span></a></a><span>
</span><a name="line-854"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">blockType</span><span> </span><a href="#local-6989586621679146847"><span class="hs-identifier hs-var">phyloSeq</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-string">&quot;data&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-855"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-856"></a><span>          </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">charDims</span><span> </span><a href="#local-6989586621679146847"><span class="hs-identifier hs-var">phyloSeq</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-857"></a><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-858"></a><span>            </span><a name="local-6989586621679146848"><a href="#local-6989586621679146848"><span class="hs-identifier">xs</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">seqTaxaLabels</span><span> </span><a href="#local-6989586621679146847"><span class="hs-identifier hs-var">phyloSeq</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-859"></a><span>                    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-860"></a><span>                    </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">newTaxa</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679146848"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-861"></a><span>
</span><a name="line-862"></a><span class="hs-comment">--checkDims :: Phylosequence -&gt; Maybe String</span><span>
</span><a name="line-863"></a><span class="hs-comment">--checkDims seq = let dim = numchars $ head (charDims seq)</span><span>
</span><a name="line-864"></a><span class="hs-comment">--                in if dim == length</span><span>
</span><a name="line-865"></a><span>
</span><a name="line-866"></a><span class="hs-comment">-- | checkForNewTaxa is frighteningly similar to areNewTaxa, but I couldn't figure out a way around</span><span>
</span><a name="line-867"></a><span class="hs-comment">-- having them both, because of the way that areNewTaxa is used. Unlike areNewTaxa, returns either Nothing or</span><span>
</span><a name="line-868"></a><span class="hs-comment">-- a list of taxon errors. These errors fall under two cases: newtaxa is spec'd, but no new taxa actually appear;</span><span>
</span><a name="line-869"></a><span class="hs-comment">-- there are new taxa, but the number of new taxa doesn't match the the spec'd number.</span><span>
</span><a name="line-870"></a><span class="hs-comment">-- TODO: this isn't right: ntax is the number of taxa in the matrix, not the number of *new* taxa in the matrix.</span><span>
</span><a name="line-871"></a><span class="hs-comment">-- Also, conditions don't seem right: they should match areNewTaxa more closely.</span><span>
</span><a name="line-872"></a><span class="hs-comment">-- See haddock notes for areNewTaxa for conditions.</span><span>
</span><a name="line-873"></a><span class="hs-identifier">checkForNewTaxa</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="File.Format.Nexus.Data.html#PhyloSequence"><span class="hs-identifier hs-type">PhyloSequence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-874"></a><a name="checkForNewTaxa"><a href="File.Format.Nexus.Validate.html#checkForNewTaxa"><span class="hs-identifier">checkForNewTaxa</span></a></a><span> </span><a name="local-6989586621679146849"><a href="#local-6989586621679146849"><span class="hs-identifier">phyloSeq</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">charDims</span><span> </span><a href="#local-6989586621679146849"><span class="hs-identifier hs-var">phyloSeq</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-875"></a><span>                         </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-876"></a><span>                         </span><a name="local-6989586621679146851"><a href="#local-6989586621679146851"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">newTaxa</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679146851"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-877"></a><span>                               </span><span class="hs-keyword">then</span><span>
</span><a name="line-878"></a><span>                                 </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">seqTaxaLabels</span><span> </span><a href="#local-6989586621679146849"><span class="hs-identifier hs-var">phyloSeq</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-879"></a><span>                                  </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;In the &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679146850"><span class="hs-identifier hs-var">which</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; block the newtaxa keyword is specified, but no new taxa are given.&quot;</span><span>
</span><a name="line-880"></a><span>                                  </span><a name="local-6989586621679146852"><a href="#local-6989586621679146852"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679146852"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">numTaxa</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679146851"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-881"></a><span>                                        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;In the &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679146850"><span class="hs-identifier hs-var">which</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; block the number of new taxa does not match the number of taxa specified.&quot;</span><span>
</span><a name="line-882"></a><span>                                        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-883"></a><span>                               </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-884"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-885"></a><span>    </span><a name="local-6989586621679146850"><a href="#local-6989586621679146850"><span class="hs-identifier">which</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">blockType</span><span> </span><a href="#local-6989586621679146849"><span class="hs-identifier hs-var">phyloSeq</span></a><span>
</span><a name="line-886"></a><span>
</span><a name="line-887"></a><span class="hs-comment">-- | createElimTups takes the output of sortElimsStr (so a list of strings) and returns a list of tuples of form (Bool, Int)</span><span>
</span><a name="line-888"></a><span class="hs-comment">-- This will be used to determine whether a given character in an aligned sequence is to be ignored. However, because</span><span>
</span><a name="line-889"></a><span class="hs-comment">-- the elim clause in a Nexus file is of the form x,y-z,a,... it's possible to be within a range. So if a single number is given</span><span>
</span><a name="line-890"></a><span class="hs-comment">-- The tuple will be (True,that number :: Int), otherwise, it will be (False, ending number of range :: Int)</span><span>
</span><a name="line-891"></a><span class="hs-identifier">createElimTups</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-892"></a><a name="createElimTups"><a href="File.Format.Nexus.Validate.html#createElimTups"><span class="hs-identifier">createElimTups</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679146889"><a href="#local-6989586621679146889"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679146890"><a href="#local-6989586621679146890"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679146853"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679146889"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679146890"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-893"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-894"></a><span>        </span><a name="local-6989586621679146853"><a href="#local-6989586621679146853"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679146854"><a href="#local-6989586621679146854"><span class="hs-identifier">inStr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679146856"><span class="hs-identifier hs-var">secondNumStr</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-895"></a><span>                      </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><a href="#local-6989586621679146857"><span class="hs-identifier hs-var">firstNum</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><a href="#local-6989586621679146858"><span class="hs-identifier hs-var">secondNum</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-896"></a><span>                      </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><a href="#local-6989586621679146857"><span class="hs-identifier hs-var">firstNum</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-897"></a><span>            </span><span class="hs-keyword">where</span><span>
</span><a name="line-898"></a><span>                </span><span class="hs-special">(</span><a name="local-6989586621679146855"><a href="#local-6989586621679146855"><span class="hs-identifier">firstNumStr</span></a></a><span class="hs-special">,</span><a name="local-6989586621679146856"><a href="#local-6989586621679146856"><span class="hs-identifier">secondNumStr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">break</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-char">'-'</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679146854"><span class="hs-identifier hs-var">inStr</span></a><span>
</span><a name="line-899"></a><span>                </span><a name="local-6989586621679146857"><a href="#local-6989586621679146857"><span class="hs-identifier">firstNum</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">{- trace (&quot;first: &quot; ++ firstNumStr) $ -}</span><span class="hs-identifier hs-var">read</span><span> </span><a href="#local-6989586621679146855"><span class="hs-identifier hs-var">firstNumStr</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-900"></a><span>                </span><a name="local-6989586621679146858"><a href="#local-6989586621679146858"><span class="hs-identifier">secondNum</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">{- trace (&quot;second: &quot; ++ secondNumStr) $ -}</span><span class="hs-identifier hs-var">read</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tail</span><span> </span><a href="#local-6989586621679146856"><span class="hs-identifier hs-var">secondNumStr</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-901"></a><span>
</span><a name="line-902"></a><span class="hs-comment">-- | getNext takes as input an index of a character in an aligned sequence, as well as the current index in a list of tuples</span><span>
</span><a name="line-903"></a><span class="hs-comment">-- as described in the output of createElimTups. It then determines whether the input character index should be ignored or not</span><span>
</span><a name="line-904"></a><span class="hs-comment">-- and returns that determination as a Bool (ignored---or eliminated, in Nexus terminology---is True),</span><span>
</span><a name="line-905"></a><span class="hs-comment">-- along with an Int giving the updated index to check at when getNext is next run.</span><span>
</span><a name="line-906"></a><span class="hs-comment">-- This could probably be done more nicely with a state monad, but I don't know, yet, how to use those.</span><span>
</span><a name="line-907"></a><span class="hs-comment">-- Note that sequences are indexed starting at 1, but Haskell Vectors are indexed starting at 0.</span><span>
</span><a name="line-908"></a><span class="hs-identifier">getNext</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-909"></a><a name="getNext"><a href="File.Format.Nexus.Validate.html#getNext"><span class="hs-identifier">getNext</span></a></a><span> </span><a name="local-6989586621679146891"><a href="#local-6989586621679146891"><span class="hs-identifier">seqIdx</span></a></a><span> </span><a name="local-6989586621679146892"><a href="#local-6989586621679146892"><span class="hs-identifier">elimsIdx</span></a></a><span> </span><a name="local-6989586621679146893"><a href="#local-6989586621679146893"><span class="hs-identifier">toElim</span></a></a><span>
</span><a name="line-910"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679146892"><span class="hs-identifier hs-var">elimsIdx</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679146893"><span class="hs-identifier hs-var">toElim</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679146892"><span class="hs-identifier hs-var">elimsIdx</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- there are no more things to eliminate</span><span>
</span><a name="line-911"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679146891"><span class="hs-identifier hs-var">seqIdx</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679146893"><span class="hs-identifier hs-var">toElim</span></a><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.!</span><span> </span><a href="#local-6989586621679146892"><span class="hs-identifier hs-var">elimsIdx</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">succ</span><span> </span><a href="#local-6989586621679146892"><span class="hs-identifier hs-var">elimsIdx</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- The given input is specifically listed, and should be eliminated</span><span>
</span><a name="line-912"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679146891"><span class="hs-identifier hs-var">seqIdx</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span>  </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679146893"><span class="hs-identifier hs-var">toElim</span></a><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.!</span><span> </span><a href="#local-6989586621679146892"><span class="hs-identifier hs-var">elimsIdx</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">succ</span><span> </span><a href="#local-6989586621679146892"><span class="hs-identifier hs-var">elimsIdx</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- The sequence index is &gt; the current index, so we need to move forward in toElim</span><span>
</span><a name="line-913"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                           </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679146893"><span class="hs-identifier hs-var">toElim</span></a><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.!</span><span> </span><a href="#local-6989586621679146892"><span class="hs-identifier hs-var">elimsIdx</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679146892"><span class="hs-identifier hs-var">elimsIdx</span></a><span class="hs-special">)</span><span>
</span><a name="line-914"></a><span>                                            </span><span class="hs-comment">-- The given input is not specifically listed,</span><span>
</span><a name="line-915"></a><span>                                            </span><span class="hs-comment">-- so check to see if we're in a range (fst tup == False)</span><span>
</span><a name="line-916"></a><span>                                            </span><span class="hs-comment">-- Also, the seqIdx must be lower than the elimsIdx</span><span>
</span><a name="line-917"></a><span>                                            </span><span class="hs-comment">-- we're not in a range, and the seq idx is not spec'ed</span><span>
</span><a name="line-918"></a><span>                                            </span><span class="hs-comment">-- we are in a range, so seqIdx should be eliminated, but we don't want to move to the next elim</span><span>
</span><a name="line-919"></a><span>
</span><a name="line-920"></a><span class="hs-comment">-- | sortElimsStr takes a String of digits, commas and hyphens and returns a list of strings, broken on the commas</span><span>
</span><a name="line-921"></a><span class="hs-comment">-- and sorted by the value of the Int representation of any numbers before a hyphen. The input and output of this fn are</span><span>
</span><a name="line-922"></a><span class="hs-comment">-- described in the Haddock comments for createElimTups</span><span>
</span><a name="line-923"></a><span class="hs-identifier">sortElimsStr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-924"></a><a name="sortElimsStr"><a href="File.Format.Nexus.Validate.html#sortElimsStr"><span class="hs-identifier">sortElimsStr</span></a></a><span> </span><a name="local-6989586621679146894"><a href="#local-6989586621679146894"><span class="hs-identifier">start</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-925"></a><span>    </span><a href="#local-6989586621679146896"><span class="hs-identifier hs-var">result</span></a><span>
</span><a name="line-926"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-927"></a><span>            </span><a name="local-6989586621679146895"><a href="#local-6989586621679146895"><span class="hs-identifier">unsortedList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">splitOn</span><span> </span><span class="hs-string">&quot;,&quot;</span><span> </span><a href="#local-6989586621679146894"><span class="hs-identifier hs-var">start</span></a><span>
</span><a name="line-928"></a><span>            </span><a name="local-6989586621679146896"><a href="#local-6989586621679146896"><span class="hs-identifier">result</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sortBy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">comparing</span><span> </span><a href="#local-6989586621679146897"><span class="hs-identifier hs-var">pert</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679146895"><span class="hs-identifier hs-var">unsortedList</span></a><span>
</span><a name="line-929"></a><span>            </span><a name="local-6989586621679146897"><a href="#local-6989586621679146897"><span class="hs-identifier">pert</span></a></a><span> </span><a name="local-6989586621679147247"><a href="#local-6989586621679147247"><span class="hs-identifier">x</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">read</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dropWhile</span><span> </span><span class="hs-identifier hs-var">isSpace</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">takeWhile</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-char">'-'</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679147247"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-930"></a><span>
</span><a name="line-931"></a><span class="hs-comment">-- | setIgnores iterates from x to y (ints), determining at each index whether that index should be &quot;ignored&quot;. If so, it</span><span>
</span><a name="line-932"></a><span class="hs-comment">-- flags True, otherwise it flags False. It accumulates all of these Booleans into a list</span><span>
</span><a name="line-933"></a><span class="hs-identifier">setIgnores</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">V</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">]</span><span>
</span><a name="line-934"></a><a name="setIgnores"><a href="File.Format.Nexus.Validate.html#setIgnores"><span class="hs-identifier">setIgnores</span></a></a><span> </span><a name="local-6989586621679147248"><a href="#local-6989586621679147248"><span class="hs-identifier">seqIdx</span></a></a><span> </span><a name="local-6989586621679147249"><a href="#local-6989586621679147249"><span class="hs-identifier">curElimIdx</span></a></a><span> </span><a name="local-6989586621679147250"><a href="#local-6989586621679147250"><span class="hs-identifier">toElim</span></a></a><span> </span><a name="local-6989586621679147251"><a href="#local-6989586621679147251"><span class="hs-identifier">seqLength</span></a></a><span> </span><a name="local-6989586621679147252"><a href="#local-6989586621679147252"><span class="hs-identifier">acc</span></a></a><span>
</span><a name="line-935"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679147248"><span class="hs-identifier hs-var">seqIdx</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621679147251"><span class="hs-identifier hs-var">seqLength</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621679147252"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-936"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#setIgnores"><span class="hs-identifier hs-var">setIgnores</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">succ</span><span> </span><a href="#local-6989586621679147248"><span class="hs-identifier hs-var">seqIdx</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679147254"><span class="hs-identifier hs-var">next</span></a><span> </span><a href="#local-6989586621679147250"><span class="hs-identifier hs-var">toElim</span></a><span> </span><a href="#local-6989586621679147251"><span class="hs-identifier hs-var">seqLength</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679147253"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679147252"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">)</span><span>
</span><a name="line-937"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-938"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679147253"><a href="#local-6989586621679147253"><span class="hs-identifier">val</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679147254"><a href="#local-6989586621679147254"><span class="hs-identifier">next</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#getNext"><span class="hs-identifier hs-var">getNext</span></a><span> </span><a href="#local-6989586621679147248"><span class="hs-identifier hs-var">seqIdx</span></a><span> </span><a href="#local-6989586621679147249"><span class="hs-identifier hs-var">curElimIdx</span></a><span> </span><a href="#local-6989586621679147250"><span class="hs-identifier hs-var">toElim</span></a><span>
</span><a name="line-939"></a><span>
</span><a name="line-940"></a><span>
</span><a name="line-941"></a><span class="hs-comment">----------------------------------------------</span><span>
</span><a name="line-942"></a><span class="hs-comment">-- Helper fns</span><span>
</span><a name="line-943"></a><span class="hs-comment">----------------------------------------------</span><span>
</span><a name="line-944"></a><span>
</span><a name="line-945"></a><span class="hs-comment">-- It's super inefficient!!!</span><span>
</span><a name="line-946"></a><span class="hs-comment">-- Maybe use `Text`?</span><span>
</span><a name="line-947"></a><span>
</span><a name="line-948"></a><span class="hs-identifier">lstrip</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-949"></a><a name="lstrip"><a href="File.Format.Nexus.Validate.html#lstrip"><span class="hs-identifier">lstrip</span></a></a><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-950"></a><span class="hs-identifier">lstrip</span><span> </span><a name="local-6989586621679147255"><a href="#local-6989586621679147255"><span class="hs-identifier">input</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dropWhile</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot; \t\n\r&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679147255"><span class="hs-identifier hs-var">input</span></a><span>
</span><a name="line-951"></a><span>
</span><a name="line-952"></a><span class="hs-identifier">rstrip</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-953"></a><a name="rstrip"><a href="File.Format.Nexus.Validate.html#rstrip"><span class="hs-identifier">rstrip</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="File.Format.Nexus.Validate.html#lstrip"><span class="hs-identifier hs-var">lstrip</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">reverse</span><span>
</span><a name="line-954"></a><span>
</span><a name="line-955"></a><span class="hs-identifier">strip</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-956"></a><a name="strip"><a href="File.Format.Nexus.Validate.html#strip"><span class="hs-identifier">strip</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="File.Format.Nexus.Validate.html#lstrip"><span class="hs-identifier hs-var">lstrip</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="File.Format.Nexus.Validate.html#rstrip"><span class="hs-identifier hs-var">rstrip</span></a><span>
</span><a name="line-957"></a></pre></body></html>