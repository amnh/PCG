<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Analysis.Parsimony.Sankoff.Internal</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Analysis.Parsimony.Sankoff.Internal.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">phylocomgraph-0.0.1.0</p></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>(c) 2015-2015 Ward Wheeler</td></tr><tr><th>License</th><td>BSD-style</td></tr><tr><th>Maintainer</th><td>wheeler@amnh.org</td></tr><tr><th>Stability</th><td>provisional</td></tr><tr><th>Portability</th><td>portable</td></tr><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Analysis.Parsimony.Sankoff.Internal</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Sankoff character analysis (cost and median)</p><p>This only works on static characters, and due to the traversal only one
 character will be received at a time.</p><p>Goloboff's algorithm relies on computing the &quot;extra cost&quot; for each non-
 optimal state assignment for each node. There's a preliminary extra
 cost, which is the difference between the assignment cost for this state
 on this node, and a final extra cost, which is the total extra cost
 when recursing over the whole tree that this state assignment implies.
 This involves, then, computing extra costs even for states that are non-
 optimal</p><p>Assumes binary trees.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:sankoffPostOrder">sankoffPostOrder</a> :: <a href="Bio-Character-Decoration-Discrete.html#t:DiscreteCharacterDecoration">DiscreteCharacterDecoration</a> d c =&gt; d -&gt; [<a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c] -&gt; <a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c</li><li class="src short"><a href="#v:sankoffPreOrder">sankoffPreOrder</a> :: <a href="Bio-Character-Encodable.html#t:EncodableStaticCharacter">EncodableStaticCharacter</a> c =&gt; <a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c -&gt; [(<a href="../base-4.10.1.0/Data-Word.html#t:Word">Word</a>, <a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c)] -&gt; <a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c</li><li class="src short"><a href="#v:initializeCostVector">initializeCostVector</a> :: <a href="Bio-Character-Decoration-Discrete.html#t:DiscreteCharacterDecoration">DiscreteCharacterDecoration</a> d c =&gt; d -&gt; <a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c</li><li class="src short"><a href="#v:updateCostVector">updateCostVector</a> :: <a href="Bio-Character-Decoration-Discrete.html#t:DiscreteCharacterDecoration">DiscreteCharacterDecoration</a> d c =&gt; d -&gt; <a href="../base-4.10.1.0/Data-List-NonEmpty.html#t:NonEmpty">NonEmpty</a> (<a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c) -&gt; <a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c</li><li class="src short"><a href="#v:updateDirectionalMins">updateDirectionalMins</a> :: <a href="Bio-Character-Encodable.html#t:EncodableStaticCharacter">EncodableStaticCharacter</a> c =&gt; <a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c -&gt; <a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c -&gt; [<a href="Bio-Character-Decoration-Metric.html#t:StateContributionList">StateContributionList</a>] -&gt; <a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c</li><li class="src short"><a href="#v:calcCostPerState">calcCostPerState</a> :: <a href="../base-4.10.1.0/Data-Word.html#t:Word">Word</a> -&gt; <a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c -&gt; <a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c -&gt; ((<a href="../pcg-utility-0.0.1.0/Numeric-Extended-Natural.html#t:ExtendedNatural">ExtendedNatural</a>, <a href="Bio-Character-Decoration-Metric.html#t:StateContributionList">StateContributionList</a>), (<a href="../pcg-utility-0.0.1.0/Numeric-Extended-Natural.html#t:ExtendedNatural">ExtendedNatural</a>, <a href="Bio-Character-Decoration-Metric.html#t:StateContributionList">StateContributionList</a>))</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:sankoffPostOrder" class="def">sankoffPostOrder</a> :: <a href="Bio-Character-Decoration-Discrete.html#t:DiscreteCharacterDecoration">DiscreteCharacterDecoration</a> d c =&gt; d -&gt; [<a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c] -&gt; <a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c <a href="src/Analysis.Parsimony.Sankoff.Internal.html#sankoffPostOrder" class="link">Source</a> <a href="#v:sankoffPostOrder" class="selflink">#</a></p><div class="doc"><p>Used on the post-order (i.e. first) traversal.</p></div></div><div class="top"><p class="src"><a id="v:sankoffPreOrder" class="def">sankoffPreOrder</a> :: <a href="Bio-Character-Encodable.html#t:EncodableStaticCharacter">EncodableStaticCharacter</a> c =&gt; <a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c -&gt; [(<a href="../base-4.10.1.0/Data-Word.html#t:Word">Word</a>, <a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c)] -&gt; <a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c <a href="src/Analysis.Parsimony.Sankoff.Internal.html#sankoffPreOrder" class="link">Source</a> <a href="#v:sankoffPreOrder" class="selflink">#</a></p><div class="doc"><p>Used on the pre-order (i.e. second) traversal.</p><p>Either calls <code>initializeDirVector</code> on root or <code><a href="Analysis-Parsimony-Sankoff-Internal.html#v:updateDirectionalMins">updateDirectionalMins</a></code>.
 Needs to determine which child it's updating, then sends the appropriate
 minlist to <code><a href="Analysis-Parsimony-Sankoff-Internal.html#v:updateDirectionalMins">updateDirectionalMins</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:initializeCostVector" class="def">initializeCostVector</a> :: <a href="Bio-Character-Decoration-Discrete.html#t:DiscreteCharacterDecoration">DiscreteCharacterDecoration</a> d c =&gt; d -&gt; <a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c <a href="src/Analysis.Parsimony.Sankoff.Internal.html#initializeCostVector" class="link">Source</a> <a href="#v:initializeCostVector" class="selflink">#</a></p><div class="doc"><p>Before post-order can actually occur, must initialize leaf vectors with values
 as such:</p><p>Given \(n\) character states, for a given character \(i_c\) on leaf \(i\),
 there are \(2^n - 1\) possible characters, including ambiguous characters. For
 extant character states \(i_{c_x}\) on the leaf, and for each possible character
 state, if that character state is extant on the leaf, give it an initial cost
 of 0, otherwise, &#8734;.</p></div></div><div class="top"><p class="src"><a id="v:updateCostVector" class="def">updateCostVector</a> :: <a href="Bio-Character-Decoration-Discrete.html#t:DiscreteCharacterDecoration">DiscreteCharacterDecoration</a> d c =&gt; d -&gt; <a href="../base-4.10.1.0/Data-List-NonEmpty.html#t:NonEmpty">NonEmpty</a> (<a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c) -&gt; <a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c <a href="src/Analysis.Parsimony.Sankoff.Internal.html#updateCostVector" class="link">Source</a> <a href="#v:updateCostVector" class="selflink">#</a></p><div class="doc"><p>Used on the post-order (i.e. first) traversal, moving from leaves to root.</p><p>Given current node and its children, does actual calculation of new node values
 for each character state:</p><ul><li>\(\forall a, minCosts_a = \forall b, \(min (transitionCost(a, b) + leftChild_{minCost(b)} + rightChild_{minCost(b)}\).
    (This is a tuple of lists), where</li><li>\(\forall a, minCost(a) = min(minCosts_a)\).</li><li>\(nodeMin = min(minCost)\)</li></ul><p>In order to run Goloboff&#8217;s Sankoff traversal optimizations, computes:</p><ul><li>\(\forall a, preliminaryExtraCost(a) = \(minCost(a) - nodeMin\)</li><li>\(\beta(a, b) = min_{a,b} (transitionCost (a, b) + preliminaryExtraCost(b))\)</li></ul><p>This node is not a leaf node. Assumes binary tree.</p></div></div><div class="top"><p class="src"><a id="v:updateDirectionalMins" class="def">updateDirectionalMins</a> :: <a href="Bio-Character-Encodable.html#t:EncodableStaticCharacter">EncodableStaticCharacter</a> c =&gt; <a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c -&gt; <a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c -&gt; [<a href="Bio-Character-Decoration-Metric.html#t:StateContributionList">StateContributionList</a>] -&gt; <a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c <a href="src/Analysis.Parsimony.Sankoff.Internal.html#updateDirectionalMins" class="link">Source</a> <a href="#v:updateDirectionalMins" class="selflink">#</a></p><div class="doc"><p>Takes two decorations in, a child and a parent, and calculates the median
 character value of the child. For each possible character state this value is
 based on whether that character state in the child is on one of the min-cost
 paths from the root to the leaves. It relies on dynamic programming to do so,
 using the minimum tuple in the parent to determine whether that character
 state can participate in the final median. Without loss of generality, for the left child,
 the character state \(a\) is part of the median if, for some character \(b\) in the child,</p><p>\[cost(a_{parent_{leftChild}}) == cost(b_{child}) + transitionCost(a, b).\]</p><p>Used on second, pre-order, pass.</p></div></div><div class="top"><p class="src"><a id="v:calcCostPerState" class="def">calcCostPerState</a> :: <a href="../base-4.10.1.0/Data-Word.html#t:Word">Word</a> -&gt; <a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c -&gt; <a href="Bio-Character-Decoration-Metric.html#t:SankoffOptimizationDecoration">SankoffOptimizationDecoration</a> c -&gt; ((<a href="../pcg-utility-0.0.1.0/Numeric-Extended-Natural.html#t:ExtendedNatural">ExtendedNatural</a>, <a href="Bio-Character-Decoration-Metric.html#t:StateContributionList">StateContributionList</a>), (<a href="../pcg-utility-0.0.1.0/Numeric-Extended-Natural.html#t:ExtendedNatural">ExtendedNatural</a>, <a href="Bio-Character-Decoration-Metric.html#t:StateContributionList">StateContributionList</a>)) <a href="src/Analysis.Parsimony.Sankoff.Internal.html#calcCostPerState" class="link">Source</a> <a href="#v:calcCostPerState" class="selflink">#</a></p><div class="doc"><p>Take in a single character state as a <code><a href="../base-4.10.1.0/Data-Word.html#t:Word">Word</a></code>---which represents an unambiguous character state on the parent---
 and two decorations: the decorations of the two child states.
 Return the minimum costs of transitioning from the input character to each of those two child decorations.
 These mins will be saved for use at the next post-order call, to the current parent node&#8217;s parent.</p><p>Note: We can throw away the medians that come back from the tcm here because we&#8217;re building medians:
 the possible character is looped over all available characters, and there's an outer loop which sends in each possible character.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.18.1</p></div></body></html>