<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-2"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-3"></a><span class="hs-comment">-- Module      :  Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- Copyright   :  (c) 2015-2015 Ward Wheeler</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- License     :  BSD-style</span><span>
</span><a name="line-6"></a><span class="hs-comment">--</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- Maintainer  :  wheeler@amnh.org</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- Stability   :  provisional</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- Portability :  portable</span><span>
</span><a name="line-10"></a><span class="hs-comment">--</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- Standard algorithm for implied alignment</span><span>
</span><a name="line-12"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-13"></a><span>
</span><a name="line-14"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts, TypeFamilies #-}</span><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Analysis</span><span class="hs-operator">.</span><span class="hs-identifier">Parsimony</span><span class="hs-operator">.</span><span class="hs-identifier">Dynamic</span><span class="hs-operator">.</span><span class="hs-identifier">DirectOptimization</span><span class="hs-operator">.</span><span class="hs-identifier">DeletionEvents</span><span>
</span><a name="line-17"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#DeletionEvents"><span class="hs-identifier hs-type">DeletionEvents</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-18"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#fromList"><span class="hs-identifier hs-var">fromList</span></a><span>
</span><a name="line-19"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IntSet</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IntSet</span><span class="hs-special">)</span><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IntSet</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">IS</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span>         </span><span class="hs-special">(</span><span class="hs-identifier hs-var">intercalate</span><span class="hs-special">)</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Monoid</span><span>       </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">MonoTraversable</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Semigroup</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-31"></a><span class="hs-comment">-- A wrapped type to represent deletion events on an edge with a custom 'Monoid'</span><span>
</span><a name="line-32"></a><span class="hs-comment">-- instance.</span><span>
</span><a name="line-33"></a><span class="hs-keyword">newtype</span><span> </span><a name="DeletionEvents"><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#DeletionEvents"><span class="hs-identifier">DeletionEvents</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="DE"><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#DE"><span class="hs-identifier">DE</span></a></a><span> </span><span class="hs-identifier hs-type">IntSet</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#DeletionEvents"><span class="hs-identifier hs-type">DeletionEvents</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span>    </span><a name="local-3458764513820541483"><span class="hs-identifier">mempty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#DE"><span class="hs-identifier hs-var">DE</span></a><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span>    </span><a name="local-3458764513820541484"><span class="hs-identifier">mappend</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;&gt;</span><span class="hs-special">)</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Semigroup</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#DeletionEvents"><span class="hs-identifier hs-type">DeletionEvents</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span>    </span><span class="hs-comment">{- | /O(m)/ where m is sequence length

         When we have two Deletion Event collections and we want to merge them
         into a new, larger deletion event collection, we must take into account
         that one collection is of anscestoral events and the other of descendant
         events. There will likely be a shift in the indices' &quot;frames of reference&quot;
         which will require incrementation of the descendant deletion event
         collection.


         |&gt; CASE 1 (simple)
         -=-=-=-=-=-=-=-=-

         Consider the comparison between the follwoing sequences:

         Anscestor:  GATTACA
         Descendant: GAACA
         Alignment:  GA--ACA
         Deletion Events: [2,3]

         Consider the comparison betwen the folowing sequences:

         Anscestor:  GAACA
         Descendant: GAAC
         Alignment:  GAAC-
         Deletion Events: [4]

         We must consider the total alignment history when merging the two deletion
         event collections so that the deletion events of the child have a reference
         frame to the root sequence

         Alignment History:
           Grandparent:  GATTACA
           Parent:       GA--ACA
           Child:        GA--AC-

         Deletion event collections:
            [2,3] &lt;&gt; [4] = [2,3,6]

         Grandparent:  GATTACA
         Child:        GA--AC-

         Note that the index of 4 on the righthand side is incremented by 2 to 6.
         This is because there are 2 indicies in the ancestor deletion event
         collection that are less than 4.


         |&gt; CASE 2: (complex)
         -=-=-=-=-=-=-=-=-

         Consider the comparison between the follwoing sequences:

         Anscestor:  GATTACATA
         Descendant: GACATA
         Alignment:  GA---CATA
         Deletion Events: [2,3,4]

         Consider the comparison betwen the folowing sequences:

         Anscestor:  GACATA
         Descendant: GAAA
         Alignment:  GA-A-A
         Deletion Events: [2,4]

         When the descendant deletion event collection has a deletion event with
         an index that is a member of the acestor deletion event collection, the
         descendant index must be updated by the number of sequential elements in
         the ancestor deletion collection starting from the matching index.

         Alignment History:
           Grandparent:  GATTACATA
           Parent:       GA--ACATA
           Child:        GA----A-A

         Deletion event collections:
            [2,3,4] &lt;&gt; [2,4] = [2,3,4,5,7]

         Grandparent:  GATTACA
         Child:        GA--A-A

         Note that the index of 2 on the righthand side is incremented by 3 to 5.
         This is because there are 3 *consecutive* indicies in the ancestor
         deletion event collection starting at index 2.

         Note that the index of 4 on the righthand side is incremented by 3 to 7.
         This is because there are 2 indicies in the ancestor deletion event
         collection that are less than 4 *and* there is 1 *consecutive* index in
         the ancestor deletion event collection starting at index 4.

    -}</span><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span>    </span><a name="local-6989586621679057387"><a href="#local-6989586621679057387"><span class="hs-identifier">ancestorSet</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#DE"><span class="hs-identifier hs-var">DE</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><a name="local-3458764513820541482"><span class="hs-operator">&lt;&gt;</span></a><span> </span><a name="local-6989586621679057389"><a href="#local-6989586621679057389"><span class="hs-identifier">descendantSet</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#DE"><span class="hs-identifier hs-var">DE</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">as</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679057387"><span class="hs-identifier hs-var">ancestorSet</span></a><span> </span><span class="hs-special">`</span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#incrementDescendant"><span class="hs-identifier hs-var">incrementDescendant</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679057389"><span class="hs-identifier hs-var">descendantSet</span></a><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span class="hs-identifier">incrementDescendant</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#DeletionEvents"><span class="hs-identifier hs-type">DeletionEvents</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#DeletionEvents"><span class="hs-identifier hs-type">DeletionEvents</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IntSet</span><span>
</span><a name="line-140"></a><a name="incrementDescendant"><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#incrementDescendant"><span class="hs-identifier">incrementDescendant</span></a></a><span> </span><span class="hs-special">(</span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#DE"><span class="hs-identifier hs-var">DE</span></a><span> </span><a name="local-6989586621679057917"><a href="#local-6989586621679057917"><span class="hs-identifier">ancestorSet</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#DE"><span class="hs-identifier hs-var">DE</span></a><span> </span><a name="local-6989586621679057918"><a href="#local-6989586621679057918"><span class="hs-identifier">descendantSet</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679057919"><span class="hs-identifier hs-var">incrementedDescendantSet</span></a><span>
</span><a name="line-141"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-142"></a><span>          </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679057919"><a href="#local-6989586621679057919"><span class="hs-identifier">incrementedDescendantSet</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ofoldl'</span><span> </span><a href="#local-6989586621679057920"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">otoList</span><span> </span><a href="#local-6989586621679057917"><span class="hs-identifier hs-var">ancestorSet</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679057918"><span class="hs-identifier hs-var">descendantSet</span></a><span>
</span><a name="line-143"></a><span>          </span><a name="local-6989586621679057920"><a href="#local-6989586621679057920"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679057921"><a href="#local-6989586621679057921"><span class="hs-identifier">counter</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679057922"><a href="#local-6989586621679057922"><span class="hs-identifier">is</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679057923"><a href="#local-6989586621679057923"><span class="hs-identifier">descendantIndex</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679057921"><span class="hs-identifier hs-var">counter</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679057921"><span class="hs-identifier hs-var">counter</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679057923"><span class="hs-identifier hs-var">descendantIndex</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">IS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">insert</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679057922"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">)</span><span>
</span><a name="line-144"></a><span>          </span><span class="hs-identifier">f</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679058004"><a href="#local-6989586621679058004"><span class="hs-identifier">counter</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-keyword">as</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679058006"><a href="#local-6989586621679058006"><span class="hs-identifier">is</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679058007"><a href="#local-6989586621679058007"><span class="hs-identifier">descendantIndex</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-145"></a><span>            </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679058009"><span class="hs-identifier hs-var">remaining</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-146"></a><span>               </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679058010"><span class="hs-identifier hs-var">counter'</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679058010"><span class="hs-identifier hs-var">counter'</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679058007"><span class="hs-identifier hs-var">descendantIndex</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">IS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">insert</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679058006"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">)</span><span>
</span><a name="line-147"></a><span>               </span><a name="local-6989586621679059130"><a href="#local-6989586621679059130"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679059131"><a href="#local-6989586621679059131"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-148"></a><span>                 </span><span class="hs-keyword">if</span><span>   </span><a href="#local-6989586621679059130"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679058007"><span class="hs-identifier hs-var">descendantIndex</span></a><span>
</span><a name="line-149"></a><span>                 </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679058010"><span class="hs-identifier hs-var">counter'</span></a><span>    </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679059130"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679059131"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span>      </span><a href="#local-6989586621679058010"><span class="hs-identifier hs-var">counter'</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679058007"><span class="hs-identifier hs-var">descendantIndex</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">IS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">insert</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679058006"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">)</span><span>
</span><a name="line-150"></a><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679058010"><span class="hs-identifier hs-var">counter'</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span>   </span><a href="#local-6989586621679059131"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679058011"><span class="hs-identifier hs-var">inc</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679058010"><span class="hs-identifier hs-var">counter'</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679058007"><span class="hs-identifier hs-var">descendantIndex</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">IS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">insert</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679058006"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">)</span><span>
</span><a name="line-151"></a><span>            </span><span class="hs-keyword">where</span><span>
</span><a name="line-152"></a><span>              </span><span class="hs-special">(</span><a name="local-6989586621679058008"><a href="#local-6989586621679058008"><span class="hs-identifier">prev</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679058009"><a href="#local-6989586621679058009"><span class="hs-identifier">remaining</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">span</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679058007"><span class="hs-identifier hs-var">descendantIndex</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-153"></a><span>              </span><a name="local-6989586621679058010"><a href="#local-6989586621679058010"><span class="hs-identifier">counter'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679058008"><span class="hs-identifier hs-var">prev</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679058004"><span class="hs-identifier hs-var">counter</span></a><span>
</span><a name="line-154"></a><span>              </span><a name="local-6989586621679058011"><a href="#local-6989586621679058011"><span class="hs-identifier">inc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679058012"><span class="hs-identifier hs-var">consecutiveLength</span></a><span> </span><a href="#local-6989586621679058009"><span class="hs-identifier hs-var">remaining</span></a><span>
</span><a name="line-155"></a><span>
</span><a name="line-156"></a><span class="hs-comment">--              descendantIndex' = descendantIndex + counter</span><span>
</span><a name="line-157"></a><span class="hs-comment">--              incrementation   = consecutiveLength . drop (descendantIndex' - 1) $ otoList ancestorSet</span><span>
</span><a name="line-158"></a><span>
</span><a name="line-159"></a><span>              </span><span class="hs-identifier">consecutiveLength</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679058013"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679058013"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679058013"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-160"></a><span>              </span><a name="local-6989586621679058012"><a href="#local-6989586621679058012"><span class="hs-identifier">consecutiveLength</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679059123"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-161"></a><span>                </span><span class="hs-keyword">where</span><span>
</span><a name="line-162"></a><span>                  </span><a name="local-6989586621679059123"><a href="#local-6989586621679059123"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-6989586621679059124"><a href="#local-6989586621679059124"><span class="hs-identifier">n</span></a></a><span>       </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679059124"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-163"></a><span>                  </span><span class="hs-identifier">g</span><span> </span><a name="local-6989586621679059125"><a href="#local-6989586621679059125"><span class="hs-identifier">n</span></a></a><span>      </span><span class="hs-special">[</span><span class="hs-identifier">_</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679059125"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-164"></a><span>                  </span><span class="hs-identifier">g</span><span> </span><a name="local-6989586621679059126"><a href="#local-6989586621679059126"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679059127"><a href="#local-6989586621679059127"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679059128"><a href="#local-6989586621679059128"><span class="hs-identifier">y</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679059129"><a href="#local-6989586621679059129"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-165"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679059127"><span class="hs-identifier hs-var">x</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679059128"><span class="hs-identifier hs-var">y</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679059123"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679059126"><span class="hs-identifier hs-var">n</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679059128"><span class="hs-identifier hs-var">y</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679059129"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span>
</span><a name="line-166"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679059126"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span>
</span><a name="line-169"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#DeletionEvents"><span class="hs-identifier hs-type">DeletionEvents</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-170"></a><span>    </span><a name="local-8214565720323786117"><span class="hs-identifier">show</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679057239"><a href="#local-6989586621679057239"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;{&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679057239"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;}&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">intercalate</span><span> </span><span class="hs-string">&quot;,&quot;</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">otoList</span><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-174"></a><span class="hs-comment">-- The element for monomorphic maps &amp; folds.</span><span>
</span><a name="line-175"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Element</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#DeletionEvents"><span class="hs-identifier hs-type">DeletionEvents</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span>
</span><a name="line-178"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-179"></a><span class="hs-comment">-- Performs monomporphic fold over the 'DeletionEvents'.</span><span>
</span><a name="line-180"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">MonoFoldable</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#DeletionEvents"><span class="hs-identifier hs-type">DeletionEvents</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-181"></a><span>
</span><a name="line-182"></a><span>    </span><span class="hs-comment">-- | Map each element of a monomorphic container to a 'Monoid'</span><span>
</span><a name="line-183"></a><span>    </span><span class="hs-comment">-- and combine the results.</span><span>
</span><a name="line-184"></a><span>    </span><span class="hs-pragma">{-# INLINE ofoldMap #-}</span><span>
</span><a name="line-185"></a><span>    </span><a name="local-8214565720323806542"><span class="hs-identifier">ofoldMap</span></a><span> </span><a name="local-6989586621679055399"><a href="#local-6989586621679055399"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#DE"><span class="hs-identifier hs-var">DE</span></a><span> </span><a name="local-6989586621679055400"><a href="#local-6989586621679055400"><span class="hs-identifier">de</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ofoldMap</span><span> </span><a href="#local-6989586621679055399"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679055400"><span class="hs-identifier hs-var">de</span></a><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span>    </span><span class="hs-comment">-- | Right-associative fold of a monomorphic container.</span><span>
</span><a name="line-188"></a><span>    </span><span class="hs-pragma">{-# INLINE ofoldr #-}</span><span>
</span><a name="line-189"></a><span>    </span><a name="local-8214565720323806541"><span class="hs-identifier">ofoldr</span></a><span> </span><a name="local-6989586621679055401"><a href="#local-6989586621679055401"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679055402"><a href="#local-6989586621679055402"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-special">(</span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#DE"><span class="hs-identifier hs-var">DE</span></a><span> </span><a name="local-6989586621679055403"><a href="#local-6989586621679055403"><span class="hs-identifier">de</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ofoldr</span><span> </span><a href="#local-6989586621679055401"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679055402"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621679055403"><span class="hs-identifier hs-var">de</span></a><span>
</span><a name="line-190"></a><span>
</span><a name="line-191"></a><span>    </span><span class="hs-comment">-- | Strict left-associative fold of a monomorphic container.</span><span>
</span><a name="line-192"></a><span>    </span><span class="hs-pragma">{-# INLINE ofoldl' #-}</span><span>
</span><a name="line-193"></a><span>    </span><a name="local-8214565720323806540"><span class="hs-identifier">ofoldl'</span></a><span> </span><a name="local-6989586621679055404"><a href="#local-6989586621679055404"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679055405"><a href="#local-6989586621679055405"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-special">(</span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#DE"><span class="hs-identifier hs-var">DE</span></a><span> </span><a name="local-6989586621679055406"><a href="#local-6989586621679055406"><span class="hs-identifier">de</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ofoldl'</span><span> </span><a href="#local-6989586621679055404"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679055405"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621679055406"><span class="hs-identifier hs-var">de</span></a><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span>    </span><span class="hs-comment">-- | Right-associative fold of a monomorphic container with no base element.</span><span>
</span><a name="line-196"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-197"></a><span>    </span><span class="hs-comment">-- Note: this is a partial function. On an empty 'MonoFoldable', it will</span><span>
</span><a name="line-198"></a><span>    </span><span class="hs-comment">-- throw an exception.</span><span>
</span><a name="line-199"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-200"></a><span>    </span><span class="hs-comment">-- /See 'Data.MinLen.ofoldr1Ex' from &quot;Data.MinLen&quot; for a total version of this function./</span><span>
</span><a name="line-201"></a><span>    </span><span class="hs-pragma">{-# INLINE ofoldr1Ex #-}</span><span>
</span><a name="line-202"></a><span>    </span><a name="local-8214565720323806526"><span class="hs-identifier">ofoldr1Ex</span></a><span> </span><a name="local-6989586621679055407"><a href="#local-6989586621679055407"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#DE"><span class="hs-identifier hs-var">DE</span></a><span> </span><a name="local-6989586621679055408"><a href="#local-6989586621679055408"><span class="hs-identifier">de</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ofoldr1Ex</span><span> </span><a href="#local-6989586621679055407"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679055408"><span class="hs-identifier hs-var">de</span></a><span>
</span><a name="line-203"></a><span>
</span><a name="line-204"></a><span>    </span><span class="hs-comment">-- | Strict left-associative fold of a monomorphic container with no base</span><span>
</span><a name="line-205"></a><span>    </span><span class="hs-comment">-- element.</span><span>
</span><a name="line-206"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-207"></a><span>    </span><span class="hs-comment">-- Note: this is a partial function. On an empty 'MonoFoldable', it will</span><span>
</span><a name="line-208"></a><span>    </span><span class="hs-comment">-- throw an exception.</span><span>
</span><a name="line-209"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-210"></a><span>    </span><span class="hs-comment">-- /See 'Data.MinLen.ofoldl1Ex'' from &quot;Data.MinLen&quot; for a total version of this function./</span><span>
</span><a name="line-211"></a><span>    </span><span class="hs-pragma">{-# INLINE ofoldl1Ex' #-}</span><span>
</span><a name="line-212"></a><span>    </span><a name="local-8214565720323806525"><span class="hs-identifier">ofoldl1Ex'</span></a><span> </span><a name="local-6989586621679055409"><a href="#local-6989586621679055409"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#DE"><span class="hs-identifier hs-var">DE</span></a><span> </span><a name="local-6989586621679055410"><a href="#local-6989586621679055410"><span class="hs-identifier">de</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ofoldl1Ex'</span><span> </span><a href="#local-6989586621679055409"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679055410"><span class="hs-identifier hs-var">de</span></a><span>
</span><a name="line-213"></a><span>
</span><a name="line-214"></a><span>    </span><span class="hs-pragma">{-# INLINE onull #-}</span><span>
</span><a name="line-215"></a><span>    </span><a name="local-8214565720323806536"><span class="hs-identifier">onull</span></a><span> </span><span class="hs-special">(</span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#DE"><span class="hs-identifier hs-var">DE</span></a><span> </span><a name="local-6989586621679055411"><a href="#local-6989586621679055411"><span class="hs-identifier">de</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">onull</span><span> </span><a href="#local-6989586621679055411"><span class="hs-identifier hs-var">de</span></a><span>
</span><a name="line-216"></a><span>
</span><a name="line-217"></a><span>    </span><span class="hs-pragma">{-# INLINE olength #-}</span><span>
</span><a name="line-218"></a><span>    </span><a name="local-8214565720323806535"><span class="hs-identifier">olength</span></a><span> </span><span class="hs-special">(</span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#DE"><span class="hs-identifier hs-var">DE</span></a><span> </span><a name="local-6989586621679055412"><a href="#local-6989586621679055412"><span class="hs-identifier">de</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">olength</span><span> </span><a href="#local-6989586621679055412"><span class="hs-identifier hs-var">de</span></a><span>
</span><a name="line-219"></a><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-222"></a><span class="hs-comment">-- Construct a 'DeletionEvent' from a structure of values coercable to an 'Int'.</span><span>
</span><a name="line-223"></a><span class="hs-identifier">fromList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Enum</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Element</span><span> </span><a href="#local-6989586621679057390"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonoFoldable</span><span> </span><a href="#local-6989586621679057390"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679057390"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#DeletionEvents"><span class="hs-identifier hs-type">DeletionEvents</span></a><span>
</span><a name="line-224"></a><a name="fromList"><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#fromList"><span class="hs-identifier">fromList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.DeletionEvents.html#DE"><span class="hs-identifier hs-var">DE</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">ofoldMap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">singleton</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span class="hs-special">)</span><span>
</span><a name="line-225"></a></pre></body></html>