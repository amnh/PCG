<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-2"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-3"></a><span class="hs-comment">-- Module      :  Bio.Graph.PhylogeneticDAG.Postorder</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- Copyright   :  (c) 2015-2015 Ward Wheeler</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- License     :  BSD-style</span><span>
</span><a name="line-6"></a><span class="hs-comment">--</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- Maintainer  :  wheeler@amnh.org</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- Stability   :  provisional</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- Portability :  portable</span><span>
</span><a name="line-10"></a><span class="hs-comment">--</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- Containing the master command for unifying all input types: tree, metadata, and sequence</span><span>
</span><a name="line-12"></a><span class="hs-comment">--</span><span>
</span><a name="line-13"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts, MonoLocalBinds #-}</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Bio</span><span class="hs-operator">.</span><span class="hs-identifier">Graph</span><span class="hs-operator">.</span><span class="hs-identifier">PhylogeneticDAG</span><span class="hs-operator">.</span><span class="hs-identifier">Postorder</span><span>
</span><a name="line-18"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Bio.Graph.PhylogeneticDAG.Postorder.html#postorderSequence%27"><span class="hs-identifier hs-var">postorderSequence'</span></a><span>
</span><a name="line-19"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span>           </span><a href="Bio.Graph.Node.html"><span class="hs-identifier">Bio</span><span class="hs-operator">.</span><span class="hs-identifier">Graph</span><span class="hs-operator">.</span><span class="hs-identifier">Node</span></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span>           </span><a href="Bio.Graph.PhylogeneticDAG.Internal.html"><span class="hs-identifier">Bio</span><span class="hs-operator">.</span><span class="hs-identifier">Graph</span><span class="hs-operator">.</span><span class="hs-identifier">PhylogeneticDAG</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span>           </span><a href="Bio.Graph.ReferenceDAG.Internal.html"><span class="hs-identifier">Bio</span><span class="hs-operator">.</span><span class="hs-identifier">Graph</span><span class="hs-operator">.</span><span class="hs-identifier">ReferenceDAG</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span>           </span><a href="Bio.Sequence.html"><span class="hs-identifier">Bio</span><span class="hs-operator">.</span><span class="hs-identifier">Sequence</span></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Arrow</span><span>               </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&amp;&amp;&amp;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span><span>         </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftA2</span><span class="hs-special">)</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Bits</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Foldable</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IntMap</span><span>          </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">IM</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Key</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span class="hs-operator">.</span><span class="hs-identifier">NonEmpty</span><span>          </span><span class="hs-special">(</span><span class="hs-identifier hs-type">NonEmpty</span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">:|</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span class="hs-operator">.</span><span class="hs-identifier">NonEmpty</span><span>   </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">NE</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">MonoTraversable</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Vector</span><span>          </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">V</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-38"></a><span class="hs-comment">-- Applies a traversal logic function over a 'ReferenceDAG' in a /pre-order/ manner.</span><span>
</span><a name="line-39"></a><span class="hs-comment">--</span><span>
</span><a name="line-40"></a><span class="hs-comment">-- The logic function takes a current node decoration,</span><span>
</span><a name="line-41"></a><span class="hs-comment">-- a list of parent node decorations with the logic function already applied,</span><span>
</span><a name="line-42"></a><span class="hs-comment">-- and returns the new decoration for the current node.</span><span>
</span><a name="line-43"></a><span class="hs-identifier">postorderSequence'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Bio.Sequence.Block.html#HasBlockCost"><span class="hs-identifier hs-type">HasBlockCost</span></a><span> </span><a href="#local-6989586621679295456"><span class="hs-identifier hs-type">u'</span></a><span> </span><a href="#local-6989586621679295457"><span class="hs-identifier hs-type">v'</span></a><span> </span><a href="#local-6989586621679295458"><span class="hs-identifier hs-type">w'</span></a><span> </span><a href="#local-6989586621679295459"><span class="hs-identifier hs-type">x'</span></a><span> </span><a href="#local-6989586621679295460"><span class="hs-identifier hs-type">y'</span></a><span> </span><a href="#local-6989586621679295461"><span class="hs-identifier hs-type">z'</span></a><span> </span><span class="hs-identifier hs-type">Word</span><span> </span><span class="hs-identifier hs-type">Double</span><span>
</span><a name="line-44"></a><span>                   </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679295462"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295456"><span class="hs-identifier hs-type">u'</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679295456"><span class="hs-identifier hs-type">u'</span></a><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679295463"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295457"><span class="hs-identifier hs-type">v'</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679295457"><span class="hs-identifier hs-type">v'</span></a><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679295464"><span class="hs-identifier hs-type">w</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295458"><span class="hs-identifier hs-type">w'</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679295458"><span class="hs-identifier hs-type">w'</span></a><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679295465"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295459"><span class="hs-identifier hs-type">x'</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679295459"><span class="hs-identifier hs-type">x'</span></a><span class="hs-special">)</span><span>
</span><a name="line-48"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679295466"><span class="hs-identifier hs-type">y</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295460"><span class="hs-identifier hs-type">y'</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679295460"><span class="hs-identifier hs-type">y'</span></a><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679295467"><span class="hs-identifier hs-type">z</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295461"><span class="hs-identifier hs-type">z'</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679295461"><span class="hs-identifier hs-type">z'</span></a><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Bio.Graph.PhylogeneticDAG.Internal.html#PhylogeneticDAG2"><span class="hs-identifier hs-type">PhylogeneticDAG2</span></a><span> </span><a href="#local-6989586621679295468"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679295469"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679295462"><span class="hs-identifier hs-type">u</span></a><span>  </span><a href="#local-6989586621679295463"><span class="hs-identifier hs-type">v</span></a><span>  </span><a href="#local-6989586621679295464"><span class="hs-identifier hs-type">w</span></a><span>  </span><a href="#local-6989586621679295465"><span class="hs-identifier hs-type">x</span></a><span>  </span><a href="#local-6989586621679295466"><span class="hs-identifier hs-type">y</span></a><span>  </span><a href="#local-6989586621679295467"><span class="hs-identifier hs-type">z</span></a><span>
</span><a name="line-51"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Bio.Graph.PhylogeneticDAG.Internal.html#PhylogeneticDAG2"><span class="hs-identifier hs-type">PhylogeneticDAG2</span></a><span> </span><a href="#local-6989586621679295468"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679295469"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679295456"><span class="hs-identifier hs-type">u'</span></a><span> </span><a href="#local-6989586621679295457"><span class="hs-identifier hs-type">v'</span></a><span> </span><a href="#local-6989586621679295458"><span class="hs-identifier hs-type">w'</span></a><span> </span><a href="#local-6989586621679295459"><span class="hs-identifier hs-type">x'</span></a><span> </span><a href="#local-6989586621679295460"><span class="hs-identifier hs-type">y'</span></a><span> </span><a href="#local-6989586621679295461"><span class="hs-identifier hs-type">z'</span></a><span>
</span><a name="line-52"></a><a name="postorderSequence%27"><a href="Bio.Graph.PhylogeneticDAG.Postorder.html#postorderSequence%27"><span class="hs-identifier">postorderSequence'</span></a></a><span> </span><a name="local-6989586621679295470"><a href="#local-6989586621679295470"><span class="hs-identifier">f1</span></a></a><span> </span><a name="local-6989586621679295471"><a href="#local-6989586621679295471"><span class="hs-identifier">f2</span></a></a><span> </span><a name="local-6989586621679295472"><a href="#local-6989586621679295472"><span class="hs-identifier">f3</span></a></a><span> </span><a name="local-6989586621679295473"><a href="#local-6989586621679295473"><span class="hs-identifier">f4</span></a></a><span> </span><a name="local-6989586621679295474"><a href="#local-6989586621679295474"><span class="hs-identifier">f5</span></a></a><span> </span><a name="local-6989586621679295475"><a href="#local-6989586621679295475"><span class="hs-identifier">f6</span></a></a><span> </span><span class="hs-special">(</span><a href="Bio.Graph.PhylogeneticDAG.Internal.html#PDAG2"><span class="hs-identifier hs-var">PDAG2</span></a><span> </span><a name="local-6989586621679295476"><a href="#local-6989586621679295476"><span class="hs-identifier">dag</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bio.Graph.PhylogeneticDAG.Internal.html#PDAG2"><span class="hs-identifier hs-var">PDAG2</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679295478"><span class="hs-identifier hs-var">newDAG</span></a><span> </span><a href="#local-6989586621679295476"><span class="hs-identifier hs-var">dag</span></a><span>
</span><a name="line-53"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-54"></a><span>    </span><a name="local-6989586621679295477"><a href="#local-6989586621679295477"><span class="hs-identifier">completeLeafSetForDAG</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="#local-6989586621679295482"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-identifier hs-var">zeroBits</span><span> </span><a href="#local-6989586621679295476"><span class="hs-identifier hs-var">dag</span></a><span>
</span><a name="line-55"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-56"></a><span>        </span><a name="local-6989586621679295482"><a href="#local-6989586621679295482"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679295483"><a href="#local-6989586621679295483"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679295483"><span class="hs-identifier hs-var">acc</span></a><span> </span><span class="hs-operator hs-var">.|.</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">leafSetRepresentation</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">NE</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">resolutions</span><span>
</span><a name="line-57"></a><span>    </span><span>
</span><a name="line-58"></a><span class="hs-comment">{-    
    newDAG
      :: ReferenceDAG d e x
      -&gt; ReferenceDAG
           d
           e
           (PhylogeneticNode2 (CharacterSequence u' v' w' x' y' z') n)
-}</span><span>
</span><a name="line-66"></a><span>    </span><a name="local-6989586621679295478"><a href="#local-6989586621679295478"><span class="hs-identifier">newDAG</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Bio.Graph.ReferenceDAG.Internal.html#RefDAG"><span class="hs-identifier hs-var">RefDAG</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><a href="#local-6989586621679295480"><span class="hs-identifier hs-var">newReferences</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier">rootRefs</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">graphData</span><span>
</span><a name="line-67"></a><span>    </span><a name="local-6989586621679295479"><a href="#local-6989586621679295479"><span class="hs-identifier">dagSize</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">references</span><span> </span><a href="#local-6989586621679295476"><span class="hs-identifier hs-var">dag</span></a><span>
</span><a name="line-68"></a><span>    </span><a name="local-6989586621679295480"><a href="#local-6989586621679295480"><span class="hs-identifier">newReferences</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">generate</span><span> </span><a href="#local-6989586621679295479"><span class="hs-identifier hs-var">dagSize</span></a><span> </span><a href="#local-6989586621679295484"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-69"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-70"></a><span>        </span><a name="local-6989586621679295484"><a href="#local-6989586621679295484"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679295485"><a href="#local-6989586621679295485"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bio.Graph.ReferenceDAG.Internal.html#IndexData"><span class="hs-identifier hs-var">IndexData</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679295481"><span class="hs-identifier hs-var">memo</span></a><span> </span><span class="hs-glyph">!</span><span> </span><a href="#local-6989586621679295485"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier">parentRefs</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier">childRefs</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">references</span><span> </span><a href="#local-6989586621679295476"><span class="hs-identifier hs-var">dag</span></a><span> </span><span class="hs-glyph">!</span><span> </span><a href="#local-6989586621679295485"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span class="hs-comment">--    memo :: Vector (PhylogeneticNode2 n (CharacterSequence u' v' w' x' y' z'))</span><span>
</span><a name="line-73"></a><span>    </span><a name="local-6989586621679295481"><a href="#local-6989586621679295481"><span class="hs-identifier">memo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">generate</span><span> </span><a href="#local-6989586621679295479"><span class="hs-identifier hs-var">dagSize</span></a><span> </span><a href="#local-6989586621679295486"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-74"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-75"></a><span>        </span><a name="local-6989586621679295486"><a href="#local-6989586621679295486"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679295487"><a href="#local-6989586621679295487"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-76"></a><span>          </span><a href="Bio.Graph.Node.Internal.html#PNode2"><span class="hs-identifier hs-var">PNode2</span></a><span>
</span><a name="line-77"></a><span>              </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">resolutions</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679295488"><span class="hs-identifier hs-var">newResolutions</span></a><span>
</span><a name="line-78"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">nodeDecorationDatum2</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nodeDecorationDatum2</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">nodeDecoration</span><span> </span><a href="#local-6989586621679295491"><span class="hs-identifier hs-var">node</span></a><span>
</span><a name="line-79"></a><span>              </span><span class="hs-special">}</span><span>
</span><a name="line-80"></a><span>          </span><span class="hs-keyword">where</span><span>
</span><a name="line-81"></a><span>            </span><a name="local-6989586621679295488"><a href="#local-6989586621679295488"><span class="hs-identifier">newResolutions</span></a></a><span>
</span><a name="line-82"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679295487"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">notElem</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">rootRefs</span><span> </span><a href="#local-6989586621679295476"><span class="hs-identifier hs-var">dag</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679295490"><span class="hs-identifier hs-var">localResolutions</span></a><span>
</span><a name="line-83"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-84"></a><span>                  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679295490"><span class="hs-identifier hs-var">localResolutions</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-85"></a><span>                    </span><a name="local-6989586621679295497"><a href="#local-6989586621679295497"><span class="hs-identifier">x</span></a></a><span class="hs-operator hs-var">:|</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679295497"><span class="hs-identifier hs-var">x</span></a><span class="hs-operator hs-var">:|</span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-86"></a><span>                    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-87"></a><span>                      </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">NE</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">filter</span><span> </span><a href="#local-6989586621679295489"><span class="hs-identifier hs-var">completeCoverage</span></a><span> </span><a href="#local-6989586621679295490"><span class="hs-identifier hs-var">localResolutions</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-88"></a><span>                        </span><a name="local-6989586621679295498"><a href="#local-6989586621679295498"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679295499"><a href="#local-6989586621679295499"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679295498"><span class="hs-identifier hs-var">x</span></a><span class="hs-operator hs-var">:|</span><a href="#local-6989586621679295499"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-89"></a><span>                        </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Root Node with no complete coverage resolutions!!! This should be logically impossible.&quot;</span><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span>            </span><a name="local-6989586621679295489"><a href="#local-6989586621679295489"><span class="hs-identifier">completeCoverage</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679295477"><span class="hs-identifier hs-var">completeLeafSetForDAG</span></a><span> </span><span class="hs-operator hs-var">==</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679295477"><span class="hs-identifier hs-var">completeLeafSetForDAG</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">leafSetRepresentation</span><span>
</span><a name="line-92"></a><span>            </span><a name="local-6989586621679295490"><a href="#local-6989586621679295490"><span class="hs-identifier">localResolutions</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-special">(</span><a href="Bio.Graph.PhylogeneticDAG.Internal.html#generateLocalResolutions"><span class="hs-identifier hs-var">generateLocalResolutions</span></a><span> </span><a href="#local-6989586621679295470"><span class="hs-identifier hs-var">f1</span></a><span> </span><a href="#local-6989586621679295471"><span class="hs-identifier hs-var">f2</span></a><span> </span><a href="#local-6989586621679295472"><span class="hs-identifier hs-var">f3</span></a><span> </span><a href="#local-6989586621679295473"><span class="hs-identifier hs-var">f4</span></a><span> </span><a href="#local-6989586621679295474"><span class="hs-identifier hs-var">f5</span></a><span> </span><a href="#local-6989586621679295475"><span class="hs-identifier hs-var">f6</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679295493"><span class="hs-identifier hs-var">datumResolutions</span></a><span> </span><a href="#local-6989586621679295494"><span class="hs-identifier hs-var">childResolutions</span></a><span>
</span><a name="line-93"></a><span>                </span><span>
</span><a name="line-94"></a><span>            </span><a name="local-6989586621679295491"><a href="#local-6989586621679295491"><span class="hs-identifier">node</span></a></a><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">references</span><span> </span><a href="#local-6989586621679295476"><span class="hs-identifier hs-var">dag</span></a><span> </span><span class="hs-glyph">!</span><span> </span><a href="#local-6989586621679295487"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-95"></a><span>            </span><a name="local-6989586621679295492"><a href="#local-6989586621679295492"><span class="hs-identifier">childIndices</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">keys</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">childRefs</span><span> </span><a href="#local-6989586621679295491"><span class="hs-identifier hs-var">node</span></a><span>
</span><a name="line-96"></a><span>            </span><a name="local-6989586621679295493"><a href="#local-6989586621679295493"><span class="hs-identifier">datumResolutions</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">resolutions</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">nodeDecoration</span><span> </span><a href="#local-6989586621679295491"><span class="hs-identifier hs-var">node</span></a><span>
</span><a name="line-97"></a><span>            </span><span>
</span><a name="line-98"></a><span class="hs-comment">--            childResolutions :: NonEmpty [a]</span><span>
</span><a name="line-99"></a><span>            </span><a name="local-6989586621679295494"><a href="#local-6989586621679295494"><span class="hs-identifier">childResolutions</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bio.Graph.PhylogeneticDAG.Internal.html#applySoftwireResolutions"><span class="hs-identifier hs-var">applySoftwireResolutions</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679295495"><span class="hs-identifier hs-var">extractResolutionContext</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679295492"><span class="hs-identifier hs-var">childIndices</span></a><span>
</span><a name="line-100"></a><span>            </span><a name="local-6989586621679295495"><a href="#local-6989586621679295495"><span class="hs-identifier">extractResolutionContext</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679295496"><span class="hs-identifier hs-var">getResolutions</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;&amp;</span><span> </span><span class="hs-identifier">parentRefs</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">references</span><span> </span><a href="#local-6989586621679295476"><span class="hs-identifier hs-var">dag</span></a><span> </span><span class="hs-glyph">!</span><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span>            </span><a name="local-6989586621679295496"><a href="#local-6989586621679295496"><span class="hs-identifier">getResolutions</span></a></a><span> </span><a name="local-6989586621679295500"><a href="#local-6989586621679295500"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621679295501"><span class="hs-identifier hs-var">updateFunction</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">resolutions</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679295481"><span class="hs-identifier hs-var">memo</span></a><span> </span><span class="hs-glyph">!</span><span> </span><a href="#local-6989586621679295500"><span class="hs-identifier hs-var">j</span></a><span>
</span><a name="line-102"></a><span>              </span><span class="hs-keyword">where</span><span>
</span><a name="line-103"></a><span>                </span><a name="local-6989586621679295501"><a href="#local-6989586621679295501"><span class="hs-identifier">updateFunction</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-104"></a><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">otoList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">parentRefs</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">references</span><span> </span><a href="#local-6989586621679295476"><span class="hs-identifier hs-var">dag</span></a><span> </span><span class="hs-glyph">!</span><span> </span><a href="#local-6989586621679295500"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-105"></a><span>                      </span><span class="hs-comment">-- In the network edge case, we add also update the topology representation</span><span>
</span><a name="line-106"></a><span>                      </span><a name="local-6989586621679295502"><a href="#local-6989586621679295502"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679295503"><a href="#local-6989586621679295503"><span class="hs-identifier">y</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-107"></a><span>                          </span><span class="hs-keyword">let</span><span>  </span><a name="local-6989586621679295504"><a href="#local-6989586621679295504"><span class="hs-identifier">mutuallyExclusiveIncidentEdge</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679295502"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679295487"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679295503"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><a href="#local-6989586621679295500"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679295502"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679295500"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span>
</span><a name="line-108"></a><span>                          </span><span class="hs-keyword">in</span><span>   </span><a href="Bio.Graph.Node.Internal.html#addEdgeToEdgeSet"><span class="hs-identifier hs-var">addEdgeToEdgeSet</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679295487"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679295500"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Bio.Graph.Node.Internal.html#addNetworkEdgeToTopology"><span class="hs-identifier hs-var">addNetworkEdgeToTopology</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679295487"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679295500"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679295504"><span class="hs-identifier hs-var">mutuallyExclusiveIncidentEdge</span></a><span>
</span><a name="line-109"></a><span>                      </span><span class="hs-identifier">_</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Bio.Graph.Node.Internal.html#addEdgeToEdgeSet"><span class="hs-identifier hs-var">addEdgeToEdgeSet</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679295487"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679295500"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span>
</span><a name="line-110"></a></pre></body></html>