<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-2"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-3"></a><span class="hs-comment">-- Module      :  Bio.Metadata.Parsed</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- Copyright   :  (c) 2015-2015 Ward Wheeler</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- License     :  BSD-style</span><span>
</span><a name="line-6"></a><span class="hs-comment">--</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- Maintainer  :  wheeler@amnh.org</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- Stability   :  provisional</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- Portability :  portable</span><span>
</span><a name="line-10"></a><span class="hs-comment">--</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- Typeclass for metadata extracted from parsed results</span><span>
</span><a name="line-12"></a><span class="hs-comment">--</span><span>
</span><a name="line-13"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances, MultiParamTypeClasses, TypeSynonymInstances #-}</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Bio</span><span class="hs-operator">.</span><span class="hs-identifier">Metadata</span><span class="hs-operator">.</span><span class="hs-identifier">Parsed</span><span>
</span><a name="line-18"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Bio.Metadata.Parsed.html#ParsedCharacterMetadata"><span class="hs-identifier hs-type">ParsedCharacterMetadata</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-19"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Bio.Metadata.Parsed.html#ParsedMetadata"><span class="hs-identifier hs-type">ParsedMetadata</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span>           </span><a href="Bio.Character.Parsed.html"><span class="hs-identifier">Bio</span><span class="hs-operator">.</span><span class="hs-identifier">Character</span><span class="hs-operator">.</span><span class="hs-identifier">Parsed</span></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.Alphabet.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Alphabet</span></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Char</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Foldable</span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Key</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span>                               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">transpose</span><span class="hs-special">)</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span class="hs-operator">.</span><span class="hs-identifier">NonEmpty</span><span>                      </span><span class="hs-special">(</span><span class="hs-identifier hs-type">NonEmpty</span><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Monoid</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.TCM.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">TCM</span></a><span>                                </span><span class="hs-special">(</span><a href="Data.TCM.Internal.html#TCM"><span class="hs-identifier hs-type">TCM</span></a><span class="hs-special">,</span><span> </span><a href="Data.TCM.Internal.html#TCMDiagnosis"><span class="hs-identifier hs-type">TCMDiagnosis</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Data.TCM.Internal.html#TCMStructure"><span class="hs-identifier hs-type">TCMStructure</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Data.TCM.Internal.html#diagnoseTcm"><span class="hs-identifier hs-var">diagnoseTcm</span></a><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Data.TCM.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">TCM</span></a><span>                         </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TCM</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Vector</span><span>                             </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Vector</span><span>                      </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">V</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Vector</span><span class="hs-operator">.</span><span class="hs-identifier">Instances</span><span>                   </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">File</span><span class="hs-operator">.</span><span class="hs-identifier">Format</span><span class="hs-operator">.</span><span class="hs-identifier">Dot</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">File</span><span class="hs-operator">.</span><span class="hs-identifier">Format</span><span class="hs-operator">.</span><span class="hs-identifier">Fasta</span><span>                       </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FastaParseResult</span><span class="hs-special">,</span><span class="hs-identifier hs-type">TaxonSequenceMap</span><span class="hs-special">)</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">File</span><span class="hs-operator">.</span><span class="hs-identifier">Format</span><span class="hs-operator">.</span><span class="hs-identifier">Fastc</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">File</span><span class="hs-operator">.</span><span class="hs-identifier">Format</span><span class="hs-operator">.</span><span class="hs-identifier">Newick</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">File</span><span class="hs-operator">.</span><span class="hs-identifier">Format</span><span class="hs-operator">.</span><span class="hs-identifier">Nexus</span><span>                </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">CharacterMetadata</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">DNA</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">RNA</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Nucleotide</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">TaxonSequenceMap</span><span class="hs-special">)</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">File</span><span class="hs-operator">.</span><span class="hs-identifier">Format</span><span class="hs-operator">.</span><span class="hs-identifier">Nexus</span><span>                </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Nex</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">File</span><span class="hs-operator">.</span><span class="hs-identifier">Format</span><span class="hs-operator">.</span><span class="hs-identifier">TNT</span><span>                  </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TNT</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">File</span><span class="hs-operator">.</span><span class="hs-identifier">Format</span><span class="hs-operator">.</span><span class="hs-identifier">TransitionCostMatrix</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">F</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">File</span><span class="hs-operator">.</span><span class="hs-identifier">Format</span><span class="hs-operator">.</span><span class="hs-identifier">VertexEdgeRoot</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Prelude</span><span>                          </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zip</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-48"></a><span class="hs-comment">-- An intermediate composite type for parse result coercion.</span><span>
</span><a name="line-49"></a><span class="hs-keyword">data</span><span> </span><a name="ParsedCharacterMetadata"><a href="Bio.Metadata.Parsed.html#ParsedCharacterMetadata"><span class="hs-identifier">ParsedCharacterMetadata</span></a></a><span>
</span><a name="line-50"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a name="ParsedCharacterMetadata"><a href="Bio.Metadata.Parsed.html#ParsedCharacterMetadata"><span class="hs-identifier">ParsedCharacterMetadata</span></a></a><span>
</span><a name="line-51"></a><span>   </span><span class="hs-special">{</span><span> </span><a name="alphabet"><a href="Bio.Metadata.Parsed.html#alphabet"><span class="hs-identifier">alphabet</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="Data.Alphabet.Internal.html#Alphabet"><span class="hs-identifier hs-type">Alphabet</span></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-52"></a><span>   </span><span class="hs-special">,</span><span> </span><a name="characterName"><a href="Bio.Metadata.Parsed.html#characterName"><span class="hs-identifier">characterName</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-53"></a><span>   </span><span class="hs-special">,</span><span> </span><a name="weight"><a href="Bio.Metadata.Parsed.html#weight"><span class="hs-identifier">weight</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Double</span><span>
</span><a name="line-54"></a><span>   </span><span class="hs-special">,</span><span> </span><a name="parsedTCM"><a href="Bio.Metadata.Parsed.html#parsedTCM"><span class="hs-identifier">parsedTCM</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Data.TCM.Internal.html#TCM"><span class="hs-identifier hs-type">TCM</span></a><span class="hs-special">,</span><span> </span><a href="Data.TCM.Internal.html#TCMStructure"><span class="hs-identifier hs-type">TCMStructure</span></a><span class="hs-special">)</span><span>
</span><a name="line-55"></a><span>   </span><span class="hs-special">,</span><span> </span><a name="isDynamic"><a href="Bio.Metadata.Parsed.html#isDynamic"><span class="hs-identifier">isDynamic</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-56"></a><span>   </span><span class="hs-special">,</span><span> </span><a name="isIgnored"><a href="Bio.Metadata.Parsed.html#isIgnored"><span class="hs-identifier">isIgnored</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-57"></a><span>   </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-61"></a><span class="hs-comment">-- Represents a parser result type which can have a character metadata</span><span>
</span><a name="line-62"></a><span class="hs-comment">-- structure extracted from it.</span><span>
</span><a name="line-63"></a><span class="hs-keyword">class</span><span> </span><a name="ParsedMetadata"><a href="Bio.Metadata.Parsed.html#ParsedMetadata"><span class="hs-identifier">ParsedMetadata</span></a></a><span> </span><a name="local-6989586621679181064"><a href="#local-6989586621679181064"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span>    </span><span class="hs-identifier">unifyMetadata</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679181064"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="Bio.Metadata.Parsed.html#ParsedCharacterMetadata"><span class="hs-identifier hs-type">ParsedCharacterMetadata</span></a><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-comment">-- | (&#10004;)</span><span>
</span><a name="line-69"></a><span class="hs-keyword">instance</span><span> </span><a href="Bio.Metadata.Parsed.html#ParsedMetadata"><span class="hs-identifier hs-type">ParsedMetadata</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">DotGraph</span><span> </span><a href="#local-6989586621679181107"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-70"></a><span>
</span><a name="line-71"></a><span>    </span><a name="local-8214565720323955957"><a href="Bio.Metadata.Parsed.html#unifyMetadata"><span class="hs-identifier">unifyMetadata</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span class="hs-comment">-- | (&#10004;)</span><span>
</span><a name="line-75"></a><span class="hs-keyword">instance</span><span> </span><a href="Bio.Metadata.Parsed.html#ParsedMetadata"><span class="hs-identifier hs-type">ParsedMetadata</span></a><span> </span><span class="hs-identifier hs-type">FastaParseResult</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span>    </span><a name="local-8214565720323955957"><a href="Bio.Metadata.Parsed.html#unifyMetadata"><span class="hs-identifier">unifyMetadata</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bio.Metadata.Parsed.html#makeEncodeInfo"><span class="hs-identifier hs-var">makeEncodeInfo</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Bio.Character.Parsed.Class.html#unifyCharacters"><span class="hs-identifier hs-var">unifyCharacters</span></a><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span class="hs-comment">-- | (&#10004;)</span><span>
</span><a name="line-81"></a><span class="hs-keyword">instance</span><span> </span><a href="Bio.Metadata.Parsed.html#ParsedMetadata"><span class="hs-identifier hs-type">ParsedMetadata</span></a><span> </span><span class="hs-identifier hs-type">TaxonSequenceMap</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span>    </span><a name="local-8214565720323955957"><a href="Bio.Metadata.Parsed.html#unifyMetadata"><span class="hs-identifier">unifyMetadata</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bio.Metadata.Parsed.html#makeEncodeInfo"><span class="hs-identifier hs-var">makeEncodeInfo</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Bio.Character.Parsed.Class.html#unifyCharacters"><span class="hs-identifier hs-var">unifyCharacters</span></a><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span class="hs-comment">-- | (&#10004;)</span><span>
</span><a name="line-87"></a><span class="hs-keyword">instance</span><span> </span><a href="Bio.Metadata.Parsed.html#ParsedMetadata"><span class="hs-identifier hs-type">ParsedMetadata</span></a><span> </span><span class="hs-identifier hs-type">FastcParseResult</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span>    </span><a name="local-8214565720323955957"><a href="Bio.Metadata.Parsed.html#unifyMetadata"><span class="hs-identifier">unifyMetadata</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bio.Metadata.Parsed.html#makeEncodeInfo"><span class="hs-identifier hs-var">makeEncodeInfo</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Bio.Character.Parsed.Class.html#unifyCharacters"><span class="hs-identifier hs-var">unifyCharacters</span></a><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-comment">-- | (&#10004;)</span><span>
</span><a name="line-93"></a><span class="hs-keyword">instance</span><span> </span><a href="Bio.Metadata.Parsed.html#ParsedMetadata"><span class="hs-identifier hs-type">ParsedMetadata</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">NonEmpty</span><span> </span><span class="hs-identifier hs-type">NewickForest</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span>    </span><a name="local-8214565720323955957"><a href="Bio.Metadata.Parsed.html#unifyMetadata"><span class="hs-identifier">unifyMetadata</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span class="hs-comment">-- | (&#10004;)</span><span>
</span><a name="line-99"></a><span class="hs-keyword">instance</span><span> </span><a href="Bio.Metadata.Parsed.html#ParsedMetadata"><span class="hs-identifier hs-type">ParsedMetadata</span></a><span> </span><span class="hs-identifier hs-type">TNT</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">TntResult</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span>    </span><a name="local-8214565720323955957"><a href="Bio.Metadata.Parsed.html#unifyMetadata"><span class="hs-identifier">unifyMetadata</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span>        </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-102"></a><span>    </span><span class="hs-identifier">unifyMetadata</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679181087"><a href="#local-6989586621679181087"><span class="hs-identifier">withSeq</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span> </span><a href="#local-6989586621679181090"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679181088"><span class="hs-identifier hs-var">parsedMetadatas</span></a><span> </span><a href="#local-6989586621679181089"><span class="hs-identifier hs-var">parsedCharacters</span></a><span>
</span><a name="line-103"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-104"></a><span>        </span><a name="local-6989586621679181088"><a href="#local-6989586621679181088"><span class="hs-identifier">parsedMetadatas</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">TNT</span><span class="hs-operator">.</span><span class="hs-identifier">charMetaData</span><span> </span><a href="#local-6989586621679181087"><span class="hs-identifier hs-var">withSeq</span></a><span>
</span><a name="line-105"></a><span>        </span><a name="local-6989586621679181089"><a href="#local-6989586621679181089"><span class="hs-identifier">parsedCharacters</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">TNT</span><span class="hs-operator">.</span><span class="hs-identifier">sequences</span><span> </span><a href="#local-6989586621679181087"><span class="hs-identifier hs-var">withSeq</span></a><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span>        </span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TNT</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">CharacterMetaData</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TNT</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">TntCharacter</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Bio.Metadata.Parsed.html#ParsedCharacterMetadata"><span class="hs-identifier hs-type">ParsedCharacterMetadata</span></a><span>
</span><a name="line-108"></a><span>        </span><a name="local-6989586621679181090"><a href="#local-6989586621679181090"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679181091"><a href="#local-6989586621679181091"><span class="hs-identifier">inMeta</span></a></a><span> </span><a name="local-6989586621679181092"><a href="#local-6989586621679181092"><span class="hs-identifier">inChar</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-109"></a><span>            </span><a href="Bio.Metadata.Parsed.html#ParsedCharacterMetadata"><span class="hs-identifier hs-var">ParsedCharacterMetadata</span></a><span>
</span><a name="line-110"></a><span>            </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">alphabet</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679181094"><span class="hs-identifier hs-var">characterAlphabet</span></a><span>
</span><a name="line-111"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">characterName</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">TNT</span><span class="hs-operator">.</span><span class="hs-identifier">characterName</span><span>         </span><a href="#local-6989586621679181091"><span class="hs-identifier hs-var">inMeta</span></a><span>
</span><a name="line-112"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">weight</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromRational</span><span> </span><a href="#local-6989586621679181093"><span class="hs-identifier hs-var">rationalWeight</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621679181096"><span class="hs-identifier hs-var">suppliedWeight</span></a><span>
</span><a name="line-113"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">parsedTCM</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679181095"><span class="hs-identifier hs-var">unfactoredTcmMay</span></a><span>
</span><a name="line-114"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isDynamic</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-115"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isIgnored</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">TNT</span><span class="hs-operator">.</span><span class="hs-identifier">active</span><span>          </span><a href="#local-6989586621679181091"><span class="hs-identifier hs-var">inMeta</span></a><span>
</span><a name="line-116"></a><span>            </span><span class="hs-special">}</span><span>
</span><a name="line-117"></a><span>          </span><span class="hs-keyword">where</span><span>
</span><a name="line-118"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679181093"><a href="#local-6989586621679181093"><span class="hs-identifier">rationalWeight</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679181094"><a href="#local-6989586621679181094"><span class="hs-identifier">characterAlphabet</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679181095"><a href="#local-6989586621679181095"><span class="hs-identifier">unfactoredTcmMay</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679181097"><span class="hs-identifier hs-var">chooseAppropriateMatrixAndAlphabet</span></a><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span>            </span><a name="local-6989586621679181096"><a href="#local-6989586621679181096"><span class="hs-identifier">suppliedWeight</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">TNT</span><span class="hs-operator">.</span><span class="hs-identifier">weight</span><span> </span><a href="#local-6989586621679181091"><span class="hs-identifier hs-var">inMeta</span></a><span>
</span><a name="line-121"></a><span>          </span><span>
</span><a name="line-122"></a><span>            </span><a name="local-6989586621679181097"><a href="#local-6989586621679181097"><span class="hs-identifier">chooseAppropriateMatrixAndAlphabet</span></a></a><span>
</span><a name="line-123"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">TNT</span><span class="hs-operator">.</span><span class="hs-identifier">sankoff</span><span>  </span><a href="#local-6989586621679181091"><span class="hs-identifier hs-var">inMeta</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-124"></a><span>                </span><span class="hs-keyword">case</span><span> </span><a href="Data.TCM.Internal.html#fromList"><span class="hs-identifier hs-var">TCM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier">TNT</span><span class="hs-operator">.</span><span class="hs-identifier">costTCM</span><span> </span><a href="#local-6989586621679181091"><span class="hs-identifier hs-var">inMeta</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-125"></a><span>                  </span><span class="hs-identifier hs-var">Nothing</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679181099"><span class="hs-identifier hs-var">fullAlphabet</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-126"></a><span>                  </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679181104"><a href="#local-6989586621679181104"><span class="hs-identifier">v</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679181105"><a href="#local-6989586621679181105"><span class="hs-identifier">tcm</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-127"></a><span>                    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679181106"><a href="#local-6989586621679181106"><span class="hs-identifier">truncatedSymbols</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">take</span><span> </span><span class="hs-special">(</span><a href="Data.TCM.Internal.html#size"><span class="hs-identifier hs-var">TCM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">size</span></a><span> </span><a href="#local-6989586621679181105"><span class="hs-identifier hs-var">tcm</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679181101"><span class="hs-identifier hs-var">initialSymbolSet</span></a><span>
</span><a name="line-128"></a><span>                    </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><a href="#local-6989586621679181104"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679181100"><span class="hs-identifier hs-var">toAlphabet</span></a><span> </span><a href="#local-6989586621679181106"><span class="hs-identifier hs-var">truncatedSymbols</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679181105"><span class="hs-identifier hs-var">tcm</span></a><span class="hs-special">,</span><span> </span><a href="Data.TCM.Internal.html#NonSymmetric"><span class="hs-identifier hs-var">NonSymmetric</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TODO: Maybe we can do the diagnosis here</span><span>
</span><a name="line-129"></a><span>                  </span><span>
</span><a name="line-130"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">TNT</span><span class="hs-operator">.</span><span class="hs-identifier">additive</span><span> </span><a href="#local-6989586621679181091"><span class="hs-identifier hs-var">inMeta</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679181099"><span class="hs-identifier hs-var">fullAlphabet</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Data.TCM.Internal.html#generate"><span class="hs-identifier hs-var">TCM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">generate</span></a><span> </span><a href="#local-6989586621679181098"><span class="hs-identifier hs-var">matrixDimension</span></a><span> </span><a href="Bio.Metadata.Parsed.html#genAdditive"><span class="hs-identifier hs-var">genAdditive</span></a><span class="hs-special">,</span><span>    </span><a href="Data.TCM.Internal.html#Additive"><span class="hs-identifier hs-var">Additive</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-131"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679181099"><span class="hs-identifier hs-var">fullAlphabet</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Data.TCM.Internal.html#generate"><span class="hs-identifier hs-var">TCM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">generate</span></a><span> </span><a href="#local-6989586621679181098"><span class="hs-identifier hs-var">matrixDimension</span></a><span> </span><a href="Bio.Metadata.Parsed.html#genFitch"><span class="hs-identifier hs-var">genFitch</span></a><span>   </span><span class="hs-special">,</span><span> </span><a href="Data.TCM.Internal.html#NonAdditive"><span class="hs-identifier hs-var">NonAdditive</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-132"></a><span>              </span><span class="hs-keyword">where</span><span>
</span><a name="line-133"></a><span>                </span><a name="local-6989586621679181098"><a href="#local-6989586621679181098"><span class="hs-identifier">matrixDimension</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679181101"><span class="hs-identifier hs-var">initialSymbolSet</span></a><span>
</span><a name="line-134"></a><span>                </span><a name="local-6989586621679181099"><a href="#local-6989586621679181099"><span class="hs-identifier">fullAlphabet</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679181100"><span class="hs-identifier hs-var">toAlphabet</span></a><span> </span><a href="#local-6989586621679181101"><span class="hs-identifier hs-var">initialSymbolSet</span></a><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span>                </span><a name="local-6989586621679181100"><a href="#local-6989586621679181100"><span class="hs-identifier">toAlphabet</span></a></a><span> </span><a name="local-6989586621679181102"><a href="#local-6989586621679181102"><span class="hs-identifier">xs</span></a></a><span>
</span><a name="line-137"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679181103"><span class="hs-identifier hs-var">stateNameValues</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Alphabet.Internal.html#fromSymbols"><span class="hs-identifier hs-var">fromSymbols</span></a><span> </span><a href="#local-6989586621679181102"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-138"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Data.Alphabet.Internal.html#fromSymbolsWithStateNames"><span class="hs-identifier hs-var">fromSymbolsWithStateNames</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621679181102"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621679181103"><span class="hs-identifier hs-var">stateNameValues</span></a><span>
</span><a name="line-139"></a><span>                  </span><span class="hs-keyword">where</span><span>
</span><a name="line-140"></a><span>                    </span><a name="local-6989586621679181103"><a href="#local-6989586621679181103"><span class="hs-identifier">stateNameValues</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">TNT</span><span class="hs-operator">.</span><span class="hs-identifier">characterStates</span><span> </span><a href="#local-6989586621679181091"><span class="hs-identifier hs-var">inMeta</span></a><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span>                </span><span class="hs-comment">-- |</span><span>
</span><a name="line-143"></a><span>                </span><span class="hs-comment">-- When constructing the Alphabet for a given character, we need to</span><span>
</span><a name="line-144"></a><span>                </span><span class="hs-comment">-- take into account several things.</span><span>
</span><a name="line-145"></a><span>                </span><span class="hs-comment">--</span><span>
</span><a name="line-146"></a><span>                </span><span class="hs-comment">-- * We must consider the well typed nature of the character. If</span><span>
</span><a name="line-147"></a><span>                </span><span class="hs-comment">--   the character type is Continuous, no alphabet exists. We</span><span>
</span><a name="line-148"></a><span>                </span><span class="hs-comment">--   supply 'undefined' in place of the alphabet as a hack to make</span><span>
</span><a name="line-149"></a><span>                </span><span class="hs-comment">--   later processing easier. This is inherently unsafe, but with</span><span>
</span><a name="line-150"></a><span>                </span><span class="hs-comment">--   proper character type checking later, we will never attempt</span><span>
</span><a name="line-151"></a><span>                </span><span class="hs-comment">--   to reference the undefined value.</span><span>
</span><a name="line-152"></a><span>                </span><span class="hs-comment">--</span><span>
</span><a name="line-153"></a><span>                </span><span class="hs-comment">-- * If the charcter type is Discrete (not DNA or Amino Acid), then</span><span>
</span><a name="line-154"></a><span>                </span><span class="hs-comment">--   we must check for supplied state names</span><span>
</span><a name="line-155"></a><span>                </span><span class="hs-comment">--</span><span>
</span><a name="line-156"></a><span>                </span><span class="hs-comment">-- * If the charcter has a Sankoff TCM defined, we truncate the</span><span>
</span><a name="line-157"></a><span>                </span><span class="hs-comment">-- character alphabet</span><span>
</span><a name="line-158"></a><span>                </span><a name="local-6989586621679181101"><a href="#local-6989586621679181101"><span class="hs-identifier">initialSymbolSet</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-159"></a><span>                    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679181092"><span class="hs-identifier hs-var">inChar</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-160"></a><span>                      </span><span class="hs-identifier hs-var">TNT</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Continuous</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">undefined</span><span> </span><span class="hs-comment">-- I'm sure this will never blow up in our face /s</span><span>
</span><a name="line-161"></a><span>                      </span><span class="hs-identifier hs-var">TNT</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Dna</span><span>        </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Bio.Metadata.Parsed.html#dnaAlph"><span class="hs-identifier hs-var">dnaAlph</span></a><span>
</span><a name="line-162"></a><span>                      </span><span class="hs-identifier hs-var">TNT</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Protein</span><span>    </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Bio.Metadata.Parsed.html#aaAlph"><span class="hs-identifier hs-var">aaAlph</span></a><span>
</span><a name="line-163"></a><span>                      </span><span class="hs-identifier hs-var">TNT</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Discrete</span><span>   </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Bio.Metadata.Parsed.html#disAlph"><span class="hs-identifier hs-var">disAlph</span></a><span>
</span><a name="line-164"></a><span class="hs-comment">{-                        
                          let stateNameValues = TNT.characterStates inMeta
                          in
                              if   null stateNameValues
                              then fromSymbols disAlph
                              else fromSymbolsWithStateNames $ zip (toList disAlph) (toList stateNameValues)
-}</span><span>
</span><a name="line-171"></a><span>                          </span><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-comment">-- | (&#10004;)</span><span>
</span><a name="line-174"></a><span class="hs-keyword">instance</span><span> </span><a href="Bio.Metadata.Parsed.html#ParsedMetadata"><span class="hs-identifier hs-type">ParsedMetadata</span></a><span> </span><span class="hs-identifier hs-type">F</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">TCM</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-175"></a><span>    </span><a name="local-8214565720323955957"><a href="Bio.Metadata.Parsed.html#unifyMetadata"><span class="hs-identifier">unifyMetadata</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">F</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">TCM</span><span> </span><a name="local-6989586621679181080"><a href="#local-6989586621679181080"><span class="hs-identifier">alph</span></a></a><span> </span><a name="local-6989586621679181081"><a href="#local-6989586621679181081"><span class="hs-identifier">mat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-176"></a><span>        </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="Bio.Metadata.Parsed.html#ParsedCharacterMetadata"><span class="hs-identifier hs-var">ParsedCharacterMetadata</span></a><span>
</span><a name="line-177"></a><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">alphabet</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Data.Alphabet.Internal.html#fromSymbols"><span class="hs-identifier hs-var">fromSymbols</span></a><span> </span><a href="#local-6989586621679181080"><span class="hs-identifier hs-var">alph</span></a><span>
</span><a name="line-178"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">characterName</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-179"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">weight</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromRational</span><span> </span><a href="#local-6989586621679181085"><span class="hs-identifier hs-var">rationalWeight</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679181082"><span class="hs-identifier hs-var">coefficient</span></a><span>
</span><a name="line-180"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">parsedTCM</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679181083"><span class="hs-identifier hs-var">resultTCM</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679181084"><span class="hs-identifier hs-var">structure</span></a><span class="hs-special">)</span><span> </span><span>
</span><a name="line-181"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isDynamic</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-182"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isIgnored</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-comment">-- Maybe this should be True?</span><span>
</span><a name="line-183"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-184"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-185"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679181082"><a href="#local-6989586621679181082"><span class="hs-identifier">coefficient</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679181083"><a href="#local-6989586621679181083"><span class="hs-identifier">resultTCM</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679181084"><a href="#local-6989586621679181084"><span class="hs-identifier">structure</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier">factoredWeight</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier">factoredTcm</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier">tcmStructure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.TCM.Internal.html#diagnoseTcm"><span class="hs-identifier hs-var">diagnoseTcm</span></a><span> </span><a href="#local-6989586621679181086"><span class="hs-identifier hs-var">unfactoredTCM</span></a><span>
</span><a name="line-186"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679181085"><a href="#local-6989586621679181085"><span class="hs-identifier">rationalWeight</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679181086"><a href="#local-6989586621679181086"><span class="hs-identifier">unfactoredTCM</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Data.TCM.Internal.html#fromList"><span class="hs-identifier hs-var">TCM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621679181081"><span class="hs-identifier hs-var">mat</span></a><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span>
</span><a name="line-189"></a><span class="hs-comment">-- | (&#10004;)</span><span>
</span><a name="line-190"></a><span class="hs-keyword">instance</span><span> </span><a href="Bio.Metadata.Parsed.html#ParsedMetadata"><span class="hs-identifier hs-type">ParsedMetadata</span></a><span> </span><span class="hs-identifier hs-type">VertexEdgeRoot</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-191"></a><span>    </span><a name="local-8214565720323955957"><a href="Bio.Metadata.Parsed.html#unifyMetadata"><span class="hs-identifier">unifyMetadata</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-192"></a><span>
</span><a name="line-193"></a><span>
</span><a name="line-194"></a><span class="hs-comment">-- | (&#10004;)</span><span>
</span><a name="line-195"></a><span class="hs-keyword">instance</span><span> </span><a href="Bio.Metadata.Parsed.html#ParsedMetadata"><span class="hs-identifier hs-type">ParsedMetadata</span></a><span> </span><span class="hs-identifier hs-type">Nexus</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span>    </span><a name="local-8214565720323955957"><a href="Bio.Metadata.Parsed.html#unifyMetadata"><span class="hs-identifier">unifyMetadata</span></a></a><span> </span><a name="local-6989586621679181065"><a href="#local-6989586621679181065"><span class="hs-identifier">input</span></a></a><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nexus</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679181066"><a href="#local-6989586621679181066"><span class="hs-identifier">metas</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">zipWith</span><span> </span><a href="#local-6989586621679181068"><span class="hs-identifier hs-var">convertNexusMeta</span></a><span> </span><a href="#local-6989586621679181067"><span class="hs-identifier hs-var">alphabetVector</span></a><span> </span><a href="#local-6989586621679181066"><span class="hs-identifier hs-var">metas</span></a><span>
</span><a name="line-198"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-199"></a><span>        </span><a name="local-6989586621679181067"><a href="#local-6989586621679181067"><span class="hs-identifier">alphabetVector</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bio.Metadata.Parsed.html#developAlphabets"><span class="hs-identifier hs-var">developAlphabets</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Bio.Character.Parsed.Class.html#unifyCharacters"><span class="hs-identifier hs-var">unifyCharacters</span></a><span> </span><a href="#local-6989586621679181065"><span class="hs-identifier hs-var">input</span></a><span>
</span><a name="line-200"></a><span>        </span><a name="local-6989586621679181068"><a href="#local-6989586621679181068"><span class="hs-identifier">convertNexusMeta</span></a></a><span> </span><a name="local-6989586621679181069"><a href="#local-6989586621679181069"><span class="hs-identifier">developedAlphabet</span></a></a><span> </span><a name="local-6989586621679181070"><a href="#local-6989586621679181070"><span class="hs-identifier">inMeta</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-201"></a><span>            </span><a href="Bio.Metadata.Parsed.html#ParsedCharacterMetadata"><span class="hs-identifier hs-var">ParsedCharacterMetadata</span></a><span>
</span><a name="line-202"></a><span>            </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">alphabet</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679181069"><span class="hs-identifier hs-var">developedAlphabet</span></a><span>
</span><a name="line-203"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">characterName</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Nex</span><span class="hs-operator">.</span><span class="hs-identifier">name</span><span> </span><a href="#local-6989586621679181070"><span class="hs-identifier hs-var">inMeta</span></a><span>
</span><a name="line-204"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">weight</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromRational</span><span> </span><a href="#local-6989586621679181072"><span class="hs-identifier hs-var">chosenWeight</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621679181071"><span class="hs-identifier hs-var">suppliedWeight</span></a><span>
</span><a name="line-205"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">parsedTCM</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679181073"><span class="hs-identifier hs-var">chosenTCM</span></a><span>
</span><a name="line-206"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isDynamic</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">Nex</span><span class="hs-operator">.</span><span class="hs-identifier">isAligned</span><span> </span><a href="#local-6989586621679181070"><span class="hs-identifier hs-var">inMeta</span></a><span> </span><span>
</span><a name="line-207"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isIgnored</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Nex</span><span class="hs-operator">.</span><span class="hs-identifier">ignored</span><span> </span><a href="#local-6989586621679181070"><span class="hs-identifier hs-var">inMeta</span></a><span>
</span><a name="line-208"></a><span>            </span><span class="hs-special">}</span><span>
</span><a name="line-209"></a><span>          </span><span class="hs-keyword">where</span><span>
</span><a name="line-210"></a><span>            </span><a name="local-6989586621679181071"><a href="#local-6989586621679181071"><span class="hs-identifier">suppliedWeight</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">Nex</span><span class="hs-operator">.</span><span class="hs-identifier">weight</span><span> </span><a href="#local-6989586621679181070"><span class="hs-identifier hs-var">inMeta</span></a><span>
</span><a name="line-211"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621679181072"><a href="#local-6989586621679181072"><span class="hs-identifier">chosenWeight</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679181073"><a href="#local-6989586621679181073"><span class="hs-identifier">chosenTCM</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-212"></a><span>              </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">Nex</span><span class="hs-operator">.</span><span class="hs-identifier">additive</span><span> </span><a href="#local-6989586621679181070"><span class="hs-identifier hs-var">inMeta</span></a><span>
</span><a name="line-213"></a><span>              </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Data.TCM.Internal.html#generate"><span class="hs-identifier hs-var">TCM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">generate</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">Nex</span><span class="hs-operator">.</span><span class="hs-identifier">alphabet</span><span> </span><a href="#local-6989586621679181070"><span class="hs-identifier hs-var">inMeta</span></a><span class="hs-special">)</span><span> </span><a href="Bio.Metadata.Parsed.html#genAdditive"><span class="hs-identifier hs-var">genAdditive</span></a><span class="hs-special">,</span><span> </span><a href="Data.TCM.Internal.html#Additive"><span class="hs-identifier hs-var">Additive</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-214"></a><span>              </span><span class="hs-keyword">else</span><span>
</span><a name="line-215"></a><span>                </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">Nex</span><span class="hs-operator">.</span><span class="hs-identifier">costM</span><span> </span><a href="#local-6989586621679181070"><span class="hs-identifier hs-var">inMeta</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-216"></a><span>                  </span><span class="hs-identifier hs-var">Nothing</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-217"></a><span>                  </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679181074"><a href="#local-6989586621679181074"><span class="hs-identifier">vals</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-218"></a><span>                    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679181075"><a href="#local-6989586621679181075"><span class="hs-identifier">rationalWeight</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679181076"><a href="#local-6989586621679181076"><span class="hs-identifier">unfactoredTcm</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Data.TCM.Internal.html#fromList"><span class="hs-identifier hs-var">TCM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">F</span><span class="hs-operator">.</span><span class="hs-identifier">transitionCosts</span><span> </span><a href="#local-6989586621679181074"><span class="hs-identifier hs-var">vals</span></a><span>
</span><a name="line-219"></a><span>                        </span><span class="hs-special">(</span><a name="local-6989586621679181077"><a href="#local-6989586621679181077"><span class="hs-identifier">coefficient</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679181078"><a href="#local-6989586621679181078"><span class="hs-identifier">resultTCM</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679181079"><a href="#local-6989586621679181079"><span class="hs-identifier">structure</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier">factoredWeight</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier">factoredTcm</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier">tcmStructure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.TCM.Internal.html#diagnoseTcm"><span class="hs-identifier hs-var">diagnoseTcm</span></a><span> </span><a href="#local-6989586621679181076"><span class="hs-identifier hs-var">unfactoredTcm</span></a><span>
</span><a name="line-220"></a><span>                    </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679181077"><span class="hs-identifier hs-var">coefficient</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621679181075"><span class="hs-identifier hs-var">rationalWeight</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679181078"><span class="hs-identifier hs-var">resultTCM</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679181079"><span class="hs-identifier hs-var">structure</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-221"></a><span>
</span><a name="line-222"></a><span>
</span><a name="line-223"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-224"></a><span class="hs-comment">-- Adds case insensitive values to a 'String'.</span><span>
</span><a name="line-225"></a><span class="hs-identifier">addOtherCases</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-226"></a><a name="addOtherCases"><a href="Bio.Metadata.Parsed.html#addOtherCases"><span class="hs-identifier">addOtherCases</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-227"></a><span class="hs-identifier">addOtherCases</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679181108"><a href="#local-6989586621679181108"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679181109"><a href="#local-6989586621679181109"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-228"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isLower</span><span> </span><a href="#local-6989586621679181108"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">toUpper</span><span> </span><a href="#local-6989586621679181108"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">notElem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679181109"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toUpper</span><span> </span><a href="#local-6989586621679181108"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679181108"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="Bio.Metadata.Parsed.html#addOtherCases"><span class="hs-identifier hs-var">addOtherCases</span></a><span> </span><a href="#local-6989586621679181109"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-229"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isUpper</span><span> </span><a href="#local-6989586621679181108"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">toLower</span><span> </span><a href="#local-6989586621679181108"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">notElem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679181109"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679181108"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">toLower</span><span> </span><a href="#local-6989586621679181108"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="Bio.Metadata.Parsed.html#addOtherCases"><span class="hs-identifier hs-var">addOtherCases</span></a><span> </span><a href="#local-6989586621679181109"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-230"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679181108"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="Bio.Metadata.Parsed.html#addOtherCases"><span class="hs-identifier hs-var">addOtherCases</span></a><span> </span><a href="#local-6989586621679181109"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-231"></a><span>
</span><a name="line-232"></a><span>
</span><a name="line-233"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-234"></a><span class="hs-comment">-- Internal function to create alphabets</span><span>
</span><a name="line-235"></a><span class="hs-comment">-- First is the new version. Following is the old version, which looks like it tosses the accumulator every once in a while.</span><span>
</span><a name="line-236"></a><span class="hs-comment">-- Notes on data types follow</span><span>
</span><a name="line-237"></a><span class="hs-comment">-- TreeChars :: Map String Maybe Vector [String]</span><span>
</span><a name="line-238"></a><span class="hs-comment">-- bases are ambiguous, possibly multi-Char containers, hence [String]</span><span>
</span><a name="line-239"></a><span class="hs-comment">-- characters are ordered groups of bases, hence Vector [String]</span><span>
</span><a name="line-240"></a><span class="hs-comment">-- characters may be missing, hence Maybe Vector [String]</span><span>
</span><a name="line-241"></a><span class="hs-comment">-- each taxon may have a sequence (multiple characters), hence Vector Maybe Vector [String]</span><span>
</span><a name="line-242"></a><span class="hs-comment">-- sequences are values mapped to using taxon names as keys, hence Map String Vector Maybe Vector [String]</span><span>
</span><a name="line-243"></a><span class="hs-identifier">developAlphabets</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Bio.Character.Parsed.Internal.html#TaxonCharacters"><span class="hs-identifier hs-type">TaxonCharacters</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-special">(</span><a href="Data.Alphabet.Internal.html#Alphabet"><span class="hs-identifier hs-type">Alphabet</span></a><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span>
</span><a name="line-244"></a><a name="developAlphabets"><a href="Bio.Metadata.Parsed.html#developAlphabets"><span class="hs-identifier">developAlphabets</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="Data.Alphabet.Internal.html#fromSymbols"><span class="hs-identifier hs-var">fromSymbols</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">foldMap</span><span> </span><a href="#local-6989586621679181453"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">transpose</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">toList</span><span>
</span><a name="line-245"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-246"></a><span>    </span><a name="local-6989586621679181453"><a href="#local-6989586621679181453"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Bio.Character.Parsed.Internal.html#ParsedContinuousCharacter"><span class="hs-identifier hs-var">ParsedContinuousCharacter</span></a><span>     </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-247"></a><span>    </span><span class="hs-identifier">f</span><span> </span><span class="hs-special">(</span><a href="Bio.Character.Parsed.Internal.html#ParsedDiscreteCharacter"><span class="hs-identifier hs-var">ParsedDiscreteCharacter</span></a><span>  </span><a name="local-6989586621679181454"><a href="#local-6989586621679181454"><span class="hs-identifier">static</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldMap</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621679181454"><span class="hs-identifier hs-var">static</span></a><span>
</span><a name="line-248"></a><span>    </span><span class="hs-identifier">f</span><span> </span><span class="hs-special">(</span><a href="Bio.Character.Parsed.Internal.html#ParsedDynamicCharacter"><span class="hs-identifier hs-var">ParsedDynamicCharacter</span></a><span>  </span><a name="local-6989586621679181455"><a href="#local-6989586621679181455"><span class="hs-identifier">dynamic</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldMap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldMap</span><span> </span><span class="hs-identifier hs-var">toList</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679181455"><span class="hs-identifier hs-var">dynamic</span></a><span>
</span><a name="line-249"></a><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span class="hs-comment">-- Alphabet values.</span><span>
</span><a name="line-252"></a><span class="hs-comment">-- TODO: Probably move to Data.Alphabet.Default at some point</span><span>
</span><a name="line-253"></a><span>
</span><a name="line-254"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-255"></a><span class="hs-comment">-- The acceptable amino acid/protein character values (with IUPAC codes).</span><span>
</span><a name="line-256"></a><span class="hs-identifier">aaAlph</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-257"></a><a name="aaAlph"><a href="Bio.Metadata.Parsed.html#aaAlph"><span class="hs-identifier">aaAlph</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Bio.Metadata.Parsed.html#addOtherCases"><span class="hs-identifier hs-var">addOtherCases</span></a><span> </span><span class="hs-string">&quot;ABCDEFGHIKLMNPQRSTVWXYZ-&quot;</span><span>
</span><a name="line-258"></a><span>
</span><a name="line-259"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-260"></a><span class="hs-comment">-- The acceptable discrete character values.</span><span>
</span><a name="line-261"></a><span class="hs-identifier">disAlph</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-262"></a><a name="disAlph"><a href="Bio.Metadata.Parsed.html#disAlph"><span class="hs-identifier">disAlph</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-char">'0'</span><span class="hs-glyph">..</span><span class="hs-char">'9'</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-char">'A'</span><span class="hs-glyph">..</span><span class="hs-char">'Z'</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-char">'a'</span><span class="hs-glyph">..</span><span class="hs-char">'z'</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;-&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;?&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-263"></a><span>
</span><a name="line-264"></a><span>
</span><a name="line-265"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-266"></a><span class="hs-comment">-- The acceptable DNA character values (with IUPAC codes).</span><span>
</span><a name="line-267"></a><span class="hs-identifier">dnaAlph</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-268"></a><a name="dnaAlph"><a href="Bio.Metadata.Parsed.html#dnaAlph"><span class="hs-identifier">dnaAlph</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Bio.Metadata.Parsed.html#addOtherCases"><span class="hs-identifier hs-var">addOtherCases</span></a><span> </span><span class="hs-string">&quot;AGCTRMWSKTVDHBNX?-&quot;</span><span>
</span><a name="line-269"></a><span>
</span><a name="line-270"></a><span>
</span><a name="line-271"></a><span class="hs-comment">{-
-- |
-- The acceptable RNA character values (with IUPAC codes).
-- rnaAlph :: Vector String
-- rnaAlph = V.fromList $ pure &lt;$&gt; addOtherCases &quot;AGCURMWSKTVDHBNX?-&quot;
-}</span><span>
</span><a name="line-277"></a><span>
</span><a name="line-278"></a><span>
</span><a name="line-279"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-280"></a><span class="hs-comment">-- Functionality to make char info from tree seqs</span><span>
</span><a name="line-281"></a><span class="hs-identifier">makeEncodeInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Bio.Character.Parsed.Internal.html#TaxonCharacters"><span class="hs-identifier hs-type">TaxonCharacters</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="Bio.Metadata.Parsed.html#ParsedCharacterMetadata"><span class="hs-identifier hs-type">ParsedCharacterMetadata</span></a><span>
</span><a name="line-282"></a><a name="makeEncodeInfo"><a href="Bio.Metadata.Parsed.html#makeEncodeInfo"><span class="hs-identifier">makeEncodeInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Bio.Metadata.Parsed.html#makeOneInfo"><span class="hs-identifier hs-var">makeOneInfo</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Bio.Metadata.Parsed.html#developAlphabets"><span class="hs-identifier hs-var">developAlphabets</span></a><span>
</span><a name="line-283"></a><span>
</span><a name="line-284"></a><span>
</span><a name="line-285"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-286"></a><span class="hs-comment">-- Make a single info given an alphabet without state names</span><span>
</span><a name="line-287"></a><span class="hs-identifier">makeOneInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Alphabet.Internal.html#Alphabet"><span class="hs-identifier hs-type">Alphabet</span></a><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Bio.Metadata.Parsed.html#ParsedCharacterMetadata"><span class="hs-identifier hs-type">ParsedCharacterMetadata</span></a><span>
</span><a name="line-288"></a><a name="makeOneInfo"><a href="Bio.Metadata.Parsed.html#makeOneInfo"><span class="hs-identifier">makeOneInfo</span></a></a><span> </span><a name="local-6989586621679181456"><a href="#local-6989586621679181456"><span class="hs-identifier">alph</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-289"></a><span>    </span><a href="Bio.Metadata.Parsed.html#ParsedCharacterMetadata"><span class="hs-identifier hs-var">ParsedCharacterMetadata</span></a><span>
</span><a name="line-290"></a><span>    </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">alphabet</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679181456"><span class="hs-identifier hs-var">alph</span></a><span>
</span><a name="line-291"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">characterName</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-292"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">weight</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-293"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">parsedTCM</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span>
</span><a name="line-294"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isDynamic</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-295"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isIgnored</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-296"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-297"></a><span>
</span><a name="line-298"></a><span>
</span><a name="line-299"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-300"></a><span class="hs-comment">-- Generate the norm metric function.</span><span>
</span><a name="line-301"></a><span class="hs-identifier">genAdditive</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-302"></a><a name="genAdditive"><a href="Bio.Metadata.Parsed.html#genAdditive"><span class="hs-identifier">genAdditive</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679181457"><a href="#local-6989586621679181457"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679181458"><a href="#local-6989586621679181458"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">max</span><span> </span><a href="#local-6989586621679181457"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679181458"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">min</span><span> </span><a href="#local-6989586621679181457"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679181458"><span class="hs-identifier hs-var">j</span></a><span>
</span><a name="line-303"></a><span>
</span><a name="line-304"></a><span>
</span><a name="line-305"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-306"></a><span class="hs-comment">-- Generate the discrete metric function.</span><span>
</span><a name="line-307"></a><span class="hs-identifier">genFitch</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-308"></a><a name="genFitch"><a href="Bio.Metadata.Parsed.html#genFitch"><span class="hs-identifier">genFitch</span></a></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679181459"><a href="#local-6989586621679181459"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><a name="local-6989586621679181460"><a href="#local-6989586621679181460"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679181459"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679181460"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-309"></a><span>
</span><a name="line-310"></a></pre></body></html>