<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-2"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-3"></a><span class="hs-comment">-- Module      :  Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Ukkonen.Internal</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- Copyright   :  (c) 2015-2015 Ward Wheeler</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- License     :  BSD-style</span><span>
</span><a name="line-6"></a><span class="hs-comment">--</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- Maintainer  :  wheeler@amnh.org</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- Stability   :  provisional</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- Portability :  portable</span><span>
</span><a name="line-10"></a><span class="hs-comment">--</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- Direct optimization functionality for binary trees.</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- Implement's Ukkonen's space &amp; time saving algorithm.</span><span>
</span><a name="line-13"></a><span class="hs-comment">--</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- Allocates a &quot;ribbon&quot; down the diagonal of the matrix rather than the entire matrix.</span><span>
</span><a name="line-15"></a><span class="hs-comment">--</span><span>
</span><a name="line-16"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-17"></a><span class="hs-pragma">{-# LANGUAGE ConstraintKinds, DeriveFoldable, DeriveFunctor, FlexibleContexts, TypeFamilies #-}</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Analysis</span><span class="hs-operator">.</span><span class="hs-identifier">Parsimony</span><span class="hs-operator">.</span><span class="hs-identifier">Dynamic</span><span class="hs-operator">.</span><span class="hs-identifier">DirectOptimization</span><span class="hs-operator">.</span><span class="hs-identifier">Pairwise</span><span class="hs-operator">.</span><span class="hs-identifier">Ukkonen</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span><span>
</span><a name="line-20"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Ukkonen.Internal.html#UkkonenMethodMatrix"><span class="hs-identifier hs-type">UkkonenMethodMatrix</span></a><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-21"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Ukkonen.Internal.html#createUkkonenMethodMatrix"><span class="hs-identifier hs-var">createUkkonenMethodMatrix</span></a><span>
</span><a name="line-22"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Ukkonen.Internal.html#ukkonenDO"><span class="hs-identifier hs-var">ukkonenDO</span></a><span>
</span><a name="line-23"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span>           </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Internal.html"><span class="hs-identifier">Analysis</span><span class="hs-operator">.</span><span class="hs-identifier">Parsimony</span><span class="hs-operator">.</span><span class="hs-identifier">Dynamic</span><span class="hs-operator">.</span><span class="hs-identifier">DirectOptimization</span><span class="hs-operator">.</span><span class="hs-identifier">Pairwise</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span>           </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.NeedlemanWunsch.html"><span class="hs-identifier">Analysis</span><span class="hs-operator">.</span><span class="hs-identifier">Parsimony</span><span class="hs-operator">.</span><span class="hs-identifier">Dynamic</span><span class="hs-operator">.</span><span class="hs-identifier">DirectOptimization</span><span class="hs-operator">.</span><span class="hs-identifier">Pairwise</span><span class="hs-operator">.</span><span class="hs-identifier">NeedlemanWunsch</span></a><span>          </span><span class="hs-special">(</span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.NeedlemanWunsch.html#naiveDOMemo"><span class="hs-identifier hs-var">naiveDOMemo</span></a><span class="hs-special">)</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span>           </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Ukkonen.Ribbon.html"><span class="hs-identifier">Analysis</span><span class="hs-operator">.</span><span class="hs-identifier">Parsimony</span><span class="hs-operator">.</span><span class="hs-identifier">Dynamic</span><span class="hs-operator">.</span><span class="hs-identifier">DirectOptimization</span><span class="hs-operator">.</span><span class="hs-identifier">Pairwise</span><span class="hs-operator">.</span><span class="hs-identifier">Ukkonen</span><span class="hs-operator">.</span><span class="hs-identifier">Ribbon</span></a><span>           </span><span class="hs-special">(</span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Ukkonen.Ribbon.html#Ribbon"><span class="hs-identifier hs-type">Ribbon</span></a><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Ukkonen.Ribbon.html"><span class="hs-identifier">Analysis</span><span class="hs-operator">.</span><span class="hs-identifier">Parsimony</span><span class="hs-operator">.</span><span class="hs-identifier">Dynamic</span><span class="hs-operator">.</span><span class="hs-identifier">DirectOptimization</span><span class="hs-operator">.</span><span class="hs-identifier">Pairwise</span><span class="hs-operator">.</span><span class="hs-identifier">Ukkonen</span><span class="hs-operator">.</span><span class="hs-identifier">Ribbon</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Ribbon</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span>           </span><a href="Bio.Character.Encodable.html"><span class="hs-identifier">Bio</span><span class="hs-operator">.</span><span class="hs-identifier">Character</span><span class="hs-operator">.</span><span class="hs-identifier">Encodable</span></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Bits</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Foldable</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Key</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">MonoTraversable</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Vector</span><span class="hs-operator">.</span><span class="hs-identifier">Instances</span><span>    </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Numeric</span><span class="hs-operator">.</span><span class="hs-identifier">Extended</span><span class="hs-operator">.</span><span class="hs-identifier">Natural</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Prelude</span><span>           </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lookup</span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-41"></a><span class="hs-comment">-- Time &amp; space saving data structure for computing only a central &quot;ribbon&quot; of</span><span>
</span><a name="line-42"></a><span class="hs-comment">-- a two dimensional matrix.</span><span>
</span><a name="line-43"></a><span class="hs-comment">--</span><span>
</span><a name="line-44"></a><span class="hs-comment">-- Allocates a &quot;ribbon&quot; down the diagonal plus an offset of the matrix rather</span><span>
</span><a name="line-45"></a><span class="hs-comment">-- than the entire matrix. The computed ribbon of the matrix is expanded until</span><span>
</span><a name="line-46"></a><span class="hs-comment">-- optimality of the the result can be guaranteed. The ribbon is expanded at most</span><span>
</span><a name="line-47"></a><span class="hs-comment">-- a logrithmic number of times in terms of the matrix dimensions.</span><span>
</span><a name="line-48"></a><span class="hs-comment">--</span><span>
</span><a name="line-49"></a><span class="hs-comment">-- Use the 'createUkkonenMethodMatrix' function to create this effcient structure.</span><span>
</span><a name="line-50"></a><span class="hs-keyword">newtype</span><span> </span><a name="UkkonenMethodMatrix"><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Ukkonen.Internal.html#UkkonenMethodMatrix"><span class="hs-identifier">UkkonenMethodMatrix</span></a></a><span> </span><a name="local-6989586621679226523"><a href="#local-6989586621679226523"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="U"><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Ukkonen.Internal.html#U"><span class="hs-identifier">U</span></a></a><span> </span><span class="hs-special">(</span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Ukkonen.Ribbon.html#Ribbon"><span class="hs-identifier hs-type">Ribbon</span></a><span> </span><a href="#local-6989586621679226523"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-51"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Foldable</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Functor</span><span class="hs-special">)</span><span> </span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Key</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Ukkonen.Internal.html#UkkonenMethodMatrix"><span class="hs-identifier hs-type">UkkonenMethodMatrix</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Indexable</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Ukkonen.Internal.html#UkkonenMethodMatrix"><span class="hs-identifier hs-type">UkkonenMethodMatrix</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span>    </span><a name="local-8214565720323802455"><span class="hs-identifier">index</span></a><span> </span><span class="hs-special">(</span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Ukkonen.Internal.html#U"><span class="hs-identifier hs-var">U</span></a><span> </span><a name="local-6989586621679226526"><a href="#local-6989586621679226526"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679226527"><a href="#local-6989586621679226527"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226526"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-glyph">!</span><span> </span><a href="#local-6989586621679226527"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span>
</span><a name="line-62"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Lookup</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Ukkonen.Internal.html#UkkonenMethodMatrix"><span class="hs-identifier hs-type">UkkonenMethodMatrix</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span>      </span><a name="local-6989586621679226524"><a href="#local-6989586621679226524"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">`</span><a name="local-8214565720323802457"><span class="hs-identifier">lookup</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Ukkonen.Internal.html#U"><span class="hs-identifier hs-var">U</span></a><span> </span><a name="local-6989586621679226525"><a href="#local-6989586621679226525"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226524"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">lookup</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679226525"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-68"></a><span class="hs-comment">-- /O( (n - m + 1 ) * log(n - m + 1) )/, /n/ &gt;= /m/</span><span>
</span><a name="line-69"></a><span class="hs-comment">--</span><span>
</span><a name="line-70"></a><span class="hs-comment">-- Compute the alignment of two dynamic characters and the median states by</span><span>
</span><a name="line-71"></a><span class="hs-comment">-- using Ukkone's string edit distance algorthim to improve space and time</span><span>
</span><a name="line-72"></a><span class="hs-comment">-- complexity.</span><span>
</span><a name="line-73"></a><span class="hs-identifier">ukkonenDO</span><span>
</span><a name="line-74"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Internal.html#DOCharConstraint"><span class="hs-identifier hs-type">DOCharConstraint</span></a><span> </span><a href="#local-6989586621679226529"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-75"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679226529"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-76"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226529"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-77"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Internal.html#OverlapFunction"><span class="hs-identifier hs-type">OverlapFunction</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Element</span><span> </span><a href="#local-6989586621679226529"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Word</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679226529"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679226529"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679226529"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679226529"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-79"></a><a name="ukkonenDO"><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Ukkonen.Internal.html#ukkonenDO"><span class="hs-identifier">ukkonenDO</span></a></a><span> </span><a name="local-6989586621679226530"><a href="#local-6989586621679226530"><span class="hs-identifier">char1</span></a></a><span> </span><a name="local-6989586621679226531"><a href="#local-6989586621679226531"><span class="hs-identifier">char2</span></a></a><span> </span><a name="local-6989586621679226532"><a href="#local-6989586621679226532"><span class="hs-identifier">overlapFunction</span></a></a><span>
</span><a name="line-80"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679226535"><span class="hs-identifier hs-var">noGainFromUkkonenMethod</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.NeedlemanWunsch.html#naiveDOMemo"><span class="hs-identifier hs-var">naiveDOMemo</span></a><span> </span><a href="#local-6989586621679226530"><span class="hs-identifier hs-var">char1</span></a><span> </span><a href="#local-6989586621679226531"><span class="hs-identifier hs-var">char2</span></a><span> </span><a href="#local-6989586621679226532"><span class="hs-identifier hs-var">overlapFunction</span></a><span>
</span><a name="line-81"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Internal.html#directOptimization"><span class="hs-identifier hs-var">directOptimization</span></a><span> </span><a href="#local-6989586621679226530"><span class="hs-identifier hs-var">char1</span></a><span> </span><a href="#local-6989586621679226531"><span class="hs-identifier hs-var">char2</span></a><span> </span><a href="#local-6989586621679226532"><span class="hs-identifier hs-var">overlapFunction</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Ukkonen.Internal.html#createUkkonenMethodMatrix"><span class="hs-identifier hs-var">createUkkonenMethodMatrix</span></a><span> </span><a href="#local-6989586621679226536"><span class="hs-identifier hs-var">coefficient</span></a><span>
</span><a name="line-82"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-83"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679226533"><a href="#local-6989586621679226533"><span class="hs-identifier">longer</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679226534"><a href="#local-6989586621679226534"><span class="hs-identifier">lesser</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Internal.html#measureCharacters"><span class="hs-identifier hs-var">measureCharacters</span></a><span> </span><a href="#local-6989586621679226530"><span class="hs-identifier hs-var">char1</span></a><span> </span><a href="#local-6989586621679226531"><span class="hs-identifier hs-var">char2</span></a><span>
</span><a name="line-84"></a><span>    </span><span>
</span><a name="line-85"></a><span>    </span><span class="hs-comment">-- If the longer character is 50% larger than the shorter character then</span><span>
</span><a name="line-86"></a><span>    </span><span class="hs-comment">-- there is no point in using the barriers. Rather, we fill the full matrix</span><span>
</span><a name="line-87"></a><span>    </span><span class="hs-comment">-- immediately.</span><span>
</span><a name="line-88"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-89"></a><span>    </span><span class="hs-comment">-- Additionally, if the shorter sequence is of length 4 or less, then the</span><span>
</span><a name="line-90"></a><span>    </span><span class="hs-comment">-- inital barrier will be set at a adjacent to or beyond the lower left and</span><span>
</span><a name="line-91"></a><span>    </span><span class="hs-comment">-- upper right corners.</span><span>
</span><a name="line-92"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-93"></a><span>    </span><span class="hs-comment">-- Lastly, a threshhold coeffcient is computed as the minimal indel cost from</span><span>
</span><a name="line-94"></a><span>    </span><span class="hs-comment">-- any symbol in the alphabet to gap. However, if the indel cost for any</span><span>
</span><a name="line-95"></a><span>    </span><span class="hs-comment">-- symbol is zero, the algorithm will hang and a naive approach must be taken.</span><span>
</span><a name="line-96"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-97"></a><span>    </span><span class="hs-comment">-- Do not perform Ukkonen's algorithm if and only if:</span><span>
</span><a name="line-98"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-99"></a><span>    </span><span class="hs-comment">-- &gt; longerLen &gt;= 1.5 * lesserLen</span><span>
</span><a name="line-100"></a><span>    </span><span class="hs-comment">--     OR</span><span>
</span><a name="line-101"></a><span>    </span><span class="hs-comment">-- &gt; lesserLen &lt;= 4</span><span>
</span><a name="line-102"></a><span>    </span><span class="hs-comment">--     OR</span><span>
</span><a name="line-103"></a><span>    </span><span class="hs-comment">-- &gt; coefficient == 0</span><span>
</span><a name="line-104"></a><span>    </span><a name="local-6989586621679226535"><a href="#local-6989586621679226535"><span class="hs-identifier">noGainFromUkkonenMethod</span></a></a><span> </span><span class="hs-glyph">=</span><span>     </span><a href="#local-6989586621679226538"><span class="hs-identifier hs-var">lesserLen</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">4</span><span>
</span><a name="line-105"></a><span>                           </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621679226537"><span class="hs-identifier hs-var">longerLen</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">3</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621679226538"><span class="hs-identifier hs-var">lesserLen</span></a><span>
</span><a name="line-106"></a><span>                           </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679226536"><span class="hs-identifier hs-var">coefficient</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-107"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-108"></a><span>        </span><a name="local-6989586621679226537"><a href="#local-6989586621679226537"><span class="hs-identifier">longerLen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">olength</span><span> </span><a href="#local-6989586621679226533"><span class="hs-identifier hs-var">longer</span></a><span>
</span><a name="line-109"></a><span>        </span><a name="local-6989586621679226538"><a href="#local-6989586621679226538"><span class="hs-identifier">lesserLen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">olength</span><span> </span><a href="#local-6989586621679226534"><span class="hs-identifier hs-var">lesser</span></a><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span>    </span><span class="hs-comment">-- /O(2*(a - 1))/</span><span>
</span><a name="line-112"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-113"></a><span>    </span><span class="hs-comment">-- This was taken from Ukkonen's original 1985 paper where the coeffcient</span><span>
</span><a name="line-114"></a><span>    </span><span class="hs-comment">-- delta @(&#916;)@ was defined by the minimum transition cost from any symbol in</span><span>
</span><a name="line-115"></a><span>    </span><span class="hs-comment">-- the alphabet @(&#931;)@ to the gap symbol @'-'@.</span><span>
</span><a name="line-116"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-117"></a><span>    </span><span class="hs-comment">-- If there is any transition to gap from a non-gap for which the cost is</span><span>
</span><a name="line-118"></a><span>    </span><span class="hs-comment">-- zero, then this coeffcient will be zero. This leaves us with no way to</span><span>
</span><a name="line-119"></a><span>    </span><span class="hs-comment">-- determine if optimality is preserved, and the Ukkonen algorithm will hang.</span><span>
</span><a name="line-120"></a><span>    </span><span class="hs-comment">-- Consequently, we do not perform Ukkonen's algorithm if the coefficient is</span><span>
</span><a name="line-121"></a><span>    </span><span class="hs-comment">-- zero.</span><span>
</span><a name="line-122"></a><span>    </span><a name="local-6989586621679226536"><a href="#local-6989586621679226536"><span class="hs-identifier">coefficient</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">minimum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679226542"><span class="hs-identifier hs-var">indelCost</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679226541"><span class="hs-identifier hs-var">nonGapElements</span></a><span>
</span><a name="line-123"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-124"></a><span>        </span><a name="local-6989586621679226539"><a href="#local-6989586621679226539"><span class="hs-identifier">gap</span></a></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Bio.Character.Encodable.Stream.html#gapOfStream"><span class="hs-identifier hs-var">gapOfStream</span></a><span> </span><a href="#local-6989586621679226530"><span class="hs-identifier hs-var">char1</span></a><span>
</span><a name="line-125"></a><span>        </span><a name="local-6989586621679226540"><a href="#local-6989586621679226540"><span class="hs-identifier">alphabetSize</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Bio.Character.Encodable.Internal.html#symbolCount"><span class="hs-identifier hs-var">symbolCount</span></a><span> </span><a href="#local-6989586621679226539"><span class="hs-identifier hs-var">gap</span></a><span>
</span><a name="line-126"></a><span>        </span><a name="local-6989586621679226541"><a href="#local-6989586621679226541"><span class="hs-identifier">nonGapElements</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">..</span><span> </span><a href="#local-6989586621679226540"><span class="hs-identifier hs-var">alphabetSize</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-127"></a><span>        </span><a name="local-6989586621679226542"><a href="#local-6989586621679226542"><span class="hs-identifier">indelCost</span></a></a><span> </span><a name="local-6989586621679226543"><a href="#local-6989586621679226543"><span class="hs-identifier">i</span></a></a><span>    </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier hs-var">min</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679226532"><span class="hs-identifier hs-var">overlapFunction</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">bit</span><span> </span><a href="#local-6989586621679226543"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>  </span><a href="#local-6989586621679226539"><span class="hs-identifier hs-var">gap</span></a><span>    </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-128"></a><span>                              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679226532"><span class="hs-identifier hs-var">overlapFunction</span></a><span>  </span><a href="#local-6989586621679226539"><span class="hs-identifier hs-var">gap</span></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">bit</span><span> </span><a href="#local-6989586621679226543"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-129"></a><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-132"></a><span class="hs-comment">-- /O( (n - m + 1 ) * log(n - m + 1) )/, /n/ &gt;= /m/</span><span>
</span><a name="line-133"></a><span class="hs-comment">--</span><span>
</span><a name="line-134"></a><span class="hs-comment">-- Generates an /optimal/, partially filled in matrix using Ukkonen's string</span><span>
</span><a name="line-135"></a><span class="hs-comment">-- edit distance algorithm.</span><span>
</span><a name="line-136"></a><span class="hs-comment">--</span><span>
</span><a name="line-137"></a><span class="hs-comment">-- Note that the threshhold value is lowered more than described in Ukkonen's</span><span>
</span><a name="line-138"></a><span class="hs-comment">-- paper. This is to handle input elements that contain a gap. In Ukkonen's</span><span>
</span><a name="line-139"></a><span class="hs-comment">-- original description of the algorithm, there was a subtle assumption that</span><span>
</span><a name="line-140"></a><span class="hs-comment">-- input did not contain any gap symbols.</span><span>
</span><a name="line-141"></a><span class="hs-identifier">createUkkonenMethodMatrix</span><span>
</span><a name="line-142"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Internal.html#DOCharConstraint"><span class="hs-identifier hs-type">DOCharConstraint</span></a><span> </span><a href="#local-6989586621679226528"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-143"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Word</span><span>                        </span><span class="hs-comment">-- ^ Coeffcient value, representing the /minimum/ transition cost from a state to gap</span><span>
</span><a name="line-144"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226528"><span class="hs-identifier hs-type">s</span></a><span>                           </span><span class="hs-comment">-- ^ Longer dynamic character</span><span>
</span><a name="line-145"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226528"><span class="hs-identifier hs-type">s</span></a><span>                           </span><span class="hs-comment">-- ^ Shorter dynamic character</span><span>
</span><a name="line-146"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Internal.html#OverlapFunction"><span class="hs-identifier hs-type">OverlapFunction</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Element</span><span> </span><a href="#local-6989586621679226528"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Function to determine the cost an median state between two other states.</span><span>
</span><a name="line-147"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Ukkonen.Internal.html#UkkonenMethodMatrix"><span class="hs-identifier hs-type">UkkonenMethodMatrix</span></a><span> </span><span class="hs-special">(</span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Internal.html#Cost"><span class="hs-identifier hs-type">Cost</span></a><span class="hs-special">,</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Internal.html#Direction"><span class="hs-identifier hs-type">Direction</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Element</span><span> </span><a href="#local-6989586621679226528"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-148"></a><a name="createUkkonenMethodMatrix"><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Ukkonen.Internal.html#createUkkonenMethodMatrix"><span class="hs-identifier">createUkkonenMethodMatrix</span></a></a><span> </span><a name="local-6989586621679226544"><a href="#local-6989586621679226544"><span class="hs-identifier">minimumIndelCost</span></a></a><span> </span><a name="local-6989586621679226545"><a href="#local-6989586621679226545"><span class="hs-identifier">longerTop</span></a></a><span> </span><a name="local-6989586621679226546"><a href="#local-6989586621679226546"><span class="hs-identifier">lesserLeft</span></a></a><span> </span><a name="local-6989586621679226547"><a href="#local-6989586621679226547"><span class="hs-identifier">overlapFunction</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Ukkonen.Internal.html#U"><span class="hs-identifier hs-var">U</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679226556"><span class="hs-identifier hs-var">ukkonenUntilOptimal</span></a><span> </span><a href="#local-6989586621679226553"><span class="hs-identifier hs-var">startOffset</span></a><span>
</span><a name="line-149"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-150"></a><span>    </span><span class="hs-comment">-- General values that need to be in scope for the recursive computations.</span><span>
</span><a name="line-151"></a><span>    </span><a name="local-6989586621679226548"><a href="#local-6989586621679226548"><span class="hs-identifier">longerLen</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">olength</span><span> </span><a href="#local-6989586621679226545"><span class="hs-identifier hs-var">longerTop</span></a><span>
</span><a name="line-152"></a><span>    </span><a name="local-6989586621679226549"><a href="#local-6989586621679226549"><span class="hs-identifier">lesserLen</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">olength</span><span> </span><a href="#local-6989586621679226546"><span class="hs-identifier hs-var">lesserLeft</span></a><span>
</span><a name="line-153"></a><span>    </span><a name="local-6989586621679226550"><a href="#local-6989586621679226550"><span class="hs-identifier">coefficient</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679226544"><span class="hs-identifier hs-var">minimumIndelCost</span></a><span>
</span><a name="line-154"></a><span>    </span><a name="local-6989586621679226551"><a href="#local-6989586621679226551"><span class="hs-identifier">rows</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toEnum</span><span> </span><a href="#local-6989586621679226549"><span class="hs-identifier hs-var">lesserLen</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-155"></a><span>    </span><a name="local-6989586621679226552"><a href="#local-6989586621679226552"><span class="hs-identifier">cols</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toEnum</span><span> </span><a href="#local-6989586621679226548"><span class="hs-identifier hs-var">longerLen</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-156"></a><span>    </span><span>
</span><a name="line-157"></a><span>    </span><span class="hs-comment">-- We start the offset at two rather than at one so that the first doubling</span><span>
</span><a name="line-158"></a><span>    </span><span class="hs-comment">-- isn't trivially small.</span><span>
</span><a name="line-159"></a><span>    </span><a name="local-6989586621679226553"><a href="#local-6989586621679226553"><span class="hs-identifier">startOffset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-160"></a><span>
</span><a name="line-161"></a><span>    </span><span class="hs-comment">-- /O(1)/</span><span>
</span><a name="line-162"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-163"></a><span>    </span><span class="hs-comment">-- Necessary to compute the width of a row in the barrier constrained matrix.</span><span>
</span><a name="line-164"></a><span>    </span><a name="local-6989586621679226554"><a href="#local-6989586621679226554"><span class="hs-identifier">quasiDiagonalWidth</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226557"><span class="hs-identifier hs-var">differenceInLength</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-165"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-166"></a><span>        </span><a name="local-6989586621679226557"><a href="#local-6989586621679226557"><span class="hs-identifier">differenceInLength</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226548"><span class="hs-identifier hs-var">longerLen</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679226549"><span class="hs-identifier hs-var">lesserLen</span></a><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span>    </span><span class="hs-comment">-- /O(n + m)/</span><span>
</span><a name="line-169"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-170"></a><span>    </span><span class="hs-comment">-- This is important to decrement the threshhold value to account for</span><span>
</span><a name="line-171"></a><span>    </span><span class="hs-comment">-- diagonal directions in the matrix having an &quot;indel&quot; cost because one or</span><span>
</span><a name="line-172"></a><span>    </span><span class="hs-comment">-- more of the aligned character elements contained a gap. This was not</span><span>
</span><a name="line-173"></a><span>    </span><span class="hs-comment">-- described in Ukkonen's original paper as the inputs were assumed to not</span><span>
</span><a name="line-174"></a><span>    </span><span class="hs-comment">-- contain any gaps.</span><span>
</span><a name="line-175"></a><span>    </span><a name="local-6989586621679226555"><a href="#local-6989586621679226555"><span class="hs-identifier">gapsPresentInInputs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226558"><span class="hs-identifier hs-var">longerGaps</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679226559"><span class="hs-identifier hs-var">lesserGaps</span></a><span>
</span><a name="line-176"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-177"></a><span>        </span><a name="local-6989586621679226558"><a href="#local-6989586621679226558"><span class="hs-identifier">longerGaps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226560"><span class="hs-identifier hs-var">countGaps</span></a><span> </span><a href="#local-6989586621679226545"><span class="hs-identifier hs-var">longerTop</span></a><span>
</span><a name="line-178"></a><span>        </span><a name="local-6989586621679226559"><a href="#local-6989586621679226559"><span class="hs-identifier">lesserGaps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226560"><span class="hs-identifier hs-var">countGaps</span></a><span> </span><a href="#local-6989586621679226546"><span class="hs-identifier hs-var">lesserLeft</span></a><span>
</span><a name="line-179"></a><span>        </span><a name="local-6989586621679226560"><a href="#local-6989586621679226560"><span class="hs-identifier">countGaps</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679226562"><a href="#local-6989586621679226562"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679226562"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><a href="#local-6989586621679226561"><span class="hs-identifier hs-var">gap</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-identifier hs-var">zeroBits</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">otoList</span><span>
</span><a name="line-180"></a><span>        </span><a name="local-6989586621679226561"><a href="#local-6989586621679226561"><span class="hs-identifier">gap</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Bio.Character.Encodable.Stream.html#gapOfStream"><span class="hs-identifier hs-var">gapOfStream</span></a><span> </span><a href="#local-6989586621679226545"><span class="hs-identifier hs-var">longerTop</span></a><span>
</span><a name="line-181"></a><span>
</span><a name="line-182"></a><span>    </span><a name="local-6989586621679226556"><a href="#local-6989586621679226556"><span class="hs-identifier">ukkonenUntilOptimal</span></a></a><span> </span><a name="local-6989586621679226563"><a href="#local-6989586621679226563"><span class="hs-identifier">offset</span></a></a><span>
</span><a name="line-183"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679226569"><span class="hs-identifier hs-var">threshhold</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="#local-6989586621679226567"><span class="hs-identifier hs-var">alignmentCost</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226556"><span class="hs-identifier hs-var">ukkonenUntilOptimal</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621679226563"><span class="hs-identifier hs-var">offset</span></a><span>
</span><a name="line-184"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226564"><span class="hs-identifier hs-var">ukkonenMatrix</span></a><span>
</span><a name="line-185"></a><span class="hs-comment">--      | otherwise                   = trace (renderedBounds &lt;&gt; renderedMatrix) ukkonenMatrix</span><span>
</span><a name="line-186"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-187"></a><span>        </span><a name="local-6989586621679226564"><a href="#local-6989586621679226564"><span class="hs-identifier">ukkonenMatrix</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Ukkonen.Ribbon.html#generate"><span class="hs-identifier hs-var">Ribbon</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">generate</span></a><span> </span><a href="#local-6989586621679226551"><span class="hs-identifier hs-var">rows</span></a><span> </span><a href="#local-6989586621679226552"><span class="hs-identifier hs-var">cols</span></a><span> </span><a href="#local-6989586621679226565"><span class="hs-identifier hs-var">generatingFunction</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">toEnum</span><span> </span><a href="#local-6989586621679226563"><span class="hs-identifier hs-var">offset</span></a><span>
</span><a name="line-188"></a><span>        </span><a name="local-6989586621679226565"><a href="#local-6989586621679226565"><span class="hs-identifier">generatingFunction</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Analysis.Parsimony.Dynamic.DirectOptimization.Pairwise.Internal.html#needlemanWunschDefinition"><span class="hs-identifier hs-var">needlemanWunschDefinition</span></a><span> </span><a href="#local-6989586621679226545"><span class="hs-identifier hs-var">longerTop</span></a><span> </span><a href="#local-6989586621679226546"><span class="hs-identifier hs-var">lesserLeft</span></a><span> </span><a href="#local-6989586621679226547"><span class="hs-identifier hs-var">overlapFunction</span></a><span> </span><a href="#local-6989586621679226564"><span class="hs-identifier hs-var">ukkonenMatrix</span></a><span>
</span><a name="line-189"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679226566"><a href="#local-6989586621679226566"><span class="hs-identifier">cost</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226564"><span class="hs-identifier hs-var">ukkonenMatrix</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679226549"><span class="hs-identifier hs-var">lesserLen</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679226548"><span class="hs-identifier hs-var">longerLen</span></a><span class="hs-special">)</span><span>
</span><a name="line-190"></a><span>        </span><a name="local-6989586621679226567"><a href="#local-6989586621679226567"><span class="hs-identifier">alignmentCost</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unsafeToFinite</span><span> </span><a href="#local-6989586621679226566"><span class="hs-identifier hs-var">cost</span></a><span>
</span><a name="line-191"></a><span>        </span><a name="local-6989586621679226568"><a href="#local-6989586621679226568"><span class="hs-identifier">computedValue</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679226550"><span class="hs-identifier hs-var">coefficient</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679226554"><span class="hs-identifier hs-var">quasiDiagonalWidth</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679226563"><span class="hs-identifier hs-var">offset</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679226555"><span class="hs-identifier hs-var">gapsPresentInInputs</span></a><span class="hs-special">)</span><span>
</span><a name="line-192"></a><span>        </span><a name="local-6989586621679226569"><a href="#local-6989586621679226569"><span class="hs-identifier">threshhold</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toEnum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">max</span><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679226568"><span class="hs-identifier hs-var">computedValue</span></a><span> </span><span class="hs-comment">-- The threshhold value must be non-negative</span><span>
</span><a name="line-193"></a><span class="hs-comment">{--
        renderedMatrix = renderCostMatrix longerTop lesserLeft ukkonenMatrix

        renderedBounds = unlines
            [ &quot;Diag Width : &quot; &lt;&gt; show quasiDiagonalWidth
            , &quot;Input Gaps : &quot; &lt;&gt; show gapsPresentInInputs
            , &quot;Offset     : &quot; &lt;&gt; show offset
            , &quot;Coefficient: &quot; &lt;&gt; show coefficient
            , &quot;Threshhold : &quot; &lt;&gt; show threshhold
            , &quot;Total Cost : &quot; &lt;&gt; show alignmentCost
            ]
--}</span><span>
</span><a name="line-205"></a><span>
</span><a name="line-206"></a></pre></body></html>